(function(x,Xe){typeof exports=="object"&&typeof module<"u"?Xe(exports,require("@mui/lab/AdapterDateFns"),require("@mui/lab/LocalizationProvider"),require("@date-io/date-fns"),require("date-fns/locale"),require("react"),require("@mui/material"),require("@emotion/react/jsx-runtime"),require("react-router-dom"),require("object-hash"),require("clsx"),require("@mui/icons-material/Error"),require("@mui/styles/createStyles"),require("@mui/styles/makeStyles"),require("@mui/styles"),require("@mui/material/InputBase"),require("@mui/material/styles"),require("@mui/icons-material/Search"),require("@mui/icons-material/Clear"),require("@mui/icons-material"),require("@mui/icons-material/Upload"),require("@uiw/react-markdown-preview"),require("@mui/icons-material/ContentPaste"),require("@mui/icons-material/OpenInNew"),require("date-fns/format"),require("@mui/icons-material/DescriptionOutlined"),require("@mui/icons-material/KeyboardTab"),require("@mui/icons-material/ArrowForward"),require("@mui/icons-material/PlaylistPlay"),require("react-base-table"),require("react-measure"),require("@mui/icons-material/Assignment"),require("@mui/icons-material/ArrowUpward"),require("@mui/icons-material/ArrowDownward"),require("@mui/icons-material/ArrowDropDownCircle"),require("@mui/material/Tooltip/Tooltip"),require("@mui/lab/DateTimePicker"),require("@mui/icons-material/CalendarToday"),require("@mui/icons-material/Menu"),require("@mui/icons-material/Brightness5"),require("@mui/icons-material/Brightness3"),require("@mui/icons-material/NavigateNext"),require("react-transition-group"),require("@mui/icons-material/Close"),require("@mui/material/Button"),require("@mui/material/Dialog"),require("@mui/material/DialogActions"),require("@mui/material/DialogContent"),require("@mui/material/DialogContentText"),require("@mui/material/DialogTitle"),require("@mui/material/colors"),require("@mui/icons-material/ErrorOutline"),require("react-fast-compare"),require("yup"),require("@mui/icons-material/Edit"),require("react-dropzone"),require("@mui/base"),require("formik"),require("@mui/icons-material/DragHandle"),require("react-beautiful-dnd"),require("@mui/icons-material/InfoOutlined"),require("@mui/icons-material/ShortText"),require("@mui/icons-material/Subject"),require("@mui/icons-material/Attachment"),require("@mui/icons-material/Crop75"),require("@mui/icons-material/List"),require("@mui/icons-material/Schedule"),require("@mui/icons-material/ListAlt"),require("@mui/icons-material/Room"),require("@mui/icons-material/ViewList"),require("@mui/icons-material/Link"),require("@mui/icons-material/Equalizer"),require("@mui/icons-material/Photo"),require("@mui/icons-material/Http"),require("@mui/icons-material/Flag"),require("@mui/icons-material/Adjust"),require("@uiw/react-md-editor"),require("@emotion/react"),require("@mui/icons-material/ArrowForwardIos"),require("@mui/icons-material/ArrowBackIosNew"),require("firebase/auth"),require("@firebase/auth"),require("firebase/firestore"),require("firebase/storage"),require("firebase/app"),require("@mui/icons-material/Email"),require("@mui/icons-material/ArrowBack"),require("@mui/icons-material/PersonOutline")):typeof define=="function"&&define.amd?define(["exports","@mui/lab/AdapterDateFns","@mui/lab/LocalizationProvider","@date-io/date-fns","date-fns/locale","react","@mui/material","@emotion/react/jsx-runtime","react-router-dom","object-hash","clsx","@mui/icons-material/Error","@mui/styles/createStyles","@mui/styles/makeStyles","@mui/styles","@mui/material/InputBase","@mui/material/styles","@mui/icons-material/Search","@mui/icons-material/Clear","@mui/icons-material","@mui/icons-material/Upload","@uiw/react-markdown-preview","@mui/icons-material/ContentPaste","@mui/icons-material/OpenInNew","date-fns/format","@mui/icons-material/DescriptionOutlined","@mui/icons-material/KeyboardTab","@mui/icons-material/ArrowForward","@mui/icons-material/PlaylistPlay","react-base-table","react-measure","@mui/icons-material/Assignment","@mui/icons-material/ArrowUpward","@mui/icons-material/ArrowDownward","@mui/icons-material/ArrowDropDownCircle","@mui/material/Tooltip/Tooltip","@mui/lab/DateTimePicker","@mui/icons-material/CalendarToday","@mui/icons-material/Menu","@mui/icons-material/Brightness5","@mui/icons-material/Brightness3","@mui/icons-material/NavigateNext","react-transition-group","@mui/icons-material/Close","@mui/material/Button","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/DialogTitle","@mui/material/colors","@mui/icons-material/ErrorOutline","react-fast-compare","yup","@mui/icons-material/Edit","react-dropzone","@mui/base","formik","@mui/icons-material/DragHandle","react-beautiful-dnd","@mui/icons-material/InfoOutlined","@mui/icons-material/ShortText","@mui/icons-material/Subject","@mui/icons-material/Attachment","@mui/icons-material/Crop75","@mui/icons-material/List","@mui/icons-material/Schedule","@mui/icons-material/ListAlt","@mui/icons-material/Room","@mui/icons-material/ViewList","@mui/icons-material/Link","@mui/icons-material/Equalizer","@mui/icons-material/Photo","@mui/icons-material/Http","@mui/icons-material/Flag","@mui/icons-material/Adjust","@uiw/react-md-editor","@emotion/react","@mui/icons-material/ArrowForwardIos","@mui/icons-material/ArrowBackIosNew","firebase/auth","@firebase/auth","firebase/firestore","firebase/storage","firebase/app","@mui/icons-material/Email","@mui/icons-material/ArrowBack","@mui/icons-material/PersonOutline"],Xe):(x=typeof globalThis<"u"?globalThis:x||self,Xe(x.FireCMS={},x.AdapterDateFns,x.LocalizationProvider,x.DateFnsUtils,x.locales,x.React,x.material,x.jsxRuntime,x.reactRouterDom,x.hash,x.clsx,x.ErrorIcon,x.createStyles,x.makeStyles,x.styles$1,x.InputBase,x.styles,x.SearchIcon,x.ClearIcon,x.iconsMaterial,x.Upload,x.MarkdownPreview,x.ContentPasteIcon,x.OpenInNewIcon,x.format,x.DescriptionOutlinedIcon,x.KeyboardTabIcon,x.ArrowForwardIcon,x.PlaylistPlayIcon,x.BaseTable,x.Measure,x.AssignmentIcon,x.ArrowUpwardIcon,x.ArrowDownwardIcon,x.ArrowDropDownCircleIcon,x.Tooltip,x.DateTimePicker,x.CalendarTodayIcon,x.MenuIcon,x.Brightness5Icon,x.Brightness3Icon,x.NavigateNextIcon,x.reactTransitionGroup,x.CloseIcon,x.Button,x.Dialog,x.DialogActions,x.DialogContent,x.DialogContentText,x.DialogTitle,x.colors,x.ErrorOutlineIcon,x.isEqual,x.yup,x.EditIcon,x.reactDropzone,x.base,x.formik,x.DragHandleIcon,x.reactBeautifulDnd,x.InfoIcon,x.ShortTextIcon,x.SubjectIcon,x.AttachmentIcon,x.Crop75Icon,x.ListIcon,x.ScheduleIcon,x.ListAltIcon,x.RoomIcon,x.ViewListIcon,x.LinkIcon,x.EqualizerIcon,x.PhotoIcon,x.HttpIcon,x.FlagIcon,x.AdjustIcon,x.MDEditor,x.react,x.ArrowForwardIosIcon,x.ArrowBackIosNewIcon,x.auth,x.auth$1,x.firestore,x.storage,x.app,x.EmailIcon,x.ArrowBackIcon,x.PersonOutlineIcon))})(this,function(x,Xe,jr,Gr,Yr,p,s,t,ce,Xr,Jr,Kr,Qr,Zr,vt,Rr,ot,en,tn,Je,on,rn,nn,an,sn,ln,cn,dn,un,yt,fn,hn,gn,pn,bn,vn,yn,wn,Cn,mn,xn,Sn,Tn,kn,_n,En,In,Bn,Pn,Fn,lo,An,$n,On,Dn,co,Ln,we,Mn,Le,Nn,qn,zn,Vn,Un,Wn,Hn,jn,Gn,Yn,Xn,Jn,Kn,Qn,Zn,Rn,ei,ti,oi,ri,te,uo,Z,Ke,ni,ii,ai,si){"use strict";function V(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function wt(e){if(e&&e.__esModule)return e;var o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(o,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}}),o.default=e,Object.freeze(o)}var li=V(Xe),ci=V(jr),di=V(Gr),fo=wt(Yr),z=V(p),se=wt(p),ho=V(Xr),he=V(Jr),Ct=V(Kr),Q=V(Qr),K=V(Zr),ui=V(Rr),fi=V(en),Be=V(tn),hi=V(on),gi=V(rn),pi=V(nn),rt=V(an),bi=V(sn),vi=V(ln),go=V(cn),yi=V(dn),wi=V(un),Ci=V(yt),po=V(fn),mi=V(hn),bo=V(gn),xi=V(pn),Si=V(bn),vo=V(vn),mt=V(yn),Ti=V(wn),ki=V(Cn),_i=V(mn),Ei=V(xn),Ii=V(Sn),Bi=V(kn),yo=V(_n),Pi=V(En),Fi=V(In),Ai=V(Bn),wo=V(Pn),$i=V(Fn),Oi=V(An),Se=V($n),Ce=wt(On),Di=V(Dn),Li=V(Mn),Mi=V(Nn),Ni=V(qn),qi=V(zn),zi=V(Vn),Vi=V(Un),Ui=V(Wn),Wi=V(Hn),Co=V(jn),Hi=V(Gn),ji=V(Yn),Gi=V(Xn),Yi=V(Jn),Xi=V(Kn),Ji=V(Qn),Ki=V(Zn),Qi=V(Rn),Zi=V(ei),Ri=V(oi),ea=V(ri),ta=V(ii),mo=V(ai),oa=V(si);const ra={isOpen:!1,close:()=>{},open:e=>{}},xt=z.default.createContext(ra),na=({children:e})=>{const[o,r]=p.useState(!1),[i,n]=p.useState(void 0),[a,l]=p.useState(void 0),[d,c]=p.useState(void 0),u=()=>{r(!1),n(void 0),l(void 0),c(void 0)},g=h=>{const{type:f,message:b,title:y}=h;c(f),l(b),n(y),r(!0)};return t.jsxs(xt.Provider,{value:{isOpen:o,close:u,open:g},children:[e,t.jsx(s.Snackbar,{open:o,autoHideDuration:3e3,onClose:h=>u(),children:t.jsxs(s.Alert,{elevation:1,variant:"filled",onClose:h=>u(),severity:d,children:[i&&t.jsx("div",{children:i}),a&&t.jsx("div",{children:a})]})})]})},xo=z.default.createContext({sideEntityController:{},navigationContext:{},dataSource:{},storageSource:{},authController:{},snackbarController:{}}),ia=({children:e,...o})=>t.jsx(xo.Provider,{value:o,children:e}),aa={breadcrumbs:[],set:e=>{}},So=z.default.createContext(aa),sa=({children:e})=>{const[o,r]=p.useState([]),i=n=>{r(n.breadcrumbs)};return t.jsx(So.Provider,{value:{breadcrumbs:o,set:i},children:e})},la={mode:"light",setMode:e=>{},toggleMode:()=>{}},St=z.default.createContext(la),ca=({children:e})=>{const o=s.useMediaQuery("(prefers-color-scheme: dark)"),i=(localStorage.getItem("prefers-dark-mode")!=null?localStorage.getItem("prefers-dark-mode")==="true":null)??o,[n,a]=p.useState(i?"dark":"light");p.useEffect(()=>{a(i?"dark":"light")},[i]);const l=()=>{n==="light"?(o?localStorage.removeItem("prefers-dark-mode"):localStorage.setItem("prefers-dark-mode","true"),a("dark")):(o?localStorage.setItem("prefers-dark-mode","false"):localStorage.removeItem("prefers-dark-mode"),a("light"))};return t.jsx(St.Provider,{value:{mode:n,setMode:a,toggleMode:l},children:e})};function le(e){return da(ua(e))}function da(e){return e.startsWith("/")?e.slice(1):e}function ua(e){return e.endsWith("/")?e.slice(0,-1):e}function fa(e,o){if(!o)return;if(le(e).split("/").length%2===0)throw Error(`Collection paths must have an odd number of segments: ${e}`);return To(le(e),o)}function To(e,o){const r=le(e).split("/"),i=ko(r);let n;for(let a=0;a<i.length;a++){const l=i[a],d=o&&o.find(c=>c.path===l);if(d){if(l===e)n=d;else if(d.subcollections){const c=e.replace(l,"").split("/").slice(2).join("/");c.length>0&&(n=To(c,d.subcollections))}}if(n)break}return n}function ko(e){const o=e.length>0&&e.length%2===0?e.splice(0,e.length-1):e,r=o.length,i=[];for(let n=r;n>0;n=n-2)i.push(o.slice(0,n).join("/"));return i}function _o(e,o){const r=e.navigation;if(!r)throw Error("You can only use `computeTopNavigation` with an initialised navigationContext");const i=[...r.collections.map(a=>({url:e.buildUrlCollectionPath(a.path),name:a.name,description:a.description,group:a.group})),...(r.views??[]).map(a=>o||!a.hideFromNavigation?{url:e.buildCMSUrlPath(Array.isArray(a.path)?a.path[0]:a.path),name:a.name,description:a.description,group:a.group}:void 0).filter(a=>!!a)],n=Array.from(new Set(Object.values(i).map(a=>a.group).filter(Boolean)).values());return{navigationEntries:i,groups:n}}function Tt(e){const{path:o,collections:r,currentFullPath:i}=e,n=le(o).split("/"),a=ko(n),l=[];for(let d=0;d<a.length;d++){const c=a[d],u=r&&r.find(g=>g.path===c);if(u){const g=i&&i.length>0?i+"/"+u.path:u.path;l.push({type:"collection",path:g,collection:u});const h=le(le(o).replace(c,"")),f=h.length>0?h.split("/"):[];if(f.length>0){const b=f[0],y=g+"/"+b;if(l.push({type:"entity",entityId:b,path:g,parentCollection:u}),f.length>1){const v=f.slice(1).join("/"),C=u.schema.views,w=C&&C.find(m=>m.path===v);if(w){const m=i&&i.length>0?i+"/"+w.path:w.path;l.push({type:"custom_view",path:m,view:w})}else u.subcollections&&l.push(...Tt({path:v,customViews:C,collections:u.subcollections,currentFullPath:y}))}}break}}return l}const Eo="new",ha=e=>{const o=ce.useLocation(),r=ce.useNavigate(),i=p.useRef(!1),[n,a]=p.useState([]),l=e.navigation?.collections,d=o.state,c=d&&d.base_location?d.base_location:o,u=p.useCallback(f=>{a(f),e.removeAllOverridesExcept(f)},[]);p.useEffect(()=>{if(e.initialised)if(o?.state&&d.panels){const f=d.panels;u(f)}else u([])},[o?.state,e.initialised]),p.useEffect(()=>{if(l&&!i.current){if(e.isUrlCollectionPath(o.pathname)){const f=o.hash===`#${Eo}`,b=e.urlPathToDataPath(o.pathname),y=ga(b,l,f);u(y)}i.current=!0}},[o,l,n]);const g=p.useCallback(()=>{if(n.length===0)return;const f=n[n.length-1],b=o?.state&&d.panels;if(b&&b.length>0)[...b.slice(0,-1)],r(-1);else{const y=e.buildUrlCollectionPath(f.path);r(y,{replace:!0})}},[n,o]),h=p.useCallback(({path:f,entityId:b,selectedSubpath:y,copy:v,width:C,...w})=>{if(v&&!b)throw Error("If you want to copy an entity you need to provide an entityId");if(w&&(w.schema!==void 0||w.permissions!==void 0||w.subcollections!==void 0)){const _=w.permissions,I=w.schema,A=w.subcollections,P=w.overrideSchemaRegistry;e.setOverride({path:f,entityId:b,schemaConfig:{permissions:_,schema:typeof I!="function"?I:void 0,schemaResolver:typeof I=="function"?I:void 0,subcollections:A,callbacks:w.callbacks},overrideSchemaRegistry:P})}const m=le(f),S=b?e.buildUrlCollectionPath(`${m}/${b}/${y||""}`):e.buildUrlCollectionPath(`${m}#${Eo}`),k=n.length>0?n[n.length-1]:void 0;if(b&&k&&k.path===f&&k?.entityId===b){const _={...k,selectedSubpath:y},I=[...n.slice(0,-1),_];u(I),r(e.buildUrlCollectionPath(`${m}/${b}/${y||""}`),{replace:!0,state:{base_location:c,panels:I}})}else{const _={path:f,entityId:b,copy:v!==void 0&&v,width:C,selectedSubpath:y},I=[...n,_];u(I),r(S,{state:{base_location:c,panels:I}})}},[n,o]);return{sidePanels:n,close:g,open:h}};function ga(e,o,r){const i=Tt({path:e,collections:o}),n=[];let a="";for(let l=0;l<i.length;l++){const d=i[l];if(d.type==="collection"&&(a=d.path),l>0){const c=i[l-1];if(d.type==="entity")c.type==="collection"&&n.push({path:d.path,entityId:d.entityId,copy:!1});else if(d.type==="custom_view"){if(c.type==="entity"){const u=n[n.length-1];u&&(u.selectedSubpath=d.view.path)}}else if(d.type==="collection"&&c.type==="entity"){const u=n[n.length-1];u&&(u.selectedSubpath=d.collection.path)}}}return r&&n.push({path:a,copy:!1}),n}class ke{id;path;constructor(o,r){this.id=o,this.path=r}get pathWithId(){return`${this.path}/${this.id}`}}class Me{latitude;longitude;constructor(o,r){this.latitude=o,this.longitude=r}}const pa=(e,...o)=>({...o.reduce((r,i)=>({...r,[i]:e[i]}),{})});function kt(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Qe(e,o){const r=Object.assign({},e);return kt(e)&&kt(o)&&Object.keys(o).forEach(i=>{kt(o[i])?i in e?r[i]=Qe(e[i],o[i]):Object.assign(r,{[i]:o[i]}):Object.assign(r,{[i]:o[i]})}),r}function _t(e,o){if(typeof e=="object"){if(o in e)return e[o];if(o.includes(".")){const r=o.split(".");return _t(e[r[0]],r.slice(1).join("."))}}}function Io(e){if(!e)return null;if(typeof e=="object"){if("id"in e)return e.id;if(e instanceof Date)return e.toLocaleString();if(e instanceof Me)return ho.default(e)}return ho.default(e,{ignoreUnknown:!0})}function ba({propertyOrBuilder:e,values:o,previousValues:r,path:i,entityId:n,propertyOverride:a}){let l;if(typeof e=="function"){if(l=e({values:o,previousValues:r,entityId:n,path:i}),!l)return console.debug("Property builder not returning `Property` so it is not rendered",i,n,e),null}else l=e;return a&&(l=Qe(l,a)),l}function Ze(e){return e.readOnly||e.dataType==="timestamp"&&e.autoValue?!0:e.dataType==="reference"?!e.path:!1}function Bo(e){return typeof e.disabled=="object"&&Boolean(e.disabled.hidden)}function ge({schemaOrResolver:e,path:o,entityId:r,values:i,previousValues:n}){if(typeof e=="function")return e({entityId:r,values:i,previousValues:n});{const a=Po({propertiesOrBuilder:e.properties,path:o,entityId:r,values:i,previousValues:n});return{...e,properties:a,originalSchema:e}}}function Po({propertiesOrBuilder:e,path:o,entityId:r,values:i,previousValues:n}){return Object.entries(e).map(([a,l])=>{const d=ba({propertyOrBuilder:l,values:i??{},previousValues:n??i??{},path:o,entityId:r});return d===null?null:{[a]:d}}).filter(a=>a!==null).reduce((a,l)=>({...a,...l}),{})}function Et(e,o){return Object.entries(e).map(([r,i])=>{const n=o&&r in o?o[r]:void 0,a=va(r,i,n);return a===void 0?{}:{[r]:a}}).reduce((r,i)=>({...r,...i}),{})}function va(e,o,r){let i;return o.dataType==="map"&&o.properties?i=Et(o.properties,r):r!==void 0?i=r:i=void 0,i}function ya({inputValues:e,properties:o,status:r,timestampNowValue:i,referenceConverter:n,geopointConverter:a}){return Fo(e,o,(l,d)=>{if(d.dataType==="timestamp")return r==="existing"&&d.autoValue==="on_update"||(r==="new"||r==="copy")&&(d.autoValue==="on_update"||d.autoValue==="on_create")?i:l;if(n&&d.dataType==="reference"){if(l instanceof ke)return n(l)}else if(a&&d.dataType==="geopoint"){if(l instanceof Me)return a(l)}else return l})}function wa(e,o){const r=e;return Object.entries(o).forEach(([i,n])=>{e&&e[i]!==void 0?r[i]=e[i]:n.validation?.required&&(r[i]=null)}),r}function nt(e){return new ke(e.id,e.path)}function Fo(e,o,r){const i=Object.entries(o).map(([n,a])=>{const l=e&&e[n],d=It(l,a,r);return d===void 0?{}:{[n]:d}}).reduce((n,a)=>({...n,...a}),{});return{...e,...i}}function It(e,o,r){let i;if(o.dataType==="map"&&o.properties)i=Fo(e,o.properties,r);else if(o.dataType==="array")if(o.of&&Array.isArray(e))i=e.map(n=>It(n,o.of,r));else if(o.oneOf&&Array.isArray(e)){const n=o.oneOf.typeField??"type",a=o.oneOf.valueField??"value";i=e.map(l=>{if(l===null)return null;if(typeof l!="object")return l;const d=l[n],c=o.oneOf.properties[d];return!d||!c?l:{[n]:d,[a]:It(l[a],c,r)}})}else i=e;else i=r(e,o);return i}function Ca({basePath:e,baseCollectionPath:o,authController:r,navigationOrBuilder:i,schemaOverrideHandler:n,dateTimeFormat:a,locale:l,dataSource:d,storageSource:c,userConfigPersistence:u}){const[g,h]=p.useState(void 0),[f,b]=p.useState(!1),[y,v]=p.useState(void 0),C=p.useRef({}),w=le(e),m=le(o),S=w?`/${w}`:"/",k=w?`/${w}/${m}`:`/${m}`,_=g?.collections!==void 0;p.useEffect(()=>{!r.canAccessMainView||(b(!0),ma({navigationOrCollections:i,user:r.user,authController:r,dateTimeFormat:a,locale:l,dataSource:d,storageSource:c}).then(L=>{h(L),b(!1)}).catch(v))},[r.user,r.canAccessMainView,i,r,a,l,d,c]);const I=p.useCallback(L=>u?u.getCollectionConfig(L)?.schema:void 0,[u]),A=p.useCallback(({schema:L,path:B})=>({entityId:M,values:F,previousValues:X})=>{const j=I(B),U=_t(j,"properties"),ee=Po({propertiesOrBuilder:L.properties,path:B,entityId:M,values:F??L.defaultValues,previousValues:X});return{...L,properties:Qe(ee,U),originalSchema:L}},[I]),P=p.useCallback(L=>{if(!u)return;const B={...u.getCollectionConfig(L)};return delete B.schema,B},[u]),q=p.useCallback((L,B,M)=>{const F=g?.collections,X=M??(F&&fa(le(L),F)),j=P(L),U=X?Qe(X,j):void 0,ee=Bt(L,B);let G={};const H=C.current[ee],Y=n&&n({entityId:B,path:le(L)});if(Y&&(G=Y),H&&(H.overrideSchemaRegistry===void 0||H.overrideSchemaRegistry?G={...H,permissions:G.permissions||H.permissions,schemaResolver:G.schemaResolver||H.schemaResolver,subcollections:G.subcollections||H.subcollections,callbacks:G.callbacks||H.callbacks}:G={...G,permissions:H.permissions??G.permissions,schemaResolver:H.schemaResolver??G.schemaResolver,subcollections:H.subcollections??G.subcollections,callbacks:H.callbacks??G.callbacks}),U){const ae=U.schema,re=U.subcollections,ne=U.callbacks,W=U.permissions;G={...G,schemaResolver:G.schemaResolver??A({schema:ae,path:L}),subcollections:G.subcollections??re,callbacks:G.callbacks??ne,permissions:G.permissions??W}}if(G&&Object.keys(G).length&&!G.schemaResolver){if(!G.schema)throw Error(`Not able to resolve schema for ${ee}`);G.schemaResolver=A({schema:G.schema,path:L})}return{...U,...G}},[g?.collections,P,n,A]),O=p.useCallback(({path:L,entityId:B,schemaConfig:M,overrideSchemaRegistry:F})=>{const X=Bt(L,B);if(M)return C.current[X]={...M,overrideSchemaRegistry:F},X;delete C.current[X]},[]),T=p.useCallback(L=>{const B=L.map(({path:M,entityId:F})=>Bt(M,F));Object.keys(C.current).forEach(M=>{B.includes(M)||delete C.current[M]})},[]),E=p.useCallback(L=>le(L+"/").startsWith(le(k)+"/"),[k]),$=p.useCallback(L=>{if(L.startsWith(k))return L.replace(k,"");throw Error("Expected path starting with "+k)},[k]),D=p.useCallback(L=>`${o}/${le(L)}`,[o]),N=p.useCallback(L=>`/${le(L)}`,[]),J=p.useCallback((L,B)=>{if(u){const M=u.getCollectionConfig(L);u.onCollectionModified(L,Qe(M,B))}},[u]);return{navigation:g,loading:f,navigationLoadingError:y,homeUrl:S,basePath:e,baseCollectionPath:o,onCollectionModifiedForUser:J,initialised:_,getCollectionResolver:q,setOverride:O,removeAllOverridesExcept:T,isUrlCollectionPath:E,urlPathToDataPath:$,buildUrlCollectionPath:D,buildCMSUrlPath:N}}const ma=async({navigationOrCollections:e,user:o,authController:r,dateTimeFormat:i,locale:n,dataSource:a,storageSource:l})=>Array.isArray(e)?{collections:e}:typeof e=="function"?e({user:o,authController:r,dateTimeFormat:i,locale:n,dataSource:a,storageSource:l}):e;function Bt(e,o){return o?`${le(e)}/${le(o)}`:le(e)}function xa({authDelegate:e,authentication:o,dateTimeFormat:r,locale:i,dataSource:n,storageSource:a}){const[l,d]=p.useState(null),[c,u]=p.useState(!1),[g,h]=p.useState(!1),[f,b]=p.useState(),y=e.loginSkipped,C=(!(o===void 0||!!o)||Boolean(l)||Boolean(y))&&!g,w=p.useMemo(()=>({user:l,loginSkipped:y,canAccessMainView:C,initialLoading:e.initialLoading??!1,authLoading:c,notAllowedError:g,signOut:e.signOut,extra:f,setExtra:b,authDelegate:e}),[e,c,C,f,y,g,l]),m=p.useCallback(async()=>{const S=e.user;if(o instanceof Function&&S){u(!0);try{await o({user:S,authController:w,dateTimeFormat:r,locale:i,dataSource:n,storageSource:a})?d(S):h(!0)}catch(k){h(k),e.signOut()}u(!1)}else d(S)},[e.user]);return p.useEffect(()=>{m()},[e.user,m]),w}function Ao(e){return e.split("/").filter((o,r)=>r%2===0).reduce((o,r)=>`${o}/${r}`)}function Sa(){function e(r,i){const n=`collection_config_${Ao(r)}`;localStorage.setItem(n,JSON.stringify(i))}function o(r){const i=`collection_config_${Ao(r)}`,n=localStorage.getItem(i);return n?JSON.parse(n):{}}return{onCollectionModified:e,getCollectionConfig:o}}const Ta="/c";function $o(e){const{children:o,navigation:r,entityLinkBuilder:i,authentication:n,dateTimeFormat:a,locale:l,authDelegate:d,schemaOverrideHandler:c,storageSource:u,dataSource:g,basePath:h,baseCollectionPath:f}=e,b=h??"/",y=f??Ta,v=l?fo[l]:void 0,C=xa({authDelegate:d,authentication:n,dateTimeFormat:a,locale:l,dataSource:g,storageSource:u}),w=Sa(),m=Ca({basePath:b,baseCollectionPath:y,authController:C,navigationOrBuilder:r,dateTimeFormat:a,locale:l,dataSource:g,storageSource:u,schemaOverrideHandler:c,userConfigPersistence:w}),S=ha(m),k=C.authLoading||C.initialLoading||m.loading;return m.navigationLoadingError?t.jsxs("div",{children:[t.jsx("p",{children:"There was an error while loading your navigation config"}),t.jsx("p",{children:m.navigationLoadingError})]}):t.jsx(ca,{children:t.jsx(na,{children:t.jsx(xt.Consumer,{children:_=>{const I={authController:C,sideEntityController:S,entityLinkBuilder:i,dateTimeFormat:a,locale:l,navigationContext:m,dataSource:g,storageSource:u,snackbarController:_};return t.jsx(ia,{...I,children:t.jsx(sa,{children:t.jsx(ci.default,{dateAdapter:li.default,utils:di.default,locale:v,children:t.jsx(St.Consumer,{children:({mode:A})=>o({context:I,mode:A,loading:k})})})})})}})})})}const ka=K.default(e=>Q.default({flexCenter:{display:"flex",alignItems:"center"},smallMargin:{margin:e.spacing(1)},text:{paddingLeft:e.spacing(2)}}));function me({error:e,tooltip:o}){const r=ka(),i=t.jsxs("div",{className:he.default(r.flexCenter,r.smallMargin),children:[t.jsx(Ct.default,{fontSize:"small",color:"error"}),t.jsx("div",{className:r.text,children:e})]});return o?t.jsx(s.Tooltip,{title:o,children:i}):i}function _a({builder:e}){const[o,r]=p.useState(!0),[i,n]=p.useState(null);return p.useEffect(()=>{let a=!1;return e.then(l=>{a||(r(!1),n(l))}).catch(l=>{r(!1),console.error(l)}),()=>{a=!0}},[e]),o?t.jsx(s.Skeleton,{variant:"text"}):t.jsx(se.Fragment,{children:i})}const Ea=se.memo(_a);class ie extends z.default.Component{constructor(o){super(o),this.state={hasError:!1}}static getDerivedStateFromError(o){return{hasError:!0}}componentDidCatch(o,r){}render(){return this.state.hasError?t.jsxs(s.Box,{display:"flex",flexDirection:"column",m:.5,children:[t.jsxs(s.Box,{display:"flex",alignItems:"center",m:.5,children:[t.jsx(Ct.default,{color:"error",fontSize:"small"}),t.jsx(s.Box,{marginLeft:1,children:"Error"})]}),t.jsx(s.Typography,{variant:"caption",children:"See the error in the console"})]}):this.props.children}}function Ia(e){let o=0,r,i;for(r=0;r<e.length;r++)i=e.charCodeAt(r),o=(o<<5)-o+i,o|=0;return Math.abs(o)}const Pt={blueLighter:{color:"#cfdfff",text:"#102046"},cyanLighter:{color:"#d0f0fd",text:"#04283f"},tealLighter:{color:"#c2f5e9",text:"#012524"},greenLighter:{color:"#d1f7c4",text:"#0b1d05"},yellowLighter:{color:"#ffeab6",text:"#3b2501"},orangeLighter:{color:"#fee2d5",text:"#6b2613"},redLighter:{color:"#ffdce5",text:"#4c0c1c"},pinkLighter:{color:"#ffdaf6",text:"#400832"},purpleLighter:{color:"#ede2fe",text:"#280b42"},grayLighter:{color:"#eee",text:"#040404"},blueLight:{color:"#9cc7ff",text:"#102046"},cyanLight:{color:"#77d1f3",text:"#04283f"},tealLight:{color:"#72ddc3",text:"#012524"},greenLight:{color:"#93e088",text:"#0b1d05"},yellowLight:{color:"#ffd66e",text:"#3b2501"},orangeLight:{color:"#ffa981",text:"#6b2613"},redLight:{color:"#ff9eb7",text:"#4c0c1c"},pinkLight:{color:"#f99de2",text:"#400832"},purpleLight:{color:"#cdb0ff",text:"#280b42"},grayLight:{color:"#ccc",text:"#040404"},blueDark:{color:"#2d7ff9",text:"#fff"},cyanDark:{color:"#18bfff",text:"#fff"},tealDark:{color:"#20d9d2",text:"#fff"},greenDark:{color:"#20c933",text:"#fff"},yellowDark:{color:"#fcb400",text:"#fff"},orangeDark:{color:"#ff6f2c",text:"#fff"},redDark:{color:"#f82b60",text:"#fff"},pinkDark:{color:"#ff08c2",text:"#fff"},purpleDark:{color:"#8b46ff",text:"#fff"},grayDark:{color:"#666",text:"#fff"},blueDarker:{color:"#2750ae",text:"#cfdfff"},cyanDarker:{color:"#0b76b7",text:"#d0f0fd"},tealDarker:{color:"#06a09b",text:"#c2f5e9"},greenDarker:{color:"#338a17",text:"#d1f7c4"},yellowDarker:{color:"#b87503",text:"#ffeab6"},orangeDarker:{color:"#d74d26",text:"#fee2d5"},redDarker:{color:"#ba1e45",text:"#ffdce5"},pinkDarker:{color:"#b2158b",text:"#ffdaf6"},purpleDarker:{color:"#6b1cb0",text:"#ede2fe"},grayDarker:{color:"#444",text:"#eee"}};function Ba(e){const o=Ia(e),r=Object.keys(Pt),i=o%r.length;return Pt[r[i]]}function Pa(e){return Pt[e]}function Ne(e){return e instanceof Map?Array.from(e.entries()):Object.entries(e)}function Oo(e,o){return e instanceof Map?e.get(o):e[o]}function Fa(e,o){const r=Oo(e,o);if(typeof r=="object"&&"color"in r)return r.color}function Re(e){return typeof e=="object"&&e.disabled}function Do(e){if(e!==void 0)return typeof e=="object"?e.label:e}const Aa=K.default(e=>Q.default({root:{maxWidth:"100%",backgroundColor:({schema:o,error:r})=>r?"#eee":o.color},label:{color:({schema:o,error:r})=>r?"red":o.text,fontWeight:e.typography.fontWeightRegular}}));function xe({enumValues:e,enumKey:o,small:r}){const i=o!==void 0?Oo(e,o.toString()):void 0,n=Do(i),a=Fa(e,o.toString());return t.jsx(Ft,{colorSeed:`${o}`,colorSchemaKey:a,label:n!==void 0?n:o,error:!n,outlined:!1,small:r})}function Ft({colorSeed:e,label:o,colorSchemaKey:r,error:i,outlined:n,small:a}){const l=p.useMemo(()=>r?Pa(r):Ba(e),[e,r]),d=Aa({schema:l,error:i});return t.jsx(s.Chip,{classes:{root:d.root,label:d.label},size:a?"small":"medium",variant:n?"outlined":"filled",label:o})}function At({name:e,value:o,property:r,size:i}){if(r.config?.enumValues){const n=o,a=r.config.enumValues;return t.jsx(xe,{enumKey:n,enumValues:a,small:i!=="regular"})}else return r.config?.previewAsTag?t.jsx(ie,{children:t.jsx(Ft,{colorSeed:e??"",label:o,small:i!=="regular"})}):t.jsx(t.Fragment,{children:o&&(o.includes(`
`)?o.split(`
`).map((n,a)=>t.jsx("div",{children:n},`string_preview_${a}`)):o)})}const $a=K.default(e=>Q.default({array:{display:"flex",flexDirection:"column"},arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItem:{margin:e.spacing(.5)}}));function Lo({name:e,value:o,property:r,size:i}){const n=$a();if(!r.of||r.dataType!=="array"||r.of.dataType!=="string")throw Error("Picked wrong preview component ArrayOfStringsPreview");if(o&&!Array.isArray(o))return t.jsx("div",{children:`Unexpected value: ${o}`});const a=r.of;return t.jsx("div",{className:n.array,children:o&&o.map((l,d)=>t.jsx("div",{className:n.arrayItem,children:t.jsx(ie,{children:t.jsx(At,{name:e,property:a,value:l,size:i})})},`preview_array_strings_${e}_${d}`))})}const Oa=K.default(e=>Q.default({arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItem:{margin:e.spacing(.5)}}));function it({name:e,value:o,enumValues:r,size:i}){const n=Oa();return t.jsx("div",{className:n.arrayWrap,children:o&&o.map((a,l)=>t.jsx("div",{className:n.arrayItem,children:t.jsx(ie,{children:t.jsx(xe,{enumKey:a,enumValues:r,small:i!=="regular"})})},`preview_array_ref_${e}_${l}`))})}function $t({name:e,value:o,property:r,size:i}){if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayEnumPreview");const n=r.of;if(!n.config?.enumValues)throw Error("Picked wrong preview component ArrayEnumPreview");if(!o)return null;const a=n.config?.enumValues;return t.jsx(it,{name:e,value:o,enumValues:a,size:i})}function Mo({name:e,value:o,property:r,size:i}){return o?t.jsx(Je.CheckBox,{color:"secondary"}):t.jsx(Je.CheckBoxOutlineBlank,{color:"disabled"})}function at({source:e}){return t.jsx(gi.default,{source:typeof e=="string"?e:"",style:{fontSize:"inherit",lineHeight:"inherit",fontFamily:"inherit"},components:{a:o=>t.jsx("a",{...o,onClick:r=>r.stopPropagation(),target:"_blank",children:o.children})}})}const Da=K.default(e=>Q.default({root:{borderRadius:"9999px",backgroundColor:"rgba(128,128,128,0.1)",width:"18px",height:"6px",display:"inline-block"}}));function qe(){const e=Da();return t.jsx("div",{className:e.root})}const La=40,Ma=100,Na=200;function ze(e){if(e==="tiny")return La;if(e==="small")return Ma;if(e==="regular")return Na;throw Error("Thumbnail size not mapped")}function Pe(e){switch(e){case"xs":case"s":return"tiny";case"m":return"small";case"l":case"xl":return"regular";default:throw Error("Missing mapping value in getPreviewSizeFrom")}}const qa=K.default(e=>Q.default({image:{maxWidth:"100%",maxHeight:"100%",borderRadius:"4px"},imageWrap:{position:"relative",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",width:({imageSize:o})=>o,height:({imageSize:o})=>o},imageTiny:{position:"relative",objectFit:"cover",width:({imageSize:o})=>o,height:({imageSize:o})=>o,borderRadius:"4px",maxHeight:"100%"},copyIcon:{borderRadius:"9999px",position:"absolute",bottom:-4,right:32,backgroundColor:e.palette.common.white},previewIcon:{borderRadius:"9999px",position:"absolute",bottom:-4,right:-4,backgroundColor:e.palette.common.white}}));function No({size:e,url:o}){const[r,i]=p.useState(!1),n=p.useMemo(()=>ze(e),[e]),a=qa({imageSize:n});if(e==="tiny")return t.jsx("img",{src:o,className:a.imageTiny},"tiny_image_preview_"+o);const l={maxWidth:"100%",maxHeight:"100%",borderRadius:"4px"};return t.jsxs("div",{className:a.imageWrap,onMouseEnter:()=>i(!0),onMouseMove:()=>i(!0),onMouseLeave:()=>i(!1),children:[t.jsx("img",{src:o,className:a.image,style:l}),r&&t.jsxs(t.Fragment,{children:[t.jsx(s.Tooltip,{title:"Copy url to clipboard",children:t.jsx("div",{className:a.copyIcon,children:t.jsx(s.IconButton,{size:"small",onClick:d=>{d.stopPropagation(),navigator.clipboard.writeText(o)},children:t.jsx(pi.default,{htmlColor:"#666",fontSize:"small"})})})}),t.jsx(s.Tooltip,{title:"Open image in new tab",children:t.jsx("a",{className:a.previewIcon,href:o,rel:"noopener noreferrer",target:"_blank",children:t.jsx(s.IconButton,{size:"small",onClick:d=>d.stopPropagation(),children:t.jsx(rt.default,{htmlColor:"#666",fontSize:"small"})})})})]})]},"image_preview_"+o)}function qo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array"||!r.of||r.of.dataType!=="map")throw Error("Picked wrong preview component ArrayOfMapsPreview");const n=r.of.properties;if(!n)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);const a=o,l=r.of.previewProperties;if(!a)return null;let d=l;return(!d||!d.length)&&(d=Object.keys(n),i&&(d=d.slice(0,3))),t.jsx(s.Table,{size:"small",children:t.jsx(s.TableBody,{children:a&&a.map((c,u)=>t.jsx(s.TableRow,{sx:{"&:last-child th, &:last-child td":{borderBottom:0}},children:d&&d.map(g=>t.jsx(s.TableCell,{component:"th",children:t.jsx(ie,{children:t.jsx(ue,{name:g,value:c[g],property:n[g],size:"small"})})},`table-cell-${g}`))},`table_${c}_${u}`))})})}function zo({name:e,value:o,property:r,size:i}){if(r.config?.enumValues){const n=o,a=r.config.enumValues;return t.jsx(xe,{enumKey:n,enumValues:a,small:i!=="regular"})}else return t.jsx(t.Fragment,{children:o})}const za="MMMM dd, yyyy, HH:mm:ss",de=()=>p.useContext(xo);function _e(){return de().dataSource}function st({path:e,schemaResolver:o,filterValues:r,sortBy:i,itemCount:n,searchString:a,entitiesDisplayedFirst:l}){const d=i?i[0]:void 0,c=i?i[1]:void 0,u=_e(),g=p.useMemo(()=>l?l.filter(I=>!!I.values):[],[l]),[h,f]=p.useState(g),[b,y]=p.useState(!1),[v,C]=p.useState(),[w,m]=p.useState(!1),[S,k]=p.useState(0),_=p.useCallback(I=>{if(!g)f(I);else{const A=new Set(g.map(P=>P.id));f([...g,...I.filter(P=>!A.has(P.id))])}},[g]);return p.useEffect(()=>{y(!0);const I=P=>{y(!1),C(void 0),_(P),k(P.length),m(!n||P.length<n)},A=P=>{console.error("ERROR",P),y(!1),f([]),C(P)};return u.listenCollection?u.listenCollection({path:e,schema:o,onUpdate:I,onError:A,searchString:a,filter:r,limit:n,startAfter:void 0,orderBy:d,order:c}):(u.fetchCollection({path:e,schema:o,searchString:a,filter:r,limit:n,startAfter:void 0,orderBy:d,order:c}).then(I).catch(A),()=>{})},[e,n,c,d,r,a]),{data:h,dataLoading:b,dataLoadingError:v,noMoreToLoad:w,entitiesLength:S}}const Ot={};function lt({path:e,entityId:o,schema:r,useCache:i=!1}){const n=_e(),[a,l]=p.useState(),[d,c]=p.useState(!0),[u,g]=p.useState();return p.useEffect(()=>{c(!0);const h=b=>{Ot[`${e}/${o}`]=b,l(b),c(!1),g(void 0)},f=b=>{console.error("ERROR fetching entity",b),c(!1),l(void 0),g(b)};return i&&Ot[`${e}/${o}`]?(l(Ot[`${e}/${o}`]),c(!1),g(void 0),()=>{}):o&&e&&r?n.listenEntity?n.listenEntity({path:e,entityId:o,schema:r,onUpdate:h,onError:f}):(n.fetchEntity({path:e,entityId:o,schema:r}).then(h).catch(f),()=>{}):(h(void 0),()=>{})},[o,e]),{entity:a,dataLoading:d,dataLoadingError:u}}async function Dt({schema:e,path:o,entityId:r,callbacks:i,values:n,previousValues:a,status:l,dataSource:d,context:c,onSaveSuccess:u,onSaveFailure:g,onPreSaveHookError:h,onSaveSuccessHookError:f}){let b;if(i?.onPreSave)try{const y=ge({values:a,entityId:r,schemaOrResolver:e,path:o});b=await i.onPreSave({schema:y,path:o,entityId:r,values:n,previousValues:a,status:l,context:c})}catch(y){console.error(y),h&&h(y);return}else b=n;return d.saveEntity({schema:e,path:o,entityId:r,values:b,previousValues:a,status:l}).then(y=>{try{if(i?.onSaveSuccess){const v=ge({values:b,entityId:r,schemaOrResolver:e,path:o});i.onSaveSuccess({schema:v,path:o,entityId:y.id,values:b,previousValues:a,status:l,context:c})}}catch(v){f&&f(v)}u&&u(y)}).catch(y=>{if(i?.onSaveFailure){const v=ge({values:b,entityId:r,schemaOrResolver:e,path:o});i.onSaveFailure({schema:v,path:o,entityId:r,values:b,previousValues:a,status:l,context:c})}g&&g(y)})}async function Vo({dataSource:e,entity:o,schema:r,callbacks:i,onDeleteSuccess:n,onDeleteFailure:a,onPreDeleteHookError:l,onDeleteSuccessHookError:d,context:c}){console.debug("Deleting entity",o.path,o.id);const u={entity:o,schema:r,entityId:o.id,path:o.path,context:c};if(i?.onPreDelete)try{await i.onPreDelete(u)}catch(g){return console.error(g),l&&l(o,g),!1}return e.deleteEntity({entity:o}).then(()=>{n&&n(o);try{return i?.onDelete&&i.onDelete(u),!0}catch(g){return d&&d(o,g),!1}}).catch(g=>(a&&a(o,g),!1))}function pe({property:e,value:o,setValue:r}){const i=p.useRef(null);p.useEffect(()=>{typeof e.disabled=="object"&&Boolean(e.disabled.clearOnDisabled)?o!=null&&(i.current=o,r(null)):i.current&&(r(i.current),i.current=null)},[e])}function Te(){return de().navigationContext}function Uo({path:e,context:o}){const r=o.dataSource,i=o.navigationContext,n=o.navigationContext.navigation;if(!n)throw Error("Calling getNavigationFrom, but main navigation has not yet been initialised");const l=Tt({path:e,collections:n.collections}).map(d=>{if(d.type==="collection")return Promise.resolve(d);if(d.type==="entity"){const c=i.getCollectionResolver(d.path,d.entityId);if(!c?.schemaResolver)throw Error(`No schema defined in the navigation for the entity with path ${d.path}`);return r.fetchEntity({path:d.path,entityId:d.entityId,schema:c?.schemaResolver}).then(u=>({...d,entity:u}))}else{if(d.type==="custom_view")return Promise.resolve(d);throw Error("Unmapped element in useEntitiesFromPath")}});return Promise.all(l)}function Va({path:e}){const o=de(),[r,i]=p.useState(),[n,a]=p.useState(!1),[l,d]=p.useState();return p.useEffect(()=>{o.navigationContext.navigation&&(a(!0),d(void 0),Uo({path:e,context:o}).then(u=>{i(u)}).catch(u=>d(u)).finally(()=>a(!1)))},[e,o]),o.navigationContext.navigation?{data:r,dataLoading:n,dataLoadingError:l}:{dataLoading:!0}}function Ve(){return de().storageSource}function Ue(){return de().authController}function Fe(){return de().sideEntityController}const We=()=>p.useContext(xt),Lt=()=>p.useContext(St),Wo=e=>{const{onSuccess:o,onError:r,disableClipboardAPI:i=!1,copiedDuration:n}=e||{},a=p.useRef(null),[l,d]=p.useState(!1),[c,u]=p.useState("");p.useEffect(()=>{n&&setTimeout(()=>d(!1),n)},[l]);const g=()=>navigator.clipboard!==void 0,h=p.useCallback(m=>{if(r)r(m);else throw new Error(m)},[r]),f=p.useCallback(m=>{o&&o(m),d(!0),u(m)},[o]),b=p.useCallback(m=>{navigator.clipboard.writeText(m).then(()=>f(m)).catch(S=>{h(S),d(!1)})},[h,f]),y=()=>{g()&&navigator.clipboard.writeText("")},v=m=>w("copy",typeof m=="object"?void 0:m),C=()=>w("cut"),w=p.useCallback((m="copy",S)=>{const k=a.current,_=k&&(k.tagName==="INPUT"||k.tagName==="TEXTAREA"),I=a.current;g()&&!i&&(S?b(S):k?_?(b(I.value),m==="cut"&&(I.value="")):b(k.innerText):h("Both the ref & text were undefined"))},[i,b,h]);return{ref:a,isCoppied:l,clipboard:c,clearClipboard:y,isSupported:g,copy:v,cut:C}};function Ho({name:e,value:o,property:r,size:i}){const n=de(),a=n?.locale?fo[n?.locale]:void 0,l=n?.dateTimeFormat??za,d=o?bi.default(o,l,{locale:a}):"";return t.jsx(t.Fragment,{children:d})}const Ua=K.default(e=>Q.default({flexCenter:{display:"flex",alignItems:"center",justifyContent:"center"},smallMargin:{margin:e.spacing(1)},arrayWrap:{display:"flex",flexWrap:"wrap"},array:{display:"flex",flexDirection:"column"},arrayItem:{margin:e.spacing(.5)},arrayItemBig:{margin:e.spacing(1)},link:{display:"flex",wordBreak:"break-word",fontWeight:e.typography.fontWeightMedium}}));function Mt({value:e,property:o,size:r}){const i=Ua();if(!e)return t.jsx("div",{});const n=e;if(typeof o.config?.url=="boolean"&&o.config.url)return t.jsxs(s.Link,{className:i.link,href:n,onMouseDown:l=>{l.preventDefault()},target:"_blank",children:[t.jsx(rt.default,{style:{marginRight:8},fontSize:"small"}),n]});const a=o.config?.url||o.config?.storageMeta?.mediaType;return a==="image"?t.jsx(No,{url:n,size:r},`image_preview_${n}_${r}`):a==="audio"?t.jsxs("audio",{controls:!0,src:n,children:["Your browser does not support the",t.jsx("code",{children:"audio"})," element."]},`audio_preview_${n}_${r}`):a==="video"?t.jsx(s.CardMedia,{style:{maxWidth:r==="small"?300:500},component:"video",controls:!0,image:n},`video_preview_${n}_${r}`):t.jsx("a",{href:n,rel:"noopener noreferrer",target:"_blank",onClick:l=>l.stopPropagation(),children:t.jsx("div",{className:i.flexCenter,style:{width:ze(r),height:ze(r)},children:t.jsx(vi.default,{})})},`link_preview_${n}_${r}`)}function Ae({property:e,size:o}){e||console.error("No property assigned for skeleton component",e,o);let r;if(e.dataType==="string"){const i=e;i.config?.url?r=Ka(i,o):i.config?.storageMeta?r=Nt(o):r=Oe()}else if(e.dataType==="array"){const i=e;i.of&&(i.of.dataType==="map"&&i.of.properties?r=Ha(i.of.properties,o,i.of.previewProperties):i.of.dataType==="string"?i.of.config?.enumValues?r=Ga():i.of.config?.storageMeta?r=jo(i.of):r=ja():r=jo(i.of))}else e.dataType==="map"?r=Wa(e,o):e.dataType==="timestamp"?r=Oe():e.dataType==="reference"?r=Ja():(e.dataType,r=Oe());return r||null}function Wa(e,o){if(!e.properties)return t.jsx(t.Fragment,{});let r;return o?e.previewProperties?r=e.previewProperties:r=Object.keys(e.properties).slice(0,3):r=Object.keys(e.properties),o?t.jsx(s.List,{children:r&&r.map(i=>t.jsx(s.ListItem,{children:t.jsx(Ae,{property:e.properties[i],size:"small"})},e.title+i))}):t.jsx(s.Table,{size:"small",children:t.jsx(s.TableBody,{children:r&&r.map((i,n)=>t.jsxs(s.TableRow,{sx:{"&:last-child th, &:last-child td":{borderBottom:0}},children:[t.jsx(s.TableCell,{component:"th",children:t.jsx(s.Skeleton,{variant:"text"})},`table-cell-title-${i}`),t.jsx(s.TableCell,{component:"th",children:t.jsx(Ae,{property:e.properties[i],size:"small"})},`table-cell-${i}`)]},`table_${e.title}_${n}`))})})}function Ha(e,o,r){let i=r;return(!i||!i.length)&&(i=Object.keys(e),o&&(i=i.slice(0,3))),t.jsx(s.Table,{size:"small",children:t.jsx(s.TableBody,{children:[0,1,2].map((n,a)=>t.jsx(s.TableRow,{children:i&&i.map(l=>t.jsx(s.TableCell,{component:"th",children:t.jsx(Ae,{property:e[l],size:"small"})},`table-cell-${l}`))},`table_${n}_${a}`))})})}function ja(){return t.jsx(s.Grid,{children:[0,1].map((e,o)=>Oe(o))})}function Ga(){return t.jsx(s.Grid,{children:[0,1].map((e,o)=>t.jsx(t.Fragment,{children:Oe(o)}))})}function jo(e){return t.jsx(s.Grid,{children:[0,1].map((o,r)=>t.jsx(t.Fragment,{children:t.jsx(Ae,{property:e,size:"small"})}))})}function Ya(){return t.jsx(s.Skeleton,{variant:"rectangular",width:300,height:100})}function Nt(e){const o=e==="tiny"?40:e==="small"?100:200;return t.jsx(s.Skeleton,{variant:"rectangular",width:o,height:o})}function Xa(e){return t.jsx(s.Skeleton,{variant:"rectangular",width:e!=="regular"?300:500,height:e!=="regular"?200:250})}function Ja(){return t.jsx(s.Skeleton,{variant:"rectangular",width:200,height:100})}function Ka(e,o="regular"){if(typeof e.config?.url=="boolean"&&e.config.url)return t.jsxs("div",{style:{display:"flex"},children:[Go(),Oe()]});const r=e.config?.url||e.config?.storageMeta?.mediaType;return r==="image"?Nt(o):r==="audio"?Ya():r==="video"?Xa(o):Qa(o)}function Qa(e){return t.jsx(s.Box,{sx:{width:ze(e),height:ze(e)},children:Go()})}function Oe(e){return t.jsx(s.Skeleton,{variant:"text"},`skeleton_${e}`)}function Go(){return t.jsx(s.Skeleton,{variant:"rectangular",width:24,height:24})}const Yo=z.default.memo(Ra,Za);function Za(e,o){return e.name===o.name&&e.size===o.size&&e.height===o.height&&e.width===o.width&&e.value===o.value}const qt={};function Ra({name:e,value:o,property:r,size:i}){const n=Ve(),a=o,[l,d]=z.default.useState(qt[a]);return p.useEffect(()=>{if(!a)return;let c=!1;return r.config?.storageMeta?.storeUrl?(d(a),qt[a]=a):a&&n.getDownloadURL(a).then(function(u){c||(d(u),qt[a]=u)}),()=>{c=!0}},[r.config?.storageMeta?.storeUrl,a]),a?l?t.jsx(Mt,{name:e,value:l,property:r,size:i}):Nt(i):null}const es=K.default(e=>Q.default({arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItem:{margin:e.spacing(.5)}}));function Xo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array"||!r.of||r.of.dataType!=="string")throw Error("Picked wrong preview component ArrayOfStorageComponentsPreview");const n=i==="regular"?"small":"tiny",a=es();return t.jsx("div",{className:a.arrayWrap,children:o&&o.map((l,d)=>t.jsx("div",{className:a.arrayItem,children:t.jsx(ie,{children:t.jsx(ue,{name:e,value:l,property:r.of,size:n})})},`preview_array_storage_${e}_${d}`))})}const He=se.memo(os,ts);function ts(e,o){return e.name===o.name&&e.size===o.size&&e.height===o.height&&e.width===o.width&&e.onHover===o.onHover&&e.value?.id===o.value?.id&&e.value?.path===o.value?.path}function os({value:e,property:o,onClick:r,size:i,onHover:n}){if(typeof o.path!="string")throw Error("Picked the wrong component ReferencePreviewComponent");const a=e,l=o.previewProperties,d=Te(),c=Fe(),u=d.getCollectionResolver(o.path);if(!u)throw Error(`Couldn't find the corresponding collection view for the path: ${o.path}`);const g=u.schema,{entity:h,dataLoading:f,dataLoadingError:b}=lt({path:a.path,entityId:a.id,schema:u.schemaResolver,useCache:!0}),y=p.useMemo(()=>{let w=l;return(!w||!w.length)&&(w=Object.keys(g.properties)),i==="small"||i==="regular"?w=w.slice(0,3):i==="tiny"&&(w=w.slice(0,1)),w},[l,g.properties,i]);let v;function C(w,m){return t.jsx(me,{error:w,tooltip:m})}return e?e instanceof ke?h&&!h.values?v=C("Reference does not exist",a.path):v=t.jsxs(t.Fragment,{children:[t.jsxs(s.Box,{sx:{display:"flex",flexDirection:"column",flexGrow:1,maxWidth:"calc(100% - 60px)",margin:1},children:[i!=="tiny"&&(e?t.jsx(s.Box,{sx:{display:i!=="regular"?"block":void 0,whiteSpace:i!=="regular"?"nowrap":void 0,overflow:i!=="regular"?"hidden":void 0,textOverflow:i!=="regular"?"ellipsis":void 0},children:t.jsx(s.Typography,{variant:"caption",className:"mono",children:e.id})}):t.jsx(s.Skeleton,{variant:"text"})),y&&y.map(w=>{const m=g.properties[w];return m?t.jsx("div",{children:h?t.jsx(ue,{name:w,value:h.values[w],property:m,size:"tiny"}):t.jsx(Ae,{property:m,size:"tiny"})},"ref_prev_"+w):null})]}),t.jsx(s.Box,{sx:{margin:"auto"},children:h&&t.jsx(s.Tooltip,{title:`See details for ${h.id}`,children:t.jsx(s.IconButton,{size:i==="tiny"?"small":"medium",onClick:w=>{w.stopPropagation(),c.open({entityId:h.id,path:h.path,schema:g,overrideSchemaRegistry:!1})},children:t.jsx(go.default,{fontSize:"small"})})})})]}):v=C("Unexpected value",JSON.stringify(e)):v=C("Reference not set"),t.jsx(s.Paper,{elevation:0,sx:w=>{const m=r?{tabindex:0,backgroundColor:n?w.palette.mode==="dark"?s.lighten(w.palette.background.default,.1):s.darken(w.palette.background.default,.15):s.darken(w.palette.background.default,.1),transition:"background-color 300ms ease, box-shadow 300ms ease",boxShadow:n?"0 0 0 2px rgba(128,128,128,0.05)":void 0,cursor:n?"pointer":void 0}:{};return{width:"100%",display:"flex",color:"#838383",backgroundColor:s.darken(w.palette.background.default,.1),borderRadius:"2px",overflow:"hidden",padding:i==="regular"?1:0,itemsAlign:i==="tiny"?"center":void 0,fontWeight:w.typography.fontWeightMedium,...m}},onClick:r,children:v})}const rs=K.default(e=>Q.default({arrayItem:{margin:e.spacing(.5)}}));function Jo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array"||!r.of||r.of.dataType!=="reference")throw Error("Picked wrong preview component ArrayOfReferencesPreview");const n=rs(),a=i==="regular"?"small":"tiny";return t.jsx(t.Fragment,{children:o&&o.map((l,d)=>t.jsx("div",{className:n.arrayItem,children:t.jsx(He,{name:`${e}[${d}]`,size:a,value:l,property:r.of})},`preview_array_ref_${e}_${d}`))})}const ns=K.default(()=>Q.default({tableNoBottomBorder:{"&:last-child th, &:last-child td":{borderBottom:0}},verticalAlignTop:{verticalAlign:"top"}}));function Ko({name:e,value:o,property:r,size:i}){const n=ns();if(r.dataType!=="map")throw Error("Picked wrong preview component MapPreview");const a=r;if(!a.properties)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);if(!o)return null;let l;return i==="regular"?l=Object.keys(a.properties):(l=a.previewProperties||Object.keys(a.properties),i==="small"?l=l.slice(0,3):i==="tiny"&&(l=l.slice(0,1))),i!=="regular"?t.jsx(t.Fragment,{children:l.map((d,c)=>t.jsx("div",{children:t.jsx(ie,{children:t.jsx(ue,{name:d,value:o[d],property:a.properties[d],size:i})})},"map_preview_"+a.title+d+c))}):t.jsx(s.Table,{size:"small",children:t.jsx(s.TableBody,{children:l&&l.map((d,c)=>t.jsxs(s.TableRow,{className:n.tableNoBottomBorder,children:[t.jsx(s.TableCell,{className:n.verticalAlignTop,width:"30%",component:"th",children:t.jsx(s.Typography,{variant:"caption",color:"textSecondary",children:a.properties[d].title})},`table-cell-title-${e}-${d}`),t.jsx(s.TableCell,{width:"70%",className:n.verticalAlignTop,component:"th",children:t.jsx(ie,{children:t.jsx(ue,{name:d,value:o[d],property:a.properties[d],size:"small"})})},`table-cell-${e}-${d}`)]},`map_preview_table_${e}_${c}`))})},`map_preview_${e}`)}const is=K.default(e=>Q.default({array:{display:"flex",flexDirection:"column"},arrayItemBig:{margin:e.spacing(1)}}));function Qo({name:e,value:o,property:r,size:i}){if(!r.of)throw Error(`You need to specify an 'of' prop (or specify a custom field) in your array property ${e}`);const n=is();if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayPreview");const a=o;if(!a)return null;const l=i==="regular"?"small":"tiny";return t.jsx("div",{className:n.array,children:a&&a.map((d,c)=>t.jsxs(z.default.Fragment,{children:[t.jsx("div",{className:n.arrayItemBig,children:t.jsx(ie,{children:t.jsx(ue,{name:e,value:d,property:r.of,size:l})})}),c<a.length-1&&t.jsx(s.Divider,{})]},"preview_array_"+d+"_"+c))})}const as=K.default(e=>Q.default({array:{display:"flex",flexDirection:"column"},arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItemBig:{margin:e.spacing(1)}}));function Zo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayPreview");if(!r.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${e}`);const n=as(),a=o;if(!a)return null;const l=i==="regular"?"small":"tiny",d=r.oneOf.typeField??"type",c=r.oneOf.valueField??"value",u=r.oneOf.properties;return t.jsx("div",{className:n.array,children:a&&a.map((g,h)=>t.jsxs(z.default.Fragment,{children:[t.jsx("div",{className:n.arrayItemBig,children:t.jsx(ie,{children:g&&t.jsx(ue,{name:e,value:g[c],property:u[g[d]],size:l})})}),h<a.length-1&&t.jsx(s.Divider,{})]},"preview_array_"+g+"_"+h))})}function ue(e){let o;const{property:r,name:i,value:n,size:a,height:l,width:d}=e,c={...e};if(n===void 0)o=t.jsx(qe,{});else if(r.config?.Preview)o=p.createElement(r.config.Preview,{name:i,value:n,property:r,size:a,height:l,width:d,customProps:r.config.customProps});else if(n===null)o=t.jsx(qe,{});else if(r.dataType==="string"){const u=r;typeof n=="string"?u.config?.url?o=t.jsx(Mt,{...c,property:r,value:n}):u.config?.storageMeta?o=t.jsx(Yo,{...c,property:r,value:n}):u.config?.markdown?o=t.jsx(at,{source:n}):o=t.jsx(At,{...c,property:r,value:n}):o=De(i,r.dataType,n)}else if(r.dataType==="array")if(n instanceof Array){const u=r;if(!u.of&&!u.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${i}`);u.of?u.of.dataType==="map"?o=t.jsx(qo,{name:i,property:r,value:n,size:a}):u.of.dataType==="reference"?typeof u.of.path=="string"?o=t.jsx(Jo,{...c,value:n,property:r}):o=t.jsx(qe,{}):u.of.dataType==="string"?u.of.config?.enumValues?o=t.jsx($t,{...c,value:n,property:r}):u.of.config?.storageMeta?o=t.jsx(Xo,{...c,value:n,property:r}):o=t.jsx(Lo,{...c,value:n,property:r}):u.of.dataType==="number"?u.of.config?.enumValues&&(o=t.jsx($t,{...c,value:n,property:r})):o=t.jsx(Qo,{...c,value:n,property:r}):u.oneOf&&(o=t.jsx(Zo,{...c,value:n,property:r}))}else o=De(i,r.dataType,n);else r.dataType==="map"?typeof n=="object"?o=t.jsx(Ko,{...c,property:r}):o=De(i,r.dataType,n):r.dataType==="timestamp"?n instanceof Date?o=t.jsx(Ho,{...c,value:n,property:r}):o=De(i,r.dataType,n):r.dataType==="reference"?typeof r.path=="string"?n instanceof ke?o=t.jsx(He,{...c,value:n,property:r}):o=De(i,r.dataType,n):o=t.jsx(qe,{}):r.dataType==="boolean"?typeof n=="boolean"?o=t.jsx(Mo,{...c,value:n,property:r}):o=De(i,r.dataType,n):r.dataType==="number"?typeof n=="number"?o=t.jsx(zo,{...c,value:n,property:r}):o=De(i,r.dataType,n):o=JSON.stringify(n);return o??t.jsx(qe,{})}function De(e,o,r){return console.error(`Unexpected value for property ${e}, of type ${o}`,r),t.jsx(me,{error:`Unexpected value: ${JSON.stringify(r)}`})}function ss(e="inherit",o="inherit"){return t.jsx(Qi.default,{color:e,fontSize:o})}function ct(e,o="inherit",r="inherit"){return e.dataType==="string"?e.config?.multiline||e.config?.markdown?t.jsx(qi.default,{color:o,fontSize:r}):e.config?.storageMeta?e.config.storageMeta.mediaType==="image"?t.jsx(Xi.default,{color:o,fontSize:r}):t.jsx(zi.default,{color:o,fontSize:r}):e.config?.url?t.jsx(Ji.default,{color:o,fontSize:r}):e.config?.enumValues?t.jsx(Ui.default,{color:o,fontSize:r}):t.jsx(Ni.default,{color:o,fontSize:r}):e.dataType==="number"?t.jsx(Yi.default,{color:o,fontSize:r}):e.dataType==="geopoint"?t.jsx(Hi.default,{color:o,fontSize:r}):e.dataType==="map"?e.properties?t.jsx(ji.default,{color:o,fontSize:r}):t.jsx(Co.default,{color:o,fontSize:r}):e.dataType==="array"?e.of?ct(e.of,o,r):t.jsx(Co.default,{color:o,fontSize:r}):e.dataType==="boolean"?t.jsx(Ki.default,{color:o,fontSize:r}):e.dataType==="timestamp"?t.jsx(Wi.default,{color:o,fontSize:r}):e.dataType==="reference"?t.jsx(Gi.default,{color:o,fontSize:r}):t.jsx(Vi.default,{color:o,fontSize:r})}const Ro=K.default(e=>Q.default({property:{display:"flex"},valuePreview:{height:"72px",padding:e.spacing(2,3)},iconCell:{paddingTop:e.spacing(1)},titleCell:{width:"25%",padding:e.spacing(1)}}));function dt({entity:e,schema:o,path:r}){const i=Ro(),n=de(),a=o.properties;return t.jsx(s.TableContainer,{children:t.jsx(s.Table,{"aria-label":"entity table",children:t.jsxs(s.TableBody,{children:[t.jsxs(s.TableRow,{children:[t.jsx(s.TableCell,{align:"right",component:"td",scope:"row",className:i.titleCell,children:t.jsx(s.Typography,{variant:"caption",color:"textSecondary",children:"Id"})}),t.jsx(s.TableCell,{padding:"none",className:i.iconCell,children:ss("disabled","small")}),t.jsx(s.TableCell,{className:i.valuePreview,children:t.jsxs(s.Box,{display:"flex",alignItems:"center",children:[e.id,n?.entityLinkBuilder&&t.jsx("a",{href:n.entityLinkBuilder({entity:e}),rel:"noopener noreferrer",target:"_blank",children:t.jsx(s.IconButton,{"aria-label":"go-to-entity-datasource",size:"large",children:t.jsx(rt.default,{fontSize:"small"})})})]})})]}),o&&Object.entries(a).map(([l,d])=>{const c=e.values[l];return t.jsxs(s.TableRow,{children:[t.jsx(s.TableCell,{align:"right",component:"td",scope:"row",className:i.titleCell,children:t.jsx(s.Typography,{style:{paddingLeft:"16px"},variant:"caption",color:"textSecondary",children:d.title})}),t.jsx(s.TableCell,{padding:"none",className:i.iconCell,children:ct(d,"disabled","small")}),t.jsx(s.TableCell,{className:i.valuePreview,children:t.jsx(ie,{children:t.jsx(ue,{name:l,value:c,property:d,size:"regular"})})})]},"entity_prev"+d.title+l)})]})})})}var ls=Object.freeze(Object.defineProperty({__proto__:null,useStyles:Ro,EntityPreview:dt,default:dt},Symbol.toStringTag,{value:"Module"}));function cs(e){return e.dataType==="boolean"?"center":e.dataType==="number"?e.config?.enumValues?"left":"right":e.dataType==="timestamp"?"right":"left"}function er(e){if(e.columnWidth)return e.columnWidth;if(e.dataType==="string")return e.config?.url?e.config?.url==="video"||e.config?.storageMeta?.mediaType==="video"?340:e.config?.url==="audio"||e.config?.storageMeta?.mediaType==="audio"?300:240:e.config?.storageMeta?220:e.config?.enumValues?200:e.config?.multiline||e.config?.markdown?300:(e.validation?.email,200);if(e.dataType==="array"){const o=e;return o.of?er(o.of):300}else return e.dataType==="number"?e.config?.enumValues?200:140:e.dataType==="map"?360:e.dataType==="timestamp"?160:e.dataType==="reference"?220:e.dataType==="boolean"?140:200}function tr(e){return`subcollection:${e.path}`}function ds(e,o,r){return p.useMemo(()=>{const i=e.properties,n=e.excludedProperties,a=e.additionalColumns??[],l=e.subcollections??[],d=o.properties,c=Object.entries(d).filter(([h,f])=>f.disabled&&typeof f.disabled=="object"&&f.disabled.hidden).map(([h,f])=>h),u=[...Object.keys(e.schema.properties),...a.map(h=>h.id)];let g;if(i?g=i.map(h=>u.find(f=>f===h)).filter(h=>!!h):n?g=u.filter(h=>!n.includes(h)):g=u.filter(h=>!c.includes(h)),r){const h=l.map(f=>tr(f)).filter(f=>n?!n?.includes(f):!0);g.push(...h.filter(f=>!g.includes(f)))}return g},[e.properties,e.excludedProperties,e.additionalColumns,e.subcollections,e.schema.properties,o.properties,r])}const us=K.default(e=>Q.default({search:{position:"relative",display:"flex",alignItems:"center",height:40,borderRadius:e.shape.borderRadius,backgroundColor:e.palette.mode==="light"?ot.alpha(e.palette.common.black,.05):ot.darken(e.palette.background.default,.2),"&:hover":{backgroundColor:e.palette.mode==="light"?ot.alpha(e.palette.common.black,.1):ot.darken(e.palette.background.default,.3)},marginLeft:e.spacing(1),[e.breakpoints.up("sm")]:{marginLeft:e.spacing(1),width:"auto"}},searchIcon:{padding:e.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",minHeight:"inherit"},inputInput:{padding:e.spacing(1,1,1,0),paddingLeft:`calc(1em + ${e.spacing(4)})`,transition:e.transitions.create("width"),width:"100%",[e.breakpoints.up("sm")]:{width:"12ch"}},inputActive:{[e.breakpoints.up("sm")]:{width:"20ch"}}}));function fs({onTextSearch:e}){const o=us(),[r,i]=p.useState(""),[n,a]=p.useState(!1);p.useEffect(()=>{const d=setTimeout(()=>{e(r||void 0)},250);return()=>{clearTimeout(d)}},[r]);const l=p.useCallback(()=>{i(""),e(void 0)},[]);return t.jsx(s.FormControl,{children:t.jsxs("div",{className:o.search,children:[t.jsx("div",{className:o.searchIcon,children:t.jsx(fi.default,{htmlColor:"#666"})}),t.jsx(ui.default,{placeholder:"Search",value:r,onChange:d=>{i(d.target.value)},onFocus:()=>a(!0),onBlur:()=>a(!1),classes:{root:o.inputRoot,input:he.default(o.inputInput,{[o.inputActive]:n})},endAdornment:r?t.jsx(s.IconButton,{size:"small",onClick:l,children:t.jsx(Be.default,{fontSize:"small"})}):t.jsx("div",{style:{width:26}}),inputProps:{"aria-label":"search"}})]})})}const hs=K.default(e=>Q.default({toolbar:{minHeight:56,[e.breakpoints.down("xl")]:{paddingLeft:e.spacing(.5),paddingRight:e.spacing(.5)},paddingLeft:e.spacing(1),paddingRight:e.spacing(1),backgroundColor:e.palette.mode==="light"?e.palette.common.white:e.palette.background.default,borderBottom:`1px solid ${e.palette.divider}`,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%"},actions:{display:"flex",alignItems:"center","& > *":{[e.breakpoints.down("md")]:{marginRight:e.spacing(.5)},marginRight:e.spacing(1)}},selectRoot:{"label + &":{marginTop:e.spacing(3)}},input:{borderRadius:4,position:"relative",backgroundColor:e.palette.mode==="light"?s.alpha(e.palette.common.black,.05):s.darken(e.palette.background.default,.2),fontSize:14,fontWeight:e.typography.fontWeightMedium,padding:"10px 26px 10px 12px",transition:e.transitions.create(["border-color","box-shadow"]),"&:focus":{borderRadius:4}},item:{backgroundColor:e.palette.background.default,fontSize:14,fontWeight:e.typography.fontWeightMedium,paddingTop:e.spacing(1),paddingBottom:e.spacing(1),"&:hover":{backgroundColor:s.darken(e.palette.background.default,.1)},"&:focus":{backgroundColor:s.darken(e.palette.background.default,.2),"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:e.palette.text.primary}}}}));function gs(e){const o=hs(),r=s.useTheme(),i=s.useMediaQuery(r.breakpoints.up("md")),n=e.filterIsSet&&t.jsx(s.Box,{display:"flex",alignItems:"center",children:t.jsx(s.Tooltip,{title:"Clear filter",children:t.jsx(s.IconButton,{style:{height:"fit-content"},"aria-label":"filter clear",onClick:e.clearFilter,size:"large",children:t.jsx(Be.default,{})})})});return t.jsxs("div",{className:o.toolbar,children:[t.jsxs(s.Box,{display:"flex",alignItems:"center",children:[e.title&&t.jsx(s.Hidden,{lgDown:!0,children:t.jsx(s.Box,{mr:2,children:e.title})}),n]}),t.jsxs("div",{className:o.actions,children:[i&&t.jsx(s.Box,{width:22,children:e.loading&&t.jsx(s.CircularProgress,{size:16,thickness:8})}),e.onTextSearch&&t.jsx(fs,{onTextSearch:e.onTextSearch},"search-bar"),e.actions]})]})}const ps=K.default(e=>Q.default({tableContainer:{width:"100%",height:"100%",flexGrow:1},headerTypography:{fontSize:"0.750rem",fontWeight:600,textTransform:"uppercase"},header:{width:"calc(100% + 24px)",margin:"0px -12px",padding:"0px 12px",color:e.palette.text.secondary,backgroundColor:e.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600},tableRow:{cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.875rem"},tableRowClickable:{"&:hover":{backgroundColor:e.palette.mode==="dark"?s.alpha(e.palette.background.default,.6):s.alpha(e.palette.background.default,.5)}},column:{padding:"0px !important"},cellButtonsWrap:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",backgroundColor:(e.palette.mode==="dark",s.alpha(e.palette.background.default,.8))},cellButtons:{minWidth:138},cellButtonsId:{width:138,textAlign:"center",textOverflow:"ellipsis",overflow:"hidden"},selectContainer:{display:"flex",justifyContent:"space-around"},verticalLine:{width:"1px",backgroundColor:"#dfdfdf",height:"55px"},"select-all":{position:"absolute",top:"-100px",right:"-100px",opacity:"0"}}));function zt({entity:e,isSelected:o,isAllSelected:r,selectionEnabled:i,size:n,toggleEntitySelection:a,selectAll:l,onCopyClicked:d,onEditClicked:c,onDeleteClicked:u,data:g}){const h=Boolean(c),f=Boolean(u),b=ps(),[y,v]=z.default.useState(null);p.useCallback(m=>{v(m.currentTarget),m.stopPropagation()},[v]),p.useCallback(()=>{v(null)},[v]);const C=m=>{a&&a(e),m.stopPropagation()},w=m=>{l&&l(e),m.stopPropagation()};return p.useCallback(m=>{m.stopPropagation(),u&&u(e),v(null)},[e,u,v]),p.useCallback(m=>{m.stopPropagation(),d&&d(e),v(null)},[e,d,v]),t.jsxs("div",{className:b.cellButtonsWrap,children:[(h||f||i)&&t.jsxs("div",{className:b.cellButtons,children:["(",t.jsxs("div",{className:b.selectContainer,children:[h&&t.jsx(s.Tooltip,{title:`Edit ${e.id}`,children:t.jsx(s.IconButton,{onClick:m=>{m.stopPropagation(),c&&c(e)},size:"large",children:t.jsx(Je.KeyboardTab,{})})}),t.jsx("span",{className:b.verticalLine}),i&&t.jsxs("div",{children:[t.jsx(s.Tooltip,{title:`Select ${e.id}`,style:{marginTop:"5px"},children:t.jsx(s.Checkbox,{checked:o,onChange:C})}),t.jsx(s.Tooltip,{title:"Select All",className:b["select-all"]+" select-all",children:t.jsx(s.Checkbox,{checked:r,onChange:w})})]})]}),")"]}),n!=="xs"&&t.jsx("div",{className:b.cellButtonsId,children:e?t.jsxs(s.Typography,{className:"mono",variant:"caption",color:"textSecondary",children:[" ",e.id," "]}):t.jsx(s.Skeleton,{variant:"text"})})]})}function Vt(e){switch(e){case"xl":return 400;case"l":return 280;case"m":return 140;case"s":return 80;case"xs":return 54;default:throw Error("Missing mapping for collection size -> height")}}const bs=K.default(e=>Q.default({tableCell:{position:"relative",height:"100%",width:"100%",border:"2px solid transparent",borderRadius:4,overflow:"hidden",contain:"strict",display:"flex",padding:({size:o,removePadding:r})=>{if(r)return 0;switch(o){case"l":case"xl":return e.spacing(2);case"m":return e.spacing(1);case"s":return e.spacing(.5);default:return e.spacing(.25)}},"&:hover":{backgroundColor:({disabled:o})=>o?void 0:e.palette.mode==="dark"?e.palette.background.paper:e.palette.background.default},justifyContent:({align:o})=>{switch(o){case"right":return"flex-end";case"center":return"center";case"left":default:return"flex-start"}}},fullWidth:{width:"100%"},fullHeight:{height:"100%"},error:{border:`2px solid ${e.palette.error.light} !important`},selected:{},saved:{border:`2px solid ${e.palette.success.light}`},disabled:{alpha:.8},iconsTop:{position:"absolute",top:2,right:2},arrow:{color:e.palette.error.light},tooltip:{margin:"0 8px",backgroundColor:e.palette.error.light},centered:{alignItems:"center"},faded:{"-webkit-mask-image":"linear-gradient(to bottom, black 60%, transparent 100%)",maskImage:"linear-gradient(to bottom, black 60%, transparent 100%)",alignItems:"start"},scrollable:{overflow:"auto",alignItems:"start"}})),vs=({children:e,selected:o,focused:r,disabled:i,disabledTooltip:n,size:a,saved:l,error:d,align:c,allowScroll:u,openPopup:g,removePadding:h,fullHeight:f,select:b,showExpandIcon:y=!0})=>{const v=z.default.createRef(),[C,w]=p.useState(!1),m=p.useMemo(()=>Vt(a),[a]),[S,k]=p.useState(!1),[_,I]=p.useState(l),A=z.default.createRef();p.useEffect(()=>{A.current&&r&&A.current.focus({preventScroll:!0})},[r]),p.useEffect(()=>{_!==l&&I(!0);const J=setTimeout(()=>{I(!1)},500);return()=>{clearTimeout(J)}},[l]);const P=p.useCallback(()=>{if(g){const N=v&&v?.current?.getBoundingClientRect();g(N)}},[v]),q=p.useCallback(N=>{N.detail===3&&P()},[P]),O=p.useCallback(()=>{if(!b)return;const N=v&&v?.current?.getBoundingClientRect();i?b(void 0):!o&&N&&b(N)},[v,b,o,i]),T=p.useCallback(N=>{O(),N.stopPropagation()},[O]),E=p.useCallback(N=>{if(N?.bounds){const J=N.bounds.height>m;C!==J&&w(J)}},[C,m]),$=bs({size:a,align:c,disabled:i,removePadding:h}),D=t.jsx(po.default,{bounds:!0,onResize:E,children:({measureRef:N})=>t.jsx("div",{ref:N,className:he.default($.fullWidth,{[$.fullHeight]:f}),children:e})});return t.jsxs("div",{tabIndex:o||i?void 0:0,ref:v,onFocus:T,onClick:q,onMouseEnter:()=>k(!0),onMouseMove:()=>k(!0),onMouseLeave:()=>k(!1),className:he.default($.tableCell,{[$.disabled]:i,[$.centered]:i||!C,[$.error]:d,[$.saved]:o&&_,[$.fullHeight]:f}),children:[t.jsx("div",{className:he.default($.fullWidth,{[$.faded]:!i&&!u&&C,[$.scrollable]:!i&&u&&C,[$.fullHeight]:f}),children:D}),i&&S&&n&&t.jsx("div",{style:{position:"absolute",top:4,right:4,fontSize:"14px"}}),(d||y)&&t.jsx("div",{className:$.iconsTop,children:d&&t.jsx(s.Tooltip,{classes:{arrow:$.arrow,tooltip:$.tooltip},arrow:!0,placement:"left",title:d.message,children:t.jsx(Oi.default,{fontSize:"inherit",color:"error"})})})]})},Ut=z.default.memo(vs,ys);function ys(e,o){return e.selected===o.selected&&e.focused===o.selected&&e.disabled===o.disabled&&e.size===o.size&&e.align===o.align&&e.saved===o.saved&&e.showExpandIcon===o.showExpandIcon&&e.removePadding===o.removePadding&&e.fullHeight===o.fullHeight&&Se.default(e.value,o.value)}Ce.addMethod(Ce.array,"uniqueInArray",function(e=r=>r,o){return this.test("uniqueInArray",o,r=>!r||r.length===new Set(r.map(e)).size)});function or(e,o){const r={};return Object.entries(e).forEach(([i,n])=>{r[i]=ut({property:n,customFieldValidator:o,name:i})}),Ce.object().shape(r)}function ut(e){const o=e.property;if(typeof o=="function")throw console.log("Error in property",e),Error("PropertyBuilders can only be defined as the root properties in entity schemas, not in child properties");if(o.dataType==="string")return Cs(e);if(o.dataType==="number")return ms(e);if(o.dataType==="boolean")return ks(e);if(o.dataType==="map")return ws(e);if(o.dataType==="array")return Es(e);if(o.dataType==="timestamp")return Ss(e);if(o.dataType==="geopoint")return xs(e);if(o.dataType==="reference")return Ts(e);throw console.error("Unsupported data type in yup mapping",o),Error("Unsupported data type in yup mapping")}function ws({property:e,parentProperty:o,customFieldValidator:r,name:i}){const n={};return e.properties&&Object.entries(e.properties).forEach(([a,l])=>{n[a]=ut({property:l,parentProperty:e,customFieldValidator:r,name:`${i}[${a}]`})}),Ce.object().shape(n)}function Cs({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.string();const a=e.validation;return e.config?.enumValues&&(a?.required&&(n=n.required(a?.requiredMessage?a.requiredMessage:"Required")),n=n.oneOf(Ne(e.config?.enumValues).map(([l,d])=>l))),a?(n=a.required?n.required(a?.requiredMessage?a.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),a.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",(l,d)=>r({name:i,property:e,parentProperty:o,value:l}))),(a.min||a.min===0)&&(n=n.min(a.min,`${e.title} must be min ${a.min} characters long`)),(a.max||a.max===0)&&(n=n.max(a.max,`${e.title} must be max ${a.max} characters long`)),a.matches&&(n=n.matches(a.matches,a.matchesMessage)),a.email&&(n=n.email(`${e.title} must be an email`)),a.url&&(n=n.url(`${e.title} must be a url`)),a.trim&&(n=n.trim()),a.lowercase&&(n=n.lowercase()),a.uppercase&&(n=n.uppercase())):n=n.notRequired().nullable(!0),n}function ms({property:e,parentProperty:o,customFieldValidator:r,name:i}){const n=e.validation;let a=Ce.number().typeError("Must be a number");return n?(a=n.required?a.required(n.requiredMessage?n.requiredMessage:"Required").nullable(!0):a.notRequired().nullable(!0),n.unique&&r&&i&&(a=a.test("unique","This value already exists and should be unique",l=>r({name:i,property:e,parentProperty:o,value:l}))),(n.min||n.min===0)&&(a=a.min(n.min,`${e.title} must be higher or equal to ${n.min}`)),(n.max||n.max===0)&&(a=a.max(n.max,`${e.title} must be lower or equal to ${n.max}`)),(n.lessThan||n.lessThan===0)&&(a=a.lessThan(n.lessThan,`${e.title} must be higher than ${n.lessThan}`)),(n.moreThan||n.moreThan===0)&&(a=a.moreThan(n.moreThan,`${e.title} must be lower than ${n.moreThan}`)),n.positive&&(a=a.positive(`${e.title} must be positive`)),n.negative&&(a=a.negative(`${e.title} must be negative`)),n.integer&&(a=a.integer(`${e.title} must be an integer`))):a=a.notRequired().nullable(!0),a}function xs({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.object();const a=e.validation;return a?.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",l=>r({name:i,property:e,parentProperty:o,value:l}))),a?.required?n=n.required(a.requiredMessage).nullable(!0):n=n.notRequired().nullable(!0),n}function Ss({property:e,parentProperty:o,customFieldValidator:r,name:i}){if(e.autoValue)return Ce.object().nullable(!0);let n=Ce.date();const a=e.validation;return a?(n=a.required?n.required(a?.requiredMessage?a.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),a.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",l=>r({name:i,property:e,parentProperty:o,value:l}))),a.min&&(n=n.min(a.min,`${e.title} must be after ${a.min}`)),a.max&&(n=n.max(a.max,`${e.title} must be before ${a.min}`))):n=n.notRequired().nullable(!0),n}function Ts({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.object();const a=e.validation;return a?(n=a.required?n.required(a?.requiredMessage?a.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),a.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",l=>r({name:i,property:e,parentProperty:o,value:l})))):n=n.notRequired().nullable(!0),n}function ks({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.boolean();const a=e.validation;return a?(n=a.required?n.required(a?.requiredMessage?a.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),a.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",l=>r({name:i,property:e,parentProperty:o,value:l})))):n=n.notRequired().nullable(!0),n}function _s(e){return e.validation?.uniqueInArray?!0:e.dataType==="map"&&e.properties?Object.entries(e.properties).filter(([o,r])=>r.validation?.uniqueInArray):!1}function Es({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.array();if(e.of){n=n.of(ut({property:e.of,parentProperty:e}));const l=_s(e.of);l&&(typeof l=="boolean"?n=n.uniqueInArray(d=>d,`${e.title} should have unique values within the array`):Array.isArray(l)&&l.forEach(([d,c])=>{n=n.uniqueInArray(u=>u&&u[d],`${e.title} \u2192 ${c.title??d}: should have unique values within the array`)}))}const a=e.validation;return a?(n=a.required?n.required(a?.requiredMessage?a.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),(a.min||a.min===0)&&(n=n.min(a.min,`${e.title} should be min ${a.min} entries long`)),a.max&&(n=n.max(a.max,`${e.title} should be max ${a.max} entries long`))):n=n.notRequired().nullable(!0),n}const Is=K.default(e=>Q.default({input:{padding:0,margin:0,width:"100%",color:"unset",fontWeight:"unset",lineHeight:"unset",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none"}}));function Bs(e){const{disabled:o,value:r,multiline:i,updateValue:n,focused:a}=e,[l,d]=p.useState(r),c=p.useRef(!1);p.useEffect(()=>{const f=setTimeout(()=>{(!r||r.length===0)&&!l||l!==r&&n(l)},300);return()=>{clearTimeout(f)}},[l]),p.useEffect(()=>{!a&&r!==l&&d(r)},[r,a]);const u=Is(),g=z.default.createRef();return p.useEffect(()=>{g.current&&a&&!c.current?(c.current=!0,g.current.focus({preventScroll:!0}),g.current.selectionStart=g.current.value.length,g.current.selectionEnd=g.current.value.length):c.current=a},[a,g]),t.jsx("div",{style:{display:"flex"},children:t.jsx(s.TextareaAutosize,{ref:g,disabled:o,className:he.default(u.input),value:l??"",onChange:h=>{const f=h.target.value;(i||!f.endsWith(`
`))&&d(f)}})})}const Ps=K.default(e=>Q.default({select:{height:"100%"},selectRoot:{display:"flex",alignItems:"center",height:"100%"}}));function Wt(e){const{name:o,enumValues:r,error:i,internalValue:n,disabled:a,small:l,focused:d,updateValue:c,multiple:u,setPreventOutsideClick:g,valueType:h}=e,[f,b]=p.useState(!1),y=()=>{g(!0),b(!0)},v=()=>{g(!1),b(!1)},C=Ps(),w=Array.isArray(n)&&u||!Array.isArray(n)&&!u,m=z.default.createRef();return p.useEffect(()=>{m.current&&d&&m.current?.focus({preventScroll:!0})},[d,m]),t.jsx(s.Select,{variant:"standard",inputRef:m,className:C.select,classes:{select:C.selectRoot},open:f,disabled:a,multiple:u,onClose:v,onOpen:y,fullWidth:!0,inputProps:{style:{height:"100%"}},disableUnderline:!0,error:!!i,value:w?u?n.map(S=>S.toString()):n:u?[]:"",onChange:S=>{if(h==="number")if(u){const k=S.target.value.map(_=>parseFloat(_));c(k)}else c(parseFloat(S.target.value));else if(h==="string")S.target.value?c(S.target.value):c(null);else throw Error("Missing mapping in TableSelect")},renderValue:S=>u&&Array.isArray(S)?t.jsx(it,{value:S,name:o,enumValues:r,size:l?"small":"regular"}):t.jsx(xe,{enumKey:S,enumValues:r,small:l}),children:Ne(r).map(([S,k])=>{const _=t.jsx(xe,{enumKey:S,enumValues:r,small:!0});return u?t.jsxs(s.MenuItem,{value:S,disabled:Re(k),dense:!0,children:[t.jsx(s.Checkbox,{checked:Array.isArray(n)&&n.map(I=>I.toString()).includes(S.toString())}),t.jsx(s.ListItemText,{primary:_})]},`select-${o}-${S}`):t.jsx(s.MenuItem,{value:S,disabled:Re(k),dense:!0,children:_},`select-${o}-${S}`)})},`table_select_${o}`)}const Fs=K.default(e=>Q.default({input:{padding:0,margin:0,width:"100%",color:"unset",fontWeight:"unset",lineHeight:"unset",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none"},numberInput:{textAlign:"right"}}));function As(e){const{align:o,value:r,updateValue:i,focused:n,onBlur:a,disabled:l}=e,d=r&&typeof r=="number"?r.toString():"",[c,u]=p.useState(d);p.useEffect(()=>{const y=setTimeout(()=>{if(c!==d)if(c!=null){const v=parseFloat(c);if(isNaN(v))return;v!=null&&i(v)}else i(null)},300);return()=>{clearTimeout(y)}},[c]),p.useEffect(()=>{!n&&d!==c&&u(r!=null?r.toString():null)},[r,n]);const g=z.default.createRef(),h=Fs();p.useEffect(()=>{g.current&&n&&g.current.focus({preventScroll:!0})},[n,g]);const f=/^-?[0-9]+[,.]?[0-9]*$/;return t.jsx(s.Input,{inputRef:g,style:{width:"100%",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none",padding:0},inputProps:{style:{textAlign:o}},disabled:l,className:he.default(h.input,h.numberInput),disableUnderline:!0,value:c??"",onBlur:a,onChange:b=>{const y=b.target.value.replace(",",".");y.length===0&&u(null),(f.test(y)||y.startsWith("-"))&&u(y)}})}function $s(e){const{disabled:o,internalValue:r,updateValue:i,focused:n}=e,a=z.default.createRef();return p.useEffect(()=>{a.current&&n&&a.current.focus({preventScroll:!0})},[n,a]),t.jsx(s.Switch,{inputRef:a,color:"secondary",checked:Boolean(r),disabled:o,onChange:l=>{const d=l.target.checked;i(d)}})}K.default(e=>Q.default({hidden:{display:"none"}}));function Os(e){const{disabled:o,error:r,internalValue:i,setPreventOutsideClick:n,updateValue:a}=e,l=p.useCallback(()=>{n(!0)},[]),d=p.useCallback(()=>{n(!1)},[]);return t.jsx(s.Box,{display:"flex",alignItems:"center",width:"100%",children:t.jsx(mt.default,{value:i??null,clearable:!0,disabled:o,onChange:c=>{a(c)},renderInput:c=>t.jsx(s.TextField,{...c,variant:"standard",error:Boolean(r),style:{height:"100%"},InputProps:{...c.InputProps,style:{fontSize:14},disableUnderline:!0}}),InputAdornmentProps:{style:{fontSize:"small",height:26}},onOpen:l,onClose:d})})}function rr(e){const{name:o,internalValue:r,setPreventOutsideClick:i,property:n,updateValue:a,size:l,disabled:d}=e;let c,u;if(n.dataType==="reference")c=n,u=!1;else if(n.dataType==="array"&&n.of?.dataType==="reference")c=n.of,u=!0;else throw Error("TableReferenceField misconfiguration");if(typeof c.path!="string")throw Error("Picked the wrong component TableReferenceField");const g=c.path,[h,f]=p.useState(!1),[b,y]=p.useState(!1),C=Te().getCollectionResolver(g);if(!C)throw Error(`Couldn't find the corresponding collection view for the path: ${g}`);const w=p.useCallback(q=>{d||q.detail<=1&&(q.stopPropagation(),i(!0),y(!0))},[d,i]),m=p.useCallback(()=>{i(!1),y(!1)},[i,y]),S=p.useCallback(q=>{a(q?nt(q):null),i(!1),y(!1)},[a,i,y]),k=p.useCallback(q=>{a(q.map(O=>nt(O)))},[a]),_=r?Array.isArray(r)?r.map(q=>q.id):r.id?[r.id]:[]:[],I=!r||Array.isArray(r)&&r.length===0;function A(){return r instanceof ke?t.jsx(He,{name:o,onClick:d?void 0:w,value:r,property:c,onHover:h,size:Pe(l)}):t.jsx(me,{error:"Data is not a reference"})}function P(){return Array.isArray(r)?t.jsx(t.Fragment,{children:r.map((q,O)=>t.jsx(s.Box,{sx:{m:.5},children:t.jsx(He,{name:`${o}[${O}]`,onClick:d?void 0:w,size:"tiny",onHover:h,value:q,property:c})},`preview_array_ref_${o}_${O}`))}):t.jsx(me,{error:"Data is not an array of references"})}return C?t.jsxs("div",{onMouseEnter:()=>f(!0),onMouseMove:()=>f(!0),onMouseLeave:()=>f(!1),children:[r&&!u&&A(),r&&u&&P(),I&&t.jsxs(s.Button,{onClick:w,size:"small",variant:"outlined",color:"primary",children:["Edit ",n.title]}),!d&&b&&t.jsx(ht,{open:b,multiselect:u,path:g,collectionResolver:C,onClose:m,onMultipleEntitiesSelected:k,onSingleEntitySelected:S,selectedEntityIds:_})]}):t.jsx(me,{error:"The specified collection does not exist"})}const Ds=K.default(e=>({dropZone:{position:"relative",height:"100%",outline:0,display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:({hasValue:o})=>o?"start":"center",alignItems:"center"},activeDrop:{borderRadius:"2px",border:"2px solid",borderColor:"transparent"},acceptDrop:{transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",background:"repeating-linear-gradient( 45deg, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.2) 10px, rgba(128, 128, 128, 0.25) 10px, rgba(128, 128, 128, 0.25) 20px) !important",borderColor:e.palette.success.light},rejectDrop:{borderColor:e.palette.error.light},arrayEntry:{border:"1px dashed transparent",borderRadius:"4px"},arrayEntryHovered:{opacity:.5,border:"1px dashed gray",boxSizing:"border-box"},thumbnailCloseIcon:{position:"absolute",borderRadius:"9999px",top:-8,right:-8,zIndex:100,backgroundColor:e.palette.background.paper}}));function Ls(e){const{name:o,error:r,internalValue:i,disabled:n,property:a,entityId:l,entityValues:d,previewSize:c,updateValue:u,setPreventOutsideClick:g}=e,h=a.dataType==="array",f=a.dataType==="string"?a.config?.storageMeta:a.dataType==="array"&&a.of.dataType==="string"?a.of.config?.storageMeta:void 0;if(!f)throw Error("Storage meta must be specified");const b=v=>{if(f.fileName){const C=f.fileName({entityId:l,values:d,property:a,file:v,storageMeta:f,name:o});if(!C||C.length===0)throw Error("You need to return a valid filename");return C}return v.name},y=v=>{if(typeof f.storagePath=="string")return f.storagePath;if(typeof f.storagePath=="function"){const C=f.storagePath({entityId:l,values:d,property:a,file:v,storageMeta:f,name:o});if(!C||C.length===0)throw Error("You need to return a valid filename");return C}return console.warn("When using a storage property, if you don't specify the storagePath, the root storage is used"),"/"};return t.jsx(Ms,{value:i,name:o,disabled:n,autoFocus:!1,property:a,onChange:v=>{u(v)},fileNameBuilder:b,storagePathBuilder:y,storageMeta:f,multipleFilesSupported:h,previewSize:c})}function Ms({property:e,name:o,value:r,onChange:i,multipleFilesSupported:n,previewSize:a,disabled:l,autoFocus:d,storageMeta:c,fileNameBuilder:u,storagePathBuilder:g}){const h=Ve(),[f,b]=p.useState(!1),y=n&&a==="regular"?"small":a;if(n){const F=e;if(F.of){if(F.of.dataType!=="string")throw Error("Storage field using array must be of data type string")}else throw Error("Storage field using array must be of data type string")}const v=c?.metadata,C=Boolean(r),w=Ds({hasValue:C}),m=r==null?[]:(n?r:[r]).map(F=>({id:I(),storagePathOrDownloadUrl:F,metadata:v,size:y})),S=se.useRef(r),[k,_]=se.useState(m);Se.default(S.current,r)||(S.current=r,_(m??[]));function I(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}function A(F){return F.filter((X,j)=>(F.map(U=>U.storagePathOrDownloadUrl).indexOf(X.storagePathOrDownloadUrl)===j||!X.storagePathOrDownloadUrl)&&(F.map(U=>U.file).indexOf(X.file)===j||!X.file))}const P=F=>{if(!F.length||l)return;let X;n?X=[...k,...F.map(j=>({id:I(),file:j,fileName:u(j),metadata:v}))]:X=[{id:I(),file:F[0],fileName:u(F[0]),metadata:v}],X=A(X),_(X)},q=async(F,X,j)=>{let U=F;c.storeUrl&&(U=await h.getDownloadURL(F)),c.postProcess&&(U=await c.postProcess(U));let ee;X.storagePathOrDownloadUrl=U,X.metadata=j,ee=[...k],ee=A(ee),_(ee);const G=ee.filter(H=>!!H.storagePathOrDownloadUrl).map(H=>H.storagePathOrDownloadUrl);i(n?G:G?G[0]:null)},O=F=>{if(n){const X=k.filter(j=>j.storagePathOrDownloadUrl!==F);i(X.filter(j=>!!j.storagePathOrDownloadUrl).map(j=>j.storagePathOrDownloadUrl)),_(X)}else i(null),_([])},{open:T,getRootProps:E,getInputProps:$,isDragActive:D,isDragAccept:N,isDragReject:J}=co.useDropzone({accept:c.acceptedFiles,disabled:l,noClick:!0,noKeyboard:!0,onDrop:P}),{...L}=E(),B=n?"Drag 'n' drop some files here, or click here to edit":"Drag 'n' drop a file here, or click here edit",M=n?e.of:e;return t.jsxs(s.Box,{...L,onMouseEnter:()=>b(!0),onMouseMove:()=>b(!0),onMouseLeave:()=>b(!1),className:he.default(w.dropZone,{[w.activeDrop]:D,[w.rejectDrop]:J,[w.acceptDrop]:N}),children:[t.jsx("input",{autoFocus:d,...$()}),k.map((F,X)=>{let j;return F.storagePathOrDownloadUrl?j=t.jsx(qs,{property:M,disabled:l,value:F.storagePathOrDownloadUrl,onClear:O,size:y},`storage_preview_${X}`):F.file&&(j=t.jsx(Ns,{entry:F,metadata:v,storagePath:g(F.file),onFileUploadComplete:q,size:y},`storage_progress_${X}`)),j}),!r&&t.jsx(s.Box,{sx:{flexGrow:1,m:2,maxWidth:200},onClick:T,children:t.jsx(s.Typography,{sx:{color:F=>F.palette.mode==="light"?"#999":"#444"},variant:"body2",align:"center",children:B})}),f&&t.jsx(s.IconButton,{color:"inherit",size:"small",onClick:T,sx:{position:"absolute",bottom:2,right:2},children:t.jsx(Di.default,{sx:{width:16,height:16,fill:"#666"}})})]})}function Ns({storagePath:e,entry:o,metadata:r,onFileUploadComplete:i,size:n}){const a=Ve(),l=We(),[d,c]=se.useState(),[u,g]=se.useState(!1),h=se.useRef(!1),f=p.useCallback((y,v)=>{c(void 0),g(!0),a.uploadFile({file:y,fileName:v,path:e,metadata:r}).then(async({path:C})=>{console.debug("Upload successful"),await i(C,o,r),h.current&&g(!1)}).catch(C=>{console.error("Upload error",C),h.current&&(c(C.message),g(!1)),l.open({type:"error",title:"Error uploading file",message:C.message})})},[o,r,i,l,a,e]);p.useEffect(()=>(h.current=!0,o.file&&f(o.file,o.fileName),()=>{h.current=!1}),[o.file,o.fileName,f]);const b=p.useMemo(()=>ze(n),[n]);return t.jsxs(s.Box,{m:1,sx:{width:b,height:b},children:[u&&t.jsx(s.Skeleton,{variant:"rectangular",sx:{width:b,height:b}}),d&&t.jsxs("p",{children:["Error uploading file: ",d]})]})}function qs({property:e,value:o,size:r}){return t.jsx(s.Box,{m:1,position:"relative",children:o&&t.jsx(ie,{children:t.jsx(ue,{value:o,property:e,size:r})})})}const zs=({selected:e,focused:o,name:r,setPreventOutsideClick:i,setFocused:n,onValueChange:a,select:l,openPopup:d,value:c,property:u,validation:g,size:h,align:f,width:b,height:y,entityId:v,entityValues:C})=>{const[w,m]=p.useState(c);pe({property:u,value:w,setValue:m});const[S,k]=p.useState(),[_,I]=p.useState(!1),A=Boolean(u.config?.Field),P=Boolean(u.config?.Preview),q=Ze(u),O=typeof u.disabled=="object"?u.disabled.disabledMessage:void 0,T=Boolean(u.disabled),E=p.useCallback(()=>{n(!1)},[]);p.useEffect(()=>{c!==w&&m(c)},[c]),p.useEffect(()=>{Se.default(c,w)||(I(!1),g.validate(w).then(()=>{k(void 0),a&&a({value:w,name:r,setError:k,setSaved:I})}).catch(M=>{console.error(M),k(M)}))},[w]);const $=p.useCallback(M=>{let F;M===void 0?F=null:F=M,m(F)},[]);let D,N=!1,J=!1,L=!1,B=!1;if(!q&&!A&&(!P||e)){if(u.dataType==="string"&&u.config?.storageMeta||u.dataType==="array"&&u.of?.dataType==="string"&&u.of?.config?.storageMeta)D=t.jsx(Ls,{error:S,disabled:T,focused:o,property:u,entityId:v,entityValues:C,internalValue:w,previewSize:Pe(h),updateValue:$,name:r,onBlur:E,setPreventOutsideClick:i}),J=!0,B=!0,L=!0;else if(e&&u.dataType==="number"){const F=u;F.config?.enumValues?D=t.jsx(Wt,{name:r,multiple:!1,disabled:T,focused:o,valueType:"number",small:Pe(h)!=="regular",enumValues:F.config.enumValues,error:S,onBlur:E,internalValue:w,updateValue:$,setPreventOutsideClick:i}):(D=t.jsx(As,{align:f,error:S,focused:o,disabled:T,onBlur:E,value:w,updateValue:$}),N=!0)}else if(e&&u.dataType==="string"){const F=u;if(F.config?.enumValues)D=t.jsx(Wt,{name:r,multiple:!1,focused:o,disabled:T,valueType:"string",small:Pe(h)!=="regular",enumValues:F.config.enumValues,error:S,onBlur:E,internalValue:w,updateValue:$,setPreventOutsideClick:i});else if(!F.config?.storageMeta&&!F.config?.markdown){const X=!!F.config?.multiline;D=t.jsx(Bs,{error:S,disabled:T,multiline:X,focused:o,value:w,updateValue:$}),N=!0}}else if(u.dataType==="boolean")D=t.jsx($s,{error:S,disabled:T,focused:o,internalValue:w,updateValue:$});else if(u.dataType==="timestamp")D=t.jsx(Os,{name:r,error:S,disabled:T,focused:o,internalValue:w,updateValue:$,setPreventOutsideClick:i}),N=!0;else if(u.dataType==="reference")typeof u.path=="string"&&(D=t.jsx(rr,{name:r,internalValue:w,updateValue:$,disabled:T,size:h,property:u,setPreventOutsideClick:i})),N=!0;else if(u.dataType==="array"){const F=u;if(F.of&&(F.of.dataType==="string"||F.of.dataType==="number"?e&&F.of.config?.enumValues&&(D=t.jsx(Wt,{name:r,multiple:!0,disabled:T,focused:o,small:Pe(h)!=="regular",valueType:F.of.dataType,enumValues:F.of.config.enumValues,error:S,onBlur:E,internalValue:w,updateValue:$,setPreventOutsideClick:i}),N=!0):F.of.dataType==="reference"&&(typeof F.of.path=="string"&&(D=t.jsx(rr,{name:r,disabled:T,internalValue:w,updateValue:$,size:h,property:u,setPreventOutsideClick:i})),N=!1)),!F.of&&!F.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${r}`)}}return D||(N=!1,J=e&&!D&&!T&&!q,D=t.jsx(ie,{children:t.jsx(ue,{width:b,height:y,name:r,value:w,property:u,size:Pe(h)})})),t.jsx(Ut,{select:l,selected:e,focused:o,disabled:T||q,disabledTooltip:O??"Disabled",removePadding:L,fullHeight:B,size:h,saved:_,error:S,align:f,allowScroll:N,showExpandIcon:J,openPopup:T?void 0:d,value:w,children:D})},Vs=z.default.memo(zs,Us);function Us(e,o){return e.selected===o.selected&&e.focused===o.selected&&e.height===o.height&&e.size===o.size&&e.align===o.align&&e.width===o.width&&Se.default(e.property,o.property)&&Se.default(e.value,o.value)}function Ws({containerRef:e,ref:o,x:r,y:i,onMove:n}){let a=0,l=0;const d=h=>{if(h.button!==0||!o.current||h.target!==o.current)return;const{x:f,y:b}=o.current.getBoundingClientRect();a=h.screenX-f,l=h.screenY-b,document.addEventListener("mousemove",u),document.addEventListener("mouseup",c),h.stopPropagation()},c=h=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c),h.stopPropagation()},u=h=>{n(h.screenX-a,h.screenY-l),h.stopPropagation()},g=()=>{e.current&&(e.current.style.top=`${i}px`,e.current.style.left=`${r}px`)};p.useEffect(()=>{const h=o.current;return h&&h.addEventListener("mousedown",d),g(),()=>{h&&h.removeEventListener("mousedown",d)}})}function Hs(){const[e,o]=p.useState({width:0,height:0});return p.useLayoutEffect(()=>{function r(){o({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",r),r(),()=>window.removeEventListener("resize",r)},[]),e}function ft({name:e,value:o,disabled:r,buildEntry:i,onInternalIdAdded:n,includeAddButton:a}){const l=o&&Array.isArray(o)&&o.length>0,d=p.useMemo(()=>l?o.map((h,f)=>h?{[Io(h)+f]:Ht()}:{}).reduce((h,f)=>({...h,...f}),{}):{},[o,l]),c=p.useRef(d),[u,g]=p.useState(l?Object.values(c.current):[]);return p.useEffect(()=>{if(l&&o&&o.length!==u.length){const h=o.map((f,b)=>{const y=Io(f)+b;if(y in c.current)return c.current[y];{const v=Ht();return c.current[y]=v,v}});g(h)}},[l,u.length,o]),t.jsx(we.FieldArray,{name:e,validateOnChange:!0,render:h=>{const f=()=>{if(r)return;const v=Ht(),C=[...u,v];n&&n(v),g(C),h.push(null)},b=v=>{const C=[...u];C.splice(v,1),g(C),h.remove(v)},y=v=>{if(!v.destination)return;const C=v.source.index,w=v.destination.index,m=[...u],S=m[C];m[C]=m[w],m[w]=S,g(m),h.move(C,w)};return t.jsx(Le.DragDropContext,{onDragEnd:y,children:t.jsx(Le.Droppable,{droppableId:`droppable_${e}`,children:(v,C)=>t.jsxs("div",{...v.droppableProps,ref:v.innerRef,children:[l&&u.map((w,m)=>t.jsx(Le.Draggable,{draggableId:`array_field_${e}_${w}}`,isDragDisabled:r,index:m,children:(S,k)=>t.jsx(s.Box,{ref:S.innerRef,...S.draggableProps,style:S.draggableProps.style,sx:{marginBottom:1,borderRadius:"4px",opacity:1},children:t.jsxs(s.Box,{display:"flex",children:[t.jsx(s.Box,{flexGrow:1,width:"100%",children:i(m,w)},`field_${e}_entryValue`),t.jsxs(s.Box,{width:"36px",display:"flex",flexDirection:"column",alignItems:"center",children:[t.jsx("div",{...S.dragHandleProps,children:t.jsx(Li.default,{fontSize:"small",color:r?"disabled":"inherit",sx:{cursor:r?"inherit":"move"}})}),!r&&t.jsx(s.IconButton,{size:"small","aria-label":"remove",onClick:()=>b(m),children:t.jsx(Be.default,{fontSize:"small"})})]})]},`field_${m}`)})},`array_field_${e}_${w}}`)),v.placeholder,a&&!r&&t.jsx(s.Box,{p:1,justifyContent:"center",textAlign:"left",children:t.jsx(s.Button,{variant:"outlined",color:"primary",disabled:r,onClick:f,children:"Add"})})]})})})}})}function Ht(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}function be({property:e}){const o=typeof e.disabled=="object"?e.disabled.disabledMessage:void 0;return t.jsxs(s.Box,{display:"flex",children:[t.jsx(s.Box,{flexGrow:1,children:t.jsx(s.FormHelperText,{children:o||e.description})}),e.longDescription&&t.jsx(s.Tooltip,{title:t.jsx(s.Typography,{variant:"caption",children:e.longDescription}),placement:"bottom-start",arrow:!0,children:t.jsx(s.IconButton,{edge:"start",size:"small",children:t.jsx(Mi.default,{color:"disabled",fontSize:"small"})})})]})}function ve({property:e}){return t.jsxs(t.Fragment,{children:[t.jsx("span",{style:{paddingRight:"12px"},children:ct(e)}),t.jsx("span",{children:e.title})]})}const js=K.default(e=>Q.default({inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)}}));function jt({name:e,value:o,setValue:r,error:i,showError:n,disabled:a,autoFocus:l,touched:d,property:c,includeDescription:u,shouldAlwaysRerender:g}){const h=js(),f=c.config?.enumValues;return pe({property:c,value:o,setValue:r}),t.jsxs(s.FormControl,{variant:"filled",fullWidth:!0,required:c.validation?.required,error:n,disabled:a,children:[t.jsx(s.InputLabel,{id:`${e}-select-label`,classes:{root:h.inputLabel,shrink:h.shrinkInputLabel},children:t.jsx(ve,{property:c})}),t.jsx(s.Select,{sx:{minHeight:"64px"},variant:"filled",labelId:`${e}-select-label`,autoFocus:l,value:o!==void 0?o:"",disabled:a,onChange:b=>{const y=b.target.value,v=y?c.dataType==="number"?parseFloat(y):y:null;return r(v)},renderValue:b=>t.jsx(xe,{enumKey:b,enumValues:f,small:!1}),children:Ne(f).map(([b,y])=>t.jsx(s.MenuItem,{value:b,disabled:Re(y),children:t.jsx(xe,{enumKey:b,enumValues:f,small:!0})},`select_${e}_${b}`))}),u&&t.jsx(be,{property:c}),n&&t.jsx(s.FormHelperText,{children:i})]})}const Gs=K.default(e=>Q.default({inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)}}));function nr({name:e,value:o,setValue:r,error:i,showError:n,disabled:a,property:l,includeDescription:d,autoFocus:c}){const u=Gs();if(!l.of)throw Error("Using wrong component ArrayEnumSelect");if(l.of.dataType!=="string"&&l.of.dataType!=="number")throw Error("Field misconfiguration: array field of type string or number");const g=l.of.config?.enumValues;if(!g)throw console.error(l),Error("Field misconfiguration: array field of type string or number needs to have enumValues");pe({property:l,value:o,setValue:r});const h=!!o&&Array.isArray(o);return t.jsxs(s.FormControl,{variant:"filled",fullWidth:!0,required:l.validation?.required,error:n,children:[t.jsx(s.InputLabel,{id:`${e}-multiselect-label`,classes:{root:u.inputLabel,shrink:u.shrinkInputLabel},children:t.jsx(ve,{property:l})}),t.jsx(s.Select,{multiple:!0,sx:{minHeight:"64px"},variant:"filled",labelId:`${e}-multiselect-label`,value:h?o.map(f=>f.toString()):[],autoFocus:c,disabled:a,onChange:f=>{let b;return l.of?.dataType==="number"?b=f.target.value?f.target.value.map(y=>parseFloat(y)):[]:b=f.target.value,r(b)},renderValue:f=>t.jsx(it,{value:f,name:e,enumValues:g,size:"regular"}),children:Ne(g).map(([f,b])=>{const y=h&&o.map(v=>v.toString()).includes(f.toString());return t.jsxs(s.MenuItem,{value:f,disabled:Re(b),dense:!0,children:[t.jsx(s.Checkbox,{checked:y}),t.jsx(s.ListItemText,{primary:t.jsx(xe,{enumKey:f,enumValues:g,small:!0})})]},`form-select-${e}-${f}`)})}),d&&t.jsx(be,{property:l}),n&&t.jsx(s.FormHelperText,{children:i})]})}const Gt=K.default(e=>({dropZone:{position:"relative",paddingTop:"2px",border:"2px solid transparent",minHeight:"254px",outline:0,borderTopLeftRadius:"2px",borderTopRightRadius:"2px",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",borderBottom:e.palette.mode==="light"?"1px solid rgba(0, 0, 0, 0.42)":"1px solid rgba(255, 255, 255, 0.7)",boxSizing:"border-box",transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms","&:focus":{borderBottom:`2px solid ${e.palette.primary.main}`}},disabled:{backgroundColor:"rgba(0, 0, 0, 0.12)",color:e.palette.mode==="light"?"rgba(0, 0, 0, 0.38)":"rgba(255, 255, 255, 0.38)",borderBottom:`1px dotted ${e.palette.grey[400]}`},nonActiveDrop:{"&:hover":{backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)"}},activeDrop:{paddingTop:"0px",boxSizing:"border-box",border:"2px solid"},acceptDrop:{transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",background:"repeating-linear-gradient( 45deg, rgba(0, 0, 0, 0.09), rgba(0, 0, 0, 0.09) 10px, rgba(0, 0, 0, 0.12) 10px, rgba(0, 0, 0, 0.12) 20px) !important",border:"2px solid",borderColor:e.palette.success.light},rejectDrop:{border:"2px solid",borderColor:e.palette.error.light},uploadItem:{padding:e.spacing(1),minWidth:220,minHeight:220},uploadItemSmall:{padding:e.spacing(1),minWidth:118,minHeight:118,boxSizing:"border-box"},thumbnailCloseIcon:{position:"absolute",borderRadius:"9999px",top:-8,right:-8,zIndex:100,backgroundColor:e.palette.background.paper}}));function Yt({name:e,value:o,setValue:r,error:i,showError:n,autoFocus:a,tableMode:l,property:d,includeDescription:c,context:u,isSubmitting:g}){const h=d.dataType==="array",f=Ze(d)||!!d.disabled||g,b=h?Array.isArray(o)?o:[]:o;pe({property:d,value:o,setValue:r});const y=d.dataType==="string"?d.config?.storageMeta:d.dataType==="array"&&d.of.dataType==="string"?d.of.config?.storageMeta:void 0;if(!y)throw Error("Storage meta must be specified");const v=w=>{if(y.fileName){const m=y.fileName({entityId:u.entityId,values:u.values,property:d,file:w,storageMeta:y,name:e});if(!m||m.length===0)throw Error("You need to return a valid filename");return m}return w.name},C=w=>{if(typeof y.storagePath=="string")return y.storagePath;if(typeof y.storagePath=="function"){const m=y.storagePath({entityId:u.entityId,values:u.values,property:d,file:w,storageMeta:y,name:e});if(!m||m.length===0)throw Error("You need to return a valid filename");return m}return console.warn("When using a storage property, if you don't specify the storagePath, the root storage is used"),"/"};return t.jsxs(s.FormControl,{fullWidth:!0,required:d.validation?.required,error:n,children:[!l&&t.jsx(s.FormHelperText,{filled:!0,required:d.validation?.required,children:t.jsx(ve,{property:d})}),t.jsx(Xs,{value:b,name:e,disabled:f,autoFocus:a,property:d,onChange:w=>{r(w)},fileNameBuilder:v,storagePathBuilder:C,storageMeta:y,multipleFilesSupported:h}),c&&t.jsx(be,{property:d}),n&&t.jsx(s.FormHelperText,{children:i})]})}function Ys({storageMeta:e,disabled:o,isDraggingOver:r,onExternalDrop:i,multipleFilesSupported:n,droppableProvided:a,autoFocus:l,internalValue:d,property:c,onClear:u,metadata:g,storagePathBuilder:h,onFileUploadComplete:f,size:b,name:y,helpText:v}){const C=Gt(),{getRootProps:w,getInputProps:m,isDragActive:S,isDragAccept:k,isDragReject:_}=co.useDropzone({accept:e.acceptedFiles,disabled:o||r,noDragEventsBubbling:!0,onDrop:i});return t.jsxs(s.Box,{...w(),className:he.default(C.dropZone,{[C.nonActiveDrop]:!S,[C.activeDrop]:S,[C.rejectDrop]:_,[C.acceptDrop]:k,[C.disabled]:o}),sx:{display:n&&d.length?void 0:"flex",alignItems:"center"},children:[t.jsxs(s.Box,{...a.droppableProps,ref:a.innerRef,sx:{display:"flex",alignItems:"center",overflow:n&&d.length?"auto":void 0,minHeight:n&&d.length?180:250,p:1,"&::-webkit-scrollbar":{display:"none"}},children:[t.jsx("input",{autoFocus:l,...m()}),d.map((I,A)=>{let P;if(I.storagePathOrDownloadUrl){const q=n?c.of:c;P=t.jsx(Ks,{name:`storage_preview_${I.storagePathOrDownloadUrl}`,property:q,disabled:o,value:I.storagePathOrDownloadUrl,onClear:u,size:I.size})}else I.file&&(P=t.jsx(Js,{entry:I,metadata:g,storagePath:h(I.file),onFileUploadComplete:f,size:b}));return t.jsx(Le.Draggable,{draggableId:`array_field_${y}_${I.id}}`,index:A,children:(q,O)=>t.jsx(s.Box,{ref:q.innerRef,...q.draggableProps,...q.dragHandleProps,style:q.draggableProps.style,sx:{borderRadius:"4px"},children:P})},`array_field_${y}_${I.id}}`)}),a.placeholder]}),t.jsx(s.Box,{sx:{flexGrow:1,minHeight:38,boxSizing:"border-box",m:2},children:t.jsx(s.Typography,{align:"center",variant:"body2",sx:I=>({color:"#838383",fontWeight:I.typography.fontWeightMedium}),children:v})})]})}function Xs({property:e,name:o,value:r,onChange:i,multipleFilesSupported:n,disabled:a,autoFocus:l,storageMeta:d,fileNameBuilder:c,storagePathBuilder:u}){const g=Ve();if(n){const O=e;if(O.of){if(O.of.dataType!=="string")throw Error("Storage field using array must be of data type string")}else throw Error("Storage field using array must be of data type string")}const h=d?.metadata,f=n?"small":"regular",b=(n?r:[r]).map(O=>({id:m(),storagePathOrDownloadUrl:O,metadata:h,size:f})),[y,v]=se.useState(r),[C,w]=se.useState(b);se.useState(void 0),Se.default(y,r)||(v(r),w(b));function m(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}const S=(O,T)=>{const E=[...C],$=E[O];E.splice(O,1),E.splice(T,0,$),w(E);const D=E.filter(N=>!!N.storagePathOrDownloadUrl).map(N=>N.storagePathOrDownloadUrl);i(D)},k=O=>{!O.destination||S(O.source.index,O.destination.index)};function _(O){return O.filter((T,E)=>(O.map($=>$.storagePathOrDownloadUrl).indexOf(T.storagePathOrDownloadUrl)===E||!T.storagePathOrDownloadUrl)&&(O.map($=>$.file).indexOf(T.file)===E||!T.file))}const I=O=>{if(!O.length||a)return;let T;n?T=[...C,...O.map(E=>({id:m(),file:E,fileName:c(E),metadata:h,size:f}))]:T=[{id:m(),file:O[0],fileName:c(O[0]),metadata:h,size:f}],T=_(T),w(T)},A=async(O,T,E)=>{console.debug("onFileUploadComplete",O,T);let $=O;d.storeUrl&&($=await g.getDownloadURL(O)),d.postProcess&&($=await d.postProcess($));let D;T.storagePathOrDownloadUrl=$,T.metadata=E,D=[...C],D=_(D),w(D);const N=D.filter(J=>!!J.storagePathOrDownloadUrl).map(J=>J.storagePathOrDownloadUrl);i(n?N:N?N[0]:null)},P=O=>{if(n){const T=C.filter(E=>E.storagePathOrDownloadUrl!==O);i(T.filter(E=>!!E.storagePathOrDownloadUrl).map(E=>E.storagePathOrDownloadUrl)),w(T)}else i(null),w([])},q=n?"Drag 'n' drop some files here, or click to select files":"Drag 'n' drop a file here, or click to select one";return t.jsx(Le.DragDropContext,{onDragEnd:k,children:t.jsx(Le.Droppable,{droppableId:`droppable_${o}`,direction:"horizontal",children:(O,T)=>t.jsx(Ys,{storageMeta:d,disabled:a,isDraggingOver:T.isDraggingOver,droppableProvided:O,onExternalDrop:I,multipleFilesSupported:n,autoFocus:l,internalValue:C,property:e,onClear:P,metadata:h,storagePathBuilder:u,onFileUploadComplete:A,size:f,name:o,helpText:q})})})}function Js({storagePath:e,entry:o,metadata:r,onFileUploadComplete:i,size:n}){const a=Ve(),l=Gt(),d=We(),[c,u]=se.useState(),[g,h]=se.useState(!1),f=se.useRef(!1),b=p.useCallback((y,v)=>{u(void 0),h(!0),a.uploadFile({file:y,fileName:v,path:e,metadata:r}).then(async({path:C})=>{console.debug("Upload successful"),await i(C,o,r),f.current&&h(!1)}).catch(C=>{console.error("Upload error",C),f.current&&(u(C.message),h(!1)),d.open({type:"error",title:"Error uploading file",message:C.message})})},[o,r,i,d,a,e]);return se.useEffect(()=>(f.current=!0,o.file&&b(o.file,o.fileName),()=>{f.current=!1}),[o.file,o.fileName,b]),t.jsx(s.Box,{m:1,children:t.jsxs(s.Paper,{elevation:0,className:n==="regular"?l.uploadItem:l.uploadItemSmall,variant:"outlined",children:[g&&t.jsx(s.Skeleton,{variant:"rectangular",sx:{width:"100%",height:"100%"}}),c&&t.jsxs("p",{children:["Error uploading file: ",c]})]})})}function Ks({name:e,property:o,value:r,onClear:i,disabled:n,size:a}){const l=Gt();return t.jsx(s.Box,{m:1,position:"relative",children:t.jsxs(s.Paper,{elevation:0,className:a==="regular"?l.uploadItem:l.uploadItemSmall,variant:"outlined",children:[!n&&t.jsx("a",{className:l.thumbnailCloseIcon,children:t.jsx(s.IconButton,{size:"small",onClick:d=>{d.stopPropagation(),i(r)},children:t.jsx(Be.default,{fontSize:"small"})})}),r&&t.jsx(ie,{children:t.jsx(ue,{name:e,value:r,property:o,size:a})})]})})}const Qs=K.default(e=>Q.default({inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)}}));function Xt({name:e,value:o,setValue:r,error:i,showError:n,disabled:a,autoFocus:l,property:d,includeDescription:c,allowInfinity:u,shouldAlwaysRerender:g}){const h=Qs();let f,b;if(d.dataType==="string"){const k=d.config?.url;f=typeof k=="string"?k:void 0,b=d.config?.multiline}pe({property:d,value:o,setValue:r});const y=!!b,v=o??(d.dataType==="string"?"":o===0?0:""),C=v===1/0,w=!C&&d.dataType==="number"?"number":void 0,m=k=>{if(!k)r(null);else if(w==="number"){const _=parseFloat(k);r(_)}else r(k)},S=t.jsx(s.FilledInput,{sx:{minHeight:"64px"},autoFocus:l,type:w,multiline:y,inputProps:{rows:4},value:C?"Infinity":o??"",disabled:a,onChange:k=>{m(k.target.value)}});return t.jsxs(t.Fragment,{children:[t.jsxs(s.FormControl,{variant:"filled",required:d.validation?.required,error:n,disabled:C,fullWidth:!0,children:[t.jsx(s.InputLabel,{classes:{root:h.inputLabel,shrink:h.shrinkInputLabel},children:t.jsx(ve,{property:d})}),S,t.jsxs(s.Box,{display:"flex",children:[t.jsxs(s.Box,{flexGrow:1,children:[n&&t.jsx(s.FormHelperText,{children:i}),c&&t.jsx(be,{property:d})]}),u&&t.jsx(s.FormControlLabel,{checked:C,style:{marginRight:0},labelPlacement:"start",control:t.jsx(s.Switch,{size:"small",type:"checkbox",onChange:k=>{m(k.target.checked?1/0:void 0)}}),disabled:a,label:t.jsx(s.Typography,{variant:"caption",children:"Set value to Infinity"})})]})]}),f&&v&&t.jsx(ie,{children:t.jsx(s.Box,{m:1,children:t.jsx(ue,{name:e,value:v,property:d,size:"regular"})})})]})}const Zs=K.default(e=>Q.default({formControl:{justifyContent:"space-between",margin:0,width:"100%",minHeight:"64px",paddingLeft:"16px",paddingRight:"24px",color:"rgba(0, 0, 0, 0.87)",boxSizing:"border-box",position:"relative",display:"inline-flex",alignItems:"center",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",borderTopLeftRadius:"4px",borderTopRightRadius:"4px",transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms","&::before":{borderBottom:e.palette.mode==="light"?"1px solid rgba(0, 0, 0, 0.42)":"1px solid rgba(255, 255, 255, 0.7)",left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",pointerEvents:"none"},"&::after":{content:'""',transition:"transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",left:0,bottom:0,position:"absolute",right:0,transform:"scaleX(0)",borderBottom:`2px solid ${e.palette.primary.main}`},"&:hover":{backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)"}},focus:{"&::before":{borderBottom:e.palette.mode==="light"?"1px solid rgba(255, 255, 255, 0.7)":"1px solid rgba(0, 0, 0, 0.87)"},"&::after":{transform:"scaleX(1)",pointerEvents:"none"}}})),Rs=z.default.forwardRef(function({name:e,value:o,setValue:r,error:i,showError:n,autoFocus:a,disabled:l,touched:d,property:c,includeDescription:u,shouldAlwaysRerender:g},h){const f=Zs();pe({property:c,value:o,setValue:r});const[b,y]=p.useState(a);return t.jsx(t.Fragment,{children:t.jsxs(s.FormControl,{fullWidth:!0,children:[t.jsx(s.FormControlLabel,{className:he.default(f.formControl,{[f.focus]:b}),onClick:v=>y(!0),labelPlacement:"start",checked:Boolean(o),inputRef:h,control:t.jsx(s.Switch,{type:"checkbox",color:"secondary",autoFocus:a,disabled:l,onFocus:v=>y(!0),onBlur:v=>y(!1),onChange:v=>{y(!0),r(v.target.checked)}}),disabled:l,label:t.jsx(s.Typography,{color:"textSecondary",children:t.jsx(ve,{property:c})})}),u&&t.jsx(be,{property:c}),n&&t.jsx(s.FormHelperText,{children:i})]})})}),ir=e=>t.jsx(Rs,{...e});function ar({name:e,value:o,setValue:r,autoFocus:i,error:n,showError:a,disabled:l,touched:d,property:c,includeDescription:u,shouldAlwaysRerender:g}){const h=o||null;return pe({property:c,value:o,setValue:r}),t.jsxs(t.Fragment,{children:[t.jsx(mt.default,{clearable:!0,autoFocus:i,value:h,label:t.jsx(ve,{property:c}),renderInput:f=>t.jsx(s.TextField,{...f,fullWidth:!0,InputProps:{...f.InputProps,sx:{minHeight:"64px"}},error:a,variant:"filled",helperText:a?n:null}),disabled:l,onChange:f=>r(f)}),u&&t.jsx(be,{property:c})]})}const el=K.default(e=>Q.default({root:{elevation:0,width:"100%",padding:e.spacing(1),position:"relative",transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",borderTopLeftRadius:"2px",borderTopRightRadius:"2px",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)","&::before":{borderBottom:e.palette.mode==="light"?"1px solid rgba(0, 0, 0, 0.42)":"1px solid rgba(255, 255, 255, 0.7)",left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",pointerEvents:"none"},"&::after":{content:'""',transition:"transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",left:0,bottom:0,position:"absolute",right:0,transform:"scaleX(0)",borderBottom:`2px solid ${e.palette.primary.main}`},"&:hover":{cursor:"pointer",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)"},color:"#838383",fontWeight:e.typography.fontWeightMedium},disabled:{backgroundColor:"rgba(0, 0, 0, 0.12)",color:e.palette.mode==="light"?"rgba(0, 0, 0, 0.38)":"rgba(255, 255, 255, 0.38)","&::before":{borderBottom:e.palette.mode==="light"?"1px dotted rgba(0, 0, 0, 0.42)":"1px dotted rgba(255, 255, 255, 0.7)"},"&::after":{borderBottom:`2px dotted ${e.palette.primary.main}`},"&:hover":{cursor:"inherit",backgroundColor:"rgba(0, 0, 0, 0.12)"}}}));function sr({name:e,value:o,setValue:r,error:i,showError:n,disabled:a,touched:l,autoFocus:d,property:c,includeDescription:u,context:g,shouldAlwaysRerender:h}){if(typeof c.path!="string")throw Error("Picked the wrong component ReferenceField");pe({property:c,value:o,setValue:r});const f=el(),[b,y]=z.default.useState(d),v=Fe(),C=Te(),w=p.useMemo(()=>C.getCollectionResolver(c.path),[c.path,C]);if(!w)throw Error(`Couldn't find the corresponding collection for the path: ${c.path}`);const m=w.schemaResolver,S=c.path,k=o&&o instanceof ke,{entity:_,dataLoading:I,dataLoadingError:A}=lt({path:k?o.path:void 0,entityId:k?o.id:void 0,schema:m,useCache:!0}),P=D=>{a||(r(D?nt(D):null),y(!1))},q=()=>{y(!0)},O=D=>{D.stopPropagation(),r(null),y(!1)},T=D=>{D.stopPropagation(),_&&v.open({entityId:_.id,path:S,overrideSchemaRegistry:!1})},E=()=>{y(!1)};function $(D){const N=_&&!_.values;let J;if(!D)J=t.jsx(me,{error:"The specified collection does not exist. Check console"});else if(N)J=t.jsx(s.Tooltip,{title:o&&o.path,children:t.jsxs(s.Box,{display:"flex",alignItems:"center",p:1,flexGrow:1,children:[t.jsx(Ct.default,{fontSize:"small",color:"error"}),t.jsxs(s.Box,{marginLeft:1,children:["Missing reference ",_&&_.id]})]})});else if(k){const L=D({}),B=Object.keys(L.properties);let M=c.previewProperties?.filter(F=>B.includes(F));(!M||!M.length)&&(M=B),M=M.slice(0,3),J=t.jsx(s.Box,{display:"flex",flexDirection:"column",flexGrow:1,ml:1,mr:1,children:M&&M.map((F,X)=>{const j=L.properties[F];return j?t.jsx(s.Box,{mt:.5,mb:.5,children:t.jsx(ie,{children:_?t.jsx(ue,{name:F,value:_.values[F],property:j,size:"tiny"}):t.jsx(Ae,{property:j,size:"tiny"})})},`reference_previews_${F}`):null})})}else J=t.jsxs(s.Box,{p:1,onClick:a?void 0:q,justifyContent:"center",display:"flex",children:[t.jsx(s.Typography,{variant:"body2",sx:L=>({flexGrow:1,textAlign:"center",color:"#838383",fontWeight:L.typography.fontWeightMedium}),children:"No value set"}),!a&&t.jsx(s.Button,{variant:"outlined",color:"primary",children:"Set"})]});return t.jsx(s.Box,{onClick:a?void 0:q,display:"flex",children:t.jsxs(s.Box,{display:"flex",flexDirection:"column",flexGrow:1,children:[t.jsxs(s.Box,{display:"flex",flexDirection:"row",flexGrow:1,children:[t.jsx(s.Box,{flexGrow:1,children:t.jsx(s.FormHelperText,{filled:!0,required:c.validation?.required,children:t.jsx(ve,{property:c})})}),_&&t.jsx(s.Box,{alignSelf:"center",m:1,children:t.jsx(s.Tooltip,{title:o&&o.path,children:t.jsx(s.Typography,{variant:"caption",className:"mono",children:_.id})})}),!N&&_&&o&&t.jsx(s.Box,{children:t.jsx(s.Tooltip,{title:`See details for ${_.id}`,children:t.jsx("span",{children:t.jsx(s.IconButton,{onClick:T,size:"large",children:t.jsx(go.default,{})})})})}),o&&t.jsx(s.Box,{children:t.jsx(s.Tooltip,{title:"Clear",children:t.jsx("span",{children:t.jsx(s.IconButton,{disabled:a,onClick:a?void 0:O,size:"large",children:t.jsx(Be.default,{})})})})})]}),J]})})}return t.jsxs(s.FormControl,{error:n,fullWidth:!0,children:[t.jsxs("div",{className:`${f.root} ${a?f.disabled:""}`,children:[m&&$(m),w&&t.jsx(ht,{open:b,collectionResolver:w,multiselect:!1,path:S,onClose:E,onSingleEntitySelected:P})]}),u&&t.jsx(be,{property:c}),n&&t.jsx(s.FormHelperText,{children:i})]})}function lr({name:e,value:o,error:r,showError:i,isSubmitting:n,setValue:a,tableMode:l,property:d,includeDescription:c,underlyingValueHasChanged:u,context:g,disabled:h,shouldAlwaysRerender:f}){if(!d.of)throw Error("ArrayDefaultField misconfiguration. Property `of` not set");const b=d.of,[y,v]=p.useState();pe({property:d,value:o,setValue:a});const C=(w,m)=>je({name:`${e}[${w}]`,disabled:h,property:b,includeDescription:c,underlyingValueHasChanged:u,context:g,tableMode:!1,partOfArray:!0,autoFocus:m===y,shouldAlwaysRerender:!1});return t.jsxs(s.FormControl,{fullWidth:!0,error:i,children:[!l&&t.jsx(s.FormHelperText,{filled:!0,required:d.validation?.required,children:t.jsx(ve,{property:d})}),t.jsx(s.Paper,{variant:"outlined",sx:w=>({elevation:0,padding:w.spacing(2),[w.breakpoints.up("md")]:{padding:w.spacing(2)}}),children:t.jsx(ft,{value:o,name:e,buildEntry:C,onInternalIdAdded:v,disabled:n||Boolean(d.disabled),includeAddButton:!d.disabled})}),c&&t.jsx(be,{property:d}),i&&typeof r=="string"&&t.jsx(s.FormHelperText,{children:r})]})}function cr({name:e,value:o,error:r,showError:i,isSubmitting:n,setValue:a,tableMode:l,property:d,includeDescription:c,underlyingValueHasChanged:u,context:g,disabled:h,shouldAlwaysRerender:f}){if(!d.oneOf)throw Error("ArrayOneOfField misconfiguration. Property `oneOf` not set");pe({property:d,value:o,setValue:a});const[b,y]=p.useState(),v=(C,w)=>t.jsx(tl,{name:`${e}[${C}]`,index:C,value:o[C],typeField:d.oneOf.typeField??"type",valueField:d.oneOf.valueField??"value",properties:d.oneOf.properties,autoFocus:w===b,context:g},`array_one_of_${C}`);return t.jsxs(s.FormControl,{fullWidth:!0,error:i,children:[!l&&t.jsx(s.FormHelperText,{filled:!0,required:d.validation?.required,children:t.jsx(ve,{property:d})}),t.jsx(s.Paper,{variant:"outlined",sx:C=>({elevation:0,padding:C.spacing(2),[C.breakpoints.up("md")]:{padding:C.spacing(2)}}),children:t.jsx(ft,{value:o,name:e,buildEntry:v,onInternalIdAdded:y,disabled:n||Boolean(d.disabled),includeAddButton:!d.disabled})}),c&&t.jsx(be,{property:d}),i&&typeof r=="string"&&t.jsx(s.FormHelperText,{children:r})]})}function tl({name:e,index:o,value:r,typeField:i,valueField:n,properties:a,autoFocus:l,context:d}){const c=r&&r[i],[u,g]=p.useState(c??void 0);p.useEffect(()=>{c!==u&&g(c)},[c]);const h=u?a[u]:void 0,f=Object.entries(a).map(([v,C])=>({[v]:C.title??v})).reduce((v,C)=>({...v,...C})),b=`${e}[${i}]`,y=`${e}[${n}]`;return t.jsxs(s.Paper,{sx:v=>({elevation:0,padding:v.spacing(2),[v.breakpoints.up("md")]:{padding:v.spacing(2)}}),elevation:0,children:[t.jsx(we.FastField,{required:!0,name:b,children:v=>t.jsxs(s.FormControl,{fullWidth:!0,children:[t.jsx(s.InputLabel,{id:`${e}_${o}_select_label`,children:t.jsx("span",{children:"Type"})}),t.jsx(s.Select,{fullWidth:!0,sx:{marginBottom:2},labelId:`${e}_${o}_select_label`,value:v.field.value!==void 0&&v.field.value!==null?v.field.value:"",onChange:C=>{const w=C.target.value;v.form.setFieldTouched(b),g(w),v.form.setFieldValue(b,w),v.form.setFieldValue(y,null)},renderValue:C=>t.jsx(xe,{enumKey:C,enumValues:f,small:!0}),children:Ne(f).map(([C,w])=>t.jsx(s.MenuItem,{value:C,children:t.jsx(xe,{enumKey:C,enumValues:f,small:!0})},`select_${e}_${o}_${C}`))})]})}),h&&t.jsx(s.FormControl,{fullWidth:!0,children:je({name:y,property:h,context:d,autoFocus:l})},`form_control_${e}_${u}`)]})}function Jt({name:e,value:o,setValue:r,error:i,showError:n,isSubmitting:a,touched:l,tableMode:d,property:c,includeDescription:u,context:g}){return t.jsxs(s.FormControl,{fullWidth:!0,error:n,children:[!d&&t.jsx(s.FormHelperText,{filled:!0,required:c.validation?.required,children:t.jsx(ve,{property:c})}),t.jsx(s.Paper,{sx:h=>({minHeight:"64px",elevation:0,padding:h.spacing(2),[h.breakpoints.up("md")]:{padding:h.spacing(3)}}),variant:"outlined",children:t.jsx(ie,{children:t.jsx(ue,{name:e,value:o,property:c,size:"regular"})})}),n&&typeof i=="string"&&t.jsx(s.FormHelperText,{children:i}),u&&t.jsx(be,{property:c})]})}const ol=K.default(e=>Q.default({root:{"& .w-md-editor-toolbar li > button":{color:e.palette.text.secondary},"& .w-md-editor-toolbar li.active > button":{color:e.palette.primary.main},"& .w-md-editor-text-pre, & .w-md-editor-text-pre .title, & .w-md-editor-text-pre .bold":{color:"inherit !important"},"& .wmde-markdown-color code.language-markdown":{color:"inherit"},"& .w-md-editor":{color:"inherit",backgroundColor:e.palette.mode==="light"?"rgb(240, 240, 240)":"#323232"},"& .w-md-editor-toolbar":{borderBottom:"inherit",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.09)"}}}));function dr({name:e,value:o,setValue:r,error:i,showError:n,disabled:a,autoFocus:l,touched:d,property:c,tableMode:u,includeDescription:g,context:h,shouldAlwaysRerender:f}){const b=ol();pe({property:c,value:o,setValue:r});const y=v=>{r(v||null)};return t.jsxs(s.FormControl,{required:c.validation?.required,error:n,fullWidth:!0,children:[!u&&t.jsx(s.FormHelperText,{filled:!0,required:c.validation?.required,children:t.jsx(ve,{property:c})}),t.jsx("div",{className:b.root,children:t.jsx(Zi.default,{value:typeof o=="string"?o:"",preview:"edit",onChange:v=>y(v)})}),t.jsx(s.Box,{display:"flex",children:t.jsxs(s.Box,{flexGrow:1,children:[n&&typeof i=="string"&&t.jsx(s.FormHelperText,{children:i}),g&&t.jsx(be,{property:c})]})})]})}function ur({name:e,value:o,error:r,showError:i,isSubmitting:n,tableMode:a,property:l,includeDescription:d,setValue:c}){const u=l.of;if(u.dataType!=="reference")throw Error("ArrayOfReferencesField expected a property containing references");const[g,h]=z.default.useState(!1),[f,b]=z.default.useState(!1),y=o&&Array.isArray(o)?o.map(_=>_.id):[];pe({property:l,value:o,setValue:c});const v=Te(),C=p.useMemo(()=>u.path?v.getCollectionResolver(u.path):void 0,[u.path]);if(!C)throw Error(`Couldn't find the corresponding collection for the path: ${u.path}`);const w=()=>{h(!0)},m=()=>{h(!1)},S=_=>{c(_.map(I=>nt(I)))},k=(_,I)=>{const A=o&&o.length>_?o[_]:void 0;return A?t.jsx("div",{onMouseEnter:()=>b(!0),onMouseMove:()=>b(!0),onMouseLeave:()=>b(!1),children:t.jsx(He,{value:A,property:u,onHover:f,size:"regular",onClick:w})}):t.jsx("div",{children:"Internal ERROR"})};return t.jsxs(t.Fragment,{children:[t.jsxs(s.FormControl,{fullWidth:!0,error:i,children:[!a&&t.jsx(s.FormHelperText,{filled:!0,required:l.validation?.required,children:t.jsx(ve,{property:l})}),t.jsxs(s.Paper,{variant:"outlined",sx:_=>({elevation:0,padding:_.spacing(2),[_.breakpoints.up("md")]:{padding:_.spacing(2)}}),children:[!C&&t.jsx(me,{error:"The specified collection does not exist. Check console"}),C&&t.jsxs(t.Fragment,{children:[t.jsx(ft,{value:o,name:e,buildEntry:k,disabled:n}),t.jsx(s.Box,{p:1,justifyContent:"center",textAlign:"left",children:t.jsxs(s.Button,{variant:"outlined",color:"primary",disabled:n,onClick:w,children:["Edit ",l.title]})})]})]}),d&&t.jsx(be,{property:l}),i&&typeof r=="string"&&t.jsx(s.FormHelperText,{children:r})]}),C&&u.path&&t.jsx(ht,{open:g,multiselect:!0,collectionResolver:C,path:u.path,onClose:m,onMultipleEntitiesSelected:S,selectedEntityIds:y})]})}function je({name:e,property:o,context:r,includeDescription:i,underlyingValueHasChanged:n,disabled:a,tableMode:l,partOfArray:d,autoFocus:c,shouldAlwaysRerender:u}){let g;if(Ze(o))g=Jt;else if(o.config?.Field)g=o.config?.Field;else if(o.dataType==="array"){const h=o.of;h&&((h.dataType==="string"||h.dataType==="number")&&h.config?.enumValues?g=nr:h.dataType==="string"&&h.config?.storageMeta?g=Yt:h.dataType==="reference"?g=ur:g=lr);const f=o.oneOf;if(f&&(g=cr),!h&&!f)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${e}`)}else o.dataType==="map"?g=fr:o.dataType==="reference"?o.path?g=sr:g=Jt:o.dataType==="timestamp"?g=ar:o.dataType==="boolean"?g=ir:o.dataType==="number"?o.config?.enumValues?g=jt:g=Xt:o.dataType==="string"&&(o.config?.storageMeta?g=Yt:o.config?.markdown?g=dr:o.config?.enumValues?g=jt:g=Xt);if(g){const h={name:e,property:o,includeDescription:i,underlyingValueHasChanged:n,context:r,disabled:a,tableMode:l,partOfArray:d,autoFocus:c,shouldAlwaysRerender:u},f=u||o.config?.Field?we.Field:we.FastField;return t.jsx(f,{required:o.validation?.required,name:`${e}`,children:b=>t.jsx(rl,{component:g,componentProps:h,fieldProps:b})})}return t.jsx("div",{children:`Currently the field ${o.dataType} is not supported`})}function rl({component:e,componentProps:{name:o,property:r,includeDescription:i,underlyingValueHasChanged:n,tableMode:a,partOfArray:l,autoFocus:d,context:c,disabled:u,shouldAlwaysRerender:g},fieldProps:h}){const f=r.config?.customProps,b=h.field.value,y=h.meta.initialValue,v=we.getIn(h.form.errors,o),C=we.getIn(h.form.touched,o),w=v&&(h.form.submitCount>0||r.validation?.unique)&&(!Array.isArray(v)||!!v.filter(I=>!!I).length),m=h.form.isSubmitting,[S,k]=p.useState(b);p.useEffect(()=>{const I=setTimeout(()=>{h.form.setFieldValue(o,S)},50);return()=>{clearTimeout(I)}},[S]),p.useEffect(()=>{Se.default(b,S)||k(b)},[b]);const _={name:o,value:S,initialValue:y,setValue:I=>{h.form.setFieldTouched(o,!0,!1),k(I)},error:v,touched:C,showError:w,isSubmitting:m,includeDescription:i??!0,property:r,disabled:u??!1,underlyingValueHasChanged:n??!1,tableMode:a??!1,partOfArray:l??!1,autoFocus:d??!1,customProps:f,context:c,shouldAlwaysRerender:g??!0};return t.jsxs(t.Fragment,{children:[z.default.createElement(e,_),n&&!m&&t.jsx(s.FormHelperText,{children:"This value has been updated elsewhere"})]})}function fr({name:e,value:o,showError:r,disabled:i,property:n,setValue:a,tableMode:l,includeDescription:d,underlyingValueHasChanged:c,context:u}){const g=n.config?.pickOnlySomeKeys||!1;if(!n.properties)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);let h;g?o?h=pa(n.properties,...Object.keys(o).filter(b=>b in n.properties)):h={}:h=n.properties,pe({property:n,value:o,setValue:a});function f(){const b=Object.keys(n.properties).filter(v=>!o||!(v in o)),y=v=>{a({...o,[v.target.value]:null})};return b.length?t.jsx(s.Box,{m:1,children:t.jsxs(s.FormControl,{fullWidth:!0,children:[t.jsx(s.InputLabel,{children:"Add property"}),t.jsx(s.Select,{variant:"standard",value:"",disabled:i,onChange:y,children:b.map(v=>t.jsx(s.MenuItem,{value:v,children:n.properties[v].title||v},v))})]})}):t.jsx(t.Fragment,{})}return t.jsxs(s.FormControl,{fullWidth:!0,error:r,children:[!l&&t.jsx(s.FormHelperText,{filled:!0,required:n.validation?.required,children:t.jsx(ve,{property:n})}),t.jsxs(s.Paper,{elevation:0,variant:"outlined",sx:b=>({elevation:0,padding:b.spacing(2),[b.breakpoints.up("md")]:{padding:b.spacing(2)}}),children:[t.jsx(s.Grid,{container:!0,spacing:2,children:Object.entries(h).filter(([b,y])=>!Bo(y)).map(([b,y],v)=>t.jsx(s.Grid,{item:!0,sm:12,xs:12,children:je({name:`${e}[${b}]`,disabled:i,property:y,includeDescription:d,underlyingValueHasChanged:c,context:u,tableMode:l,partOfArray:!1,autoFocus:!1,shouldAlwaysRerender:!1})},`map-${e}-${v}`))}),g&&f()]}),d&&t.jsx(be,{property:n})]})}const nl=({containerRef:e})=>{const{isSubmitting:o,isValidating:r,errors:i}=we.useFormikContext();return p.useEffect(()=>{const n=Object.keys(i);if(n.length>0&&o&&!r){const a=e?.current?.querySelector(`#form_field_${n[0]}`);if(a&&e?.current){const l=hr(e.current);if(l){const c=a.getBoundingClientRect().top;l.scrollTo({top:l.scrollTop+c-64,behavior:"smooth"})}const d=a.querySelector("input");d&&d.focus()}}},[o,r,i,e]),null},il=e=>{const o=e&&e.scrollHeight>e.clientHeight,r=e?window.getComputedStyle(e).overflowY:null,i=r&&r.indexOf("hidden")!==-1;return o&&!i},hr=e=>!e||e===document.body?document.body:il(e)?e:hr(e.parentNode),al=K.default(e=>Q.default({paper:{elevation:0,padding:e.spacing(2),[e.breakpoints.up("md")]:{padding:e.spacing(2)}},largePadding:{padding:e.spacing(2),[e.breakpoints.up("md")]:{padding:e.spacing(3)}},inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)},buttons:{display:"flex",justifyContent:"flex-end"},button:{margin:e.spacing(1)},form:{marginTop:e.spacing(2)},input:{minHeight:"64px"},select:{paddingTop:e.spacing(1/2)},oneOfInput:{marginBottom:e.spacing(2)}}));function sl({schema:e,status:o,onChange:r,error:i,entity:n}){const a=al(),l=o==="existing"||!e.customId,d=o!=="existing"&&!e.customId,c=typeof e.customId=="object",u=We(),{copy:g}=Wo({onSuccess:y=>u.open({type:"success",message:`Copied ${y}`})}),h=de(),f={className:a.input,endAdornment:n?t.jsxs(s.InputAdornment,{position:"end",children:[t.jsx(s.IconButton,{onClick:y=>g(n.id),"aria-label":"copy-id",size:"large",children:t.jsx(s.Tooltip,{title:"Copy",children:t.jsx("svg",{className:"MuiSvgIcon-root MuiSvgIcon-fontSizeSmall",fill:"currentColor",width:"20",height:"20",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})})})}),h?.entityLinkBuilder&&t.jsx("a",{href:h.entityLinkBuilder({entity:n}),rel:"noopener noreferrer",target:"_blank",children:t.jsx(s.IconButton,{onClick:y=>y.stopPropagation(),"aria-label":"go-to-datasource",size:"large",children:t.jsx(s.Tooltip,{title:"Open in the console",children:t.jsx(rt.default,{fontSize:"small"})})})})]}):void 0},b={label:d?"ID is set automatically":"ID",disabled:l,name:"id",type:null,value:n&&o==="existing"?n.id:void 0,variant:"filled"};return ti.createElement(s.FormControl,{fullWidth:!0,error:i,...b,key:"custom-id-field"},c&&e.customId&&t.jsxs(t.Fragment,{children:[t.jsx(s.InputLabel,{id:"id-label",children:b.label}),t.jsx(s.Select,{labelId:"id-label",className:a.select,error:i,...b,onChange:y=>r(y.target.value),children:Object.entries(e.customId).map(([y,v])=>t.jsx(s.MenuItem,{value:y,children:`${y} - ${v}`},`custom-id-item-${y}`))})]}),!c&&t.jsx(s.TextField,{...b,error:i,InputProps:f,helperText:e.customId==="optional"?"Leave this blank to autogenerate an ID":"ID of the new document",onChange:y=>{let v=y.target.value;return v&&(v=v.trim()),r(v.length?v:void 0)}}),t.jsx(we.ErrorMessage,{name:"id",component:"div",children:y=>"You need to specify an ID"}))}const gr=K.default(e=>Q.default({stickyButtons:{marginTop:e.spacing(2),background:e.palette.mode==="light"?"rgba(255,255,255,0.6)":"rgba(255, 255, 255, 0)",backdropFilter:"blur(4px)",borderTop:e.palette.divider,position:"sticky",bottom:0,zIndex:200},container:{padding:e.spacing(4),marginTop:e.spacing(2),marginBottom:e.spacing(2),[e.breakpoints.down("lg")]:{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),paddingTop:e.spacing(3),paddingBottom:e.spacing(3)},[e.breakpoints.down("md")]:{padding:e.spacing(2)}},button:{margin:e.spacing(1)},form:{marginTop:e.spacing(2)}}));function Kt({status:e,path:o,schemaOrResolver:r,entity:i,onEntitySave:n,onDiscard:a,onModified:l,onValuesChanged:d}){const c=gr(),u=_e(),g=e==="existing"?i?.id:void 0,h=p.useMemo(()=>ge({schemaOrResolver:r,path:o,entityId:g}),[o,g]),f=p.useMemo(()=>{const D=h.properties;if((e==="existing"||e==="copy")&&i)return i.values??Et(D,h.defaultValues);if(e==="new")return Et(D,h.defaultValues);throw console.error({status:e,entity:i}),new Error("Form has not been initialised with the correct parameters")},[e,h,i]),b=z.default.useRef(null),[y,v]=z.default.useState(void 0),[C,w]=z.default.useState(!1),[m,S]=z.default.useState(),k=z.default.useRef(i?.values??f),_=k.current,[I,A]=p.useState(_),P=p.useMemo(()=>ge({schemaOrResolver:r,path:o,entityId:g,values:I,previousValues:_}),[r,o,g,I]),q=(e==="new"||e==="copy")&&!!P.customId&&P.customId!=="optional",O=p.useMemo(()=>_&&e==="existing"?Object.keys(P.properties).map(D=>{const N=_[D],J=f[D];return Se.default(N,J)?{}:{[D]:J}}).reduce((D,N)=>({...D,...N}),{}):{},[_,f]),T=p.useCallback((D,N)=>{if(q&&!y){console.error("Missing custom Id"),w(!0),N.setSubmitting(!1);return}S(null),w(!1);let J;if(e==="existing"){if(!i?.id)throw Error("Form misconfiguration when saving, no id for existing entity");J=i.id}else if(e==="new"||e==="copy"){if(P.customId){if(P.customId!=="optional"&&!y)throw Error("Form misconfiguration when saving, customId should be set");J=y}}else throw Error("New FormType added, check EntityForm");n&&n({schema:P,path:o,entityId:J,values:D,previousValues:i?.values}).then(L=>{k.current=D,N.setTouched({})}).catch(L=>{console.error(L),S(L)}).finally(()=>{N.setSubmitting(!1)})},[e,o,P,i,n,q,y]),E=p.useCallback(({name:D,value:N,property:J})=>u.checkUniqueField(o,D,N,J,g),[u,o,g]),$=p.useMemo(()=>or(P.properties,E),[P.properties]);return t.jsx(we.Formik,{initialValues:_,onSubmit:T,validationSchema:$,validate:D=>console.debug("Validating",D),onReset:()=>a&&a(),children:({values:D,touched:N,setFieldValue:J,handleSubmit:L,isSubmitting:B,dirty:M})=>t.jsx(ll,{baseDataSourceValues:f,values:D,onModified:l,setInternalValue:A,onValuesChanged:d,underlyingChanges:O,entityId:g,entity:i,touched:N,setFieldValue:J,schema:P,isSubmitting:B,classes:c,formRef:b,status:e,setCustomId:v,customIdError:C,handleSubmit:L,savingError:m})})}function ll({baseDataSourceValues:e,values:o,onModified:r,setInternalValue:i,onValuesChanged:n,underlyingChanges:a,entity:l,touched:d,setFieldValue:c,schema:u,entityId:g,isSubmitting:h,classes:f,formRef:b,status:y,setCustomId:v,customIdError:C,handleSubmit:w,savingError:m}){const S=e,k=o;S.userType!==void 0&&k.userType!==void 0&&S.userType!==k.userType&&(k.userType=S.userType);const _=p.useMemo(()=>!Se.default(S,k),[S,k]);p.useEffect(()=>{r&&r(_),i(o),n&&n(o)},[_,o]),a&&l&&Object.entries(a).forEach(([P,q])=>{const O=o[P];!Se.default(q,O)&&!d[P]&&(console.debug("Updated value from the datasource:",P,q),c(P,q!==void 0?q:null))});const I={schema:u,entityId:g,values:o},A=t.jsx(s.Grid,{container:!0,spacing:4,children:Object.entries(u.properties).filter(([P,q])=>!Bo(q)).map(([P,q])=>{const O=!!a&&Object.keys(a).includes(P)&&!!d[P],T=typeof u.originalSchema.properties[P]=="function",E=h||Ze(q)||Boolean(q.disabled),$={name:P,disabled:E,property:q,includeDescription:!0,underlyingValueHasChanged:O,context:I,tableMode:!1,partOfArray:!1,autoFocus:!1,shouldAlwaysRerender:T};return t.jsx(s.Grid,{item:!0,xs:12,id:`form_field_${P}`,children:je($)},`field_${u.name}_${P}`)})});return t.jsxs(s.Container,{maxWidth:"sm",className:f.container,ref:b,children:[t.jsx(sl,{schema:u,status:y,onChange:v,error:C,entity:l}),t.jsxs(we.Form,{className:f.form,onSubmit:w,noValidate:!0,children:[t.jsx(s.Box,{pt:3,children:A}),t.jsxs("div",{className:f.stickyButtons,children:[m&&t.jsx(s.Box,{textAlign:"right",children:t.jsx(s.Typography,{color:"error",children:m.message})}),cl(f,h,_,y)]})]}),t.jsx(nl,{containerRef:b})]})}function cl(e,o,r,i){const n=o||!r&&i==="existing";return t.jsxs(s.Box,{textAlign:"right",children:[i==="existing"&&t.jsx(s.Button,{variant:"text",color:"primary",disabled:n,className:e.button,type:"reset",children:"Discard"}),t.jsxs(s.Button,{variant:"contained",color:"primary",type:"submit",disabled:n,className:e.button,children:[i==="existing"&&"Save",i==="copy"&&"Create copy",i==="new"&&"Create"]})]})}var dl=Object.freeze(Object.defineProperty({__proto__:null,useStyles:gr,EntityForm:Kt,default:Kt},Symbol.toStringTag,{value:"Module"}));const ul=({onResize:e})=>{const o=p.useRef(0),r=p.useRef(null),i=p.useRef(e);i.current=e;const n=p.useCallback(l=>{o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{i.current(l)})},[]),a=p.useCallback(()=>{const l=r.current;l&&l.contentDocument&&l.contentDocument.defaultView&&l.contentDocument.defaultView.addEventListener("resize",n)},[n]);return p.useEffect(()=>{const l=r.current;return()=>{l&&l.contentDocument&&l.contentDocument.defaultView&&l.contentDocument.defaultView.removeEventListener("resize",n)}},[n]),t.jsx("object",{onLoad:a,ref:r,tabIndex:-1,type:"text/html",data:"about:blank",title:"",style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",pointerEvents:"none",zIndex:-1,opacity:0}})},fl=K.default(e=>Q.default({form:{display:"flex",flexDirection:"column"},button:{marginTop:e.spacing(1),alignSelf:"flex-end",position:"sticky",bottom:0},popup:{display:"inline-block",userSelect:"none",position:"fixed",zIndex:1300,boxShadow:"0 0 0 2px rgba(128,128,128,0.2)",borderRadius:"4px",backgroundColor:e.palette.background.paper},popupInner:{padding:e.spacing(2),overflow:"auto",cursor:"inherit"},hidden:{visibility:"hidden",zIndex:-1}}));function hl({tableKey:e,entity:o,customFieldValidator:r,name:i,schemaResolver:n,path:a,cellRect:l,setPreventOutsideClick:d,open:c,onClose:u,columnIndex:g,onCellValueChange:h}){const[f,b]=z.default.useState(),[y,v]=p.useState(),[C,w]=p.useState(o?.values),m=fl(),S=Hs(),k=z.default.useRef(null),_=z.default.useRef(null),I=z.default.useRef(!1),A=k.current?.getBoundingClientRect();Ws({containerRef:_,ref:k,x:y?.x,y:y?.y,onMove:(L,B)=>$({x:L,y:B})}),p.useEffect(()=>{I.current=!1},[i,o]);const P=p.useCallback(()=>{if(!l)throw Error("getInitialLocation error");return{x:l.left<S.width-l.right?l.x+l.width/2:l.x-l.width/2,y:l.top<S.height-l.bottom?l.y+l.height/2:l.y-l.height/2}},[l,S.height,S.width]),q=p.useCallback(({x:L,y:B})=>{if(!A)throw Error("normalizePosition called before draggableBoundingRect is set");return{x:Math.max(0,Math.min(L,S.width-A.width)),y:Math.max(0,Math.min(B,S.height-A.height))}},[A,S]),O=p.useCallback(L=>{if(!l||!A)return;const B=q(L??P());(!y||B.x!==y.x||B.y!==y.y)&&v(B)},[l,A,P,q,y]);p.useEffect(()=>{!l||!A||I.current||(I.current=!0,O(P()))},[l,A,P,O]),p.useLayoutEffect(()=>{O(y)},[S,l]),p.useEffect(()=>{d(c)},[c]);const T=p.useMemo(()=>{if(!n)return;const L=ge({schemaOrResolver:n,path:a,values:C,previousValues:o?.values});return or(i&&L.properties[i]?{[i]:L.properties[i]}:{},r)},[a,C,i]),E=()=>{if(!!A)return O(y)},$=L=>{if(!!A)return O(L)},D=async L=>(b(null),o&&h&&i?h({value:L[i],name:i,entity:o,setError:b,setSaved:()=>{}}):Promise.resolve());if(!o)return t.jsx(t.Fragment,{});const N=o&&t.jsxs("div",{style:{width:520,maxWidth:"100vw",maxHeight:"85vh"},children:[t.jsx(we.Formik,{initialValues:o.values,validationSchema:T,validate:L=>console.debug("Validating",L),onSubmit:(L,B)=>{D(L).then(()=>u()).finally(()=>B.setSubmitting(!1))},children:({handleChange:L,values:B,errors:M,touched:F,dirty:X,setFieldValue:j,setFieldTouched:U,handleSubmit:ee,isSubmitting:G})=>{if(Se.default(B,C)||w(B),!o)return t.jsx(me,{error:"PopupFormField misconfiguration"});if(!n)return t.jsx(t.Fragment,{});const H=G,Y=ge({schemaOrResolver:n,path:a,values:B,previousValues:o?.values}),ae={schema:Y,entityId:o.id,values:B},re=Y.properties[i];return t.jsxs(we.Form,{className:m.form,onSubmit:ee,noValidate:!0,children:[i&&re&&je({name:i,disabled:G||Ze(re)||!!re.disabled,property:re,includeDescription:!1,underlyingValueHasChanged:!1,context:ae,tableMode:!0,partOfArray:!1,autoFocus:c,shouldAlwaysRerender:!0}),t.jsx(s.Button,{className:m.button,variant:"contained",color:"primary",type:"submit",disabled:H,children:"Save"})]})}}),f&&t.jsx(s.Typography,{color:"error",children:f.message})]},`popup_form_${e}_${o.id}_${g}`),J=t.jsxs("div",{className:he.default(m.popup,{[m.hidden]:!c}),ref:_,children:[t.jsx(ul,{onResize:E}),t.jsxs("div",{className:m.popupInner,ref:k,children:[N,t.jsx(s.IconButton,{size:"small",style:{position:"absolute",top:-14,right:-14,backgroundColor:"#666"},onClick:L=>{L.stopPropagation(),u()},children:t.jsx(Be.default,{style:{color:"white"},fontSize:"small"})})]})]},`draggable_${i}_${o.id}`);return t.jsx(Ln.Portal,{container:document.body,children:J})}function gl(e,o){return typeof e=="boolean"?e:typeof e=="function"?e(o):!0}function pl({schemaResolver:e,additionalColumns:o,displayedProperties:r,path:i,inlineEditing:n,size:a,onCellValueChange:l,uniqueFieldValidator:d}){const c=de(),[u,g]=z.default.useState(void 0),[h,f]=z.default.useState(void 0),[b,y]=z.default.useState(!1),[v,C]=z.default.useState(!1),w=z.default.useRef(Math.random().toString(36)),m=p.useMemo(()=>o?o.map(B=>({[B.id]:B})).reduce((B,M)=>({...B,...M}),[]):{},[o]);p.useEffect(()=>{const B=M=>{M.keyCode===27&&k()};return document.addEventListener("keydown",B,!1),()=>{document.removeEventListener("keydown",B,!1)}});const S=p.useCallback(B=>{g(B),y(!0)},[]),k=p.useCallback(()=>{g(void 0),y(!1),C(!1)},[]),_=p.useCallback(()=>{f(void 0),y(!0)},[]),I=p.useCallback(B=>Ne(B).filter(([M,F])=>!Re(F)).map(([M,F])=>({[M]:Do(F)})).reduce((M,F)=>({...M,...F}),{}),[]),A=p.useCallback((B,M=!1)=>{if(B.dataType==="number"||B.dataType==="string"){const F=B.title,X=B.config?.enumValues;return{dataType:B.dataType,isArray:M,title:F,enumValues:X?I(X):void 0}}else{if(B.dataType==="array"&&B.of)return A(B.of,!0);if(B.dataType==="boolean"){const F=B.title;return{dataType:B.dataType,isArray:M,title:F}}else if(B.dataType==="timestamp"){const F=B.title;return{dataType:B.dataType,isArray:M,title:F}}}},[I]),P=p.useMemo(()=>ge({schemaOrResolver:e,path:i}),[e,i]),O=Ue().extra.admin,T={};Object.keys(P.properties).forEach(B=>{P.properties[B].onlyForGlobalAdmin?O&&(T[B]=P.properties[B]):T[B]=P.properties[B]}),P.properties=T;const E=({column:B,columnIndex:M,rowData:F,rowIndex:X})=>{const j=F,U=B.dataKey,G=e({entityId:j.id,values:j.values}).properties[U];if(!G)return null;if(gl(n,j)){const Y=ye=>{f(ye?{columnIndex:M,width:B.width,height:B.height,entity:j,cellRect:ye,name:U,schemaResolver:e}:void 0)},ae=ye=>{S(ye?{columnIndex:M,width:B.width,height:B.height,entity:j,cellRect:ye,name:U,schemaResolver:e}:void 0)},re=u?.columnIndex===M&&u?.entity.id===j.id,ne=re&&b,R=ut({property:G,customFieldValidator:d?({name:ye,value:et,property:ao})=>d({name:ye,value:et,property:ao,entityId:j.id}):void 0,name:U}),Ie=l?ye=>l({...ye,entity:j}):void 0;return j?t.jsx(Vs,{size:a,align:B.align,name:U,validation:R,onValueChange:Ie,selected:re,focused:ne,setPreventOutsideClick:C,setFocused:y,value:j?.values?j.values[U]:void 0,property:G,openPopup:Y,select:ae,width:B.width,height:B.height,entityId:j.id,entityValues:j.values},`table_cell_${U}_${X}_${M}`):t.jsx(Ae,{property:G,size:Pe(a)})}else return t.jsx(Ut,{size:a,value:j.values[U],align:B.align,disabled:!0,children:t.jsx(ue,{width:B.width,height:B.height,name:`preview_${U}_${X}_${M}`,property:G,value:j.values[U],size:Pe(a)})},`preview_cell_${U}_${X}_${M}`)},$=({column:B,columnIndex:M,rowData:F,rowIndex:X})=>{const j=F,U=m[B.dataKey],ee=U.dependencies?Object.entries(j.values).filter(([G,H])=>U.dependencies.includes(G)).reduce((G,H)=>({...G,...H}),{}):void 0;return t.jsx(Ut,{value:ee,focused:!1,selected:!1,disabled:!0,size:a,align:"left",allowScroll:!1,showExpandIcon:!1,disabledTooltip:"Additional columns can't be edited directly",children:t.jsx(ie,{children:U.builder({entity:j,context:c})})})},D=Object.keys(P.properties).map(B=>{const M=P.properties[B];return{key:B,property:M,align:cs(M),icon:F=>ct(M,F?void 0:"disabled","small"),label:M.title||B,sortable:!0,filter:A(M),width:er(M),cellRenderer:E}});if(o){const B=o.map(M=>{const F={key:M.id,type:"additional",align:"left",sortable:!1,label:M.title,width:M.width??200,cellRenderer:$};return M.hideInTable&&(F.property={hideInTable:!0}),F});D.push(...B)}const N=r.map(B=>D.find(M=>M.key===B)).filter(B=>!!B),J=d?({name:B,value:M,property:F})=>d({name:B,value:M,property:F,entityId:u?.entity.id}):void 0,L=t.jsx(hl,{open:Boolean(h),onClose:_,cellRect:h?.cellRect,columnIndex:h?.columnIndex,name:h?.name,schemaResolver:h?.schemaResolver,entity:h?.entity,tableKey:w.current,customFieldValidator:J,path:i,onCellValueChange:l,setPreventOutsideClick:C});return{columns:N,popupFormField:L}}const bl=50,vl=vt.makeStyles(e=>Q.default({root:{height:"100%",width:"100%",display:"flex",flexDirection:"column"}})),Qt=z.default.memo(wl,yl);function yl(e,o){return e.path===o.path&&e.collection===o.collection&&e.title===o.title&&e.toolbarActionsBuilder===o.toolbarActionsBuilder&&e.tableRowActionsBuilder===o.tableRowActionsBuilder&&e.inlineEditing===o.inlineEditing}function wl({path:e,collection:o,schemaResolver:r,inlineEditing:i,toolbarActionsBuilder:n,title:a,tableRowActionsBuilder:l,entitiesDisplayedFirst:d,onEntityClick:c,onColumnResize:u,onSizeChanged:g,hoverRow:h=!0}){const f=de(),b=_e(),y=Fe(),v=s.useTheme(),C=s.useMediaQuery(v.breakpoints.up("md")),[w,m]=z.default.useState("xs"),S=o.initialFilter,k=o.initialSort,_=o.filterCombinations,I=o.textSearchEnabled,A=o.pagination===void 0||Boolean(o.pagination),P=typeof o.pagination=="number"?o.pagination:bl,[q,O]=z.default.useState(A?P:void 0),[T,E]=z.default.useState(S||{}),[$,D]=z.default.useState(k),N=!!T&&Object.keys(T).length>0,J=vl(),L=p.useMemo(()=>{const oe=o.subcollections?.map(fe=>({id:tr(fe),title:fe.name,width:200,dependencies:[],hideInTable:fe.hideInTable??!1,builder:({entity:Ye})=>t.jsx(s.Button,{color:"primary",onClick:tt=>{tt.stopPropagation(),y.open({path:e,entityId:Ye.id,selectedSubpath:fe.path,permissions:o.permissions,schema:r,subcollections:o.subcollections,callbacks:o.callbacks,overrideSchemaRegistry:!1})},children:(fe.buttonContent&&fe.buttonContent({entity:Ye}))??fe.name})}))??[];return[...o.additionalColumns??[],...oe]},[o,e]),B=p.useMemo(()=>r({}),[]),M=ds(o,B,!0),F=p.useCallback(({name:oe,value:fe,property:Ye,entityId:tt})=>b.checkUniqueField(e,oe,fe,Ye,tt),[e,b]),X=p.useCallback(({value:oe,name:fe,setSaved:Ye,setError:tt,entity:so})=>{const Fc={path:e,entityId:so.id,values:{...so.values,[fe]:oe},previousValues:so.values,schema:r,status:"existing"};return Dt({...Fc,callbacks:o.callbacks,dataSource:b,context:f,onSaveSuccess:()=>Ye(!0),onSaveFailure:Ac=>{tt(Ac)}})},[e,o,r]);let{columns:j,popupFormField:U}=pl({schemaResolver:r,additionalColumns:L,displayedProperties:M,path:e,inlineEditing:i,size:w,onCellValueChange:X,uniqueFieldValidator:F});j=j.filter(oe=>oe.property?!oe.property.hideInTable:!0);const[ee,G]=z.default.useState(),{data:H,dataLoading:Y,noMoreToLoad:ae,dataLoadingError:re}=st({entitiesDisplayedFirst:d,path:e,schemaResolver:r,filterValues:T,sortBy:$,searchString:ee,itemCount:q}),[ne,W]=p.useState(1),R=H.slice(ne===1?0:(ne-1)*10),Ie=p.useMemo(()=>n&&n({size:w,data:R}),[n,w,R]);p.useCallback(()=>{!A||Y||ae||q!==void 0&&O(q+P)},[Y,q,ae,P,A]);const ye=p.useCallback(()=>{O(P)},[P]),et=p.useCallback(()=>E({}),[]),ao=p.useCallback(({entry:oe,size:fe})=>l?l({entity:oe,size:fe}):t.jsx(zt,{entity:oe,size:fe,data:R}),[l]),kc=p.useCallback(({rowData:oe})=>{},[c]),_c=p.useCallback(oe=>{g&&g(oe),m(oe)},[]),Ec=()=>{if(ne===1)return;const oe=ne-1;W(oe),O(oe*10)},Ic=()=>{const oe=ne+1;W(oe),O(oe*10)},Bc=p.useCallback(oe=>G(oe),[]),Pc=()=>{W(1),O(10)};return t.jsxs(s.Paper,{className:J.root,children:[t.jsx(gs,{filterIsSet:N,onTextSearch:I?Bc:void 0,clearFilter:et,actions:Ie,size:w,onSizeChanged:_c,title:a,loading:Y}),t.jsx(Tr,{data:Y?[]:R,columns:j,onRowClick:kc,onResetPagination:ye,idColumnBuilder:ao,error:re,paginationEnabled:A,onColumnResize:u,frozenIdColumn:C,size:w,loading:Y,filter:T,onFilterUpdate:E,sortBy:$,onSortByUpdate:D,hoverRow:h,checkFilterCombination:(oe,fe)=>Cl(oe,_,fe),collection:o,onSort:Pc}),t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsxs(s.ButtonGroup,{disableElevation:!0,variant:"contained",children:[t.jsx(s.Button,{disabled:ne===1||Y,onClick:Ec,children:t.jsx(ea.default,{})}),t.jsx(s.Button,{disabled:ae||Y,onClick:Ic,children:t.jsx(Ri.default,{})})]})})]})}function Cl(e,o,r){const i=r?r[0]:void 0,n=r?r[1]:void 0,a=Object.values(e);if(i&&a.map(c=>c[0]).includes("=="))return!1;const l=Object.keys(e),d=l.length;return d===1&&(!i||i===l[0])?!0:!o&&d>1||i&&d===1&&l[0]!==i?!1:!!o&&o.filter(c=>!i||i in c).find(c=>Object.entries(e).every(([u,g])=>c[u]!==void 0&&(!n||c[u]===n)))!==void 0}const ml=K.default(e=>Q.default({dialogBody:{flexGrow:1,overflow:"auto",minWidth:"85vw"},paper:{height:"100%"}}));function ht({onSingleEntitySelected:e,onMultipleEntitiesSelected:o,onClose:r,open:i,multiselect:n,collectionResolver:a,path:l,selectedEntityIds:d}){const c=ml(),u=_e(),g=a,h=a.schema,f=a.schemaResolver,[b,y]=p.useState();p.useEffect(()=>{let _=!1;return d?Promise.all(d.map(I=>u.fetchEntity({path:l,entityId:I,schema:f}))).then(I=>{_||y(I)}):y([]),()=>{_=!0}},[u,l,d]);const v=_=>{!n&&e?e(_):w(_)},C=()=>{!n&&e?e(null):o&&o([])},w=_=>{let I;b&&(b.map(A=>A.id).indexOf(_.id)>-1?I=b.filter(A=>A.id!==_.id):I=[...b,_],y(I),o&&o(I))},m=({entity:_,size:I})=>{const A=d&&d.indexOf(_.id)>-1;return t.jsx(zt,{entity:_,size:I,isSelected:A,selectionEnabled:n,toggleEntitySelection:w})},S=()=>t.jsx(s.Button,{onClick:C,color:"primary",children:"Clear"}),k=t.jsx(s.Typography,{variant:"h6",children:`Select ${h.name}`});return t.jsxs(s.Dialog,{onClose:r,classes:{paper:c.paper},maxWidth:"xl",scroll:"paper",open:i,children:[t.jsx("div",{className:c.dialogBody,children:b&&t.jsx(Qt,{path:l,collection:g,schemaResolver:f,inlineEditing:!1,toolbarActionsBuilder:S,onEntityClick:v,tableRowActionsBuilder:m,title:k,entitiesDisplayedFirst:b})}),t.jsx(s.Divider,{}),t.jsx(s.DialogActions,{children:t.jsx(s.Button,{onClick:_=>{_.stopPropagation(),r()},color:"primary",variant:"contained",children:"Close"})})]})}function xl({entityOrEntitiesToDelete:e,schemaResolver:o,onClose:r,open:i,callbacks:n,onEntityDelete:a,onMultipleEntitiesDelete:l,path:d,...c}){const u=_e(),g=We(),[h,f]=p.useState(!1),[b,y]=z.default.useState(),[v,C]=z.default.useState(),w=de(),m=p.useMemo(()=>o({}),[]);z.default.useEffect(()=>{if(e){const E=Array.isArray(e)&&e.length===1?e[0]:e;y(E),C(Array.isArray(E))}},[e]);const S=p.useCallback(()=>{r()},[r]),k=p.useCallback(E=>{console.debug("Deleted",E)},[]),_=p.useCallback((E,$)=>{g.open({type:"error",title:`${m.name}: Error deleting`,message:$?.message}),console.error("Error deleting entity"),console.error($)},[m.name]),I=p.useCallback((E,$)=>{g.open({type:"error",title:`${m.name}: Error before deleting`,message:$?.message}),console.error($)},[m.name]),A=p.useCallback((E,$)=>{g.open({type:"error",title:`${m.name}: Error after deleting (entity is deleted)`,message:$?.message}),console.error($)},[m.name]),P=p.useCallback(E=>Vo({dataSource:u,entity:E,schema:m,callbacks:n,onDeleteSuccess:k,onDeleteFailure:_,onPreDeleteHookError:I,onDeleteSuccessHookError:A,context:w}),[u,m,n,k,_,I,A,w]),q=p.useCallback(async()=>{b&&(f(!0),v?Promise.all(b.map(P)).then(E=>{f(!1),l&&b&&l(d,b),E.every(Boolean)?g.open({type:"success",message:`${m.name}: multiple deleted`}):E.some(Boolean)?g.open({type:"warning",message:`${m.name}: Some of the entities have been deleted, but not all`}):g.open({type:"error",message:`${m.name}: Error deleting entities`}),r()}):P(b).then(E=>{f(!1),E&&(a&&b&&a(d,b),g.open({type:"success",message:`${m.name} deleted`}),r())}))},[b,v,P,l,d,r,g,m.name,a]);let O;if(b&&v)O=t.jsx("div",{children:"Multiple entities"});else{const E=b,$=o({entityId:E?.id,values:E?.values});O=E?t.jsx(dt,{entity:E,schema:$,path:d}):t.jsx(t.Fragment,{})}const T=v?`${m.name}: Confirm multiple delete?`:`Would you like to delete this ${m.name}?`;return t.jsxs(s.Dialog,{maxWidth:"md","aria-labelledby":"delete-dialog",open:i,onBackdropClick:r,...c,children:[t.jsx(s.DialogTitle,{id:"delete-dialog-title",children:T}),!v&&t.jsx(s.DialogContent,{dividers:!0,children:O}),t.jsxs(s.DialogActions,{children:[h&&t.jsx(s.CircularProgress,{size:16,thickness:8}),t.jsx(s.Button,{onClick:S,disabled:h,color:"primary",children:"Cancel"}),t.jsx(s.Button,{autoFocus:!0,disabled:h,onClick:q,color:"primary",children:"Ok"})]})]})}function Sl(e,o,r,i,n){const a=r.properties,l=kl(a,i,n),d=Tl(e,o,a,l),c=yr(l.map(g=>g.label)),u=d.map(g=>yr(g));_l([c,...u],`${r.name}.csv`,"text/csv")}function Tl(e,o,r,i){const n=e.map(a=>({id:a.id,...vr(a.values,r)}));return o&&o.forEach((a,l)=>{n[l]={...n[l],...a}}),n&&n.map(a=>i.map(l=>_t(a,l.key)))}function kl(e,o,r){const i=[{label:"id",key:"id"},...Object.entries(e).map(([n,a])=>pr(a,n,"")).flat()];return r?.additionalColumns&&i.push(...r.additionalColumns.map(n=>({label:n.key,key:n.key}))),i}function pr(e,o,r=""){const i=r?`${r}.${o}`:o;return e.dataType==="map"&&e.properties?Object.entries(e.properties).map(([n,a])=>pr(a,n,i)).flat():[{label:i,key:i}]}function br(e,o){let r;if(o.dataType==="map"&&o.properties)r=vr(e,o.properties);else if(o.dataType==="array")o.of&&Array.isArray(e)?o.of.dataType==="map"?r=e.map(i=>JSON.stringify(i)):r=e.map(i=>br(i,o.of)):r=e;else if(o.dataType==="reference"){const i=e||void 0;r=i?i.pathWithId:null}else o.dataType==="timestamp"?r=e?e.getTime():null:r=e;return r}function vr(e,o){const r=Object.entries(o).map(([i,n])=>{const a=e&&e[i],l=br(a,n);return l===void 0?{}:{[i]:l}}).reduce((i,n)=>({...i,...n}),{});return{...e,...r}}function yr(e){return e.map(o=>{if(o==null)return"";const r=String(o);return'"'+r.replaceAll('"','""')+'"'}).join(",")+`\r
`}function _l(e,o,r){const i=new Blob(e,{type:r}),n=URL.createObjectURL(i),a=document.createElement("a");a.href=n,a.setAttribute("download",o),a.click()}const Zt=200;function El({schema:e,schemaResolver:o,path:r,exportConfig:i}){const n=_e(),a=de(),l=p.useRef(),d=p.useRef(),[c,u]=z.default.useState(!1),[g,h]=z.default.useState(),[f,b]=z.default.useState(!1),[y,v]=z.default.useState(!1),[C,w]=z.default.useState(!1),m=p.useCallback(()=>{w(!0)},[w]),S=p.useCallback(()=>{w(!1)},[w]),k=p.useCallback((A,P,q,O,T,E)=>{if(!A)throw Error("Trying to perform export without loading data first");const $=O({});Sl(A,P,$,T,E)},[]);p.useEffect(()=>{if(!C)return;u(!0);const A=async O=>{O.length>=Zt&&b(!0);const T=l.current&&O.length>l.current.length&&y;l.current=O;const E=await P(O);d.current=E,u(!1),h(void 0),T&&(k(O,E,e,o,r,i),S())},P=async O=>{if(!i?.additionalColumns)return;const T=i.additionalColumns;return await Promise.all(O.map(async $=>(await Promise.all(T.map(async D=>({[D.key]:await D.builder({entity:$,context:a})})))).reduce((D,N)=>({...D,...N}),{})))},q=O=>{console.error("ERROR",O),u(!1),h(O)};n.fetchCollection({path:r,schema:o,limit:y?void 0:Zt}).then(A).catch(q)},[r,y,e,C,n,o,k,i,S,a]);const _=f&&!y,I=p.useCallback(()=>{_?v(!0):(k(l.current,d.current,e,o,r,i),S())},[_,k,e,o,r,i,S]);return t.jsxs(t.Fragment,{children:[t.jsx(s.Tooltip,{title:"Export",children:t.jsx(s.IconButton,{color:"primary",onClick:m,size:"large",children:t.jsx(hi.default,{})})}),t.jsxs(s.Dialog,{open:C,onClose:S,children:[t.jsx(s.DialogTitle,{children:"Export data"}),t.jsx(s.DialogContent,{children:t.jsxs(s.DialogContentText,{children:[t.jsx("div",{children:"Download the the content of this table as a CSV"}),t.jsx("br",{}),_&&t.jsxs(s.Alert,{elevation:1,variant:"filled",severity:"warning",children:[t.jsxs("div",{children:["This collections has a large number of documents (more than ",Zt,")."]}),t.jsx("div",{children:"Would you like to proceed?"})]})]})}),t.jsxs(s.DialogActions,{children:[c&&t.jsx(s.CircularProgress,{size:16,thickness:8}),t.jsx(s.Button,{color:"primary",onClick:S,children:"Cancel"}),t.jsx(s.Button,{color:"primary",disabled:c,onClick:I,children:"Download"})]})]})]})}const gt={edit:!0,create:!0,delete:!0};function Rt(e,o,r,i,n){if(e===void 0)return gt;if(typeof e=="object")return e;if(typeof e=="function")return e({user:r.user,authController:r,entity:o,path:i,context:n});throw Error("New type of HasPermission added and not mapped")}function eo(e,o,r,i,n){return Rt(e,o,r,i,n).edit??gt.edit}function wr(e,o,r,i){return Rt(e,null,o,r,i).create??gt.create}function Cr(e,o,r,i,n){return Rt(e,o,r,i,n).delete??gt.delete}function to(e){const[o,r]=p.useState([]);let i=st({path:e.path,schemaResolver:e.schemaResolver});i=st({path:e.path,schemaResolver:e.schemaResolver});const n=p.useCallback(c=>{let u;o.map(g=>g.id).includes(c.id)?u=o.filter(g=>g.id!==c.id):u=[...o,c],r(u)},[o]),a=p.useCallback(c=>{if(o.length===i.data.length&&o.length!==0)r([]);else if(i.data){const u=i.data;r(u)}},[o]),l=p.useCallback(c=>o.map(u=>u.id).includes(c.id),[o]),d=p.useCallback(()=>o.length===i.data.length&&o.length!==0,[o,i]);return{selectedEntities:o,setSelectedEntities:r,isEntitySelected:l,isAllEntitiesSelected:d,toggleEntitySelection:n,selectAll:a}}function pt({path:e,collection:o}){const r=Fe(),i=de(),n=Ue(),a=Te(),l=s.useTheme(),d=s.useMediaQuery(l.breakpoints.up("md")),[c,u]=z.default.useState(void 0),g=a.getCollectionResolver(e);if(!g)throw Error(`Couldn't find the corresponding collection view for the path: ${e}`);const h=p.useCallback(U=>{a.onCollectionModifiedForUser(e,U)},[e]),f=g??o,{schemaResolver:b}=g,y=f.exportable===void 0||f.exportable,v=f.selectionEnabled===void 0||f.selectionEnabled,C=f.inlineEditing!==void 0&&!f.inlineEditing,[w,m]=z.default.useState(null),S=to(f),k=f.selectionController??S,{selectedEntities:_,toggleEntitySelection:I,selectAll:A,isAllEntitiesSelected:P,isEntitySelected:q,setSelectedEntities:O,collectionData:T}=k;p.useEffect(()=>{u(void 0)},[_]);const E=p.useCallback(U=>r.open({entityId:U.id,path:e,permissions:f.permissions,schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1}),[e,f,r]),$=p.useCallback(U=>(U.stopPropagation(),r.open({path:e,permissions:f.permissions,schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1})),[e,f,r]),D=p.useCallback((U,ee)=>{O(_.filter(G=>G.id!==ee.id))},[_,O]),N=p.useCallback((U,ee)=>{O([]),u(void 0)},[O]),J=p.useCallback(U=>eo(f.permissions,U,n,e,i)?f.inlineEditing===void 0||f.inlineEditing:!1,[f.inlineEditing,f.permissions,e]),L=p.useCallback(({width:U,key:ee})=>{if(!f.schema.properties[ee])return;const G={columnWidth:U},H={schema:{properties:{[ee]:G}}};h&&h(H)},[f.schema.properties,h]),B=p.useCallback(U=>{h&&h({defaultSize:"xs"})},[h]),M=w!=null,F=p.useMemo(()=>t.jsxs("div",{style:{padding:"4px"},children:[t.jsx(s.Typography,{variant:"h6",style:{lineHeight:"1.0",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"fit-content",cursor:f.description?"pointer":"inherit"},onClick:f.description?U=>{m(U.currentTarget),U.stopPropagation()}:void 0,children:`${f.name}`}),t.jsx(s.Typography,{style:{display:"block",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"160px",direction:"rtl",textAlign:"left"},variant:"caption",color:"textSecondary",children:`/${e}`}),f.description&&t.jsx(s.Popover,{id:"info-dialog",open:M,anchorEl:w,elevation:1,onClose:()=>{m(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(s.Box,{m:2,children:t.jsx(at,{source:f.description})})})]}),[f.description,f.name,e,M,w]),X=p.useCallback(({entity:U,size:ee})=>{const G=q(U),H=P(),Y=wr(f.permissions,n,e,i),ae=eo(f.permissions,U,n,e,i),re=Cr(f.permissions,U,n,e,i),ne=R=>r.open({entityId:R.id,path:e,copy:!0,permissions:{edit:ae,create:Y,delete:re},schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1}),W=R=>r.open({entityId:R.id,path:e,permissions:{edit:ae,create:Y,delete:re},schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1});return t.jsx(zt,{entity:U,isSelected:G,isAllSelected:H,selectionEnabled:v,size:ee,toggleEntitySelection:I,selectAll:A,onEditClicked:W,onCopyClicked:Y?ne:void 0,onDeleteClicked:re?u:void 0})},[k,r,f.permissions,n,e]),j=p.useCallback(U=>{const ee=wr(f.permissions,n,e,i)&&$&&(d?t.jsxs(s.Button,{onClick:$,startIcon:t.jsx(Je.Add,{}),size:"large",variant:"contained",color:"primary",children:["Add ",f.schema.name]}):t.jsx(s.Button,{onClick:$,size:"medium",variant:"contained",color:"primary",children:t.jsx(Je.Add,{})}));_.every(Y=>Cr(f.permissions,Y,n,e,i));const G=f.extraActions?f.extraActions({path:e,collection:f,selectionController:k,context:i}):void 0,H=y&&t.jsx(El,{schema:f.schema,schemaResolver:b,exportConfig:typeof f.exportable=="object"?f.exportable:void 0,path:e});return t.jsxs(t.Fragment,{children:[G,H,f.disableCreate?t.jsx(t.Fragment,{}):ee]})},[k,e,f,d]);return t.jsxs(t.Fragment,{children:[t.jsx(Qt,{title:F,path:e,collection:f,schemaResolver:b,onSizeChanged:B,inlineEditing:J,onEntityClick:E,onColumnResize:L,tableRowActionsBuilder:X,toolbarActionsBuilder:j,hoverRow:C},`collection_table_${e}`),c&&t.jsx(xl,{entityOrEntitiesToDelete:c,path:e,schema:f.schema,schemaResolver:b,callbacks:f.callbacks,open:!!c,onEntityDelete:D,onMultipleEntitiesDelete:N,onClose:()=>u(void 0)})]})}var Il=Object.freeze(Object.defineProperty({__proto__:null,useSelectionController:to,EntityCollectionView:pt,default:pt},Symbol.toStringTag,{value:"Module"}));function Ee(e){return t.jsx(s.Box,{display:"flex",width:"100%",maxHeight:"100%",height:"100vh",children:t.jsx(s.Box,{m:"auto",children:t.jsx(s.CircularProgress,{...e})})})}const Bl=K.default(e=>Q.default({card:{display:"flex",flexDirection:"column",alignItems:"flex-start",minHeight:248},flexGrow:{flexGrow:1}}));function mr(){const e=Bl(),o=Te();if(!o.navigation)return t.jsx(t.Fragment,{});const{navigationEntries:r,groups:i}=_o(o,!1),n=[...i];r.filter(l=>!l.group).length>0&&n.push(null);function a(l){return t.jsx(s.Grid,{item:!0,xs:12,sm:6,md:4,children:t.jsx(s.Paper,{variant:"outlined",children:t.jsxs(s.CardActionArea,{className:e.card,component:ce.Link,to:l.url,children:[t.jsxs(s.CardContent,{className:e.flexGrow,children:[t.jsx(wi.default,{color:"disabled"}),t.jsx(s.Typography,{gutterBottom:!0,variant:"h5",component:"h2",children:l.name}),l.description&&t.jsx(s.Typography,{variant:"body2",color:"textSecondary",component:"div",children:t.jsx(at,{source:l.description})})]}),t.jsx(s.CardActions,{style:{alignSelf:"flex-end"},children:t.jsx(s.Box,{p:1,children:t.jsx(yi.default,{color:"primary"})})})]})})},`nav_${l.group}_${l.name}`)}return t.jsx(s.Container,{children:n.map((l,d)=>t.jsxs(s.Box,{mt:6,mb:6,children:[n.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s.Typography,{color:"textSecondary",className:"weight-500",children:l?.toUpperCase()??"Collections".toUpperCase()}),t.jsx(s.Divider,{})]}),t.jsx(s.Box,{mt:2,children:t.jsxs(s.Grid,{container:!0,spacing:2,children:[l&&r.filter(c=>c.group===l).map(c=>a(c)),!l&&r.filter(c=>!c.group).map(c=>a(c))]})})]},`group_${d}`))})}const Pl={name:"1oajfbb",styles:"& .BaseTable{box-shadow:0 2px 4px 0 rgba(128, 128, 128, 0.2);contain:strict;position:relative;box-sizing:border-box;font-size:13px;}& .BaseTable--disabled{opacity:0.7;pointer-events:none;}& .BaseTable--dynamic .BaseTable__row{overflow:hidden;align-items:stretch;}& .BaseTable:not(.BaseTable--dynamic) .BaseTable__row-cell-text,& .BaseTable .BaseTable__row--frozen .BaseTable__row-cell-text{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}& .BaseTable__table{position:absolute;top:0;display:flex;flex-direction:column-reverse;}& .BaseTable__table-main{outline:1px solid rgba(128, 128, 128, 0.1);left:0;}& .BaseTable__table-main .BaseTable__header-cell:first-of-type,.BaseTable__table-main .BaseTable__row-cell:first-of-type{padding:0;}& .BaseTable__table-frozen-left .BaseTable__body{backdrop-filter:blur(4px);}& .BaseTable__table-frozen-left .BaseTable__header,& .BaseTable__table-frozen-left .BaseTable__body,.BaseTable__table-frozen-right .BaseTable__header,& .BaseTable__table-frozen-right .BaseTable__body{overflow:hidden!important;}& .BaseTable__table-frozen-left{box-shadow:2px 0 4px 0 rgba(128, 128, 128, 0.1);top:0;left:0;}& .BaseTable__table-frozen-left .BaseTable__header-cell:first-of-type,.BaseTable__table-frozen-left .BaseTable__row-cell:first-of-type{padding:0;}& .BaseTable__table-frozen-left .BaseTable__header-row,& .BaseTable__table-frozen-left .BaseTable__row{padding-right:0!important;}& .BaseTable__table-frozen-left .BaseTable__body{overflow-y:auto!important;}& .BaseTable__table-frozen-right{box-shadow:-2px 0 4px 0 rgba(128, 128, 128, 0.3);top:0;right:0;}& .BaseTable__table-frozen-right .BaseTable__header-cell:last-child,.BaseTable__table-frozen-right .BaseTable__row-cell:last-child{padding-right:15px;}& .BaseTable__table-frozen-right .BaseTable__header-row,& .BaseTable__table-frozen-right .BaseTable__row{padding-left:0!important;}& .BaseTable__table-frozen-right .BaseTable__body{overflow-y:auto!important;}& .BaseTable__header{overflow:hidden!important;}& .BaseTable .BaseTable__header,& .BaseTable .BaseTable__body{outline:none;}& .BaseTable__header-row,.BaseTable__row{display:flex;align-items:center;border-bottom:1px solid rgba(128, 128, 128, 0.1);box-sizing:border-box;}& .BaseTable__header-row{font-weight:700;}& .BaseTable__row{}& .BaseTable__row:hover,.BaseTable__row--hovered{}& .BaseTable__row-expanded{}& .BaseTable__header-cell,.BaseTable__row-cell{min-width:0;height:100%;display:flex;align-items:center;padding:0 7.5px;box-sizing:border-box;}& .BaseTable__header-cell--align-center,.BaseTable__row-cell--align-center{justify-content:center;text-align:center;}& .BaseTable__header-cell--align-right,.BaseTable__row-cell--align-right{justify-content:flex-end;text-align:right;}& .BaseTable__header-cell{position:relative;cursor:default;}& .BaseTable__header-cell:hover .BaseTable__column-resizer{visibility:visible;opacity:0.5;}& .BaseTable__header-cell:hover .BaseTable__column-resizer:hover{opacity:1;}& .BaseTable__header-cell .BaseTable__sort-indicator{display:none;}& .BaseTable__header-cell--sortable:hover{background-color:#f3f3f3;cursor:pointer;}& .BaseTable__header-cell--sortable:not(.BaseTable__header-cell--sorting):hover .BaseTable__sort-indicator{display:block;color:#888888;}& .BaseTable__header-cell--sorting .BaseTable__sort-indicator,.BaseTable__header-cell--sorting:hover .BaseTable__sort-indicator{display:block;}& .BaseTable__header-cell--resizing .BaseTable__column-resizer{visibility:visible;opacity:1;}& .BaseTable__header-cell--resizing .BaseTable__column-resizer::after{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;content:'';left:-9999px;}& .BaseTable__header-cell-text{overflow:hidden;text-overflow:ellipsis;white-space:normal;}& .BaseTable__header-row--resizing .BaseTable__header-cell{background-color:transparent;cursor:col-resize;}& .BaseTable__header-row--resizing .BaseTable__header-cell:not(.BaseTable__header-cell--sorting) .BaseTable__sort-indicator{display:none;}& .BaseTable__header-row--resizing .BaseTable__header-cell:not(.BaseTable__header-cell--resizing) .BaseTable__column-resizer{visibility:hidden;}& .BaseTable__column-resizer{width:3px;visibility:hidden;background-color:#cccccc;}& .BaseTable__column-resizer:hover{visibility:visible;opacity:1;}& .BaseTable__footer{position:absolute;left:0;right:0;bottom:0;overflow:hidden;background-color:#ffffff;}& .BaseTable__resizing-line{cursor:col-resize;position:absolute;top:0;background-color:#cccccc;width:3px;transform:translateX(-100%);}& .BaseTable__empty-layer{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;}& .BaseTable__overlay{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;pointer-events:none;}& .BaseTable__overlay>*{pointer-events:auto;}"},Fl={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"in","array-contains":"Contains","array-contains-any":"Any"},oo=["array-contains-any","in"];function Al({name:e,value:o,setValue:r,dataType:i,isArray:n,enumValues:a,title:l}){const d=n?["array-contains"]:["==","!=",">","<",">=","<="];a&&(n?d.push("array-contains-any"):d.push("in"));const[c,u]=o||[d[0],void 0],[g,h]=p.useState(c),[f,b]=p.useState(u);function y(C,w){let m=w;const S=oo.includes(g),k=oo.includes(C);S!==k&&(m=k?typeof w=="string"||typeof w=="number"?[w]:[]:""),typeof m=="number"&&isNaN(m)&&(m=void 0),h(C),b(m);const _=m!==null&&Array.isArray(m)?m.length>0:m!==void 0;r(C&&_?[C,m]:void 0)}const v=oo.includes(g);return t.jsxs(s.Box,{display:"flex",width:340,alignItems:"center",children:[t.jsx(s.Box,{width:80,children:t.jsx(s.FormControl,{fullWidth:!0,children:t.jsx(s.Select,{value:g,fullWidth:!0,onChange:C=>{y(C.target.value,f)},children:d.map(C=>t.jsx(s.MenuItem,{value:C,children:Fl[C]},`filter_op_${e}_${C}`))})})}),t.jsx(s.Box,{flexGrow:1,ml:1,children:t.jsxs(s.FormControl,{fullWidth:!0,children:[!a&&t.jsx(s.OutlinedInput,{fullWidth:!0,type:i==="number"?"number":void 0,value:f!==void 0?f:"",onChange:C=>{const w=i==="number"?parseFloat(C.target.value):C.target.value;y(g,w)}},`filter_${e}`),a&&t.jsx(s.Select,{fullWidth:!0,multiple:v,value:f!==void 0?f:n?[]:"",onChange:C=>y(g,i==="number"?parseInt(C.target.value):C.target.value),renderValue:v?C=>t.jsx("div",{children:C.map(w=>t.jsx(xe,{enumKey:w,enumValues:a,small:!0},`select_value_${e}_${w}`))}):void 0,children:Object.entries(a).map(([C,w])=>t.jsx(s.MenuItem,{value:C,children:t.jsx(xe,{enumKey:C,enumValues:a,small:!0})},`select_${e}_${C}`))},`filter-select-${v}-${e}`)]})}),f!==void 0&&t.jsx(s.Box,{ml:1,children:t.jsx(s.IconButton,{onClick:C=>y(g,void 0),size:"small",children:t.jsx(vo.default,{title:`Clear ${l}`,children:t.jsx(Be.default,{fontSize:"small"})})})})]})}const $l=K.default(e=>Q.default({formControl:{width:"200px"},label:{width:"100%",height:"100%"}}));function Ol({name:e,title:o,value:r,setValue:i}){const n=$l();function a(c){i(c!==void 0?["==",c]:void 0)}const l=r&&r[1],d=!!r;return t.jsx(s.FormControlLabel,{className:n.formControl,labelPlacement:"end",checked:d&&l,control:t.jsx(s.Checkbox,{indeterminate:!d,onChange:c=>{a(l?!1:d?void 0:!0)}},`filter-${e}`),label:d?l?`${o} is true`:`${o} is false`:"No filter"})}const Dl={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"in","array-contains":"Contains","array-contains-any":"Any"},xr=["array-contains-any","in"];function Ll({name:e,isArray:o,value:r,setValue:i,title:n}){const a=o?["array-contains"]:["==","!=",">","<",">=","<="],[l,d]=r||[a[0],void 0],[c,u]=p.useState(l),[g,h]=p.useState(d);function f(b,y){let v=y;const C=xr.includes(c),w=xr.includes(b);C!==w&&(v=w?y?[y]:[]:""),u(b),h(v===null?void 0:v);const m=v!==null&&Array.isArray(v)?v.length>0:v!==void 0;i(b&&m?[b,v]:void 0)}return t.jsxs(s.Box,{display:"flex",width:340,alignItems:"center",children:[t.jsx(s.Box,{width:80,children:t.jsx(s.FormControl,{fullWidth:!0,children:t.jsx(s.Select,{value:c,fullWidth:!0,onChange:b=>{f(b.target.value,g)},children:a.map(b=>t.jsx(s.MenuItem,{value:b,children:Dl[b]},`filter_op_${e}_${b}`))})})}),t.jsx(s.Box,{flexGrow:1,ml:1,children:t.jsx(mt.default,{clearable:!0,InputProps:{},renderInput:b=>t.jsx(s.Input,{startAdornment:t.jsx(Ti.default,{fontSize:"small"})}),value:g??null,onChange:b=>{f(c,b===null?void 0:b)}})}),g!==void 0&&t.jsx(s.Box,{ml:1,children:t.jsx(s.IconButton,{onClick:b=>f(c,void 0),size:"small",children:t.jsx(vo.default,{title:`Clear ${n}`,children:t.jsx(Be.default,{fontSize:"small"})})})})]})}const Sr=K.default(e=>Q.default({header:({onHover:o})=>({width:"calc(100% + 24px)",margin:"0px -12px",padding:"0px 12px",color:o?e.palette.text.primary:e.palette.text.secondary,backgroundColor:o?s.darken(e.palette.background.default,.05):e.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600}),headerInternal:({align:o})=>({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),headerTitle:({align:o})=>({overflow:"hidden",flexShrink:1}),headerTitleInternal:({align:o})=>({margin:"0px 4px",overflow:"hidden",justifyContent:o,flexShrink:1}),headerIcon:{paddingTop:"4px"},headerIconButton:{backgroundColor:e.palette.mode==="light"?"#f5f5f5":e.palette.background.default},headerTypography:{fontSize:"0.750rem",fontWeight:600,textTransform:"uppercase"}})),Ml=z.default.memo(Nl);function Nl({sort:e,onColumnSort:o,onFilterUpdate:r,filter:i,column:n}){const[a,l]=p.useState(!1),d=p.useRef(null),c=Sr({onHover:a,align:n.align}),[u,g]=z.default.useState(!1),h=p.useCallback(y=>{g(!0)},[]),f=p.useCallback(()=>{g(!1)},[]),b=p.useCallback(y=>{r(y),g(!1)},[]);return t.jsxs(ie,{children:[t.jsxs(s.Grid,{className:c.header,ref:d,wrap:"nowrap",alignItems:"center",onMouseEnter:()=>l(!0),onMouseMove:()=>l(!0),onMouseLeave:()=>l(!1),container:!0,children:[t.jsx(s.Grid,{item:!0,xs:!0,className:c.headerTitle,children:t.jsxs("div",{className:c.headerInternal,children:[t.jsx("div",{className:c.headerIcon,children:n.icon&&n.icon(a||u)}),t.jsx("div",{className:c.headerTitleInternal,children:n.label})]})}),n.property&&!n.property.hideFilter&&n.sortable&&(e||a||u)&&t.jsx(s.Grid,{item:!0,children:t.jsx(s.Badge,{color:"secondary",variant:"dot",overlap:"circular",invisible:!e,children:t.jsxs(s.IconButton,{size:"small",className:c.headerIconButton,onClick:()=>{o(n.key)},children:[!e&&t.jsx(bo.default,{fontSize:"small"}),e==="asc"&&t.jsx(bo.default,{fontSize:"small"}),e==="desc"&&t.jsx(xi.default,{fontSize:"small"})]})})}),n.property&&!n.property.hideFilter&&n.filter&&t.jsx(s.Grid,{item:!0,children:t.jsx(s.Badge,{color:"secondary",variant:"dot",overlap:"circular",invisible:!i,children:t.jsx(s.IconButton,{className:c.headerIconButton,size:"small",onClick:h,children:t.jsx(Si.default,{fontSize:"small",color:a||u?void 0:"disabled"})})})})]}),n.sortable&&t.jsx(s.Popover,{id:u?`popover_${n.key}`:void 0,open:u,elevation:2,anchorEl:d.current,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsx(ql,{column:n,filter:i,onFilterUpdate:b})})]})}function ql({column:e,onFilterUpdate:o,filter:r}){const i=e.key,n=Sr({}),[a,l]=p.useState(r),d=h=>{o(a)},c=h=>{o(void 0)},u=!!r;function g(h,f,b,y){if(f.dataType==="number"||f.dataType==="string"){const v=f.dataType,C=f.title,w=f.enumValues;return t.jsx(Al,{value:b,setValue:y,name:h,dataType:v,isArray:f.isArray,enumValues:w,title:C})}else if(f.dataType==="boolean"){const v=f.title;return t.jsx(Ol,{value:b,setValue:y,name:h,title:v})}else if(f.dataType==="timestamp"){const v=f.title;return t.jsx(Ll,{value:b,setValue:y,name:h,isArray:f.isArray,title:v})}return t.jsx("div",{children:`Currently the field ${f.dataType} is not supported`})}return t.jsxs(t.Fragment,{children:[t.jsx(s.Box,{p:2,className:n.headerTypography,children:e.label??i}),t.jsx(s.Divider,{}),e.filter&&t.jsx(s.Box,{p:2,children:g(i,e.filter,a,l)}),t.jsxs(s.Box,{display:"flex",justifyContent:"flex-end",m:2,children:[t.jsx(s.Box,{mr:1,children:t.jsx(s.Button,{disabled:!u,color:"primary",type:"reset","aria-label":"filter clear",onClick:c,children:"Clear"})}),t.jsx(s.Button,{variant:"outlined",color:"primary",onClick:d,children:"Filter"})]})]})}const zl=1200,Vl=K.default(e=>Q.default({tableContainer:{width:"100%",height:"100%",flexGrow:1},header:{width:"calc(100% + 24px)",margin:"0px -12px",padding:"0px 12px",color:e.palette.text.secondary,backgroundColor:e.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600},tableRow:{cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.875rem"},tableRowClickable:{"&:hover":{backgroundColor:e.palette.mode==="dark"?s.alpha(e.palette.background.default,.6):s.alpha(e.palette.background.default,.5)}},column:{padding:"0px !important"},alignText:{paddingLeft:"12px !important"}}));function Tr({data:e,idColumnBuilder:o,onResetPagination:r,onEndReached:i,size:n,columns:a,frozenIdColumn:l,onRowClick:d,onColumnResize:c,filter:u,checkFilterCombination:g,collection:h,onFilterUpdate:f,sortBy:b,error:y,emptyMessage:v,onSortByUpdate:C,loading:w,hoverRow:m=!0,onSort:S}){const k=b?b[0]:void 0,_=b?b[1]:void 0,[I,A]=z.default.useState(),P=p.useRef(null),q=p.useRef(0),O=p.useRef(0),T=Vl(),E=H=>H.property&&!H.property.disableCustomStyles&&(H.property.dataType==="number"||H.property.dataType==="string"||H.property.dataType==="timestamp")?`${T.column} ${T.alignText} alignText`:T.column;p.useEffect(()=>{P.current&&e?.length&&P.current.scrollToTop(q.current)},[e?.length]);const $=H=>{const Y=k===H&&_==="desc",re=k===H&&_==="asc"?"desc":Y?void 0:"asc",ne=Y?void 0:H,W=re&&ne?[ne,re]:void 0;u&&g&&!g(u,W)&&f&&f(void 0),r&&r(),C&&C(W),S(),B()},[D,N]=z.default.useState(void 0),J=()=>{const H=document.querySelectorAll(".select-all")[0].getElementsByTagName("input")[0];D===void 0?(H.click(),setTimeout(()=>{H.click()},100)):H.click(),N(H.checked)},L=()=>{C&&C(void 0)},B=()=>{P.current&&(q.current=0,P.current.scrollToTop(0))},M=({scrollTop:H,scrollUpdateWasRequested:Y})=>{const ae=Date.now()-O.current>3e3;!Y&&ae&&(q.current=H)},F=()=>{O.current=Date.now(),i&&i()},X=H=>{!d||d(H)},j=({columnIndex:H})=>{const Y=a[H-1],ae=Y&&u&&u[Y.key]?u[Y.key]:void 0,re=ne=>{let W=u?{...u}:{};ne?W[Y.key]=ne:delete W[Y.key],!g||g(W,k&&_?[k,_]:void 0)||(W=ne?{[Y.key]:ne}:{}),f&&f(W),Y.key!==k&&L()};return t.jsx(ie,{children:H===0?t.jsxs("div",{className:T.header,style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",padding:0},children:[t.jsx("p",{style:{margin:0,width:"45px"},children:"ID"}),t.jsx(s.Tooltip,{title:"Select All",className:"select-all",children:t.jsx(s.Checkbox,{checked:D,onChange:J})})]}):t.jsx(Ml,{onFilterUpdate:re,filter:ae,sort:k===Y.key?_:void 0,onColumnSort:$,column:Y})})};function U(){return t.jsxs(s.Box,{display:"flex",flexDirection:"column",justifyContent:"center",margin:6,children:[t.jsx(s.Typography,{variant:"h6",children:"Error fetching data from the data source"}),y?.name&&t.jsx(s.Typography,{children:y?.name}),y?.message&&t.jsx(s.Typography,{children:y?.message})]})}function ee(){return w?t.jsx(Ee,{}):t.jsxs(s.Box,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:2,children:[t.jsx(s.Box,{padding:1,children:t.jsx(mi.default,{})}),t.jsx(s.Typography,{children:v})]})}const G=p.useCallback(({column:H,width:Y})=>{c&&c({width:Y,key:H.key,column:H})},[c]);return t.jsx(t.Fragment,{children:t.jsx(po.default,{bounds:!0,onResize:A,children:({measureRef:H})=>t.jsx("div",{ref:H,className:T.tableContainer,css:Pl,children:I?.bounds&&t.jsxs(Ci.default,{rowClassName:he.default(T.tableRow,{[T.tableRowClickable]:m}),data:e,onColumnResizeEnd:G,width:I.bounds.width,height:I.bounds.height,emptyRenderer:y?U():ee(),fixed:!0,ignoreFunctionInColumnCompare:!1,rowHeight:Vt(n),ref:P,onScroll:M,overscanRowCount:2,onEndReachedThreshold:zl,onEndReached:F,rowEventHandlers:{onClick:X},children:[t.jsx(yt.Column,{headerRenderer:j,cellRenderer:({rowData:Y})=>o?o({size:n,entry:Y}):null,align:"center",dataKey:"id",flexShrink:0,frozen:l?"left":void 0,width:160},"header-id"),a.map(Y=>t.jsx(yt.Column,{title:Y.label,className:({rowData:ae})=>(e?.filter(ne=>ne.id===ae.id)[0]).values.archived?`${E(Y)} archived-row`:E(Y),style:{color:Y.property&&Y.property.textColor?Y.property.textColor:"rgba(0, 0, 0, 0.87)"},headerRenderer:j,cellRenderer:Y.cellRenderer,height:Vt(n),align:Y.align,flexGrow:1,flexShrink:0,resizable:!0,size:n,dataKey:Y.key,width:Y.width},Y.key))]})})})})}const kr=()=>p.useContext(So);function Ul(){return t.jsx(s.Box,{display:"flex",width:"100%",height:"100%",children:t.jsxs(s.Box,{m:"auto",children:[t.jsx(s.Typography,{variant:"h4",align:"center",gutterBottom:!0,children:"Page not found"}),t.jsx(s.Typography,{align:"center",children:"This page does not exist or you may not have access to it"})]})})}function _r({HomePage:e}){const o=ce.useLocation(),r=Te(),i=r.navigation;if(!i)return t.jsx(t.Fragment,{});const n=o.state,a=n&&n.base_location?n.base_location:o,l=[];if(i.views){const g=(h,f)=>t.jsx(ce.Route,{path:h,element:t.jsx(ro,{path:h,title:f.name,children:f.view},`navigation_${h}`)},"navigation_view_"+h);i.views.forEach(h=>{Array.isArray(h.path)?l.push(...h.path.map(f=>g(f,h))):l.push(g(h.path,h))})}const d=[...i.collections].sort((g,h)=>h.path.length-g.path.length).map(g=>{const h=r.buildUrlCollectionPath(g.path);return t.jsx(ce.Route,{path:h+"/*",element:t.jsx(ro,{path:h,title:g.name,children:t.jsx(pt,{path:g.path,collection:g})})},`navigation_${g.path}`)}),c=t.jsx(ce.Route,{path:"/",element:t.jsx(ro,{path:"/",title:"Home",children:e?t.jsx(e,{}):t.jsx(mr,{})},"navigation_home")}),u=t.jsx(ce.Route,{path:"*",element:t.jsx(Ul,{})});return t.jsxs(ce.Routes,{location:a,children:[d,l,c,u]})}function ro({children:e,title:o,path:r}){const i=kr();return z.default.useEffect(()=>{i.set({breadcrumbs:[{title:o,url:r}]})},[r,o]),t.jsx(t.Fragment,{children:e})}function Er(){return t.jsxs("svg",{width:"232",height:"232",viewBox:"0 0 599 599",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[t.jsxs("defs",{children:[t.jsxs("radialGradient",{cx:"28.6213569%",cy:"43.1133328%",fx:"28.6213569%",fy:"43.1133328%",r:"71.5003456%",gradientTransform:"translate(0.286214,0.431133),rotate(3.343450),scale(1.000000,0.996175),translate(-0.286214,-0.431133)",id:"radialGradient-1",children:[t.jsx("stop",{stopColor:"#FF5B79",offset:"0%"}),t.jsx("stop",{stopColor:"#FA5574",offset:"28.0930803%"}),t.jsx("stop",{stopColor:"#EC4C51",offset:"44.7242531%"}),t.jsx("stop",{stopColor:"#9543C1",offset:"71.4578165%"}),t.jsx("stop",{stopColor:"#3857B3",offset:"100%"})]}),t.jsxs("radialGradient",{cx:"53.6205516%",cy:"47.2473036%",fx:"53.6205516%",fy:"47.2473036%",r:"50.8229649%",gradientTransform:"translate(0.536206,0.472473),rotate(90.000000),scale(1.000000,1.206631),translate(-0.536206,-0.472473)",id:"radialGradient-2",children:[t.jsx("stop",{stopColor:"#68294F",stopOpacity:"0",offset:"0%"}),t.jsx("stop",{stopColor:"#5E2548",stopOpacity:"0.04641108",offset:"75.3503173%"}),t.jsx("stop",{stopColor:"#0D060B",stopOpacity:"0.437431709",offset:"100%"})]}),t.jsxs("radialGradient",{cx:"53.8605015%",cy:"48.1990423%",fx:"53.8605015%",fy:"48.1990423%",r:"59.9151549%",gradientTransform:"translate(0.538605,0.481990),rotate(180.000000),scale(1.000000,0.925027),translate(-0.538605,-0.481990)",id:"radialGradient-3",children:[t.jsx("stop",{stopColor:"#68294F",stopOpacity:"0",offset:"0%"}),t.jsx("stop",{stopColor:"#5E2548",stopOpacity:"0.04641108",offset:"84.0867343%"}),t.jsx("stop",{stopColor:"#FF0000",stopOpacity:"0.567324765",offset:"100%"})]})]}),t.jsx("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:t.jsxs("g",{id:"firecms_logo",children:[t.jsx("circle",{fill:"url(#radialGradient-1)",cx:"299.5",cy:"299.5",r:"299.5"}),t.jsx("circle",{fill:"url(#radialGradient-2)",cx:"299.5",cy:"299.5",r:"299.5"}),t.jsx("circle",{fill:"url(#radialGradient-3)",cx:"299.5",cy:"299.5",r:"299.5"})]})})]})}const Wl=K.default(e=>Q.default({logo:{padding:e.spacing(3),maxWidth:280}}));function Ir({logo:e,closeDrawer:o}){const r=Wl(),i=Te(),{navigationEntries:n,groups:a}=p.useMemo(()=>_o(i,!1),[i]),l=Object.values(n).filter(u=>!u.group),d=p.useCallback((u,g,h)=>t.jsx(s.ListItem,{button:!0,component:ce.NavLink,onClick:o,style:({isActive:f})=>({fontWeight:f?"600":"500",background:f?"rgba(128,128,128,0.1)":"inherit"}),to:h.url,children:t.jsx(s.Typography,{variant:"subtitle2",sx:{fontWeight:"inherit",py:.5},children:h.name.toUpperCase()})},`navigation_${u}`),[o]);let c;return e?c=t.jsx("img",{className:r.logo,src:e,alt:"Logo"}):c=t.jsx("div",{className:r.logo,children:t.jsx(Er,{})}),t.jsxs(t.Fragment,{children:[t.jsx(s.Link,{color:"inherit",onClick:o,component:ce.NavLink,to:i.homeUrl,children:c},"breadcrumb-home"),t.jsxs(s.List,{children:[a.map(u=>t.jsxs(z.default.Fragment,{children:[t.jsx(s.Divider,{},`divider_${u}`),t.jsx(s.Box,{pt:2,pl:2,pr:2,pb:.5,children:t.jsx(s.Typography,{variant:"caption",color:"textSecondary",className:"weight-500",children:u.toUpperCase()})}),Object.values(n).filter(g=>g.group===u).map((g,h)=>d(h,u,g))]},`drawer_group_${u}`)),l.length>0&&t.jsx(s.Divider,{},"divider_ungrouped"),l.map((u,g)=>d(g,"none",u))]})]})}const Hl=K.default(e=>Q.default({appbar:{},menuButton:{marginRight:e.spacing(2)},breadcrumb:{backgroundColor:e.palette.grey[100],height:e.spacing(3),color:e.palette.grey[800],fontWeight:e.typography.fontWeightMedium,"&:hover, &:focus":{cursor:"pointer",backgroundColor:e.palette.grey[300]},"&:active":{boxShadow:e.shadows[1],backgroundColor:e.palette.grey[400]}}}));function jl({title:e,handleDrawerToggle:o,toolbarExtraWidget:r}){const i=Hl(),n=kr(),{breadcrumbs:a}=n,l=Ue(),{mode:d,toggleMode:c}=Lt(),u=l.user?.displayName?l.user.displayName[0].toUpperCase():l.user?.email?l.user.email[0].toUpperCase():"A";return t.jsx(s.Slide,{direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:t.jsx(s.AppBar,{className:i.appbar,position:"relative",elevation:1,children:t.jsxs(s.Toolbar,{children:[t.jsx(s.IconButton,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:o,className:i.menuButton,size:"large",children:t.jsx(ki.default,{})}),t.jsx(s.Hidden,{lgDown:!0,children:t.jsx(s.Box,{mr:3,children:t.jsx(s.Link,{underline:"none",color:"inherit",component:ce.Link,to:"/",children:t.jsx(s.Typography,{variant:"h6",noWrap:!0,children:e})},"breadcrumb-home")})}),t.jsx(s.Box,{mr:2,children:t.jsx(s.Breadcrumbs,{separator:t.jsx(Ii.default,{htmlColor:"rgb(0,0,0,0.87)",fontSize:"small"}),"aria-label":"breadcrumb",children:a.map((g,h)=>t.jsx(s.Link,{underline:"none",color:"inherit",component:ce.Link,to:g.url,children:t.jsx(s.Chip,{classes:{root:i.breadcrumb},label:g.title})},`breadcrumb-${h}`))})}),t.jsx(s.Box,{flexGrow:1}),r&&t.jsx(ie,{children:r}),t.jsx(s.Box,{p:1,mr:1,children:t.jsx(s.IconButton,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:()=>c(),size:"large",children:d==="dark"?t.jsx(Ei.default,{}):t.jsx(_i.default,{})})}),t.jsx(s.Box,{p:1,mr:1,children:l.user&&l.user.photoURL?t.jsx(s.Avatar,{src:l.user.photoURL}):t.jsx(s.Avatar,{children:u})}),t.jsx(s.Button,{variant:"text",color:"inherit",onClick:l.signOut,children:"Log Out"})]})})})}const Gl=vt.makeStyles(e=>vt.createStyles({main:{display:"flex",flexDirection:"column",width:"100vw",height:"100vh"},content:{flexGrow:1,width:"100%",height:"100%",overflow:"auto"},drawerPaper:{width:280}}));function Br(e){const{children:o,name:r,logo:i,toolbarExtraWidget:n,Drawer:a}=e,l=Gl(),d=Te(),[c,u]=z.default.useState(!1),g=()=>u(!c),h=()=>u(!1),f=a||Ir;return t.jsxs(t.Fragment,{children:[t.jsx("nav",{children:t.jsx(s.Drawer,{variant:"temporary",anchor:"left",open:c,onClose:h,classes:{paper:l.drawerPaper},ModalProps:{keepMounted:!0},children:d.navigation?t.jsx(f,{logo:i,closeDrawer:h}):t.jsx(Ee,{})})}),t.jsxs("div",{className:l.main,children:[t.jsx(jl,{title:r,handleDrawerToggle:g,toolbarExtraWidget:n}),t.jsx("main",{className:l.content,children:o}),t.jsxs("div",{style:{height:"40px",width:"100%",backgroundColor:"#3D8B76",display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 20px",color:"#fff",fontWeight:"500"},children:["\xA9 2015-",new Date().getFullYear()," Neuro-Eye Diagnostic Systems LLC. Patent No. 11,369,263"]})]})]})}function Yl(e){const o=e.getBoundingClientRect(),r=s.ownerWindow(e);let i;if(e.fakeTransform)i=e.fakeTransform;else{const a=r.getComputedStyle(e);i=a.getPropertyValue("-webkit-transform")||a.getPropertyValue("transform")}let n=0;if(i&&i!=="none"&&typeof i=="string"){const a=i.split("(")[1].split(")")[0].split(",");n=parseInt(a[4],10)}return`translateX(${r.innerWidth}px) translateX(${n-o.left}px)`}function bt(e){const o=Yl(e);o&&(e.style.webkitTransform=o,e.style.transform=o)}const Xl=se.forwardRef(function(o,r){const{children:i,in:n,timeout:a,onExitAnimation:l,...d}=o,c=s.useTheme(),u=se.useRef(null),g=s.useForkRef(i.ref,u),h=s.useForkRef(g,r),f=m=>S=>{m&&(S===void 0?m(u.current):m(u.current,S))},b=f(m=>{bt(m),Jl(m)}),y=f(m=>{const S=Pr({timeout:a},{mode:"enter"});m.style.webkitTransition=c.transitions.create("-webkit-transform",{...S,easing:c.transitions.easing.easeOut}),m.style.transition=c.transitions.create("transform",{...S,easing:c.transitions.easing.easeOut}),m.style.webkitTransform="none",m.style.transform="none",m.style.opacity=1}),v=f(m=>{const S=Pr({timeout:a},{mode:"exit"});m.style.opacity=.5,m.style.webkitTransition=c.transitions.create(["-webkit-transform","opacity"],{...S,easing:c.transitions.easing.sharp}),m.style.transition=c.transitions.create(["transform","opacity"],{...S,easing:c.transitions.easing.sharp}),bt(m)}),C=f(m=>{m.style.webkitTransition="",m.style.transition=""}),w=se.useCallback(()=>{u.current&&bt(u.current)},[]);return se.useEffect(()=>{if(n)return;const m=s.debounce(()=>{u.current&&bt(u.current)}),S=s.ownerWindow(u.current);return S.addEventListener("resize",m),()=>{m.clear(),S.removeEventListener("resize",m)}},[n]),se.useEffect(()=>{n||w()},[n,w]),t.jsx(Tn.Transition,{nodeRef:u,onEnter:b,onEntering:y,onExit:v,onExited:C,appear:!0,in:n,timeout:a,...d,children:(m,S)=>se.cloneElement(i,{ref:h,style:{visibility:m==="exited"&&!n?"hidden":void 0,...i.props.style},...S})})}),Jl=e=>e.scrollTop;function Pr(e,o){const{timeout:r}=e;return{duration:typeof r=="number"?r:r[o.mode]||0}}const Kl=K.default(e=>Q.default({root:{},paper:{height:"100%",WebkitOverflowScrolling:"touch",position:"fixed",outline:0},paperAnchorRight:({offsetPosition:o})=>({left:"auto",right:0}),modal:{}})),Fr={enter:225,exit:175},Ar=z.default.forwardRef(function(o,r){const{children:i,onClose:n,open:a,offsetPosition:l,onExitAnimation:d}=o,c=Kl({offsetPosition:l}),u=t.jsx(s.Paper,{elevation:1,square:!0,style:{transition:"transform 1000ms cubic-bezier(0.33, 1, 0.68, 1)",transform:`translateX(-${l*240}px)`},className:he.default(c.paper,c.paperAnchorRight),children:i}),g=t.jsx(Xl,{in:a,timeout:Fr,onExitAnimation:d,children:u});return t.jsx(s.Modal,{BackdropProps:{transitionDuration:Fr},BackdropComponent:s.Backdrop,className:he.default(c.root,c.modal),open:a,onClose:n,ref:r,keepMounted:!0,disableEnforceFocus:!0,children:g})}),$r="560px",Ge="100vw",no="55vw",Ql=p.lazy(()=>Promise.resolve().then(function(){return Il})),Zl=p.lazy(()=>Promise.resolve().then(function(){return dl})),Rl=p.lazy(()=>Promise.resolve().then(function(){return ls})),ec=K.default(e=>Q.default({container:({containerWidth:o})=>({display:"flex",flexDirection:"column",width:o,height:"100%",[e.breakpoints.down("sm")]:{width:Ge},transition:"width 250ms ease-in-out"}),containerWide:({containerWidth:o})=>({width:`calc(${no} + ${o})`,[e.breakpoints.down("lg")]:{width:Ge}}),subcollectionPanel:{width:no,height:"100%",overflow:"auto",borderLeft:`1px solid ${e.palette.divider}`,[e.breakpoints.down("lg")]:{borderLeft:"inherit",width:Ge}},tabsContainer:({containerWidth:o})=>({flexGrow:1,height:"100%",width:`calc(${no} + ${o})`,[e.breakpoints.down("lg")]:{width:Ge},display:"flex",overflow:"auto",flexDirection:"row"}),form:({containerWidth:o})=>({width:o,maxWidth:"100%",height:"100%",overflow:"auto",[e.breakpoints.down("sm")]:{maxWidth:Ge,width:Ge}}),tabBar:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1),paddingTop:e.spacing(0)},tab:{fontSize:"0.875rem",minWidth:"140px"}}));function tc({path:e,entityId:o,callbacks:r,selectedSubpath:i,copy:n,permissions:a,schema:l,subcollections:d,onModifiedValues:c,width:u}){const g=typeof u=="number"?`${u}px`:u,h=ec({containerWidth:g??$r}),f=_e(),b=Fe(),y=We(),v=de(),C=Ue(),[w,m]=p.useState(n?"copy":o?"existing":"new"),[S,k]=p.useState(o),[_,I]=p.useState(!1),[A,P]=z.default.useState(-1),[q,O]=p.useState(),{entity:T,dataLoading:E,dataLoadingError:$}=lt({path:e,entityId:S,schema:l,useCache:!1}),D=p.useMemo(()=>ge({schemaOrResolver:l,path:e,entityId:o,values:q,previousValues:T?.values}),[l,e,o,q]);p.useEffect(()=>{function W(R){q&&(R.preventDefault(),R.returnValue=`You have unsaved changes in this ${D.name}. Are you sure you want to leave this page?`)}return typeof window<"u"&&window.addEventListener("beforeunload",W),()=>{typeof window<"u"&&window.removeEventListener("beforeunload",W)}},[q,window]);const N=D.views,J=N?.length??0;p.useEffect(()=>{T&&I(!eo(a,T,C,e,v))},[T,a]);const L=s.useTheme(),B=s.useMediaQuery(L.breakpoints.up("lg"));p.useEffect(()=>{if(i||P(-1),N){const W=N.map(R=>R.path).findIndex(R=>R===i);P(W)}if(d&&i){const W=d.map(R=>R.path).findIndex(R=>R===i);P(W+J)}},[i]);const M=p.useCallback(W=>{y.open({type:"error",title:"Error before saving",message:W?.message}),console.error(W)},[]),F=p.useCallback(W=>{y.open({type:"error",title:`${D.name}: Error after saving (entity is saved)`,message:W?.message}),console.error(W)},[]),X=p.useCallback(W=>{k(W.id),y.open({type:"success",message:`${D.name}: Saved correctly`}),m("existing"),c(!1),A===-1&&b.close()},[]),j=p.useCallback(W=>{y.open({type:"error",title:`${D.name}: Error saving`,message:W?.message}),console.error("Error saving entity",e,o),console.error(W)},[]),U=p.useCallback(async({schema:W,path:R,entityId:Ie,values:ye,previousValues:et})=>{if(!!w)return Dt({path:R,entityId:Ie,callbacks:r,values:ye,previousValues:et,schema:W,status:w,dataSource:f,context:v,onSaveSuccess:X,onSaveFailure:j,onPreSaveHookError:M,onSaveSuccessHookError:F})},[w,r,f,v,X,j,M,F]),ee=p.useCallback(()=>{A===-1&&b.close()},[b,A]),G=_?t.jsx(p.Suspense,{fallback:t.jsx(Ee,{}),children:t.jsx(Rl,{entity:T,path:e,schema:D})}):t.jsx(p.Suspense,{fallback:t.jsx(Ee,{}),children:t.jsx(Zl,{status:w,path:e,schemaOrResolver:l,onEntitySave:U,onDiscard:ee,onValuesChanged:O,onModified:c,entity:T},`form_${e}_${T?.id??"new"}`)}),H=N&&N.map((W,R)=>t.jsx(s.Box,{className:h.subcollectionPanel,role:"tabpanel",flexGrow:1,height:"100%",width:"100%",hidden:A!==R,children:t.jsx(ie,{children:W.builder({schema:D,entity:T,modifiedValues:q??T?.values})})},`custom_view_${W.path}_${R}`)),Y=d&&d.map((W,R)=>{const Ie=T?`${T?.path}/${T?.id}/${le(W.path)}`:void 0;return t.jsx(s.Box,{className:h.subcollectionPanel,role:"tabpanel",flexGrow:1,hidden:A!==R+J,children:T&&Ie?t.jsx(p.Suspense,{fallback:t.jsx(Ee,{}),children:t.jsx(Ql,{path:Ie,collection:W})}):t.jsx(s.Box,{m:3,display:"flex",alignItems:"center",justifyContent:"center",children:t.jsx(s.Box,{children:"You need to save your entity before adding additional collections"})})},`subcol_${W.name}_${R}`)}),ae=p.useCallback(W=>{if(W!==-1){if(N&&W<J)return N[W].path;if(d)return d[W-J].path;throw Error("Something is wrong in getSelectedSubpath")}},[N]),re=p.useCallback(W=>{P(W),o&&b.open({path:e,entityId:o,selectedSubpath:ae(W),overrideSchemaRegistry:!1})},[]),ne=t.jsxs(s.Box,{sx:{paddingLeft:2,paddingRight:2,paddingTop:2,display:"flex",alignItems:"center",backgroundColor:L.palette.mode==="light"?L.palette.background.default:L.palette.background.paper},children:[t.jsx(s.IconButton,{onClick:W=>b.close(),size:"large",children:t.jsx(Bi.default,{})}),t.jsx(s.Tabs,{value:A===-1?0:!1,indicatorColor:"secondary",textColor:"inherit",scrollButtons:"auto",children:t.jsx(s.Tab,{label:D.name,classes:{root:h.tab},wrapped:!0,onClick:()=>{re(-1)}})}),t.jsx(s.Box,{flexGrow:1}),E&&t.jsx(s.CircularProgress,{size:16,thickness:8}),t.jsxs(s.Tabs,{value:A>=0?A:!1,indicatorColor:"secondary",textColor:"inherit",onChange:(W,R)=>{re(R)},className:h.tabBar,variant:"scrollable",scrollButtons:"auto",children:[N&&N.map(W=>t.jsx(s.Tab,{classes:{root:h.tab},wrapped:!0,label:W.name},`entity_detail_custom_tab_${W.name}`)),d&&d.map(W=>t.jsx(s.Tab,{classes:{root:h.tab},wrapped:!0,label:W.name},`entity_detail_collection_tab_${W.name}`))]})]});return t.jsx("div",{className:he.default(h.container,{[h.containerWide]:A!==-1}),children:E?t.jsx(Ee,{}):t.jsxs(t.Fragment,{children:[ne,t.jsx(s.Divider,{}),t.jsxs("div",{className:h.tabsContainer,children:[t.jsx(s.Box,{role:"tabpanel",hidden:!B&&A!==-1,className:h.form,children:G}),H,Y]})]})})}function oc(e,o){const[r,i]=z.default.useState(),{navigator:n}=z.default.useContext(ce.UNSAFE_NavigationContext),a=ce.useNavigate(),l=()=>{i(void 0)},d=()=>{o(),i(void 0),a(-1)},c=p.useCallback(({action:u,location:g,retry:h})=>{switch(u){case"REPLACE":{h();return}case"POP":i(g)}},[]);return z.default.useEffect(()=>{if(!e||r||!("block"in n))return;const u=n.block(g=>{const h={...g,retry(){u(),g.retry()}};c(h)});return u},[n,c,e,r]),{navigationWasBlocked:Boolean(r),handleCancel:l,handleOk:d}}function rc({open:e,handleOk:o,handleCancel:r,schemaName:i}){return t.jsxs(Pi.default,{open:e,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[t.jsx($i.default,{id:"alert-dialog-title",children:"Unsaved changes"}),t.jsxs(Ai.default,{children:[t.jsxs(wo.default,{id:"alert-dialog-description",children:["You have unsaved changes in this ",t.jsx("b",{children:i}),"."]}),t.jsx(wo.default,{id:"alert-dialog-description",children:"Are you sure you want to leave this page?"})]}),t.jsxs(Fi.default,{children:[t.jsx(yo.default,{onClick:r,autoFocus:!0,children:" Cancel "}),t.jsx(yo.default,{onClick:o,children:" Ok "})]})]})}function Or(){const o=Fe().sidePanels,r=[...o,void 0];return t.jsx(t.Fragment,{children:r.map((i,n)=>t.jsx(nc,{panel:i,offsetPosition:o.length-n-1},`side_entity_dialog_${n}`))})}function nc({panel:e,offsetPosition:o}){const[r,i]=p.useState(!1),[n,a]=p.useState(!1),{navigationWasBlocked:l,handleOk:d,handleCancel:c}=oc(r&&!n,()=>i(!1)),u=()=>{i(!1),a(!1),h.close()},g=()=>{a(!1)},h=Fe(),f=Te(),b=e?f.getCollectionResolver(e.path,e.entityId):void 0;if(e&&!b)throw Error("ERROR: You are trying to open an entity with no schema defined.");const y=p.useMemo(()=>{if(!!e)return ge({schemaOrResolver:b.schemaResolver,path:e.path,entityId:e.entityId})},[e,b]);return!e||!y?t.jsx(Ar,{open:!1,offsetPosition:o,children:t.jsx("div",{style:{width:$r}})}):t.jsxs(t.Fragment,{children:[t.jsx(Ar,{open:Boolean(e),onClose:()=>{r?a(!0):h.close()},offsetPosition:o,children:t.jsx(ie,{children:t.jsx(tc,{...b,...e,schema:b.schemaResolver,onModifiedValues:i})})}),t.jsx(rc,{open:l||n,handleOk:n?u:d,handleCancel:n?g:c,schemaName:y.name})]})}const Dr=({mode:e,primaryColor:o,secondaryColor:r,fontFamily:i})=>({...s.createTheme({palette:{mode:e,background:{default:e==="dark"?"#242424":"#f6f7f8"},primary:{main:o||"#0070f4"},secondary:{main:r||lo.pink["400"]},error:{main:lo.red.A400}},typography:{fontFamily:i||'"Rubik", "Roboto", "Helvetica", "Arial", sans-serif',fontWeightMedium:500,h6:{fontWeight:500,fontSize:"1.15rem"}},components:{MuiButton:{styleOverrides:{root:{borderRadius:4}}},MuiTableRow:{styleOverrides:{root:{"&:last-child td":{borderBottom:0}}}},MuiTypography:{styleOverrides:{root:{"&.mono":{fontFamily:"'Space Mono', 'Lucida Console', monospace"},"&.weight-500":{fontWeight:500}}}},MuiInputBase:{styleOverrides:{root:{"&.mono":{fontFamily:"'Space Mono', 'Lucida Console', monospace"}}}}}})});function ic(e){return e}function ac(e){return e}function sc(e){return e}function lc(e){return e}function cc(e){return e}function dc(e){return e}function uc(e){return e}function fc(e){return e}function hc(e){return e}function gc(e){return e}const Lr=({firebaseApp:e,signInOptions:o})=>{const[r,i]=p.useState(void 0),[n,a]=p.useState(),[l,d]=p.useState(!0),[c,u]=p.useState(!0),[g,h]=p.useState(!1);function f(){h(!0),i(null)}p.useEffect(()=>{if(!e)return;const T=te.getAuth(e);return i(T.currentUser),te.onAuthStateChanged(T,b,E=>a(E))},[e]);const b=async T=>{i(T),d(!1),u(!1)};function y(){const T=te.getAuth(e);te.signOut(T).then(E=>{i(null),a(null)}),h(!1)}const v=T=>o.find(E=>{if(E===null)throw Error("useFirebaseAuthDelegate");if(typeof E=="object"&&E.provider===T)return E}),C=()=>{const T=new te.GoogleAuthProvider,E=v("google.com");E?.scopes&&E.scopes.forEach(D=>T.addScope(D)),E?.customParameters&&T.setCustomParameters(E.customParameters);const $=te.getAuth();te.signInWithPopup($,T).catch(a)};function w(T,E){u(!0),te.signInWithPopup(T,E).catch(a).then(()=>u(!1))}return{user:r??null,authError:n,authLoading:c,initialLoading:l,signOut:y,loginSkipped:g,skipLogin:f,googleLogin:C,anonymousLogin:()=>{const T=te.getAuth();u(!0),uo.signInAnonymously(T).catch(a).then(()=>u(!1))},appleLogin:()=>{const T=new te.OAuthProvider("apple.com"),E=v("apple.com");E?.scopes&&E.scopes.forEach(D=>T.addScope(D)),E?.customParameters&&T.setCustomParameters(E.customParameters);const $=te.getAuth();w($,T)},facebookLogin:()=>{const T=new te.FacebookAuthProvider,E=v("facebook.com");E?.scopes&&E.scopes.forEach(D=>T.addScope(D)),E?.customParameters&&T.setCustomParameters(E.customParameters);const $=te.getAuth();w($,T)},githubLogin:()=>{const T=new te.GithubAuthProvider,E=v("github.com");E?.scopes&&E.scopes.forEach(D=>T.addScope(D)),E?.customParameters&&T.setCustomParameters(E.customParameters);const $=te.getAuth();w($,T)},microsoftLogin:()=>{const T=new te.OAuthProvider("microsoft.com"),E=v("microsoft.com");E?.scopes&&E.scopes.forEach(D=>T.addScope(D)),E?.customParameters&&T.setCustomParameters(E.customParameters);const $=te.getAuth();w($,T)},twitterLogin:()=>{const T=new te.TwitterAuthProvider,E=v("twitter.com");E?.customParameters&&T.setCustomParameters(E.customParameters);const $=te.getAuth();w($,T)},emailPasswordLogin:(T,E)=>{const $=te.getAuth();u(!0),te.signInWithEmailAndPassword($,T,E).catch(a).then(()=>u(!1))},fetchSignInMethodsForEmail:T=>{const E=te.getAuth();return u(!0),te.fetchSignInMethodsForEmail(E,T).then($=>(u(!1),$))},createUserWithEmailAndPassword:(T,E)=>{const $=te.getAuth();u(!0),uo.createUserWithEmailAndPassword($,T,E).catch(a).then(()=>u(!1))}}};function Mr({firebaseApp:e,textSearchController:o}){const r=p.useRef(),i=r.current;p.useEffect(()=>{!e||(r.current=Z.getFirestore(e))},[e]);function n(c,u,g){const h=Nr(c.data()),f=c.data()?g.properties?wa(h,g.properties):c.data():void 0;return{id:c.id,path:qr(c.ref.path),values:f}}function a(c,u,g,h,f,b){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");const y=Z.collection(i,c),v=[];return u&&Object.entries(u).filter(([C,w])=>!!w).forEach(([C,w])=>{const[m,S]=w;v.push(Z.where(C,m,io(S,i)))}),u&&g&&h&&Object.entries(u).forEach(([C,w])=>{C!==g&&v.push(Z.orderBy(C,"asc"))}),g&&h&&v.push(Z.orderBy(g,h)),f&&v.push(Z.startAfter(f)),b&&v.push(Z.limit(b)),Z.query(y,...v)}function l(c,u,g){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");return Z.getDoc(Z.doc(i,c,u)).then(h=>{const f=ge({schemaOrResolver:g,entityId:h.id,path:c});return n(h,c,f)})}async function d(c,u,g){if(!o)throw Error("Trying to make text search without specifying a FirestoreTextSearchController");const h=await o({path:c,searchString:u});if(h===void 0)throw Error("The current path is not supported by the specified FirestoreTextSearchController");const f=h.map(async b=>{try{return await l(c,b,g)}catch(y){return console.error(y),null}});return Promise.all(f).then(b=>b.filter(y=>y!==null&&y.values))}return{fetchCollection({path:c,schema:u,filter:g,limit:h,startAfter:f,searchString:b,orderBy:y,order:v}){if(b)return d(c,b,u);console.debug("Fetching collection",c,h,g,f,y,v);const C=a(c,g,y,v,f,h),w=ge({schemaOrResolver:u,path:c});return Z.getDocs(C).then(m=>m.docs.map(S=>n(S,c,w)))},listenCollection({path:c,schema:u,filter:g,limit:h,startAfter:f,searchString:b,orderBy:y,order:v,onUpdate:C,onError:w}){console.debug("Listening collection",c,h,g,f,y,v);const m=a(c,g,y,v,f,h);if(b)return d(c,b,u).then(C).catch(k=>{w&&w(k)}),()=>{};const S=ge({schemaOrResolver:u,path:c});return Z.onSnapshot(m,{next:k=>{C(k.docs.map(_=>n(_,c,S)))},error:w})},fetchEntity({path:c,entityId:u,schema:g}){return l(c,u,g)},listenEntity({path:c,entityId:u,schema:g,onUpdate:h,onError:f}){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");return Z.onSnapshot(Z.doc(i,c,u),{next:b=>{const y=ge({schemaOrResolver:g,entityId:b.id,path:c});h(n(b,c,y))},error:f})},saveEntity:async function({path:c,entityId:u,values:g,schema:h,status:f}){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");const y=ge({schemaOrResolver:h,entityId:u,path:c}).properties,v=Z.collection(i,c),C=ya({inputValues:g,properties:y,status:f,timestampNowValue:Z.serverTimestamp(),referenceConverter:m=>Z.doc(i,m.path,m.id),geopointConverter:m=>new Z.GeoPoint(m.latitude,m.longitude)});console.debug("Saving entity",c,u,C);let w;return u?w=Z.doc(v,u):w=Z.doc(v),Z.setDoc(w,C,{merge:!0}).then(()=>({id:w.id,path:w.path,values:Nr(C)}))},async deleteEntity({entity:c}){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");return Z.deleteDoc(Z.doc(i,c.path,c.id))},checkUniqueField(c,u,g,h,f){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");if(console.debug("Check unique field entity",c,u,g,f),h.dataType==="array"&&console.error("checkUniqueField received an array"),g==null)return Promise.resolve(!0);const b=Z.query(Z.collection(i,c),Z.where(u,"==",g));return Z.getDocs(b).then(y=>y.docs.filter(v=>v.id!==f).length===0)}}}function Nr(e){const o=r=>{if(r==null)return r;if(Z.serverTimestamp().isEqual(r))return null;if(r instanceof Z.Timestamp)return r.toDate();if(r instanceof Me)return new Me(r.latitude,r.longitude);if(r instanceof Z.DocumentReference)return new ke(r.id,qr(r.path));if(Array.isArray(r))return r.map(o);if(typeof r=="object"){const i={};for(const n of Object.keys(r))i[n]=o(r[n]);return i}return r};return o(e)}function io(e,o){return Array.isArray(e)?e.map(r=>io(r,o)):e instanceof ke?Z.doc(o,e.path,e.id):e instanceof Me?new Z.GeoPoint(e.latitude,e.longitude):typeof e=="object"?Object.entries(e).map(([r,i])=>({[r]:io(i,o)})).reduce((r,i)=>({...r,...i}),{}):e}function qr(e){let o=e.lastIndexOf("/");return o=o===-1?e.length:o,e.substring(0,o)}function zr({firebaseApp:e}){const[o,r]=p.useState();p.useEffect(()=>{!e||r(Ke.getStorage(e))},[e]);const i={};return{uploadFile({file:n,fileName:a,path:l,metadata:d}){if(!o)throw Error("useFirebaseStorageSource Firebase not initialised");const c=a??n.name;return console.debug("Uploading file",c,n,l,d),Ke.uploadBytes(Ke.ref(o,`${l}/${c}`),n,d).then(u=>({path:u.ref.fullPath}))},getDownloadURL(n){if(!o)throw Error("useFirebaseStorageSource Firebase not initialised");if(i[n])return i[n];const a=Ke.getDownloadURL(Ke.ref(o,n));return i[n]=a,a}}}function Vr({firebaseConfig:e,onFirebaseInit:o}){const[r,i]=z.default.useState(),[n,a]=z.default.useState(!1),[l,d]=z.default.useState(),[c,u]=z.default.useState(),g=p.useCallback(h=>{try{const f=ni.initializeApp(h);u(void 0),a(!1),o&&o(h),i(f)}catch(f){console.error(f),u(f)}},[o]);return p.useEffect(()=>{a(!0),e?(console.log("Using specified config",e),g(e)):fetch("/__/firebase/init.json").then(async h=>{if(console.debug("Firebase init response",h.status),h&&h.status<300){const f=await h.json();console.log("Using configuration fetched from Firebase Hosting",f),g(f)}}).catch(h=>{a(!1),d("Could not load Firebase configuration from Firebase hosting. If the app is not deployed in Firebase hosting, you need to specify the configuration manually"+h.toString())})},[e,g]),{firebaseApp:r,firebaseConfigLoading:n,configError:l,firebaseConfigError:c}}const pc=e=>t.jsx(t.Fragment,{children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:32,height:32,children:[t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJb",x1:"29.401",x2:"29.401",y1:"4.064",y2:"106.734",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#ff5840"}),t.jsx("stop",{offset:".007",stopColor:"#ff5840"}),t.jsx("stop",{offset:".989",stopColor:"#fa528c"}),t.jsx("stop",{offset:"1",stopColor:"#fa528c"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJb)",d:"M47.46,15.5l-1.37,1.48c-1.34,1.44-3.5,1.67-5.15,0.6c-2.71-1.75-6.43-3.13-11-2.37 c-4.94,0.83-9.17,3.85-11.64, 7.97l-8.03-6.08C14.99,9.82,23.2,5,32.5,5c5,0,9.94,1.56,14.27,4.46 C48.81,10.83,49.13,13.71,47.46,15.5z"}),t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJc",x1:"12.148",x2:"12.148",y1:".872",y2:"47.812",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#feaa53"}),t.jsx("stop",{offset:".612",stopColor:"#ffcd49"}),t.jsx("stop",{offset:"1",stopColor:"#ffde44"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJc)",d:"M16.01,30.91c-0.09,2.47,0.37,4.83,1.27,6.96l-8.21,6.05c-1.35-2.51-2.3-5.28-2.75-8.22 c-1.06-6.88,0.54-13.38, 3.95-18.6l8.03,6.08C16.93,25.47,16.1,28.11,16.01,30.91z"}),t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJd",x1:"29.76",x2:"29.76",y1:"32.149",y2:"-6.939",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#42d778"}),t.jsx("stop",{offset:".428",stopColor:"#3dca76"}),t.jsx("stop",{offset:"1",stopColor:"#34b171"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJd)",d:"M50.45,51.28c-4.55,4.07-10.61,6.57-17.36,6.71C22.91,58.2,13.66,52.53,9.07,43.92l8.21-6.05 C19.78,43.81, 25.67,48,32.5,48c3.94,0,7.52-1.28,10.33-3.44L50.45,51.28z"}),t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJe",x1:"46",x2:"46",y1:"3.638",y2:"35.593",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#155cde"}),t.jsx("stop",{offset:".278",stopColor:"#1f7fe5"}),t.jsx("stop",{offset:".569",stopColor:"#279ceb"}),t.jsx("stop",{offset:".82",stopColor:"#2cafef"}),t.jsx("stop",{offset:"1",stopColor:"#2eb5f0"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJe)",d:"M59,31.97c0.01,7.73-3.26,14.58-8.55,19.31l-7.62-6.72c2.1-1.61,3.77-3.71,4.84-6.15 c0.29-0.66-0.2-1.41-0.92-1.41H37c-2.21,0-4-1.79-4-4v-2c0-2.21,1.79-4,4-4h17C56.75,27,59,29.22,59,31.97z"})]})}),bc=e=>t.jsx("svg",{width:32,height:32,viewBox:"0 0 56 56",style:{transform:"scale(2.8)"},version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("g",{stroke:e==="light"?"#424245":"white",strokeWidth:"0.5",fillRule:"evenodd",children:t.jsx("path",{d:"M28.2226562,20.3846154 C29.0546875,20.3846154 30.0976562,19.8048315 30.71875,19.0317864 C31.28125,18.3312142 31.6914062,17.352829 31.6914062,16.3744437 C31.6914062,16.2415766 31.6796875,16.1087095 31.65625,16 C30.7304687,16.0362365 29.6171875,16.640178 28.9492187,17.4494596 C28.421875,18.06548 27.9414062,19.0317864 27.9414062,20.0222505 C27.9414062,20.1671964 27.9648438,20.3121424 27.9765625,20.3604577 C28.0351562,20.3725366 28.1289062,20.3846154 28.2226562,20.3846154 Z M25.2929688,35 C26.4296875,35 26.9335938,34.214876 28.3515625,34.214876 C29.7929688,34.214876 30.109375,34.9758423 31.375,34.9758423 C32.6171875,34.9758423 33.4492188,33.792117 34.234375,32.6325493 C35.1132812,31.3038779 35.4765625,29.9993643 35.5,29.9389701 C35.4179688,29.9148125 33.0390625,28.9122695 33.0390625,26.0979021 C33.0390625,23.6579784 34.9140625,22.5588048 35.0195312,22.474253 C33.7773438,20.6382708 31.890625,20.5899555 31.375,20.5899555 C29.9804688,20.5899555 28.84375,21.4596313 28.1289062,21.4596313 C27.3554688,21.4596313 26.3359375,20.6382708 25.1289062,20.6382708 C22.8320312,20.6382708 20.5,22.5950413 20.5,26.2911634 C20.5,28.5861411 21.3671875,31.013986 22.4335938,32.5842339 C23.3476562,33.9129053 24.1445312,35 25.2929688,35 Z",fill:e==="light"?"#424245":"white",fillRule:"nonzero"})})}),vc=e=>t.jsx("svg",{fill:e==="light"?"#1c1e21":"white",role:"img",viewBox:"0 0 24 24",width:28,height:28,xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"})}),yc=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 90 90",children:t.jsx("g",{children:t.jsx("path",{d:"M90,15.001C90,7.119,82.884,0,75,0H15C7.116,0,0,7.119,0,15.001v59.998   C0,82.881,7.116,90,15.001,90H45V56H34V41h11v-5.844C45,25.077,52.568,16,61.875,16H74v15H61.875C60.548,31,59,32.611,59,35.024V41   h15v15H59v34h16c7.884,0,15-7.119,15-15.001V15.001z",fill:e==="light"?"#39569c":"white"})})}),wc=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 480 480",children:t.jsx("g",{children:t.jsx("path",{d:"M0.176,224L0.001,67.963l192-26.072V224H0.176z M224.001,37.241L479.937,0v224H224.001V37.241z M479.999,256l-0.062,224   l-255.936-36.008V256H479.999z M192.001,439.918L0.157,413.621L0.147,256h191.854V439.918z",fill:e==="light"?"#00a2ed":"white"})})}),Cc=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 24 24",children:t.jsx("path",{fill:e==="light"?"#00acee":"white",d:"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"})}),mc=K.default(e=>Q.default({logo:{padding:e.spacing(3),width:260,height:260}}));function Ur({allowSkipLogin:e,logo:o,signInOptions:r,firebaseApp:i,authDelegate:n,NoUserComponent:a,disableSignupScreen:l=!1}){const d=mc(),c=Ue(),u=Lt(),[g,h]=p.useState(!1),f=r.map(C=>typeof C=="object"?C.provider:C);function b(){let C;const w=["auth/popup-closed-by-user","auth/cancelled-popup-request"];return n.authError&&(n.authError.code==="auth/operation-not-allowed"?C=t.jsxs(t.Fragment,{children:[t.jsx(s.Box,{p:1,children:t.jsx(me,{error:"You need to enable the corresponding login provider in your Firebase project"})}),i&&t.jsx(s.Box,{p:1,children:t.jsx("a",{href:`https://console.firebase.google.com/project/${i.options.projectId}/authentication/providers`,rel:"noopener noreferrer",target:"_blank",children:t.jsx(s.Button,{variant:"text",color:"primary",children:"Open Firebase configuration"})})})]}):w.includes(n.authError.code)||(console.error(n.authError),C=t.jsx(s.Box,{p:1,children:t.jsx(me,{error:n.authError.message})}))),C}let y;o?y=t.jsx("img",{className:d.logo,src:o,alt:"Logo"}):y=t.jsx("div",{className:d.logo,children:t.jsx(Er,{})});let v;return c.notAllowedError&&(typeof c.notAllowedError=="string"?v=c.notAllowedError:c.notAllowedError instanceof Error?v=c.notAllowedError.message:v="It looks like you don't have access to the CMS, based on the specified Authenticator configuration"),t.jsx(s.Fade,{in:!0,timeout:500,mountOnEnter:!0,unmountOnExit:!0,children:t.jsx(s.Box,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",p:2},children:t.jsxs(s.Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",maxWidth:340},children:[t.jsx(s.Box,{m:1,children:y}),v&&t.jsx(s.Box,{p:2,children:t.jsx(me,{error:v})}),b(),!g&&t.jsxs(t.Fragment,{children:[Wr(n,f,u.mode),f.includes("password")&&t.jsx($e,{text:"Email/password",icon:t.jsx(ta.default,{fontSize:"large"}),onClick:()=>h(!0)}),f.includes("anonymous")&&t.jsx($e,{text:"Log in anonymously",icon:t.jsx(oa.default,{fontSize:"large"}),onClick:n.anonymousLogin}),e&&t.jsx(s.Box,{m:1,children:t.jsx(s.Button,{onClick:n.skipLogin,children:"Skip login"})})]}),g&&t.jsx(xc,{authDelegate:n,onClose:()=>h(!1),mode:u.mode,NoUserComponent:a,disableSignupScreen:l})]})})})}function $e({icon:e,onClick:o,text:r}){return t.jsx(s.Box,{m:.5,width:"100%",children:t.jsx(s.Button,{fullWidth:!0,variant:"outlined",onClick:o,children:t.jsxs(s.Box,{sx:{p:"1",display:"flex",width:"240px",height:"32px",alignItems:"center",justifyItems:"center"},children:[t.jsx(s.Box,{sx:{display:"flex",flexDirection:"column",width:"32px",alignItems:"center",justifyItems:"center"},children:e}),t.jsx(s.Box,{sx:{flexGrow:1,pl:2,textAlign:"center"},children:r})]})})})}function xc({onClose:e,authDelegate:o,mode:r,NoUserComponent:i,disableSignupScreen:n}){const a=p.useRef(null),[l,d]=p.useState(),[c,u]=p.useState(),[g,h]=p.useState(),f=c===void 0,b=c&&c.includes("password"),y=c&&!c.includes("password")&&c.length>0,v=c&&!c.includes("password");p.useEffect(()=>{console.log("loginMode",b),(b||v)&&a.current&&a.current.focus()},[b,v]),p.useEffect(()=>{if(!document)return;const A=P=>{P.keyCode===27&&e()};return document.addEventListener("keydown",A,!1),()=>{document.removeEventListener("keydown",A,!1)}},[document]);function C(){l&&o.fetchSignInMethodsForEmail(l).then(A=>{console.log(A),u(A)})}function w(){l&&g&&o.emailPasswordLogin(l,g)}function m(){l&&g&&o.createUserWithEmailAndPassword(l,g)}const S=()=>{f?e():u(void 0)},k=A=>{A.preventDefault(),f?C():b?w():v&&m()},_=v?"No user found with that email. Pick a password to create a new account":b?"Please enter your password":"Please enter your email",I=v?"Create account":b?"Login":"Ok";return y?t.jsxs(s.Grid,{container:!0,spacing:1,children:[t.jsx(s.Grid,{item:!0,xs:12,children:t.jsx(s.IconButton,{onClick:S,children:t.jsx(mo.default,{sx:{width:20,height:20}})})}),t.jsxs(s.Grid,{item:!0,xs:12,sx:{p:1},children:[t.jsx(s.Typography,{align:"center",variant:"subtitle2",children:"You already have an account"}),t.jsxs(s.Typography,{align:"center",variant:"body2",children:["You can use one of these methods to login with ",l]})]}),t.jsx(s.Grid,{item:!0,xs:12,children:c&&Wr(o,c,r)})]}):t.jsx(s.Slide,{direction:"up",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:t.jsx("form",{onSubmit:k,children:t.jsxs(s.Grid,{container:!0,spacing:1,children:[t.jsx(s.Grid,{item:!0,xs:12,children:t.jsx(s.IconButton,{onClick:S,children:t.jsx(mo.default,{sx:{width:20,height:20}})})}),t.jsx(s.Grid,{item:!0,xs:12,sx:{p:1,display:v&&n?"none":"flex"},children:t.jsx(s.Typography,{align:"center",variant:"subtitle2",children:_})}),t.jsx(s.Grid,{item:!0,xs:12,sx:{display:f?"inherit":"none"},children:t.jsx(s.TextField,{placeholder:"Email",fullWidth:!0,autoFocus:!0,value:l,disabled:o.authLoading,type:"email",onChange:A=>d(A.target.value)})}),t.jsx(s.Grid,{item:!0,xs:12,children:v&&i}),t.jsx(s.Grid,{item:!0,xs:12,sx:{display:b||v&&!n?"inherit":"none"},children:t.jsx(s.TextField,{placeholder:"Password",fullWidth:!0,value:g,disabled:o.authLoading,inputRef:a,type:"password",onChange:A=>h(A.target.value)})}),t.jsx(s.Grid,{item:!0,xs:12,children:t.jsxs(s.Box,{sx:{display:v&&n?"none":"flex",justifyContent:"end",alignItems:"center",width:"100%"},children:[o.authLoading&&t.jsx(s.CircularProgress,{sx:{p:1},size:16,thickness:8}),t.jsx(s.Button,{type:"submit",children:I})]})})]})})})}function Wr(e,o,r){return t.jsxs(t.Fragment,{children:[o.includes("google.com")&&t.jsx($e,{text:"Sign in with Google",icon:pc(),onClick:e.googleLogin}),o.includes("microsoft.com")&&t.jsx($e,{text:"Sign in with Microsoft",icon:wc(r),onClick:e.microsoftLogin}),o.includes("apple.com")&&t.jsx($e,{text:"Sign in with Apple",icon:bc(r),onClick:e.appleLogin}),o.includes("github.com")&&t.jsx($e,{text:"Sign in with Github",icon:vc(r),onClick:e.githubLogin}),o.includes("facebook.com")&&t.jsx($e,{text:"Sign in with Facebook",icon:yc(r),onClick:e.facebookLogin}),o.includes("twitter.com")&&t.jsx($e,{text:"Sign in with Twitter",icon:Cc(r),onClick:e.twitterLogin})]})}const Hr=[te.GoogleAuthProvider.PROVIDER_ID];function Sc({name:e,logo:o,toolbarExtraWidget:r,authentication:i,schemaOverrideHandler:n,navigation:a,textSearchController:l,allowSkipLogin:d,signInOptions:c=Hr,firebaseConfig:u,onFirebaseInit:g,primaryColor:h,secondaryColor:f,fontFamily:b,dateTimeFormat:y,locale:v,HomePage:C,basePath:w,baseCollectionPath:m,LoginViewProps:S}){const{firebaseApp:k,firebaseConfigLoading:_,configError:I,firebaseConfigError:A}=Vr({onFirebaseInit:g,firebaseConfig:u}),P=Lr({firebaseApp:k,signInOptions:c}),q=Mr({firebaseApp:k,textSearchController:l}),O=zr({firebaseApp:k});return I?t.jsxs("div",{children:[" ",I," "]}):A?t.jsx("div",{children:"It seems like the provided Firebase config is not correct. If you are using the credentials provided automatically by Firebase Hosting, make sure you link your Firebase app to Firebase Hosting."}):_||!k?t.jsxs(t.Fragment,{children:[t.jsx(s.CssBaseline,{}),t.jsx(Ee,{})]}):t.jsx(ce.BrowserRouter,{basename:w,children:t.jsx($o,{navigation:a,authDelegate:P,authentication:i,schemaOverrideHandler:n,dateTimeFormat:y,dataSource:q,storageSource:O,entityLinkBuilder:({entity:T})=>`https://console.firebase.google.com/project/${k.options.projectId}/firestore/data/${T.path}/${T.id}`,locale:v,basePath:w,baseCollectionPath:m,children:({context:T,mode:E,loading:$})=>{const D=Dr({mode:E,primaryColor:h,secondaryColor:f,fontFamily:b});let N;return $?N=t.jsx(Ee,{}):T.authController.canAccessMainView?N=t.jsxs(Br,{name:e,logo:o,toolbarExtraWidget:r,children:[t.jsx(_r,{HomePage:C}),t.jsx(Or,{})]}):N=t.jsx(Ur,{logo:o,allowSkipLogin:d,signInOptions:c??Hr,firebaseApp:k,authDelegate:P,...S}),t.jsxs(s.ThemeProvider,{theme:D,children:[t.jsx(s.CssBaseline,{}),N]})}})})}function Tc(e,o){return console.log("Performing Algolia query",e,o),e.search(o).then(({hits:r})=>r.map(i=>i.objectID)).catch(r=>(console.log(r),[]))}x.ArrayContainer=ft,x.ArrayDefaultField=lr,x.ArrayEnumPreview=it,x.ArrayEnumSelect=nr,x.ArrayOfMapsPreview=qo,x.ArrayOfReferencesField=ur,x.ArrayOfReferencesPreview=Jo,x.ArrayOfStorageComponentsPreview=Xo,x.ArrayOfStringsPreview=Lo,x.ArrayOneOfField=cr,x.ArrayOneOfPreview=Zo,x.ArrayPreview=Qo,x.ArrayPropertyEnumPreview=$t,x.AsyncPreviewComponent=Ea,x.BooleanPreview=Mo,x.CircularProgressCenter=Ee,x.CollectionTable=Qt,x.CustomChip=Ft,x.DateTimeField=ar,x.Drawer=Ir,x.EmptyValue=qe,x.EntityCollectionView=pt,x.EntityForm=Kt,x.EntityPreview=dt,x.EntityReference=ke,x.ErrorView=me,x.FieldDescription=be,x.FireCMS=$o,x.FireCMSHomePage=mr,x.FirebaseCMSApp=Sc,x.FirebaseLoginView=Ur,x.GeoPoint=Me,x.ImagePreview=No,x.LabelWithIcon=ve,x.MapField=fr,x.MapPreview=Ko,x.Markdown=at,x.MarkdownField=dr,x.NavigationRoutes=_r,x.NumberPreview=zo,x.PreviewComponent=ue,x.ReadOnlyField=Jt,x.ReferenceDialog=ht,x.ReferenceField=sr,x.ReferencePreview=He,x.Scaffold=Br,x.Select=jt,x.SideEntityDialogs=Or,x.SkeletonComponent=Ae,x.StorageThumbnail=Yo,x.StorageUploadField=Yt,x.StringPreview=At,x.SwitchField=ir,x.Table=Tr,x.TextField=Xt,x.TimestampPreview=Ho,x.UrlComponentPreview=Mt,x.buildAdditionalColumnDelegate=gc,x.buildCollection=ac,x.buildEntityCallbacks=hc,x.buildEnumValueConfig=fc,x.buildEnumValues=uc,x.buildNavigation=ic,x.buildProperties=cc,x.buildPropertiesOrBuilder=dc,x.buildProperty=lc,x.buildPropertyField=je,x.buildSchema=sc,x.createCMSDefaultTheme=Dr,x.deleteEntityWithCallbacks=Vo,x.performAlgoliaTextSearch=Tc,x.resolveNavigationFrom=Uo,x.saveEntityWithCallbacks=Dt,x.useAuthController=Ue,x.useClearRestoreValue=pe,x.useClipboard=Wo,x.useCollectionFetch=st,x.useDataSource=_e,x.useEntityFetch=lt,x.useFireCMSContext=de,x.useFirebaseAuthDelegate=Lr,x.useFirebaseStorageSource=zr,x.useFirestoreDataSource=Mr,x.useInitialiseFirebase=Vr,x.useModeState=Lt,x.useNavigation=Te,x.useResolvedNavigationFrom=Va,x.useSelectionController=to,x.useSideEntityController=Fe,x.useSnackbarController=We,x.useStorageSource=Ve,Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map

(function(x,Ye){typeof exports=="object"&&typeof module<"u"?Ye(exports,require("@mui/lab/AdapterDateFns"),require("@mui/lab/LocalizationProvider"),require("@date-io/date-fns"),require("date-fns/locale"),require("react"),require("@mui/material"),require("@emotion/react/jsx-runtime"),require("react-router-dom"),require("object-hash"),require("clsx"),require("@mui/icons-material/Error"),require("@mui/styles/createStyles"),require("@mui/styles/makeStyles"),require("@mui/styles"),require("@mui/material/InputBase"),require("@mui/material/styles"),require("@mui/icons-material/Search"),require("@mui/icons-material/Clear"),require("@mui/icons-material"),require("@mui/icons-material/GetApp"),require("@uiw/react-markdown-preview"),require("@mui/icons-material/ContentPaste"),require("@mui/icons-material/OpenInNew"),require("date-fns/format"),require("@mui/icons-material/DescriptionOutlined"),require("@mui/icons-material/KeyboardTab"),require("@mui/icons-material/ArrowForward"),require("@mui/icons-material/PlaylistPlay"),require("react-base-table"),require("react-measure"),require("@mui/icons-material/Assignment"),require("@mui/icons-material/ArrowUpward"),require("@mui/icons-material/ArrowDownward"),require("@mui/icons-material/ArrowDropDownCircle"),require("@mui/material/Tooltip/Tooltip"),require("@mui/lab/DateTimePicker"),require("@mui/icons-material/CalendarToday"),require("@mui/icons-material/Menu"),require("@mui/icons-material/Brightness5"),require("@mui/icons-material/Brightness3"),require("@mui/icons-material/NavigateNext"),require("react-transition-group"),require("@mui/icons-material/Close"),require("@mui/material/Button"),require("@mui/material/Dialog"),require("@mui/material/DialogActions"),require("@mui/material/DialogContent"),require("@mui/material/DialogContentText"),require("@mui/material/DialogTitle"),require("@mui/material/colors"),require("@mui/icons-material/ErrorOutline"),require("@mui/icons-material/RemoveCircle"),require("react-fast-compare"),require("yup"),require("@mui/icons-material/Edit"),require("react-dropzone"),require("@mui/base"),require("formik"),require("@mui/icons-material/DragHandle"),require("react-beautiful-dnd"),require("@mui/icons-material/InfoOutlined"),require("@mui/icons-material/ShortText"),require("@mui/icons-material/Subject"),require("@mui/icons-material/Attachment"),require("@mui/icons-material/Crop75"),require("@mui/icons-material/List"),require("@mui/icons-material/Schedule"),require("@mui/icons-material/ListAlt"),require("@mui/icons-material/Room"),require("@mui/icons-material/ViewList"),require("@mui/icons-material/Link"),require("@mui/icons-material/Equalizer"),require("@mui/icons-material/Photo"),require("@mui/icons-material/Http"),require("@mui/icons-material/Flag"),require("@mui/icons-material/Adjust"),require("@uiw/react-md-editor"),require("@emotion/react"),require("firebase/auth"),require("@firebase/auth"),require("firebase/firestore"),require("firebase/storage"),require("firebase/app"),require("@mui/icons-material/Email"),require("@mui/icons-material/ArrowBack"),require("@mui/icons-material/PersonOutline")):typeof define=="function"&&define.amd?define(["exports","@mui/lab/AdapterDateFns","@mui/lab/LocalizationProvider","@date-io/date-fns","date-fns/locale","react","@mui/material","@emotion/react/jsx-runtime","react-router-dom","object-hash","clsx","@mui/icons-material/Error","@mui/styles/createStyles","@mui/styles/makeStyles","@mui/styles","@mui/material/InputBase","@mui/material/styles","@mui/icons-material/Search","@mui/icons-material/Clear","@mui/icons-material","@mui/icons-material/GetApp","@uiw/react-markdown-preview","@mui/icons-material/ContentPaste","@mui/icons-material/OpenInNew","date-fns/format","@mui/icons-material/DescriptionOutlined","@mui/icons-material/KeyboardTab","@mui/icons-material/ArrowForward","@mui/icons-material/PlaylistPlay","react-base-table","react-measure","@mui/icons-material/Assignment","@mui/icons-material/ArrowUpward","@mui/icons-material/ArrowDownward","@mui/icons-material/ArrowDropDownCircle","@mui/material/Tooltip/Tooltip","@mui/lab/DateTimePicker","@mui/icons-material/CalendarToday","@mui/icons-material/Menu","@mui/icons-material/Brightness5","@mui/icons-material/Brightness3","@mui/icons-material/NavigateNext","react-transition-group","@mui/icons-material/Close","@mui/material/Button","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/DialogTitle","@mui/material/colors","@mui/icons-material/ErrorOutline","@mui/icons-material/RemoveCircle","react-fast-compare","yup","@mui/icons-material/Edit","react-dropzone","@mui/base","formik","@mui/icons-material/DragHandle","react-beautiful-dnd","@mui/icons-material/InfoOutlined","@mui/icons-material/ShortText","@mui/icons-material/Subject","@mui/icons-material/Attachment","@mui/icons-material/Crop75","@mui/icons-material/List","@mui/icons-material/Schedule","@mui/icons-material/ListAlt","@mui/icons-material/Room","@mui/icons-material/ViewList","@mui/icons-material/Link","@mui/icons-material/Equalizer","@mui/icons-material/Photo","@mui/icons-material/Http","@mui/icons-material/Flag","@mui/icons-material/Adjust","@uiw/react-md-editor","@emotion/react","firebase/auth","@firebase/auth","firebase/firestore","firebase/storage","firebase/app","@mui/icons-material/Email","@mui/icons-material/ArrowBack","@mui/icons-material/PersonOutline"],Ye):(x=typeof globalThis<"u"?globalThis:x||self,Ye(x.FireCMS={},x.AdapterDateFns,x.LocalizationProvider,x.DateFnsUtils,x.locales,x.React,x.material,x.jsxRuntime,x.reactRouterDom,x.hash,x.clsx,x.ErrorIcon,x.createStyles,x.makeStyles,x.styles$1,x.InputBase,x.styles,x.SearchIcon,x.ClearIcon,x.iconsMaterial,x.GetAppIcon,x.MarkdownPreview,x.ContentPasteIcon,x.OpenInNewIcon,x.format,x.DescriptionOutlinedIcon,x.KeyboardTabIcon,x.ArrowForwardIcon,x.PlaylistPlayIcon,x.BaseTable,x.Measure,x.AssignmentIcon,x.ArrowUpwardIcon,x.ArrowDownwardIcon,x.ArrowDropDownCircleIcon,x.Tooltip,x.DateTimePicker,x.CalendarTodayIcon,x.MenuIcon,x.Brightness5Icon,x.Brightness3Icon,x.NavigateNextIcon,x.reactTransitionGroup,x.CloseIcon,x.Button,x.Dialog,x.DialogActions,x.DialogContent,x.DialogContentText,x.DialogTitle,x.colors,x.ErrorOutlineIcon,x.RemoveCircleIcon,x.isEqual,x.yup,x.EditIcon,x.reactDropzone,x.base,x.formik,x.DragHandleIcon,x.reactBeautifulDnd,x.InfoIcon,x.ShortTextIcon,x.SubjectIcon,x.AttachmentIcon,x.Crop75Icon,x.ListIcon,x.ScheduleIcon,x.ListAltIcon,x.RoomIcon,x.ViewListIcon,x.LinkIcon,x.EqualizerIcon,x.PhotoIcon,x.HttpIcon,x.FlagIcon,x.AdjustIcon,x.MDEditor,x.react,x.auth,x.auth$1,x.firestore,x.storage,x.app,x.EmailIcon,x.ArrowBackIcon,x.PersonOutlineIcon))})(this,function(x,Ye,Hr,jr,Gr,p,a,t,se,Yr,Xr,Jr,Kr,Zr,bt,Qr,et,Rr,en,Oe,tn,on,rn,nn,ln,an,sn,cn,dn,vt,un,fn,hn,gn,pn,bn,vn,yn,wn,Cn,mn,xn,Sn,Tn,kn,_n,En,In,Bn,Pn,ao,Fn,An,On,$n,Dn,so,Ln,we,Mn,Le,Nn,qn,zn,Vn,Un,Wn,Hn,jn,Gn,Yn,Xn,Jn,Kn,Zn,Qn,Rn,ei,ti,oe,co,Q,Xe,oi,ri,ni,ii){"use strict";function z(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function yt(e){if(e&&e.__esModule)return e;var o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(o,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}}),o.default=e,Object.freeze(o)}var li=z(Ye),ai=z(Hr),si=z(jr),uo=yt(Gr),N=z(p),ne=yt(p),fo=z(Yr),fe=z(Xr),wt=z(Jr),J=z(Kr),X=z(Zr),ci=z(Qr),di=z(Rr),Ie=z(en),ui=z(tn),fi=z(on),hi=z(rn),tt=z(nn),gi=z(ln),pi=z(an),ho=z(sn),bi=z(cn),vi=z(dn),yi=z(vt),go=z(un),wi=z(fn),po=z(hn),Ci=z(gn),mi=z(pn),bo=z(bn),Ct=z(vn),xi=z(yn),Si=z(wn),Ti=z(Cn),ki=z(mn),_i=z(xn),Ei=z(Tn),vo=z(kn),Ii=z(_n),Bi=z(En),Pi=z(In),yo=z(Bn),Fi=z(Pn),Ai=z(Fn),Oi=z(An),Te=z(On),Ce=yt($n),$i=z(Dn),Di=z(Mn),Li=z(Nn),Mi=z(qn),Ni=z(zn),qi=z(Vn),zi=z(Un),Vi=z(Wn),Ui=z(Hn),wo=z(jn),Wi=z(Gn),Hi=z(Yn),ji=z(Xn),Gi=z(Jn),Yi=z(Kn),Xi=z(Zn),Ji=z(Qn),Ki=z(Rn),Zi=z(ei),Qi=z(ri),Co=z(ni),Ri=z(ii);const el={isOpen:!1,close:()=>{},open:e=>{}},mt=N.default.createContext(el),tl=({children:e})=>{const[o,r]=p.useState(!1),[i,n]=p.useState(void 0),[l,s]=p.useState(void 0),[u,c]=p.useState(void 0),d=()=>{r(!1),n(void 0),s(void 0),c(void 0)},g=h=>{const{type:f,message:b,title:y}=h;c(f),s(b),n(y),r(!0)};return t.jsxs(mt.Provider,{value:{isOpen:o,close:d,open:g},children:[e,t.jsx(a.Snackbar,{open:o,autoHideDuration:3e3,onClose:h=>d(),children:t.jsxs(a.Alert,{elevation:1,variant:"filled",onClose:h=>d(),severity:u,children:[i&&t.jsx("div",{children:i}),l&&t.jsx("div",{children:l})]})})]})},mo=N.default.createContext({sideEntityController:{},navigationContext:{},dataSource:{},storageSource:{},authController:{},snackbarController:{}}),ol=({children:e,...o})=>t.jsx(mo.Provider,{value:o,children:e}),rl={breadcrumbs:[],set:e=>{}},xo=N.default.createContext(rl),nl=({children:e})=>{const[o,r]=p.useState([]),i=n=>{r(n.breadcrumbs)};return t.jsx(xo.Provider,{value:{breadcrumbs:o,set:i},children:e})},il={mode:"light",setMode:e=>{},toggleMode:()=>{}},xt=N.default.createContext(il),ll=({children:e})=>{const o=a.useMediaQuery("(prefers-color-scheme: dark)"),i=(localStorage.getItem("prefers-dark-mode")!=null?localStorage.getItem("prefers-dark-mode")==="true":null)??o,[n,l]=p.useState(i?"dark":"light");p.useEffect(()=>{l(i?"dark":"light")},[i]);const s=()=>{n==="light"?(o?localStorage.removeItem("prefers-dark-mode"):localStorage.setItem("prefers-dark-mode","true"),l("dark")):(o?localStorage.setItem("prefers-dark-mode","false"):localStorage.removeItem("prefers-dark-mode"),l("light"))};return t.jsx(xt.Provider,{value:{mode:n,setMode:l,toggleMode:s},children:e})};function le(e){return al(sl(e))}function al(e){return e.startsWith("/")?e.slice(1):e}function sl(e){return e.endsWith("/")?e.slice(0,-1):e}function cl(e,o){if(!o)return;if(le(e).split("/").length%2===0)throw Error(`Collection paths must have an odd number of segments: ${e}`);return So(le(e),o)}function So(e,o){const r=le(e).split("/"),i=To(r);let n;for(let l=0;l<i.length;l++){const s=i[l],u=o&&o.find(c=>c.path===s);if(u){if(s===e)n=u;else if(u.subcollections){const c=e.replace(s,"").split("/").slice(2).join("/");c.length>0&&(n=So(c,u.subcollections))}}if(n)break}return n}function To(e){const o=e.length>0&&e.length%2===0?e.splice(0,e.length-1):e,r=o.length,i=[];for(let n=r;n>0;n=n-2)i.push(o.slice(0,n).join("/"));return i}function ko(e,o){const r=e.navigation;if(!r)throw Error("You can only use `computeTopNavigation` with an initialised navigationContext");const i=[...r.collections.map(l=>({url:e.buildUrlCollectionPath(l.path),name:l.name,description:l.description,group:l.group})),...(r.views??[]).map(l=>o||!l.hideFromNavigation?{url:e.buildCMSUrlPath(Array.isArray(l.path)?l.path[0]:l.path),name:l.name,description:l.description,group:l.group}:void 0).filter(l=>!!l)],n=Array.from(new Set(Object.values(i).map(l=>l.group).filter(Boolean)).values());return{navigationEntries:i,groups:n}}function St(e){const{path:o,collections:r,currentFullPath:i}=e,n=le(o).split("/"),l=To(n),s=[];for(let u=0;u<l.length;u++){const c=l[u],d=r&&r.find(g=>g.path===c);if(d){const g=i&&i.length>0?i+"/"+d.path:d.path;s.push({type:"collection",path:g,collection:d});const h=le(le(o).replace(c,"")),f=h.length>0?h.split("/"):[];if(f.length>0){const b=f[0],y=g+"/"+b;if(s.push({type:"entity",entityId:b,path:g,parentCollection:d}),f.length>1){const v=f.slice(1).join("/"),C=d.schema.views,w=C&&C.find(m=>m.path===v);if(w){const m=i&&i.length>0?i+"/"+w.path:w.path;s.push({type:"custom_view",path:m,view:w})}else d.subcollections&&s.push(...St({path:v,customViews:C,collections:d.subcollections,currentFullPath:y}))}}break}}return s}const _o="new",dl=e=>{const o=se.useLocation(),r=se.useNavigate(),i=p.useRef(!1),[n,l]=p.useState([]),s=e.navigation?.collections,u=o.state,c=u&&u.base_location?u.base_location:o,d=p.useCallback(f=>{l(f),e.removeAllOverridesExcept(f)},[]);p.useEffect(()=>{if(e.initialised)if(o?.state&&u.panels){const f=u.panels;d(f)}else d([])},[o?.state,e.initialised]),p.useEffect(()=>{if(s&&!i.current){if(e.isUrlCollectionPath(o.pathname)){const f=o.hash===`#${_o}`,b=e.urlPathToDataPath(o.pathname),y=ul(b,s,f);d(y)}i.current=!0}},[o,s,n]);const g=p.useCallback(()=>{if(n.length===0)return;const f=n[n.length-1],b=o?.state&&u.panels;if(b&&b.length>0)[...b.slice(0,-1)],r(-1);else{const y=e.buildUrlCollectionPath(f.path);r(y,{replace:!0})}},[n,o]),h=p.useCallback(({path:f,entityId:b,selectedSubpath:y,copy:v,width:C,...w})=>{if(v&&!b)throw Error("If you want to copy an entity you need to provide an entityId");if(w&&(w.schema!==void 0||w.permissions!==void 0||w.subcollections!==void 0)){const k=w.permissions,B=w.schema,P=w.subcollections,M=w.overrideSchemaRegistry;e.setOverride({path:f,entityId:b,schemaConfig:{permissions:k,schema:typeof B!="function"?B:void 0,schemaResolver:typeof B=="function"?B:void 0,subcollections:P,callbacks:w.callbacks},overrideSchemaRegistry:M})}const m=le(f),S=b?e.buildUrlCollectionPath(`${m}/${b}/${y||""}`):e.buildUrlCollectionPath(`${m}#${_o}`),_=n.length>0?n[n.length-1]:void 0;if(b&&_&&_.path===f&&_?.entityId===b){const k={..._,selectedSubpath:y},B=[...n.slice(0,-1),k];d(B),r(e.buildUrlCollectionPath(`${m}/${b}/${y||""}`),{replace:!0,state:{base_location:c,panels:B}})}else{const k={path:f,entityId:b,copy:v!==void 0&&v,width:C,selectedSubpath:y},B=[...n,k];d(B),r(S,{state:{base_location:c,panels:B}})}},[n,o]);return{sidePanels:n,close:g,open:h}};function ul(e,o,r){const i=St({path:e,collections:o}),n=[];let l="";for(let s=0;s<i.length;s++){const u=i[s];if(u.type==="collection"&&(l=u.path),s>0){const c=i[s-1];if(u.type==="entity")c.type==="collection"&&n.push({path:u.path,entityId:u.entityId,copy:!1});else if(u.type==="custom_view"){if(c.type==="entity"){const d=n[n.length-1];d&&(d.selectedSubpath=u.view.path)}}else if(u.type==="collection"&&c.type==="entity"){const d=n[n.length-1];d&&(d.selectedSubpath=u.collection.path)}}}return r&&n.push({path:l,copy:!1}),n}class ke{id;path;constructor(o,r){this.id=o,this.path=r}get pathWithId(){return`${this.path}/${this.id}`}}class Me{latitude;longitude;constructor(o,r){this.latitude=o,this.longitude=r}}const fl=(e,...o)=>({...o.reduce((r,i)=>({...r,[i]:e[i]}),{})});function Tt(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Je(e,o){const r=Object.assign({},e);return Tt(e)&&Tt(o)&&Object.keys(o).forEach(i=>{Tt(o[i])?i in e?r[i]=Je(e[i],o[i]):Object.assign(r,{[i]:o[i]}):Object.assign(r,{[i]:o[i]})}),r}function kt(e,o){if(typeof e=="object"){if(o in e)return e[o];if(o.includes(".")){const r=o.split(".");return kt(e[r[0]],r.slice(1).join("."))}}}function Eo(e){if(!e)return null;if(typeof e=="object"){if("id"in e)return e.id;if(e instanceof Date)return e.toLocaleString();if(e instanceof Me)return fo.default(e)}return fo.default(e,{ignoreUnknown:!0})}function hl({propertyOrBuilder:e,values:o,previousValues:r,path:i,entityId:n,propertyOverride:l}){let s;if(typeof e=="function"){if(s=e({values:o,previousValues:r,entityId:n,path:i}),!s)return console.debug("Property builder not returning `Property` so it is not rendered",i,n,e),null}else s=e;return l&&(s=Je(s,l)),s}function Ke(e){return e.readOnly||e.dataType==="timestamp"&&e.autoValue?!0:e.dataType==="reference"?!e.path:!1}function Io(e){return typeof e.disabled=="object"&&Boolean(e.disabled.hidden)}function he({schemaOrResolver:e,path:o,entityId:r,values:i,previousValues:n}){if(typeof e=="function")return e({entityId:r,values:i,previousValues:n});{const l=Bo({propertiesOrBuilder:e.properties,path:o,entityId:r,values:i,previousValues:n});return{...e,properties:l,originalSchema:e}}}function Bo({propertiesOrBuilder:e,path:o,entityId:r,values:i,previousValues:n}){return Object.entries(e).map(([l,s])=>{const u=hl({propertyOrBuilder:s,values:i??{},previousValues:n??i??{},path:o,entityId:r});return u===null?null:{[l]:u}}).filter(l=>l!==null).reduce((l,s)=>({...l,...s}),{})}function _t(e,o){return Object.entries(e).map(([r,i])=>{const n=o&&r in o?o[r]:void 0,l=gl(r,i,n);return l===void 0?{}:{[r]:l}}).reduce((r,i)=>({...r,...i}),{})}function gl(e,o,r){let i;return o.dataType==="map"&&o.properties?i=_t(o.properties,r):r!==void 0?i=r:i=void 0,i}function pl({inputValues:e,properties:o,status:r,timestampNowValue:i,referenceConverter:n,geopointConverter:l}){return Po(e,o,(s,u)=>{if(u.dataType==="timestamp")return r==="existing"&&u.autoValue==="on_update"||(r==="new"||r==="copy")&&(u.autoValue==="on_update"||u.autoValue==="on_create")?i:s;if(n&&u.dataType==="reference"){if(s instanceof ke)return n(s)}else if(l&&u.dataType==="geopoint"){if(s instanceof Me)return l(s)}else return s})}function bl(e,o){const r=e;return Object.entries(o).forEach(([i,n])=>{e&&e[i]!==void 0?r[i]=e[i]:n.validation?.required&&(r[i]=null)}),r}function ot(e){return new ke(e.id,e.path)}function Po(e,o,r){const i=Object.entries(o).map(([n,l])=>{const s=e&&e[n],u=Et(s,l,r);return u===void 0?{}:{[n]:u}}).reduce((n,l)=>({...n,...l}),{});return{...e,...i}}function Et(e,o,r){let i;if(o.dataType==="map"&&o.properties)i=Po(e,o.properties,r);else if(o.dataType==="array")if(o.of&&Array.isArray(e))i=e.map(n=>Et(n,o.of,r));else if(o.oneOf&&Array.isArray(e)){const n=o.oneOf.typeField??"type",l=o.oneOf.valueField??"value";i=e.map(s=>{if(s===null)return null;if(typeof s!="object")return s;const u=s[n],c=o.oneOf.properties[u];return!u||!c?s:{[n]:u,[l]:Et(s[l],c,r)}})}else i=e;else i=r(e,o);return i}function vl({basePath:e,baseCollectionPath:o,authController:r,navigationOrBuilder:i,schemaOverrideHandler:n,dateTimeFormat:l,locale:s,dataSource:u,storageSource:c,userConfigPersistence:d}){const[g,h]=p.useState(void 0),[f,b]=p.useState(!1),[y,v]=p.useState(void 0),C=p.useRef({}),w=le(e),m=le(o),S=w?`/${w}`:"/",_=w?`/${w}/${m}`:`/${m}`,k=g?.collections!==void 0;p.useEffect(()=>{!r.canAccessMainView||(b(!0),yl({navigationOrCollections:i,user:r.user,authController:r,dateTimeFormat:l,locale:s,dataSource:u,storageSource:c}).then(F=>{h(F),b(!1)}).catch(v))},[r.user,r.canAccessMainView,i,r,l,s,u,c]);const B=p.useCallback(F=>d?d.getCollectionConfig(F)?.schema:void 0,[d]),P=p.useCallback(({schema:F,path:H})=>({entityId:W,values:D,previousValues:Y})=>{const V=B(H),K=kt(V,"properties"),te=Bo({propertiesOrBuilder:F.properties,path:H,entityId:W,values:D??F.defaultValues,previousValues:Y});return{...F,properties:Je(te,K),originalSchema:F}},[B]),M=p.useCallback(F=>{if(!d)return;const H={...d.getCollectionConfig(F)};return delete H.schema,H},[d]),q=p.useCallback((F,H,W)=>{const D=g?.collections,Y=W??(D&&cl(le(F),D)),V=M(F),K=Y?Je(Y,V):void 0,te=It(F,H);let j={};const Z=C.current[te],ie=n&&n({entityId:H,path:le(F)});if(ie&&(j=ie),Z&&(Z.overrideSchemaRegistry===void 0||Z.overrideSchemaRegistry?j={...Z,permissions:j.permissions||Z.permissions,schemaResolver:j.schemaResolver||Z.schemaResolver,subcollections:j.subcollections||Z.subcollections,callbacks:j.callbacks||Z.callbacks}:j={...j,permissions:Z.permissions??j.permissions,schemaResolver:Z.schemaResolver??j.schemaResolver,subcollections:Z.subcollections??j.subcollections,callbacks:Z.callbacks??j.callbacks}),K){const R=K.schema,G=K.subcollections,ye=K.callbacks,U=K.permissions;j={...j,schemaResolver:j.schemaResolver??P({schema:R,path:F}),subcollections:j.subcollections??G,callbacks:j.callbacks??ye,permissions:j.permissions??U}}if(!j.schemaResolver){if(!j.schema)throw Error(`Not able to resolve schema for ${te}`);j.schemaResolver=P({schema:j.schema,path:F})}return{...K,...j}},[g?.collections,M,n,P]),O=p.useCallback(({path:F,entityId:H,schemaConfig:W,overrideSchemaRegistry:D})=>{const Y=It(F,H);if(W)return C.current[Y]={...W,overrideSchemaRegistry:D},Y;delete C.current[Y]},[]),T=p.useCallback(F=>{const H=F.map(({path:W,entityId:D})=>It(W,D));Object.keys(C.current).forEach(W=>{H.includes(W)||delete C.current[W]})},[]),I=p.useCallback(F=>le(F+"/").startsWith(le(_)+"/"),[_]),A=p.useCallback(F=>{if(F.startsWith(_))return F.replace(_,"");throw Error("Expected path starting with "+_)},[_]),$=p.useCallback(F=>`${o}/${le(F)}`,[o]),E=p.useCallback(F=>`/${le(F)}`,[]),L=p.useCallback((F,H)=>{if(d){const W=d.getCollectionConfig(F);d.onCollectionModified(F,Je(W,H))}},[d]);return{navigation:g,loading:f,navigationLoadingError:y,homeUrl:S,basePath:e,baseCollectionPath:o,onCollectionModifiedForUser:L,initialised:k,getCollectionResolver:q,setOverride:O,removeAllOverridesExcept:T,isUrlCollectionPath:I,urlPathToDataPath:A,buildUrlCollectionPath:$,buildCMSUrlPath:E}}const yl=async({navigationOrCollections:e,user:o,authController:r,dateTimeFormat:i,locale:n,dataSource:l,storageSource:s})=>Array.isArray(e)?{collections:e}:typeof e=="function"?e({user:o,authController:r,dateTimeFormat:i,locale:n,dataSource:l,storageSource:s}):e;function It(e,o){return o?`${le(e)}/${le(o)}`:le(e)}function wl({authDelegate:e,authentication:o,dateTimeFormat:r,locale:i,dataSource:n,storageSource:l}){const[s,u]=p.useState(null),[c,d]=p.useState(!1),[g,h]=p.useState(!1),[f,b]=p.useState(),y=e.loginSkipped,C=(!(o===void 0||!!o)||Boolean(s)||Boolean(y))&&!g,w=p.useMemo(()=>({user:s,loginSkipped:y,canAccessMainView:C,initialLoading:e.initialLoading??!1,authLoading:c,notAllowedError:g,signOut:e.signOut,extra:f,setExtra:b,authDelegate:e}),[e,c,C,f,y,g,s]),m=p.useCallback(async()=>{const S=e.user;if(o instanceof Function&&S){d(!0);try{await o({user:S,authController:w,dateTimeFormat:r,locale:i,dataSource:n,storageSource:l})?u(S):h(!0)}catch(_){h(_),e.signOut()}d(!1)}else u(S)},[e.user]);return p.useEffect(()=>{m()},[e.user,m]),w}function Fo(e){return e.split("/").filter((o,r)=>r%2===0).reduce((o,r)=>`${o}/${r}`)}function Cl(){function e(r,i){const n=`collection_config_${Fo(r)}`;localStorage.setItem(n,JSON.stringify(i))}function o(r){const i=`collection_config_${Fo(r)}`,n=localStorage.getItem(i);return n?JSON.parse(n):{}}return{onCollectionModified:e,getCollectionConfig:o}}const ml="/c";function Ao(e){const{children:o,navigation:r,entityLinkBuilder:i,authentication:n,dateTimeFormat:l,locale:s,authDelegate:u,schemaOverrideHandler:c,storageSource:d,dataSource:g,basePath:h,baseCollectionPath:f}=e,b=h??"/",y=f??ml,v=s?uo[s]:void 0,C=wl({authDelegate:u,authentication:n,dateTimeFormat:l,locale:s,dataSource:g,storageSource:d}),w=Cl(),m=vl({basePath:b,baseCollectionPath:y,authController:C,navigationOrBuilder:r,dateTimeFormat:l,locale:s,dataSource:g,storageSource:d,schemaOverrideHandler:c,userConfigPersistence:w}),S=dl(m),_=C.authLoading||C.initialLoading||m.loading;return m.navigationLoadingError?t.jsxs("div",{children:[t.jsx("p",{children:"There was an error while loading your navigation config"}),t.jsx("p",{children:m.navigationLoadingError})]}):t.jsx(ll,{children:t.jsx(tl,{children:t.jsx(mt.Consumer,{children:k=>{const B={authController:C,sideEntityController:S,entityLinkBuilder:i,dateTimeFormat:l,locale:s,navigationContext:m,dataSource:g,storageSource:d,snackbarController:k};return t.jsx(ol,{...B,children:t.jsx(nl,{children:t.jsx(ai.default,{dateAdapter:li.default,utils:si.default,locale:v,children:t.jsx(xt.Consumer,{children:({mode:P})=>o({context:B,mode:P,loading:_})})})})})}})})})}const xl=X.default(e=>J.default({flexCenter:{display:"flex",alignItems:"center"},smallMargin:{margin:e.spacing(1)},text:{paddingLeft:e.spacing(2)}}));function me({error:e,tooltip:o}){const r=xl(),i=t.jsxs("div",{className:fe.default(r.flexCenter,r.smallMargin),children:[t.jsx(wt.default,{fontSize:"small",color:"error"}),t.jsx("div",{className:r.text,children:e})]});return o?t.jsx(a.Tooltip,{title:o,children:i}):i}function Sl({builder:e}){const[o,r]=p.useState(!0),[i,n]=p.useState(null);return p.useEffect(()=>{let l=!1;return e.then(s=>{l||(r(!1),n(s))}).catch(s=>{r(!1),console.error(s)}),()=>{l=!0}},[e]),o?t.jsx(a.Skeleton,{variant:"text"}):t.jsx(ne.Fragment,{children:i})}const Tl=ne.memo(Sl);class re extends N.default.Component{constructor(o){super(o),this.state={hasError:!1}}static getDerivedStateFromError(o){return{hasError:!0}}componentDidCatch(o,r){}render(){return this.state.hasError?t.jsxs(a.Box,{display:"flex",flexDirection:"column",m:.5,children:[t.jsxs(a.Box,{display:"flex",alignItems:"center",m:.5,children:[t.jsx(wt.default,{color:"error",fontSize:"small"}),t.jsx(a.Box,{marginLeft:1,children:"Error"})]}),t.jsx(a.Typography,{variant:"caption",children:"See the error in the console"})]}):this.props.children}}function kl(e){let o=0,r,i;for(r=0;r<e.length;r++)i=e.charCodeAt(r),o=(o<<5)-o+i,o|=0;return Math.abs(o)}const Bt={blueLighter:{color:"#cfdfff",text:"#102046"},cyanLighter:{color:"#d0f0fd",text:"#04283f"},tealLighter:{color:"#c2f5e9",text:"#012524"},greenLighter:{color:"#d1f7c4",text:"#0b1d05"},yellowLighter:{color:"#ffeab6",text:"#3b2501"},orangeLighter:{color:"#fee2d5",text:"#6b2613"},redLighter:{color:"#ffdce5",text:"#4c0c1c"},pinkLighter:{color:"#ffdaf6",text:"#400832"},purpleLighter:{color:"#ede2fe",text:"#280b42"},grayLighter:{color:"#eee",text:"#040404"},blueLight:{color:"#9cc7ff",text:"#102046"},cyanLight:{color:"#77d1f3",text:"#04283f"},tealLight:{color:"#72ddc3",text:"#012524"},greenLight:{color:"#93e088",text:"#0b1d05"},yellowLight:{color:"#ffd66e",text:"#3b2501"},orangeLight:{color:"#ffa981",text:"#6b2613"},redLight:{color:"#ff9eb7",text:"#4c0c1c"},pinkLight:{color:"#f99de2",text:"#400832"},purpleLight:{color:"#cdb0ff",text:"#280b42"},grayLight:{color:"#ccc",text:"#040404"},blueDark:{color:"#2d7ff9",text:"#fff"},cyanDark:{color:"#18bfff",text:"#fff"},tealDark:{color:"#20d9d2",text:"#fff"},greenDark:{color:"#20c933",text:"#fff"},yellowDark:{color:"#fcb400",text:"#fff"},orangeDark:{color:"#ff6f2c",text:"#fff"},redDark:{color:"#f82b60",text:"#fff"},pinkDark:{color:"#ff08c2",text:"#fff"},purpleDark:{color:"#8b46ff",text:"#fff"},grayDark:{color:"#666",text:"#fff"},blueDarker:{color:"#2750ae",text:"#cfdfff"},cyanDarker:{color:"#0b76b7",text:"#d0f0fd"},tealDarker:{color:"#06a09b",text:"#c2f5e9"},greenDarker:{color:"#338a17",text:"#d1f7c4"},yellowDarker:{color:"#b87503",text:"#ffeab6"},orangeDarker:{color:"#d74d26",text:"#fee2d5"},redDarker:{color:"#ba1e45",text:"#ffdce5"},pinkDarker:{color:"#b2158b",text:"#ffdaf6"},purpleDarker:{color:"#6b1cb0",text:"#ede2fe"},grayDarker:{color:"#444",text:"#eee"}};function _l(e){const o=kl(e),r=Object.keys(Bt),i=o%r.length;return Bt[r[i]]}function El(e){return Bt[e]}function Ne(e){return e instanceof Map?Array.from(e.entries()):Object.entries(e)}function Oo(e,o){return e instanceof Map?e.get(o):e[o]}function Il(e,o){const r=Oo(e,o);if(typeof r=="object"&&"color"in r)return r.color}function Ze(e){return typeof e=="object"&&e.disabled}function $o(e){if(e!==void 0)return typeof e=="object"?e.label:e}const Bl=X.default(e=>J.default({root:{maxWidth:"100%",backgroundColor:({schema:o,error:r})=>r?"#eee":o.color},label:{color:({schema:o,error:r})=>r?"red":o.text,fontWeight:e.typography.fontWeightRegular}}));function xe({enumValues:e,enumKey:o,small:r}){const i=o!==void 0?Oo(e,o.toString()):void 0,n=$o(i),l=Il(e,o.toString());return t.jsx(Pt,{colorSeed:`${o}`,colorSchemaKey:l,label:n!==void 0?n:o,error:!n,outlined:!1,small:r})}function Pt({colorSeed:e,label:o,colorSchemaKey:r,error:i,outlined:n,small:l}){const s=p.useMemo(()=>r?El(r):_l(e),[e,r]),u=Bl({schema:s,error:i});return t.jsx(a.Chip,{classes:{root:u.root,label:u.label},size:l?"small":"medium",variant:n?"outlined":"filled",label:o})}function Ft({name:e,value:o,property:r,size:i}){if(r.config?.enumValues){const n=o,l=r.config.enumValues;return t.jsx(xe,{enumKey:n,enumValues:l,small:i!=="regular"})}else return r.config?.previewAsTag?t.jsx(re,{children:t.jsx(Pt,{colorSeed:e??"",label:o,small:i!=="regular"})}):t.jsx(t.Fragment,{children:o&&(o.includes(`
`)?o.split(`
`).map((n,l)=>t.jsx("div",{children:n},`string_preview_${l}`)):o)})}const Pl=X.default(e=>J.default({array:{display:"flex",flexDirection:"column"},arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItem:{margin:e.spacing(.5)}}));function Do({name:e,value:o,property:r,size:i}){const n=Pl();if(!r.of||r.dataType!=="array"||r.of.dataType!=="string")throw Error("Picked wrong preview component ArrayOfStringsPreview");if(o&&!Array.isArray(o))return t.jsx("div",{children:`Unexpected value: ${o}`});const l=r.of;return t.jsx("div",{className:n.array,children:o&&o.map((s,u)=>t.jsx("div",{className:n.arrayItem,children:t.jsx(re,{children:t.jsx(Ft,{name:e,property:l,value:s,size:i})})},`preview_array_strings_${e}_${u}`))})}const Fl=X.default(e=>J.default({arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItem:{margin:e.spacing(.5)}}));function rt({name:e,value:o,enumValues:r,size:i}){const n=Fl();return t.jsx("div",{className:n.arrayWrap,children:o&&o.map((l,s)=>t.jsx("div",{className:n.arrayItem,children:t.jsx(re,{children:t.jsx(xe,{enumKey:l,enumValues:r,small:i!=="regular"})})},`preview_array_ref_${e}_${s}`))})}function At({name:e,value:o,property:r,size:i}){if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayEnumPreview");const n=r.of;if(!n.config?.enumValues)throw Error("Picked wrong preview component ArrayEnumPreview");if(!o)return null;const l=n.config?.enumValues;return t.jsx(rt,{name:e,value:o,enumValues:l,size:i})}function Lo({name:e,value:o,property:r,size:i}){return o?t.jsx(Oe.CheckBox,{color:"secondary"}):t.jsx(Oe.CheckBoxOutlineBlank,{color:"disabled"})}function nt({source:e}){return t.jsx(fi.default,{source:typeof e=="string"?e:"",style:{fontSize:"inherit",lineHeight:"inherit",fontFamily:"inherit"},components:{a:o=>t.jsx("a",{...o,onClick:r=>r.stopPropagation(),target:"_blank",children:o.children})}})}const Al=X.default(e=>J.default({root:{borderRadius:"9999px",backgroundColor:"rgba(128,128,128,0.1)",width:"18px",height:"6px",display:"inline-block"}}));function qe(){const e=Al();return t.jsx("div",{className:e.root})}const Ol=40,$l=100,Dl=200;function ze(e){if(e==="tiny")return Ol;if(e==="small")return $l;if(e==="regular")return Dl;throw Error("Thumbnail size not mapped")}function Be(e){switch(e){case"xs":case"s":return"tiny";case"m":return"small";case"l":case"xl":return"regular";default:throw Error("Missing mapping value in getPreviewSizeFrom")}}const Ll=X.default(e=>J.default({image:{maxWidth:"100%",maxHeight:"100%",borderRadius:"4px"},imageWrap:{position:"relative",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",width:({imageSize:o})=>o,height:({imageSize:o})=>o},imageTiny:{position:"relative",objectFit:"cover",width:({imageSize:o})=>o,height:({imageSize:o})=>o,borderRadius:"4px",maxHeight:"100%"},copyIcon:{borderRadius:"9999px",position:"absolute",bottom:-4,right:32,backgroundColor:e.palette.common.white},previewIcon:{borderRadius:"9999px",position:"absolute",bottom:-4,right:-4,backgroundColor:e.palette.common.white}}));function Mo({size:e,url:o}){const[r,i]=p.useState(!1),n=p.useMemo(()=>ze(e),[e]),l=Ll({imageSize:n});if(e==="tiny")return t.jsx("img",{src:o,className:l.imageTiny},"tiny_image_preview_"+o);const s={maxWidth:"100%",maxHeight:"100%",borderRadius:"4px"};return t.jsxs("div",{className:l.imageWrap,onMouseEnter:()=>i(!0),onMouseMove:()=>i(!0),onMouseLeave:()=>i(!1),children:[t.jsx("img",{src:o,className:l.image,style:s}),r&&t.jsxs(t.Fragment,{children:[t.jsx(a.Tooltip,{title:"Copy url to clipboard",children:t.jsx("div",{className:l.copyIcon,children:t.jsx(a.IconButton,{size:"small",onClick:u=>{u.stopPropagation(),navigator.clipboard.writeText(o)},children:t.jsx(hi.default,{htmlColor:"#666",fontSize:"small"})})})}),t.jsx(a.Tooltip,{title:"Open image in new tab",children:t.jsx("a",{className:l.previewIcon,href:o,rel:"noopener noreferrer",target:"_blank",children:t.jsx(a.IconButton,{size:"small",onClick:u=>u.stopPropagation(),children:t.jsx(tt.default,{htmlColor:"#666",fontSize:"small"})})})})]})]},"image_preview_"+o)}function No({name:e,value:o,property:r,size:i}){if(r.dataType!=="array"||!r.of||r.of.dataType!=="map")throw Error("Picked wrong preview component ArrayOfMapsPreview");const n=r.of.properties;if(!n)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);const l=o,s=r.of.previewProperties;if(!l)return null;let u=s;return(!u||!u.length)&&(u=Object.keys(n),i&&(u=u.slice(0,3))),t.jsx(a.Table,{size:"small",children:t.jsx(a.TableBody,{children:l&&l.map((c,d)=>t.jsx(a.TableRow,{sx:{"&:last-child th, &:last-child td":{borderBottom:0}},children:u&&u.map(g=>t.jsx(a.TableCell,{component:"th",children:t.jsx(re,{children:t.jsx(de,{name:g,value:c[g],property:n[g],size:"small"})})},`table-cell-${g}`))},`table_${c}_${d}`))})})}function qo({name:e,value:o,property:r,size:i}){if(r.config?.enumValues){const n=o,l=r.config.enumValues;return t.jsx(xe,{enumKey:n,enumValues:l,small:i!=="regular"})}else return t.jsx(t.Fragment,{children:o})}const Ml="MMMM dd, yyyy, HH:mm:ss",ce=()=>p.useContext(mo);function _e(){return ce().dataSource}function Ot({path:e,schemaResolver:o,filterValues:r,sortBy:i,itemCount:n,searchString:l,entitiesDisplayedFirst:s}){const u=i?i[0]:void 0,c=i?i[1]:void 0,d=_e(),g=p.useMemo(()=>s?s.filter(_=>!!_.values):[],[s]),[h,f]=p.useState(g),[b,y]=p.useState(!1),[v,C]=p.useState(),[w,m]=p.useState(!1),S=p.useCallback(_=>{if(!g)f(_);else{const k=new Set(g.map(B=>B.id));f([...g,..._.filter(B=>!k.has(B.id))])}},[g]);return p.useEffect(()=>{y(!0);const _=B=>{y(!1),C(void 0),S(B),m(!n||B.length<n)},k=B=>{console.error("ERROR",B),y(!1),f([]),C(B)};return d.listenCollection?d.listenCollection({path:e,schema:o,onUpdate:_,onError:k,searchString:l,filter:r,limit:n,startAfter:void 0,orderBy:u,order:c}):(d.fetchCollection({path:e,schema:o,searchString:l,filter:r,limit:n,startAfter:void 0,orderBy:u,order:c}).then(_).catch(k),()=>{})},[e,n,c,u,r,l]),{data:h,dataLoading:b,dataLoadingError:v,noMoreToLoad:w}}const $t={};function it({path:e,entityId:o,schema:r,useCache:i=!1}){const n=_e(),[l,s]=p.useState(),[u,c]=p.useState(!0),[d,g]=p.useState();return p.useEffect(()=>{c(!0);const h=b=>{$t[`${e}/${o}`]=b,s(b),c(!1),g(void 0)},f=b=>{console.error("ERROR fetching entity",b),c(!1),s(void 0),g(b)};return i&&$t[`${e}/${o}`]?(s($t[`${e}/${o}`]),c(!1),g(void 0),()=>{}):o&&e&&r?n.listenEntity?n.listenEntity({path:e,entityId:o,schema:r,onUpdate:h,onError:f}):(n.fetchEntity({path:e,entityId:o,schema:r}).then(h).catch(f),()=>{}):(h(void 0),()=>{})},[o,e]),{entity:l,dataLoading:u,dataLoadingError:d}}async function Dt({schema:e,path:o,entityId:r,callbacks:i,values:n,previousValues:l,status:s,dataSource:u,context:c,onSaveSuccess:d,onSaveFailure:g,onPreSaveHookError:h,onSaveSuccessHookError:f}){let b;if(i?.onPreSave)try{const y=he({values:l,entityId:r,schemaOrResolver:e,path:o});b=await i.onPreSave({schema:y,path:o,entityId:r,values:n,previousValues:l,status:s,context:c})}catch(y){console.error(y),h&&h(y);return}else b=n;return u.saveEntity({schema:e,path:o,entityId:r,values:b,previousValues:l,status:s}).then(y=>{try{if(i?.onSaveSuccess){const v=he({values:b,entityId:r,schemaOrResolver:e,path:o});i.onSaveSuccess({schema:v,path:o,entityId:y.id,values:b,previousValues:l,status:s,context:c})}}catch(v){f&&f(v)}d&&d(y)}).catch(y=>{if(i?.onSaveFailure){const v=he({values:b,entityId:r,schemaOrResolver:e,path:o});i.onSaveFailure({schema:v,path:o,entityId:r,values:b,previousValues:l,status:s,context:c})}g&&g(y)})}async function zo({dataSource:e,entity:o,schema:r,callbacks:i,onDeleteSuccess:n,onDeleteFailure:l,onPreDeleteHookError:s,onDeleteSuccessHookError:u,context:c}){console.debug("Deleting entity",o.path,o.id);const d={entity:o,schema:r,entityId:o.id,path:o.path,context:c};if(i?.onPreDelete)try{await i.onPreDelete(d)}catch(g){return console.error(g),s&&s(o,g),!1}return e.deleteEntity({entity:o}).then(()=>{n&&n(o);try{return i?.onDelete&&i.onDelete(d),!0}catch(g){return u&&u(o,g),!1}}).catch(g=>(l&&l(o,g),!1))}function pe({property:e,value:o,setValue:r}){const i=p.useRef(null);p.useEffect(()=>{typeof e.disabled=="object"&&Boolean(e.disabled.clearOnDisabled)?o!=null&&(i.current=o,r(null)):i.current&&(r(i.current),i.current=null)},[e])}function Se(){return ce().navigationContext}function Vo({path:e,context:o}){const r=o.dataSource,i=o.navigationContext,n=o.navigationContext.navigation;if(!n)throw Error("Calling getNavigationFrom, but main navigation has not yet been initialised");const s=St({path:e,collections:n.collections}).map(u=>{if(u.type==="collection")return Promise.resolve(u);if(u.type==="entity"){const c=i.getCollectionResolver(u.path,u.entityId);if(!c?.schemaResolver)throw Error(`No schema defined in the navigation for the entity with path ${u.path}`);return r.fetchEntity({path:u.path,entityId:u.entityId,schema:c?.schemaResolver}).then(d=>({...u,entity:d}))}else{if(u.type==="custom_view")return Promise.resolve(u);throw Error("Unmapped element in useEntitiesFromPath")}});return Promise.all(s)}function Nl({path:e}){const o=ce(),[r,i]=p.useState(),[n,l]=p.useState(!1),[s,u]=p.useState();return p.useEffect(()=>{o.navigationContext.navigation&&(l(!0),u(void 0),Vo({path:e,context:o}).then(d=>{i(d)}).catch(d=>u(d)).finally(()=>l(!1)))},[e,o]),o.navigationContext.navigation?{data:r,dataLoading:n,dataLoadingError:s}:{dataLoading:!0}}function Ve(){return ce().storageSource}function Qe(){return ce().authController}function Pe(){return ce().sideEntityController}const Ue=()=>p.useContext(mt),Lt=()=>p.useContext(xt),Uo=e=>{const{onSuccess:o,onError:r,disableClipboardAPI:i=!1,copiedDuration:n}=e||{},l=p.useRef(null),[s,u]=p.useState(!1),[c,d]=p.useState("");p.useEffect(()=>{n&&setTimeout(()=>u(!1),n)},[s]);const g=()=>navigator.clipboard!==void 0,h=p.useCallback(m=>{if(r)r(m);else throw new Error(m)},[r]),f=p.useCallback(m=>{o&&o(m),u(!0),d(m)},[o]),b=p.useCallback(m=>{navigator.clipboard.writeText(m).then(()=>f(m)).catch(S=>{h(S),u(!1)})},[h,f]),y=()=>{g()&&navigator.clipboard.writeText("")},v=m=>w("copy",typeof m=="object"?void 0:m),C=()=>w("cut"),w=p.useCallback((m="copy",S)=>{const _=l.current,k=_&&(_.tagName==="INPUT"||_.tagName==="TEXTAREA"),B=l.current;g()&&!i&&(S?b(S):_?k?(b(B.value),m==="cut"&&(B.value="")):b(_.innerText):h("Both the ref & text were undefined"))},[i,b,h]);return{ref:l,isCoppied:s,clipboard:c,clearClipboard:y,isSupported:g,copy:v,cut:C}};function Wo({name:e,value:o,property:r,size:i}){const n=ce(),l=n?.locale?uo[n?.locale]:void 0,s=n?.dateTimeFormat??Ml,u=o?gi.default(o,s,{locale:l}):"";return t.jsx(t.Fragment,{children:u})}const ql=X.default(e=>J.default({flexCenter:{display:"flex",alignItems:"center",justifyContent:"center"},smallMargin:{margin:e.spacing(1)},arrayWrap:{display:"flex",flexWrap:"wrap"},array:{display:"flex",flexDirection:"column"},arrayItem:{margin:e.spacing(.5)},arrayItemBig:{margin:e.spacing(1)},link:{display:"flex",wordBreak:"break-word",fontWeight:e.typography.fontWeightMedium}}));function Mt({value:e,property:o,size:r}){const i=ql();if(!e)return t.jsx("div",{});const n=e;if(typeof o.config?.url=="boolean"&&o.config.url)return t.jsxs(a.Link,{className:i.link,href:n,onMouseDown:s=>{s.preventDefault()},target:"_blank",children:[t.jsx(tt.default,{style:{marginRight:8},fontSize:"small"}),n]});const l=o.config?.url||o.config?.storageMeta?.mediaType;return l==="image"?t.jsx(Mo,{url:n,size:r},`image_preview_${n}_${r}`):l==="audio"?t.jsxs("audio",{controls:!0,src:n,children:["Your browser does not support the",t.jsx("code",{children:"audio"})," element."]},`audio_preview_${n}_${r}`):l==="video"?t.jsx(a.CardMedia,{style:{maxWidth:r==="small"?300:500},component:"video",controls:!0,image:n},`video_preview_${n}_${r}`):t.jsx("a",{href:n,rel:"noopener noreferrer",target:"_blank",onClick:s=>s.stopPropagation(),children:t.jsx("div",{className:i.flexCenter,style:{width:ze(r),height:ze(r)},children:t.jsx(pi.default,{})})},`link_preview_${n}_${r}`)}function Fe({property:e,size:o}){e||console.error("No property assigned for skeleton component",e,o);let r;if(e.dataType==="string"){const i=e;i.config?.url?r=Yl(i,o):i.config?.storageMeta?r=Nt(o):r=$e()}else if(e.dataType==="array"){const i=e;i.of&&(i.of.dataType==="map"&&i.of.properties?r=Vl(i.of.properties,o,i.of.previewProperties):i.of.dataType==="string"?i.of.config?.enumValues?r=Wl():i.of.config?.storageMeta?r=Ho(i.of):r=Ul():r=Ho(i.of))}else e.dataType==="map"?r=zl(e,o):e.dataType==="timestamp"?r=$e():e.dataType==="reference"?r=Gl():(e.dataType,r=$e());return r||null}function zl(e,o){if(!e.properties)return t.jsx(t.Fragment,{});let r;return o?e.previewProperties?r=e.previewProperties:r=Object.keys(e.properties).slice(0,3):r=Object.keys(e.properties),o?t.jsx(a.List,{children:r&&r.map(i=>t.jsx(a.ListItem,{children:t.jsx(Fe,{property:e.properties[i],size:"small"})},e.title+i))}):t.jsx(a.Table,{size:"small",children:t.jsx(a.TableBody,{children:r&&r.map((i,n)=>t.jsxs(a.TableRow,{sx:{"&:last-child th, &:last-child td":{borderBottom:0}},children:[t.jsx(a.TableCell,{component:"th",children:t.jsx(a.Skeleton,{variant:"text"})},`table-cell-title-${i}`),t.jsx(a.TableCell,{component:"th",children:t.jsx(Fe,{property:e.properties[i],size:"small"})},`table-cell-${i}`)]},`table_${e.title}_${n}`))})})}function Vl(e,o,r){let i=r;return(!i||!i.length)&&(i=Object.keys(e),o&&(i=i.slice(0,3))),t.jsx(a.Table,{size:"small",children:t.jsx(a.TableBody,{children:[0,1,2].map((n,l)=>t.jsx(a.TableRow,{children:i&&i.map(s=>t.jsx(a.TableCell,{component:"th",children:t.jsx(Fe,{property:e[s],size:"small"})},`table-cell-${s}`))},`table_${n}_${l}`))})})}function Ul(){return t.jsx(a.Grid,{children:[0,1].map((e,o)=>$e(o))})}function Wl(){return t.jsx(a.Grid,{children:[0,1].map((e,o)=>t.jsx(t.Fragment,{children:$e(o)}))})}function Ho(e){return t.jsx(a.Grid,{children:[0,1].map((o,r)=>t.jsx(t.Fragment,{children:t.jsx(Fe,{property:e,size:"small"})}))})}function Hl(){return t.jsx(a.Skeleton,{variant:"rectangular",width:300,height:100})}function Nt(e){const o=e==="tiny"?40:e==="small"?100:200;return t.jsx(a.Skeleton,{variant:"rectangular",width:o,height:o})}function jl(e){return t.jsx(a.Skeleton,{variant:"rectangular",width:e!=="regular"?300:500,height:e!=="regular"?200:250})}function Gl(){return t.jsx(a.Skeleton,{variant:"rectangular",width:200,height:100})}function Yl(e,o="regular"){if(typeof e.config?.url=="boolean"&&e.config.url)return t.jsxs("div",{style:{display:"flex"},children:[jo(),$e()]});const r=e.config?.url||e.config?.storageMeta?.mediaType;return r==="image"?Nt(o):r==="audio"?Hl():r==="video"?jl(o):Xl(o)}function Xl(e){return t.jsx(a.Box,{sx:{width:ze(e),height:ze(e)},children:jo()})}function $e(e){return t.jsx(a.Skeleton,{variant:"text"},`skeleton_${e}`)}function jo(){return t.jsx(a.Skeleton,{variant:"rectangular",width:24,height:24})}const Go=N.default.memo(Kl,Jl);function Jl(e,o){return e.name===o.name&&e.size===o.size&&e.height===o.height&&e.width===o.width&&e.value===o.value}const qt={};function Kl({name:e,value:o,property:r,size:i}){const n=Ve(),l=o,[s,u]=N.default.useState(qt[l]);return p.useEffect(()=>{if(!l)return;let c=!1;return r.config?.storageMeta?.storeUrl?(u(l),qt[l]=l):l&&n.getDownloadURL(l).then(function(d){c||(u(d),qt[l]=d)}),()=>{c=!0}},[r.config?.storageMeta?.storeUrl,l]),l?s?t.jsx(Mt,{name:e,value:s,property:r,size:i}):Nt(i):null}const Zl=X.default(e=>J.default({arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItem:{margin:e.spacing(.5)}}));function Yo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array"||!r.of||r.of.dataType!=="string")throw Error("Picked wrong preview component ArrayOfStorageComponentsPreview");const n=i==="regular"?"small":"tiny",l=Zl();return t.jsx("div",{className:l.arrayWrap,children:o&&o.map((s,u)=>t.jsx("div",{className:l.arrayItem,children:t.jsx(re,{children:t.jsx(de,{name:e,value:s,property:r.of,size:n})})},`preview_array_storage_${e}_${u}`))})}const We=ne.memo(Rl,Ql);function Ql(e,o){return e.name===o.name&&e.size===o.size&&e.height===o.height&&e.width===o.width&&e.onHover===o.onHover&&e.value?.id===o.value?.id&&e.value?.path===o.value?.path}function Rl({value:e,property:o,onClick:r,size:i,onHover:n}){if(typeof o.path!="string")throw Error("Picked the wrong component ReferencePreviewComponent");const l=e,s=o.previewProperties,u=Se(),c=Pe(),d=u.getCollectionResolver(o.path);if(!d)throw Error(`Couldn't find the corresponding collection view for the path: ${o.path}`);const g=d.schema,{entity:h,dataLoading:f,dataLoadingError:b}=it({path:l.path,entityId:l.id,schema:d.schemaResolver,useCache:!0}),y=p.useMemo(()=>{let w=s;return(!w||!w.length)&&(w=Object.keys(g.properties)),i==="small"||i==="regular"?w=w.slice(0,3):i==="tiny"&&(w=w.slice(0,1)),w},[s,g.properties,i]);let v;function C(w,m){return t.jsx(me,{error:w,tooltip:m})}return e?e instanceof ke?h&&!h.values?v=C("Reference does not exist",l.path):v=t.jsxs(t.Fragment,{children:[t.jsxs(a.Box,{sx:{display:"flex",flexDirection:"column",flexGrow:1,maxWidth:"calc(100% - 60px)",margin:1},children:[i!=="tiny"&&(e?t.jsx(a.Box,{sx:{display:i!=="regular"?"block":void 0,whiteSpace:i!=="regular"?"nowrap":void 0,overflow:i!=="regular"?"hidden":void 0,textOverflow:i!=="regular"?"ellipsis":void 0},children:t.jsx(a.Typography,{variant:"caption",className:"mono",children:e.id})}):t.jsx(a.Skeleton,{variant:"text"})),y&&y.map(w=>{const m=g.properties[w];return m?t.jsx("div",{children:h?t.jsx(de,{name:w,value:h.values[w],property:m,size:"tiny"}):t.jsx(Fe,{property:m,size:"tiny"})},"ref_prev_"+w):null})]}),t.jsx(a.Box,{sx:{margin:"auto"},children:h&&t.jsx(a.Tooltip,{title:`See details for ${h.id}`,children:t.jsx(a.IconButton,{size:i==="tiny"?"small":"medium",onClick:w=>{w.stopPropagation(),c.open({entityId:h.id,path:h.path,schema:g,overrideSchemaRegistry:!1})},children:t.jsx(ho.default,{fontSize:"small"})})})})]}):v=C("Unexpected value",JSON.stringify(e)):v=C("Reference not set"),t.jsx(a.Paper,{elevation:0,sx:w=>{const m=r?{tabindex:0,backgroundColor:n?w.palette.mode==="dark"?a.lighten(w.palette.background.default,.1):a.darken(w.palette.background.default,.15):a.darken(w.palette.background.default,.1),transition:"background-color 300ms ease, box-shadow 300ms ease",boxShadow:n?"0 0 0 2px rgba(128,128,128,0.05)":void 0,cursor:n?"pointer":void 0}:{};return{width:"100%",display:"flex",color:"#838383",backgroundColor:a.darken(w.palette.background.default,.1),borderRadius:"2px",overflow:"hidden",padding:i==="regular"?1:0,itemsAlign:i==="tiny"?"center":void 0,fontWeight:w.typography.fontWeightMedium,...m}},onClick:r,children:v})}const ea=X.default(e=>J.default({arrayItem:{margin:e.spacing(.5)}}));function Xo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array"||!r.of||r.of.dataType!=="reference")throw Error("Picked wrong preview component ArrayOfReferencesPreview");const n=ea(),l=i==="regular"?"small":"tiny";return t.jsx(t.Fragment,{children:o&&o.map((s,u)=>t.jsx("div",{className:n.arrayItem,children:t.jsx(We,{name:`${e}[${u}]`,size:l,value:s,property:r.of})},`preview_array_ref_${e}_${u}`))})}const ta=X.default(()=>J.default({tableNoBottomBorder:{"&:last-child th, &:last-child td":{borderBottom:0}},verticalAlignTop:{verticalAlign:"top"}}));function Jo({name:e,value:o,property:r,size:i}){const n=ta();if(r.dataType!=="map")throw Error("Picked wrong preview component MapPreview");const l=r;if(!l.properties)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);if(!o)return null;let s;return i==="regular"?s=Object.keys(l.properties):(s=l.previewProperties||Object.keys(l.properties),i==="small"?s=s.slice(0,3):i==="tiny"&&(s=s.slice(0,1))),i!=="regular"?t.jsx(t.Fragment,{children:s.map((u,c)=>t.jsx("div",{children:t.jsx(re,{children:t.jsx(de,{name:u,value:o[u],property:l.properties[u],size:i})})},"map_preview_"+l.title+u+c))}):t.jsx(a.Table,{size:"small",children:t.jsx(a.TableBody,{children:s&&s.map((u,c)=>t.jsxs(a.TableRow,{className:n.tableNoBottomBorder,children:[t.jsx(a.TableCell,{className:n.verticalAlignTop,width:"30%",component:"th",children:t.jsx(a.Typography,{variant:"caption",color:"textSecondary",children:l.properties[u].title})},`table-cell-title-${e}-${u}`),t.jsx(a.TableCell,{width:"70%",className:n.verticalAlignTop,component:"th",children:t.jsx(re,{children:t.jsx(de,{name:u,value:o[u],property:l.properties[u],size:"small"})})},`table-cell-${e}-${u}`)]},`map_preview_table_${e}_${c}`))})},`map_preview_${e}`)}const oa=X.default(e=>J.default({array:{display:"flex",flexDirection:"column"},arrayItemBig:{margin:e.spacing(1)}}));function Ko({name:e,value:o,property:r,size:i}){if(!r.of)throw Error(`You need to specify an 'of' prop (or specify a custom field) in your array property ${e}`);const n=oa();if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayPreview");const l=o;if(!l)return null;const s=i==="regular"?"small":"tiny";return t.jsx("div",{className:n.array,children:l&&l.map((u,c)=>t.jsxs(N.default.Fragment,{children:[t.jsx("div",{className:n.arrayItemBig,children:t.jsx(re,{children:t.jsx(de,{name:e,value:u,property:r.of,size:s})})}),c<l.length-1&&t.jsx(a.Divider,{})]},"preview_array_"+u+"_"+c))})}const ra=X.default(e=>J.default({array:{display:"flex",flexDirection:"column"},arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItemBig:{margin:e.spacing(1)}}));function Zo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayPreview");if(!r.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${e}`);const n=ra(),l=o;if(!l)return null;const s=i==="regular"?"small":"tiny",u=r.oneOf.typeField??"type",c=r.oneOf.valueField??"value",d=r.oneOf.properties;return t.jsx("div",{className:n.array,children:l&&l.map((g,h)=>t.jsxs(N.default.Fragment,{children:[t.jsx("div",{className:n.arrayItemBig,children:t.jsx(re,{children:g&&t.jsx(de,{name:e,value:g[c],property:d[g[u]],size:s})})}),h<l.length-1&&t.jsx(a.Divider,{})]},"preview_array_"+g+"_"+h))})}function de(e){let o;const{property:r,name:i,value:n,size:l,height:s,width:u}=e,c={...e};if(n===void 0)o=t.jsx(qe,{});else if(r.config?.Preview)o=p.createElement(r.config.Preview,{name:i,value:n,property:r,size:l,height:s,width:u,customProps:r.config.customProps});else if(n===null)o=t.jsx(qe,{});else if(r.dataType==="string"){const d=r;typeof n=="string"?d.config?.url?o=t.jsx(Mt,{...c,property:r,value:n}):d.config?.storageMeta?o=t.jsx(Go,{...c,property:r,value:n}):d.config?.markdown?o=t.jsx(nt,{source:n}):o=t.jsx(Ft,{...c,property:r,value:n}):o=De(i,r.dataType,n)}else if(r.dataType==="array")if(n instanceof Array){const d=r;if(!d.of&&!d.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${i}`);d.of?d.of.dataType==="map"?o=t.jsx(No,{name:i,property:r,value:n,size:l}):d.of.dataType==="reference"?typeof d.of.path=="string"?o=t.jsx(Xo,{...c,value:n,property:r}):o=t.jsx(qe,{}):d.of.dataType==="string"?d.of.config?.enumValues?o=t.jsx(At,{...c,value:n,property:r}):d.of.config?.storageMeta?o=t.jsx(Yo,{...c,value:n,property:r}):o=t.jsx(Do,{...c,value:n,property:r}):d.of.dataType==="number"?d.of.config?.enumValues&&(o=t.jsx(At,{...c,value:n,property:r})):o=t.jsx(Ko,{...c,value:n,property:r}):d.oneOf&&(o=t.jsx(Zo,{...c,value:n,property:r}))}else o=De(i,r.dataType,n);else r.dataType==="map"?typeof n=="object"?o=t.jsx(Jo,{...c,property:r}):o=De(i,r.dataType,n):r.dataType==="timestamp"?n instanceof Date?o=t.jsx(Wo,{...c,value:n,property:r}):o=De(i,r.dataType,n):r.dataType==="reference"?typeof r.path=="string"?n instanceof ke?o=t.jsx(We,{...c,value:n,property:r}):o=De(i,r.dataType,n):o=t.jsx(qe,{}):r.dataType==="boolean"?typeof n=="boolean"?o=t.jsx(Lo,{...c,value:n,property:r}):o=De(i,r.dataType,n):r.dataType==="number"?typeof n=="number"?o=t.jsx(qo,{...c,value:n,property:r}):o=De(i,r.dataType,n):o=JSON.stringify(n);return o??t.jsx(qe,{})}function De(e,o,r){return console.error(`Unexpected value for property ${e}, of type ${o}`,r),t.jsx(me,{error:`Unexpected value: ${JSON.stringify(r)}`})}function na(e="inherit",o="inherit"){return t.jsx(Ki.default,{color:e,fontSize:o})}function lt(e,o="inherit",r="inherit"){return e.dataType==="string"?e.config?.multiline||e.config?.markdown?t.jsx(Ni.default,{color:o,fontSize:r}):e.config?.storageMeta?e.config.storageMeta.mediaType==="image"?t.jsx(Yi.default,{color:o,fontSize:r}):t.jsx(qi.default,{color:o,fontSize:r}):e.config?.url?t.jsx(Xi.default,{color:o,fontSize:r}):e.config?.enumValues?t.jsx(Vi.default,{color:o,fontSize:r}):t.jsx(Mi.default,{color:o,fontSize:r}):e.dataType==="number"?t.jsx(Gi.default,{color:o,fontSize:r}):e.dataType==="geopoint"?t.jsx(Wi.default,{color:o,fontSize:r}):e.dataType==="map"?e.properties?t.jsx(Hi.default,{color:o,fontSize:r}):t.jsx(wo.default,{color:o,fontSize:r}):e.dataType==="array"?e.of?lt(e.of,o,r):t.jsx(wo.default,{color:o,fontSize:r}):e.dataType==="boolean"?t.jsx(Ji.default,{color:o,fontSize:r}):e.dataType==="timestamp"?t.jsx(Ui.default,{color:o,fontSize:r}):e.dataType==="reference"?t.jsx(ji.default,{color:o,fontSize:r}):t.jsx(zi.default,{color:o,fontSize:r})}const Qo=X.default(e=>J.default({property:{display:"flex"},valuePreview:{height:"72px",padding:e.spacing(2,3)},iconCell:{paddingTop:e.spacing(1)},titleCell:{width:"25%",padding:e.spacing(1)}}));function at({entity:e,schema:o,path:r}){const i=Qo(),n=ce(),l=o.properties;return t.jsx(a.TableContainer,{children:t.jsx(a.Table,{"aria-label":"entity table",children:t.jsxs(a.TableBody,{children:[t.jsxs(a.TableRow,{children:[t.jsx(a.TableCell,{align:"right",component:"td",scope:"row",className:i.titleCell,children:t.jsx(a.Typography,{variant:"caption",color:"textSecondary",children:"Id"})}),t.jsx(a.TableCell,{padding:"none",className:i.iconCell,children:na("disabled","small")}),t.jsx(a.TableCell,{className:i.valuePreview,children:t.jsxs(a.Box,{display:"flex",alignItems:"center",children:[e.id,n?.entityLinkBuilder&&t.jsx("a",{href:n.entityLinkBuilder({entity:e}),rel:"noopener noreferrer",target:"_blank",children:t.jsx(a.IconButton,{"aria-label":"go-to-entity-datasource",size:"large",children:t.jsx(tt.default,{fontSize:"small"})})})]})})]}),o&&Object.entries(l).map(([s,u])=>{const c=e.values[s];return t.jsxs(a.TableRow,{children:[t.jsx(a.TableCell,{align:"right",component:"td",scope:"row",className:i.titleCell,children:t.jsx(a.Typography,{style:{paddingLeft:"16px"},variant:"caption",color:"textSecondary",children:u.title})}),t.jsx(a.TableCell,{padding:"none",className:i.iconCell,children:lt(u,"disabled","small")}),t.jsx(a.TableCell,{className:i.valuePreview,children:t.jsx(re,{children:t.jsx(de,{name:s,value:c,property:u,size:"regular"})})})]},"entity_prev"+u.title+s)})]})})})}var ia=Object.freeze(Object.defineProperty({__proto__:null,useStyles:Qo,EntityPreview:at,default:at},Symbol.toStringTag,{value:"Module"}));function la(e){return e.dataType==="boolean"?"center":e.dataType==="number"?e.config?.enumValues?"left":"right":e.dataType==="timestamp"?"right":"left"}function Ro(e){if(e.columnWidth)return e.columnWidth;if(e.dataType==="string")return e.config?.url?e.config?.url==="video"||e.config?.storageMeta?.mediaType==="video"?340:e.config?.url==="audio"||e.config?.storageMeta?.mediaType==="audio"?300:240:e.config?.storageMeta?220:e.config?.enumValues?200:e.config?.multiline||e.config?.markdown?300:(e.validation?.email,200);if(e.dataType==="array"){const o=e;return o.of?Ro(o.of):300}else return e.dataType==="number"?e.config?.enumValues?200:140:e.dataType==="map"?360:e.dataType==="timestamp"?160:e.dataType==="reference"?220:e.dataType==="boolean"?140:200}function er(e){return`subcollection:${e.path}`}function aa(e,o,r){return p.useMemo(()=>{const i=e.properties,n=e.excludedProperties,l=e.additionalColumns??[],s=e.subcollections??[],u=o.properties,c=Object.entries(u).filter(([h,f])=>f.disabled&&typeof f.disabled=="object"&&f.disabled.hidden).map(([h,f])=>h),d=[...Object.keys(e.schema.properties),...l.map(h=>h.id)];let g;if(i?g=i.map(h=>d.find(f=>f===h)).filter(h=>!!h):n?g=d.filter(h=>!n.includes(h)):g=d.filter(h=>!c.includes(h)),r){const h=s.map(f=>er(f)).filter(f=>n?!n?.includes(f):!0);g.push(...h.filter(f=>!g.includes(f)))}return g},[e.properties,e.excludedProperties,e.additionalColumns,e.subcollections,e.schema.properties,o.properties,r])}const sa=X.default(e=>J.default({search:{position:"relative",display:"flex",alignItems:"center",height:40,borderRadius:e.shape.borderRadius,backgroundColor:e.palette.mode==="light"?et.alpha(e.palette.common.black,.05):et.darken(e.palette.background.default,.2),"&:hover":{backgroundColor:e.palette.mode==="light"?et.alpha(e.palette.common.black,.1):et.darken(e.palette.background.default,.3)},marginLeft:e.spacing(1),[e.breakpoints.up("sm")]:{marginLeft:e.spacing(1),width:"auto"}},searchIcon:{padding:e.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",minHeight:"inherit"},inputInput:{padding:e.spacing(1,1,1,0),paddingLeft:`calc(1em + ${e.spacing(4)})`,transition:e.transitions.create("width"),width:"100%",[e.breakpoints.up("sm")]:{width:"12ch"}},inputActive:{[e.breakpoints.up("sm")]:{width:"20ch"}}}));function ca({onTextSearch:e}){const o=sa(),[r,i]=p.useState(""),[n,l]=p.useState(!1);p.useEffect(()=>{const u=setTimeout(()=>{e(r||void 0)},250);return()=>{clearTimeout(u)}},[r]);const s=p.useCallback(()=>{i(""),e(void 0)},[]);return t.jsx(a.FormControl,{children:t.jsxs("div",{className:o.search,children:[t.jsx("div",{className:o.searchIcon,children:t.jsx(di.default,{htmlColor:"#666"})}),t.jsx(ci.default,{placeholder:"Search",value:r,onChange:u=>{i(u.target.value)},onFocus:()=>l(!0),onBlur:()=>l(!1),classes:{root:o.inputRoot,input:fe.default(o.inputInput,{[o.inputActive]:n})},endAdornment:r?t.jsx(a.IconButton,{size:"small",onClick:s,children:t.jsx(Ie.default,{fontSize:"small"})}):t.jsx("div",{style:{width:26}}),inputProps:{"aria-label":"search"}})]})})}const da=X.default(e=>J.default({toolbar:{minHeight:56,[e.breakpoints.down("xl")]:{paddingLeft:e.spacing(.5),paddingRight:e.spacing(.5)},paddingLeft:e.spacing(1),paddingRight:e.spacing(1),backgroundColor:e.palette.mode==="light"?e.palette.common.white:e.palette.background.default,borderBottom:`1px solid ${e.palette.divider}`,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%"},actions:{display:"flex",alignItems:"center","& > *":{[e.breakpoints.down("md")]:{marginRight:e.spacing(.5)},marginRight:e.spacing(1)}},selectRoot:{"label + &":{marginTop:e.spacing(3)}},input:{borderRadius:4,position:"relative",backgroundColor:e.palette.mode==="light"?a.alpha(e.palette.common.black,.05):a.darken(e.palette.background.default,.2),fontSize:14,fontWeight:e.typography.fontWeightMedium,padding:"10px 26px 10px 12px",transition:e.transitions.create(["border-color","box-shadow"]),"&:focus":{borderRadius:4}},item:{backgroundColor:e.palette.background.default,fontSize:14,fontWeight:e.typography.fontWeightMedium,paddingTop:e.spacing(1),paddingBottom:e.spacing(1),"&:hover":{backgroundColor:a.darken(e.palette.background.default,.1)},"&:focus":{backgroundColor:a.darken(e.palette.background.default,.2),"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:e.palette.text.primary}}}}));function ua(e){const o=da(),r=a.useTheme(),i=a.useMediaQuery(r.breakpoints.up("md")),n=e.filterIsSet&&t.jsx(a.Box,{display:"flex",alignItems:"center",children:t.jsx(a.Tooltip,{title:"Clear filter",children:t.jsx(a.IconButton,{style:{height:"fit-content"},"aria-label":"filter clear",onClick:e.clearFilter,size:"large",children:t.jsx(Ie.default,{})})})}),l=t.jsx(a.Select,{variant:"standard",value:e.size,style:{width:56},onChange:s=>{e.onSizeChanged(s.target.value)},MenuProps:{MenuListProps:{disablePadding:!0,style:{borderRadius:4}},elevation:1},input:t.jsx(a.InputBase,{classes:{root:o.selectRoot,input:o.input}}),renderValue:s=>s.toUpperCase(),children:["xs","s","m","l","xl"].map(s=>t.jsx(a.MenuItem,{classes:{root:o.item},value:s,children:s.toUpperCase()},`size-select-${s}`))});return t.jsxs("div",{className:o.toolbar,children:[t.jsxs(a.Box,{display:"flex",alignItems:"center",children:[e.title&&t.jsx(a.Hidden,{lgDown:!0,children:t.jsx(a.Box,{mr:2,children:e.title})}),l,n]}),t.jsxs("div",{className:o.actions,children:[i&&t.jsx(a.Box,{width:22,children:e.loading&&t.jsx(a.CircularProgress,{size:16,thickness:8})}),e.onTextSearch&&t.jsx(ca,{onTextSearch:e.onTextSearch},"search-bar"),e.actions]})]})}const fa=X.default(e=>J.default({tableContainer:{width:"100%",height:"100%",flexGrow:1},headerTypography:{fontSize:"0.750rem",fontWeight:600,textTransform:"uppercase"},header:{width:"calc(100% + 24px)",margin:"0px -12px",padding:"0px 12px",color:e.palette.text.secondary,backgroundColor:e.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600},tableRow:{cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.875rem"},tableRowClickable:{"&:hover":{backgroundColor:e.palette.mode==="dark"?a.alpha(e.palette.background.default,.6):a.alpha(e.palette.background.default,.5)}},column:{padding:"0px !important"},cellButtonsWrap:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",backgroundColor:(e.palette.mode==="dark",a.alpha(e.palette.background.default,.8))},cellButtons:{minWidth:138},cellButtonsId:{width:138,textAlign:"center",textOverflow:"ellipsis",overflow:"hidden"},selectContainer:{display:"flex",justifyContent:"space-around"},verticalLine:{width:"1px",backgroundColor:"#dfdfdf",height:"55px"}}));function zt({entity:e,isSelected:o,isAllSelected:r,selectionEnabled:i,size:n,toggleEntitySelection:l,selectAll:s,onCopyClicked:u,onEditClicked:c,onDeleteClicked:d,data:g}){const h=Boolean(c),f=Boolean(d),b=fa(),[y,v]=N.default.useState(null);p.useCallback(m=>{v(m.currentTarget),m.stopPropagation()},[v]),p.useCallback(()=>{v(null)},[v]);const C=m=>{l&&l(e),m.stopPropagation()},w=m=>{s&&s(e),m.stopPropagation()};return p.useCallback(m=>{m.stopPropagation(),d&&d(e),v(null)},[e,d,v]),p.useCallback(m=>{m.stopPropagation(),u&&u(e),v(null)},[e,u,v]),t.jsxs("div",{className:b.cellButtonsWrap,children:[(h||f||i)&&t.jsxs("div",{className:b.cellButtons,children:["(",t.jsxs("div",{className:b.selectContainer,children:[h&&t.jsx(a.Tooltip,{title:`Edit ${e.id}`,children:t.jsx(a.IconButton,{onClick:m=>{m.stopPropagation(),c&&c(e)},size:"large",children:t.jsx(Oe.KeyboardTab,{})})}),t.jsx("span",{className:b.verticalLine}),i&&t.jsxs("div",{children:[t.jsx(a.Tooltip,{title:`Select 1asd ${e.id}`,children:t.jsx(a.Checkbox,{checked:o,onChange:C})}),t.jsx(a.Tooltip,{title:"Select All",className:"select-all",children:t.jsx(a.Checkbox,{checked:r,onChange:w})})]})]}),")"]}),n!=="xs"&&t.jsx("div",{className:b.cellButtonsId,children:e?t.jsxs(a.Typography,{className:"mono",variant:"caption",color:"textSecondary",children:[" ",e.id," "]}):t.jsx(a.Skeleton,{variant:"text"})})]})}function Vt(e){switch(e){case"xl":return 400;case"l":return 280;case"m":return 140;case"s":return 80;case"xs":return 54;default:throw Error("Missing mapping for collection size -> height")}}const ha=X.default(e=>J.default({tableCell:{position:"relative",height:"100%",width:"100%",border:"2px solid transparent",borderRadius:4,overflow:"hidden",contain:"strict",display:"flex",padding:({size:o,removePadding:r})=>{if(r)return 0;switch(o){case"l":case"xl":return e.spacing(2);case"m":return e.spacing(1);case"s":return e.spacing(.5);default:return e.spacing(.25)}},"&:hover":{backgroundColor:({disabled:o})=>o?void 0:e.palette.mode==="dark"?e.palette.background.paper:e.palette.background.default},justifyContent:({align:o})=>{switch(o){case"right":return"flex-end";case"center":return"center";case"left":default:return"flex-start"}}},fullWidth:{width:"100%"},fullHeight:{height:"100%"},error:{border:`2px solid ${e.palette.error.light} !important`},selected:{backgroundColor:e.palette.mode==="dark"?e.palette.background.paper:e.palette.background.default,border:"2px solid #5E9ED6",transition:"border-color 300ms ease-in-out"},saved:{border:`2px solid ${e.palette.success.light}`},disabled:{alpha:.8},iconsTop:{position:"absolute",top:2,right:2},arrow:{color:e.palette.error.light},tooltip:{margin:"0 8px",backgroundColor:e.palette.error.light},centered:{alignItems:"center"},faded:{"-webkit-mask-image":"linear-gradient(to bottom, black 60%, transparent 100%)",maskImage:"linear-gradient(to bottom, black 60%, transparent 100%)",alignItems:"start"},scrollable:{overflow:"auto",alignItems:"start"}})),ga=({children:e,selected:o,focused:r,disabled:i,disabledTooltip:n,size:l,saved:s,error:u,align:c,allowScroll:d,openPopup:g,removePadding:h,fullHeight:f,select:b,showExpandIcon:y=!0})=>{const v=N.default.createRef(),[C,w]=p.useState(!1),m=p.useMemo(()=>Vt(l),[l]),[S,_]=p.useState(!1),[k,B]=p.useState(s),P=N.default.createRef();p.useEffect(()=>{P.current&&r&&P.current.focus({preventScroll:!0})},[r]),p.useEffect(()=>{k!==s&&B(!0);const L=setTimeout(()=>{B(!1)},500);return()=>{clearTimeout(L)}},[s]);const M=p.useCallback(()=>{if(g){const E=v&&v?.current?.getBoundingClientRect();g(E)}},[v]),q=p.useCallback(E=>{E.detail===3&&M()},[M]),O=p.useCallback(()=>{if(!b)return;const E=v&&v?.current?.getBoundingClientRect();i?b(void 0):!o&&E&&b(E)},[v,b,o,i]),T=p.useCallback(E=>{O(),E.stopPropagation()},[O]),I=p.useCallback(E=>{if(E?.bounds){const L=E.bounds.height>m;C!==L&&w(L)}},[C,m]),A=ha({size:l,align:c,disabled:i,removePadding:h}),$=t.jsx(go.default,{bounds:!0,onResize:I,children:({measureRef:E})=>t.jsx("div",{ref:E,className:fe.default(A.fullWidth,{[A.fullHeight]:f}),children:e})});return t.jsxs("div",{tabIndex:o||i?void 0:0,ref:v,onFocus:T,onClick:q,onMouseEnter:()=>_(!0),onMouseMove:()=>_(!0),onMouseLeave:()=>_(!1),className:fe.default(A.tableCell,{[A.disabled]:i,[A.centered]:i||!C,[A.error]:u,[A.saved]:o&&k,[A.selected]:!u&&(o||r),[A.fullHeight]:f}),children:[t.jsx("div",{className:fe.default(A.fullWidth,{[A.faded]:!i&&!d&&C,[A.scrollable]:!i&&d&&C,[A.fullHeight]:f}),children:$}),i&&S&&n&&t.jsx("div",{style:{position:"absolute",top:4,right:4,fontSize:"14px"},children:t.jsx(a.Tooltip,{title:n,children:t.jsx(Oi.default,{color:"disabled",fontSize:"inherit"})})}),(u||y)&&t.jsxs("div",{className:A.iconsTop,children:[o&&!i&&y&&t.jsx(a.IconButton,{ref:P,color:"inherit",size:"small",onClick:M,children:t.jsxs("svg",{className:"MuiSvgIcon-root MuiSvgIcon-fontSizeSmall",fill:"#666",width:"20",height:"20",viewBox:"0 0 24 24",children:[t.jsx("path",{className:"cls-2",d:"M20,5a1,1,0,0,0-1-1L14,4h0a1,1,0,0,0,0,2h2.57L13.29,9.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L18,7.42V10a1,1,0,0,0,1,1h0a1,1,0,0,0,1-1Z"}),t.jsx("path",{className:"cls-2",d:"M10.71,13.29a1,1,0,0,0-1.42,0L6,16.57V14a1,1,0,0,0-1-1H5a1,1,0,0,0-1,1l0,5a1,1,0,0,0,1,1h5a1,1,0,0,0,0-2H7.42l3.29-3.29A1,1,0,0,0,10.71,13.29Z"})]})}),u&&t.jsx(a.Tooltip,{classes:{arrow:A.arrow,tooltip:A.tooltip},arrow:!0,placement:"left",title:u.message,children:t.jsx(Ai.default,{fontSize:"inherit",color:"error"})})]})]})},Ut=N.default.memo(ga,pa);function pa(e,o){return e.selected===o.selected&&e.focused===o.selected&&e.disabled===o.disabled&&e.size===o.size&&e.align===o.align&&e.saved===o.saved&&e.showExpandIcon===o.showExpandIcon&&e.removePadding===o.removePadding&&e.fullHeight===o.fullHeight&&Te.default(e.value,o.value)}Ce.addMethod(Ce.array,"uniqueInArray",function(e=r=>r,o){return this.test("uniqueInArray",o,r=>!r||r.length===new Set(r.map(e)).size)});function tr(e,o){const r={};return Object.entries(e).forEach(([i,n])=>{r[i]=st({property:n,customFieldValidator:o,name:i})}),Ce.object().shape(r)}function st(e){const o=e.property;if(typeof o=="function")throw console.log("Error in property",e),Error("PropertyBuilders can only be defined as the root properties in entity schemas, not in child properties");if(o.dataType==="string")return va(e);if(o.dataType==="number")return ya(e);if(o.dataType==="boolean")return xa(e);if(o.dataType==="map")return ba(e);if(o.dataType==="array")return Ta(e);if(o.dataType==="timestamp")return Ca(e);if(o.dataType==="geopoint")return wa(e);if(o.dataType==="reference")return ma(e);throw console.error("Unsupported data type in yup mapping",o),Error("Unsupported data type in yup mapping")}function ba({property:e,parentProperty:o,customFieldValidator:r,name:i}){const n={};return e.properties&&Object.entries(e.properties).forEach(([l,s])=>{n[l]=st({property:s,parentProperty:e,customFieldValidator:r,name:`${i}[${l}]`})}),Ce.object().shape(n)}function va({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.string();const l=e.validation;return e.config?.enumValues&&(l?.required&&(n=n.required(l?.requiredMessage?l.requiredMessage:"Required")),n=n.oneOf(Ne(e.config?.enumValues).map(([s,u])=>s))),l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),l.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",(s,u)=>r({name:i,property:e,parentProperty:o,value:s}))),(l.min||l.min===0)&&(n=n.min(l.min,`${e.title} must be min ${l.min} characters long`)),(l.max||l.max===0)&&(n=n.max(l.max,`${e.title} must be max ${l.max} characters long`)),l.matches&&(n=n.matches(l.matches,l.matchesMessage)),l.email&&(n=n.email(`${e.title} must be an email`)),l.url&&(n=n.url(`${e.title} must be a url`)),l.trim&&(n=n.trim()),l.lowercase&&(n=n.lowercase()),l.uppercase&&(n=n.uppercase())):n=n.notRequired().nullable(!0),n}function ya({property:e,parentProperty:o,customFieldValidator:r,name:i}){const n=e.validation;let l=Ce.number().typeError("Must be a number");return n?(l=n.required?l.required(n.requiredMessage?n.requiredMessage:"Required").nullable(!0):l.notRequired().nullable(!0),n.unique&&r&&i&&(l=l.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s}))),(n.min||n.min===0)&&(l=l.min(n.min,`${e.title} must be higher or equal to ${n.min}`)),(n.max||n.max===0)&&(l=l.max(n.max,`${e.title} must be lower or equal to ${n.max}`)),(n.lessThan||n.lessThan===0)&&(l=l.lessThan(n.lessThan,`${e.title} must be higher than ${n.lessThan}`)),(n.moreThan||n.moreThan===0)&&(l=l.moreThan(n.moreThan,`${e.title} must be lower than ${n.moreThan}`)),n.positive&&(l=l.positive(`${e.title} must be positive`)),n.negative&&(l=l.negative(`${e.title} must be negative`)),n.integer&&(l=l.integer(`${e.title} must be an integer`))):l=l.notRequired().nullable(!0),l}function wa({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.object();const l=e.validation;return l?.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s}))),l?.required?n=n.required(l.requiredMessage).nullable(!0):n=n.notRequired().nullable(!0),n}function Ca({property:e,parentProperty:o,customFieldValidator:r,name:i}){if(e.autoValue)return Ce.object().nullable(!0);let n=Ce.date();const l=e.validation;return l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),l.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s}))),l.min&&(n=n.min(l.min,`${e.title} must be after ${l.min}`)),l.max&&(n=n.max(l.max,`${e.title} must be before ${l.min}`))):n=n.notRequired().nullable(!0),n}function ma({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.object();const l=e.validation;return l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),l.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s})))):n=n.notRequired().nullable(!0),n}function xa({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.boolean();const l=e.validation;return l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),l.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s})))):n=n.notRequired().nullable(!0),n}function Sa(e){return e.validation?.uniqueInArray?!0:e.dataType==="map"&&e.properties?Object.entries(e.properties).filter(([o,r])=>r.validation?.uniqueInArray):!1}function Ta({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.array();if(e.of){n=n.of(st({property:e.of,parentProperty:e}));const s=Sa(e.of);s&&(typeof s=="boolean"?n=n.uniqueInArray(u=>u,`${e.title} should have unique values within the array`):Array.isArray(s)&&s.forEach(([u,c])=>{n=n.uniqueInArray(d=>d&&d[u],`${e.title} \u2192 ${c.title??u}: should have unique values within the array`)}))}const l=e.validation;return l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),(l.min||l.min===0)&&(n=n.min(l.min,`${e.title} should be min ${l.min} entries long`)),l.max&&(n=n.max(l.max,`${e.title} should be max ${l.max} entries long`))):n=n.notRequired().nullable(!0),n}const ka=X.default(e=>J.default({input:{padding:0,margin:0,width:"100%",color:"unset",fontWeight:"unset",lineHeight:"unset",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none"}}));function _a(e){const{disabled:o,value:r,multiline:i,updateValue:n,focused:l}=e,[s,u]=p.useState(r),c=p.useRef(!1);p.useEffect(()=>{const f=setTimeout(()=>{(!r||r.length===0)&&!s||s!==r&&n(s)},300);return()=>{clearTimeout(f)}},[s]),p.useEffect(()=>{!l&&r!==s&&u(r)},[r,l]);const d=ka(),g=N.default.createRef();return p.useEffect(()=>{g.current&&l&&!c.current?(c.current=!0,g.current.focus({preventScroll:!0}),g.current.selectionStart=g.current.value.length,g.current.selectionEnd=g.current.value.length):c.current=l},[l,g]),t.jsx("div",{style:{display:"flex"},children:t.jsx(a.TextareaAutosize,{ref:g,disabled:o,className:fe.default(d.input),value:s??"",onChange:h=>{const f=h.target.value;(i||!f.endsWith(`
`))&&u(f)}})})}const Ea=X.default(e=>J.default({select:{height:"100%"},selectRoot:{display:"flex",alignItems:"center",height:"100%"}}));function Wt(e){const{name:o,enumValues:r,error:i,internalValue:n,disabled:l,small:s,focused:u,updateValue:c,multiple:d,setPreventOutsideClick:g,valueType:h}=e,[f,b]=p.useState(!1),y=()=>{g(!0),b(!0)},v=()=>{g(!1),b(!1)},C=Ea(),w=Array.isArray(n)&&d||!Array.isArray(n)&&!d,m=N.default.createRef();return p.useEffect(()=>{m.current&&u&&m.current?.focus({preventScroll:!0})},[u,m]),t.jsx(a.Select,{variant:"standard",inputRef:m,className:C.select,classes:{select:C.selectRoot},open:f,disabled:l,multiple:d,onClose:v,onOpen:y,fullWidth:!0,inputProps:{style:{height:"100%"}},disableUnderline:!0,error:!!i,value:w?d?n.map(S=>S.toString()):n:d?[]:"",onChange:S=>{if(h==="number")if(d){const _=S.target.value.map(k=>parseFloat(k));c(_)}else c(parseFloat(S.target.value));else if(h==="string")S.target.value?c(S.target.value):c(null);else throw Error("Missing mapping in TableSelect")},renderValue:S=>d&&Array.isArray(S)?t.jsx(rt,{value:S,name:o,enumValues:r,size:s?"small":"regular"}):t.jsx(xe,{enumKey:S,enumValues:r,small:s}),children:Ne(r).map(([S,_])=>{const k=t.jsx(xe,{enumKey:S,enumValues:r,small:!0});return d?t.jsxs(a.MenuItem,{value:S,disabled:Ze(_),dense:!0,children:[t.jsx(a.Checkbox,{checked:Array.isArray(n)&&n.map(B=>B.toString()).includes(S.toString())}),t.jsx(a.ListItemText,{primary:k})]},`select-${o}-${S}`):t.jsx(a.MenuItem,{value:S,disabled:Ze(_),dense:!0,children:k},`select-${o}-${S}`)})},`table_select_${o}`)}const Ia=X.default(e=>J.default({input:{padding:0,margin:0,width:"100%",color:"unset",fontWeight:"unset",lineHeight:"unset",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none"},numberInput:{textAlign:"right"}}));function Ba(e){const{align:o,value:r,updateValue:i,focused:n,onBlur:l,disabled:s}=e,u=r&&typeof r=="number"?r.toString():"",[c,d]=p.useState(u);p.useEffect(()=>{const y=setTimeout(()=>{if(c!==u)if(c!=null){const v=parseFloat(c);if(isNaN(v))return;v!=null&&i(v)}else i(null)},300);return()=>{clearTimeout(y)}},[c]),p.useEffect(()=>{!n&&u!==c&&d(r!=null?r.toString():null)},[r,n]);const g=N.default.createRef(),h=Ia();p.useEffect(()=>{g.current&&n&&g.current.focus({preventScroll:!0})},[n,g]);const f=/^-?[0-9]+[,.]?[0-9]*$/;return t.jsx(a.Input,{inputRef:g,style:{width:"100%",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none",padding:0},inputProps:{style:{textAlign:o}},disabled:s,className:fe.default(h.input,h.numberInput),disableUnderline:!0,value:c??"",onBlur:l,onChange:b=>{const y=b.target.value.replace(",",".");y.length===0&&d(null),(f.test(y)||y.startsWith("-"))&&d(y)}})}function Pa(e){const{disabled:o,internalValue:r,updateValue:i,focused:n}=e,l=N.default.createRef();return p.useEffect(()=>{l.current&&n&&l.current.focus({preventScroll:!0})},[n,l]),t.jsx(a.Switch,{inputRef:l,color:"secondary",checked:Boolean(r),disabled:o,onChange:s=>{const u=s.target.checked;i(u)}})}X.default(e=>J.default({hidden:{display:"none"}}));function Fa(e){const{disabled:o,error:r,internalValue:i,setPreventOutsideClick:n,updateValue:l}=e,s=p.useCallback(()=>{n(!0)},[]),u=p.useCallback(()=>{n(!1)},[]);return t.jsx(a.Box,{display:"flex",alignItems:"center",width:"100%",children:t.jsx(Ct.default,{value:i??null,clearable:!0,disabled:o,onChange:c=>{l(c)},renderInput:c=>t.jsx(a.TextField,{...c,variant:"standard",error:Boolean(r),style:{height:"100%"},InputProps:{...c.InputProps,style:{fontSize:14},disableUnderline:!0}}),InputAdornmentProps:{style:{fontSize:"small",height:26}},onOpen:s,onClose:u})})}function or(e){const{name:o,internalValue:r,setPreventOutsideClick:i,property:n,updateValue:l,size:s,disabled:u}=e;let c,d;if(n.dataType==="reference")c=n,d=!1;else if(n.dataType==="array"&&n.of?.dataType==="reference")c=n.of,d=!0;else throw Error("TableReferenceField misconfiguration");if(typeof c.path!="string")throw Error("Picked the wrong component TableReferenceField");const g=c.path,[h,f]=p.useState(!1),[b,y]=p.useState(!1),C=Se().getCollectionResolver(g);if(!C)throw Error(`Couldn't find the corresponding collection view for the path: ${g}`);const w=p.useCallback(q=>{u||q.detail<=1&&(q.stopPropagation(),i(!0),y(!0))},[u,i]),m=p.useCallback(()=>{i(!1),y(!1)},[i,y]),S=p.useCallback(q=>{l(q?ot(q):null),i(!1),y(!1)},[l,i,y]),_=p.useCallback(q=>{l(q.map(O=>ot(O)))},[l]),k=r?Array.isArray(r)?r.map(q=>q.id):r.id?[r.id]:[]:[],B=!r||Array.isArray(r)&&r.length===0;function P(){return r instanceof ke?t.jsx(We,{name:o,onClick:u?void 0:w,value:r,property:c,onHover:h,size:Be(s)}):t.jsx(me,{error:"Data is not a reference"})}function M(){return Array.isArray(r)?t.jsx(t.Fragment,{children:r.map((q,O)=>t.jsx(a.Box,{sx:{m:.5},children:t.jsx(We,{name:`${o}[${O}]`,onClick:u?void 0:w,size:"tiny",onHover:h,value:q,property:c})},`preview_array_ref_${o}_${O}`))}):t.jsx(me,{error:"Data is not an array of references"})}return C?t.jsxs("div",{onMouseEnter:()=>f(!0),onMouseMove:()=>f(!0),onMouseLeave:()=>f(!1),children:[r&&!d&&P(),r&&d&&M(),B&&t.jsxs(a.Button,{onClick:w,size:"small",variant:"outlined",color:"primary",children:["Edit ",n.title]}),!u&&b&&t.jsx(dt,{open:b,multiselect:d,path:g,collectionResolver:C,onClose:m,onMultipleEntitiesSelected:_,onSingleEntitySelected:S,selectedEntityIds:k})]}):t.jsx(me,{error:"The specified collection does not exist"})}const Aa=X.default(e=>({dropZone:{position:"relative",height:"100%",outline:0,display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:({hasValue:o})=>o?"start":"center",alignItems:"center"},activeDrop:{borderRadius:"2px",border:"2px solid",borderColor:"transparent"},acceptDrop:{transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",background:"repeating-linear-gradient( 45deg, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.2) 10px, rgba(128, 128, 128, 0.25) 10px, rgba(128, 128, 128, 0.25) 20px) !important",borderColor:e.palette.success.light},rejectDrop:{borderColor:e.palette.error.light},arrayEntry:{border:"1px dashed transparent",borderRadius:"4px"},arrayEntryHovered:{opacity:.5,border:"1px dashed gray",boxSizing:"border-box"},thumbnailCloseIcon:{position:"absolute",borderRadius:"9999px",top:-8,right:-8,zIndex:100,backgroundColor:e.palette.background.paper}}));function Oa(e){const{name:o,error:r,internalValue:i,disabled:n,property:l,entityId:s,entityValues:u,previewSize:c,updateValue:d,setPreventOutsideClick:g}=e,h=l.dataType==="array",f=l.dataType==="string"?l.config?.storageMeta:l.dataType==="array"&&l.of.dataType==="string"?l.of.config?.storageMeta:void 0;if(!f)throw Error("Storage meta must be specified");const b=v=>{if(f.fileName){const C=f.fileName({entityId:s,values:u,property:l,file:v,storageMeta:f,name:o});if(!C||C.length===0)throw Error("You need to return a valid filename");return C}return v.name},y=v=>{if(typeof f.storagePath=="string")return f.storagePath;if(typeof f.storagePath=="function"){const C=f.storagePath({entityId:s,values:u,property:l,file:v,storageMeta:f,name:o});if(!C||C.length===0)throw Error("You need to return a valid filename");return C}return console.warn("When using a storage property, if you don't specify the storagePath, the root storage is used"),"/"};return t.jsx($a,{value:i,name:o,disabled:n,autoFocus:!1,property:l,onChange:v=>{d(v)},fileNameBuilder:b,storagePathBuilder:y,storageMeta:f,multipleFilesSupported:h,previewSize:c})}function $a({property:e,name:o,value:r,onChange:i,multipleFilesSupported:n,previewSize:l,disabled:s,autoFocus:u,storageMeta:c,fileNameBuilder:d,storagePathBuilder:g}){const h=Ve(),[f,b]=p.useState(!1),y=n&&l==="regular"?"small":l;if(n){const D=e;if(D.of){if(D.of.dataType!=="string")throw Error("Storage field using array must be of data type string")}else throw Error("Storage field using array must be of data type string")}const v=c?.metadata,C=Boolean(r),w=Aa({hasValue:C}),m=r==null?[]:(n?r:[r]).map(D=>({id:B(),storagePathOrDownloadUrl:D,metadata:v,size:y})),S=ne.useRef(r),[_,k]=ne.useState(m);Te.default(S.current,r)||(S.current=r,k(m??[]));function B(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}function P(D){return D.filter((Y,V)=>(D.map(K=>K.storagePathOrDownloadUrl).indexOf(Y.storagePathOrDownloadUrl)===V||!Y.storagePathOrDownloadUrl)&&(D.map(K=>K.file).indexOf(Y.file)===V||!Y.file))}const M=D=>{if(!D.length||s)return;let Y;n?Y=[..._,...D.map(V=>({id:B(),file:V,fileName:d(V),metadata:v}))]:Y=[{id:B(),file:D[0],fileName:d(D[0]),metadata:v}],Y=P(Y),k(Y)},q=async(D,Y,V)=>{let K=D;c.storeUrl&&(K=await h.getDownloadURL(D)),c.postProcess&&(K=await c.postProcess(K));let te;Y.storagePathOrDownloadUrl=K,Y.metadata=V,te=[..._],te=P(te),k(te);const j=te.filter(Z=>!!Z.storagePathOrDownloadUrl).map(Z=>Z.storagePathOrDownloadUrl);i(n?j:j?j[0]:null)},O=D=>{if(n){const Y=_.filter(V=>V.storagePathOrDownloadUrl!==D);i(Y.filter(V=>!!V.storagePathOrDownloadUrl).map(V=>V.storagePathOrDownloadUrl)),k(Y)}else i(null),k([])},{open:T,getRootProps:I,getInputProps:A,isDragActive:$,isDragAccept:E,isDragReject:L}=so.useDropzone({accept:c.acceptedFiles,disabled:s,noClick:!0,noKeyboard:!0,onDrop:M}),{...F}=I(),H=n?"Drag 'n' drop some files here, or click here to edit":"Drag 'n' drop a file here, or click here edit",W=n?e.of:e;return t.jsxs(a.Box,{...F,onMouseEnter:()=>b(!0),onMouseMove:()=>b(!0),onMouseLeave:()=>b(!1),className:fe.default(w.dropZone,{[w.activeDrop]:$,[w.rejectDrop]:L,[w.acceptDrop]:E}),children:[t.jsx("input",{autoFocus:u,...A()}),_.map((D,Y)=>{let V;return D.storagePathOrDownloadUrl?V=t.jsx(La,{property:W,disabled:s,value:D.storagePathOrDownloadUrl,onClear:O,size:y},`storage_preview_${Y}`):D.file&&(V=t.jsx(Da,{entry:D,metadata:v,storagePath:g(D.file),onFileUploadComplete:q,size:y},`storage_progress_${Y}`)),V}),!r&&t.jsx(a.Box,{sx:{flexGrow:1,m:2,maxWidth:200},onClick:T,children:t.jsx(a.Typography,{sx:{color:D=>D.palette.mode==="light"?"#999":"#444"},variant:"body2",align:"center",children:H})}),f&&t.jsx(a.IconButton,{color:"inherit",size:"small",onClick:T,sx:{position:"absolute",bottom:2,right:2},children:t.jsx($i.default,{sx:{width:16,height:16,fill:"#666"}})})]})}function Da({storagePath:e,entry:o,metadata:r,onFileUploadComplete:i,size:n}){const l=Ve(),s=Ue(),[u,c]=ne.useState(),[d,g]=ne.useState(!1),h=ne.useRef(!1),f=p.useCallback((y,v)=>{c(void 0),g(!0),l.uploadFile({file:y,fileName:v,path:e,metadata:r}).then(async({path:C})=>{console.debug("Upload successful"),await i(C,o,r),h.current&&g(!1)}).catch(C=>{console.error("Upload error",C),h.current&&(c(C.message),g(!1)),s.open({type:"error",title:"Error uploading file",message:C.message})})},[o,r,i,s,l,e]);p.useEffect(()=>(h.current=!0,o.file&&f(o.file,o.fileName),()=>{h.current=!1}),[o.file,o.fileName,f]);const b=p.useMemo(()=>ze(n),[n]);return t.jsxs(a.Box,{m:1,sx:{width:b,height:b},children:[d&&t.jsx(a.Skeleton,{variant:"rectangular",sx:{width:b,height:b}}),u&&t.jsxs("p",{children:["Error uploading file: ",u]})]})}function La({property:e,value:o,size:r}){return t.jsx(a.Box,{m:1,position:"relative",children:o&&t.jsx(re,{children:t.jsx(de,{value:o,property:e,size:r})})})}const Ma=({selected:e,focused:o,name:r,setPreventOutsideClick:i,setFocused:n,onValueChange:l,select:s,openPopup:u,value:c,property:d,validation:g,size:h,align:f,width:b,height:y,entityId:v,entityValues:C})=>{const[w,m]=p.useState(c);pe({property:d,value:w,setValue:m});const[S,_]=p.useState(),[k,B]=p.useState(!1),P=Boolean(d.config?.Field),M=Boolean(d.config?.Preview),q=Ke(d),O=typeof d.disabled=="object"?d.disabled.disabledMessage:void 0,T=Boolean(d.disabled),I=p.useCallback(()=>{n(!1)},[]);p.useEffect(()=>{c!==w&&m(c)},[c]),p.useEffect(()=>{Te.default(c,w)||(B(!1),g.validate(w).then(()=>{_(void 0),l&&l({value:w,name:r,setError:_,setSaved:B})}).catch(W=>{console.error(W),_(W)}))},[w]);const A=p.useCallback(W=>{let D;W===void 0?D=null:D=W,m(D)},[]);let $,E=!1,L=!1,F=!1,H=!1;if(!q&&!P&&(!M||e)){if(d.dataType==="string"&&d.config?.storageMeta||d.dataType==="array"&&d.of?.dataType==="string"&&d.of?.config?.storageMeta)$=t.jsx(Oa,{error:S,disabled:T,focused:o,property:d,entityId:v,entityValues:C,internalValue:w,previewSize:Be(h),updateValue:A,name:r,onBlur:I,setPreventOutsideClick:i}),L=!0,H=!0,F=!0;else if(e&&d.dataType==="number"){const D=d;D.config?.enumValues?$=t.jsx(Wt,{name:r,multiple:!1,disabled:T,focused:o,valueType:"number",small:Be(h)!=="regular",enumValues:D.config.enumValues,error:S,onBlur:I,internalValue:w,updateValue:A,setPreventOutsideClick:i}):($=t.jsx(Ba,{align:f,error:S,focused:o,disabled:T,onBlur:I,value:w,updateValue:A}),E=!0)}else if(e&&d.dataType==="string"){const D=d;if(D.config?.enumValues)$=t.jsx(Wt,{name:r,multiple:!1,focused:o,disabled:T,valueType:"string",small:Be(h)!=="regular",enumValues:D.config.enumValues,error:S,onBlur:I,internalValue:w,updateValue:A,setPreventOutsideClick:i});else if(!D.config?.storageMeta&&!D.config?.markdown){const Y=!!D.config?.multiline;$=t.jsx(_a,{error:S,disabled:T,multiline:Y,focused:o,value:w,updateValue:A}),E=!0}}else if(d.dataType==="boolean")$=t.jsx(Pa,{error:S,disabled:T,focused:o,internalValue:w,updateValue:A});else if(d.dataType==="timestamp")$=t.jsx(Fa,{name:r,error:S,disabled:T,focused:o,internalValue:w,updateValue:A,setPreventOutsideClick:i}),E=!0;else if(d.dataType==="reference")typeof d.path=="string"&&($=t.jsx(or,{name:r,internalValue:w,updateValue:A,disabled:T,size:h,property:d,setPreventOutsideClick:i})),E=!0;else if(d.dataType==="array"){const D=d;if(D.of&&(D.of.dataType==="string"||D.of.dataType==="number"?e&&D.of.config?.enumValues&&($=t.jsx(Wt,{name:r,multiple:!0,disabled:T,focused:o,small:Be(h)!=="regular",valueType:D.of.dataType,enumValues:D.of.config.enumValues,error:S,onBlur:I,internalValue:w,updateValue:A,setPreventOutsideClick:i}),E=!0):D.of.dataType==="reference"&&(typeof D.of.path=="string"&&($=t.jsx(or,{name:r,disabled:T,internalValue:w,updateValue:A,size:h,property:d,setPreventOutsideClick:i})),E=!1)),!D.of&&!D.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${r}`)}}return $||(E=!1,L=e&&!$&&!T&&!q,$=t.jsx(re,{children:t.jsx(de,{width:b,height:y,name:r,value:w,property:d,size:Be(h)})})),t.jsx(Ut,{select:s,selected:e,focused:o,disabled:T||q,disabledTooltip:O??"Disabled",removePadding:F,fullHeight:H,size:h,saved:k,error:S,align:f,allowScroll:E,showExpandIcon:L,openPopup:T?void 0:u,value:w,children:$})},Na=N.default.memo(Ma,qa);function qa(e,o){return e.selected===o.selected&&e.focused===o.selected&&e.height===o.height&&e.size===o.size&&e.align===o.align&&e.width===o.width&&Te.default(e.property,o.property)&&Te.default(e.value,o.value)}function za({containerRef:e,ref:o,x:r,y:i,onMove:n}){let l=0,s=0;const u=h=>{if(h.button!==0||!o.current||h.target!==o.current)return;const{x:f,y:b}=o.current.getBoundingClientRect();l=h.screenX-f,s=h.screenY-b,document.addEventListener("mousemove",d),document.addEventListener("mouseup",c),h.stopPropagation()},c=h=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",c),h.stopPropagation()},d=h=>{n(h.screenX-l,h.screenY-s),h.stopPropagation()},g=()=>{e.current&&(e.current.style.top=`${i}px`,e.current.style.left=`${r}px`)};p.useEffect(()=>{const h=o.current;return h&&h.addEventListener("mousedown",u),g(),()=>{h&&h.removeEventListener("mousedown",u)}})}function Va(){const[e,o]=p.useState({width:0,height:0});return p.useLayoutEffect(()=>{function r(){o({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",r),r(),()=>window.removeEventListener("resize",r)},[]),e}function ct({name:e,value:o,disabled:r,buildEntry:i,onInternalIdAdded:n,includeAddButton:l}){const s=o&&Array.isArray(o)&&o.length>0,u=p.useMemo(()=>s?o.map((h,f)=>h?{[Eo(h)+f]:Ht()}:{}).reduce((h,f)=>({...h,...f}),{}):{},[o,s]),c=p.useRef(u),[d,g]=p.useState(s?Object.values(c.current):[]);return p.useEffect(()=>{if(s&&o&&o.length!==d.length){const h=o.map((f,b)=>{const y=Eo(f)+b;if(y in c.current)return c.current[y];{const v=Ht();return c.current[y]=v,v}});g(h)}},[s,d.length,o]),t.jsx(we.FieldArray,{name:e,validateOnChange:!0,render:h=>{const f=()=>{if(r)return;const v=Ht(),C=[...d,v];n&&n(v),g(C),h.push(null)},b=v=>{const C=[...d];C.splice(v,1),g(C),h.remove(v)},y=v=>{if(!v.destination)return;const C=v.source.index,w=v.destination.index,m=[...d],S=m[C];m[C]=m[w],m[w]=S,g(m),h.move(C,w)};return t.jsx(Le.DragDropContext,{onDragEnd:y,children:t.jsx(Le.Droppable,{droppableId:`droppable_${e}`,children:(v,C)=>t.jsxs("div",{...v.droppableProps,ref:v.innerRef,children:[s&&d.map((w,m)=>t.jsx(Le.Draggable,{draggableId:`array_field_${e}_${w}}`,isDragDisabled:r,index:m,children:(S,_)=>t.jsx(a.Box,{ref:S.innerRef,...S.draggableProps,style:S.draggableProps.style,sx:{marginBottom:1,borderRadius:"4px",opacity:1},children:t.jsxs(a.Box,{display:"flex",children:[t.jsx(a.Box,{flexGrow:1,width:"100%",children:i(m,w)},`field_${e}_entryValue`),t.jsxs(a.Box,{width:"36px",display:"flex",flexDirection:"column",alignItems:"center",children:[t.jsx("div",{...S.dragHandleProps,children:t.jsx(Di.default,{fontSize:"small",color:r?"disabled":"inherit",sx:{cursor:r?"inherit":"move"}})}),!r&&t.jsx(a.IconButton,{size:"small","aria-label":"remove",onClick:()=>b(m),children:t.jsx(Ie.default,{fontSize:"small"})})]})]},`field_${m}`)})},`array_field_${e}_${w}}`)),v.placeholder,l&&!r&&t.jsx(a.Box,{p:1,justifyContent:"center",textAlign:"left",children:t.jsx(a.Button,{variant:"outlined",color:"primary",disabled:r,onClick:f,children:"Add"})})]})})})}})}function Ht(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}function be({property:e}){const o=typeof e.disabled=="object"?e.disabled.disabledMessage:void 0;return t.jsxs(a.Box,{display:"flex",children:[t.jsx(a.Box,{flexGrow:1,children:t.jsx(a.FormHelperText,{children:o||e.description})}),e.longDescription&&t.jsx(a.Tooltip,{title:t.jsx(a.Typography,{variant:"caption",children:e.longDescription}),placement:"bottom-start",arrow:!0,children:t.jsx(a.IconButton,{edge:"start",size:"small",children:t.jsx(Li.default,{color:"disabled",fontSize:"small"})})})]})}function ve({property:e}){return t.jsxs(t.Fragment,{children:[t.jsx("span",{style:{paddingRight:"12px"},children:lt(e)}),t.jsx("span",{children:e.title})]})}const Ua=X.default(e=>J.default({inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)}}));function jt({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,autoFocus:s,touched:u,property:c,includeDescription:d,shouldAlwaysRerender:g}){const h=Ua(),f=c.config?.enumValues;return pe({property:c,value:o,setValue:r}),t.jsxs(a.FormControl,{variant:"filled",fullWidth:!0,required:c.validation?.required,error:n,disabled:l,children:[t.jsx(a.InputLabel,{id:`${e}-select-label`,classes:{root:h.inputLabel,shrink:h.shrinkInputLabel},children:t.jsx(ve,{property:c})}),t.jsx(a.Select,{sx:{minHeight:"64px"},variant:"filled",labelId:`${e}-select-label`,autoFocus:s,value:o!==void 0?o:"",disabled:l,onChange:b=>{const y=b.target.value,v=y?c.dataType==="number"?parseFloat(y):y:null;return r(v)},renderValue:b=>t.jsx(xe,{enumKey:b,enumValues:f,small:!1}),children:Ne(f).map(([b,y])=>t.jsx(a.MenuItem,{value:b,disabled:Ze(y),children:t.jsx(xe,{enumKey:b,enumValues:f,small:!0})},`select_${e}_${b}`))}),d&&t.jsx(be,{property:c}),n&&t.jsx(a.FormHelperText,{children:i})]})}const Wa=X.default(e=>J.default({inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)}}));function rr({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,property:s,includeDescription:u,autoFocus:c}){const d=Wa();if(!s.of)throw Error("Using wrong component ArrayEnumSelect");if(s.of.dataType!=="string"&&s.of.dataType!=="number")throw Error("Field misconfiguration: array field of type string or number");const g=s.of.config?.enumValues;if(!g)throw console.error(s),Error("Field misconfiguration: array field of type string or number needs to have enumValues");pe({property:s,value:o,setValue:r});const h=!!o&&Array.isArray(o);return t.jsxs(a.FormControl,{variant:"filled",fullWidth:!0,required:s.validation?.required,error:n,children:[t.jsx(a.InputLabel,{id:`${e}-multiselect-label`,classes:{root:d.inputLabel,shrink:d.shrinkInputLabel},children:t.jsx(ve,{property:s})}),t.jsx(a.Select,{multiple:!0,sx:{minHeight:"64px"},variant:"filled",labelId:`${e}-multiselect-label`,value:h?o.map(f=>f.toString()):[],autoFocus:c,disabled:l,onChange:f=>{let b;return s.of?.dataType==="number"?b=f.target.value?f.target.value.map(y=>parseFloat(y)):[]:b=f.target.value,r(b)},renderValue:f=>t.jsx(rt,{value:f,name:e,enumValues:g,size:"regular"}),children:Ne(g).map(([f,b])=>{const y=h&&o.map(v=>v.toString()).includes(f.toString());return t.jsxs(a.MenuItem,{value:f,disabled:Ze(b),dense:!0,children:[t.jsx(a.Checkbox,{checked:y}),t.jsx(a.ListItemText,{primary:t.jsx(xe,{enumKey:f,enumValues:g,small:!0})})]},`form-select-${e}-${f}`)})}),u&&t.jsx(be,{property:s}),n&&t.jsx(a.FormHelperText,{children:i})]})}const Gt=X.default(e=>({dropZone:{position:"relative",paddingTop:"2px",border:"2px solid transparent",minHeight:"254px",outline:0,borderTopLeftRadius:"2px",borderTopRightRadius:"2px",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",borderBottom:e.palette.mode==="light"?"1px solid rgba(0, 0, 0, 0.42)":"1px solid rgba(255, 255, 255, 0.7)",boxSizing:"border-box",transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms","&:focus":{borderBottom:`2px solid ${e.palette.primary.main}`}},disabled:{backgroundColor:"rgba(0, 0, 0, 0.12)",color:e.palette.mode==="light"?"rgba(0, 0, 0, 0.38)":"rgba(255, 255, 255, 0.38)",borderBottom:`1px dotted ${e.palette.grey[400]}`},nonActiveDrop:{"&:hover":{backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)"}},activeDrop:{paddingTop:"0px",boxSizing:"border-box",border:"2px solid"},acceptDrop:{transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",background:"repeating-linear-gradient( 45deg, rgba(0, 0, 0, 0.09), rgba(0, 0, 0, 0.09) 10px, rgba(0, 0, 0, 0.12) 10px, rgba(0, 0, 0, 0.12) 20px) !important",border:"2px solid",borderColor:e.palette.success.light},rejectDrop:{border:"2px solid",borderColor:e.palette.error.light},uploadItem:{padding:e.spacing(1),minWidth:220,minHeight:220},uploadItemSmall:{padding:e.spacing(1),minWidth:118,minHeight:118,boxSizing:"border-box"},thumbnailCloseIcon:{position:"absolute",borderRadius:"9999px",top:-8,right:-8,zIndex:100,backgroundColor:e.palette.background.paper}}));function Yt({name:e,value:o,setValue:r,error:i,showError:n,autoFocus:l,tableMode:s,property:u,includeDescription:c,context:d,isSubmitting:g}){const h=u.dataType==="array",f=Ke(u)||!!u.disabled||g,b=h?Array.isArray(o)?o:[]:o;pe({property:u,value:o,setValue:r});const y=u.dataType==="string"?u.config?.storageMeta:u.dataType==="array"&&u.of.dataType==="string"?u.of.config?.storageMeta:void 0;if(!y)throw Error("Storage meta must be specified");const v=w=>{if(y.fileName){const m=y.fileName({entityId:d.entityId,values:d.values,property:u,file:w,storageMeta:y,name:e});if(!m||m.length===0)throw Error("You need to return a valid filename");return m}return w.name},C=w=>{if(typeof y.storagePath=="string")return y.storagePath;if(typeof y.storagePath=="function"){const m=y.storagePath({entityId:d.entityId,values:d.values,property:u,file:w,storageMeta:y,name:e});if(!m||m.length===0)throw Error("You need to return a valid filename");return m}return console.warn("When using a storage property, if you don't specify the storagePath, the root storage is used"),"/"};return t.jsxs(a.FormControl,{fullWidth:!0,required:u.validation?.required,error:n,children:[!s&&t.jsx(a.FormHelperText,{filled:!0,required:u.validation?.required,children:t.jsx(ve,{property:u})}),t.jsx(ja,{value:b,name:e,disabled:f,autoFocus:l,property:u,onChange:w=>{r(w)},fileNameBuilder:v,storagePathBuilder:C,storageMeta:y,multipleFilesSupported:h}),c&&t.jsx(be,{property:u}),n&&t.jsx(a.FormHelperText,{children:i})]})}function Ha({storageMeta:e,disabled:o,isDraggingOver:r,onExternalDrop:i,multipleFilesSupported:n,droppableProvided:l,autoFocus:s,internalValue:u,property:c,onClear:d,metadata:g,storagePathBuilder:h,onFileUploadComplete:f,size:b,name:y,helpText:v}){const C=Gt(),{getRootProps:w,getInputProps:m,isDragActive:S,isDragAccept:_,isDragReject:k}=so.useDropzone({accept:e.acceptedFiles,disabled:o||r,noDragEventsBubbling:!0,onDrop:i});return t.jsxs(a.Box,{...w(),className:fe.default(C.dropZone,{[C.nonActiveDrop]:!S,[C.activeDrop]:S,[C.rejectDrop]:k,[C.acceptDrop]:_,[C.disabled]:o}),sx:{display:n&&u.length?void 0:"flex",alignItems:"center"},children:[t.jsxs(a.Box,{...l.droppableProps,ref:l.innerRef,sx:{display:"flex",alignItems:"center",overflow:n&&u.length?"auto":void 0,minHeight:n&&u.length?180:250,p:1,"&::-webkit-scrollbar":{display:"none"}},children:[t.jsx("input",{autoFocus:s,...m()}),u.map((B,P)=>{let M;if(B.storagePathOrDownloadUrl){const q=n?c.of:c;M=t.jsx(Ya,{name:`storage_preview_${B.storagePathOrDownloadUrl}`,property:q,disabled:o,value:B.storagePathOrDownloadUrl,onClear:d,size:B.size})}else B.file&&(M=t.jsx(Ga,{entry:B,metadata:g,storagePath:h(B.file),onFileUploadComplete:f,size:b}));return t.jsx(Le.Draggable,{draggableId:`array_field_${y}_${B.id}}`,index:P,children:(q,O)=>t.jsx(a.Box,{ref:q.innerRef,...q.draggableProps,...q.dragHandleProps,style:q.draggableProps.style,sx:{borderRadius:"4px"},children:M})},`array_field_${y}_${B.id}}`)}),l.placeholder]}),t.jsx(a.Box,{sx:{flexGrow:1,minHeight:38,boxSizing:"border-box",m:2},children:t.jsx(a.Typography,{align:"center",variant:"body2",sx:B=>({color:"#838383",fontWeight:B.typography.fontWeightMedium}),children:v})})]})}function ja({property:e,name:o,value:r,onChange:i,multipleFilesSupported:n,disabled:l,autoFocus:s,storageMeta:u,fileNameBuilder:c,storagePathBuilder:d}){const g=Ve();if(n){const O=e;if(O.of){if(O.of.dataType!=="string")throw Error("Storage field using array must be of data type string")}else throw Error("Storage field using array must be of data type string")}const h=u?.metadata,f=n?"small":"regular",b=(n?r:[r]).map(O=>({id:m(),storagePathOrDownloadUrl:O,metadata:h,size:f})),[y,v]=ne.useState(r),[C,w]=ne.useState(b);ne.useState(void 0),Te.default(y,r)||(v(r),w(b));function m(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}const S=(O,T)=>{const I=[...C],A=I[O];I.splice(O,1),I.splice(T,0,A),w(I);const $=I.filter(E=>!!E.storagePathOrDownloadUrl).map(E=>E.storagePathOrDownloadUrl);i($)},_=O=>{!O.destination||S(O.source.index,O.destination.index)};function k(O){return O.filter((T,I)=>(O.map(A=>A.storagePathOrDownloadUrl).indexOf(T.storagePathOrDownloadUrl)===I||!T.storagePathOrDownloadUrl)&&(O.map(A=>A.file).indexOf(T.file)===I||!T.file))}const B=O=>{if(!O.length||l)return;let T;n?T=[...C,...O.map(I=>({id:m(),file:I,fileName:c(I),metadata:h,size:f}))]:T=[{id:m(),file:O[0],fileName:c(O[0]),metadata:h,size:f}],T=k(T),w(T)},P=async(O,T,I)=>{console.debug("onFileUploadComplete",O,T);let A=O;u.storeUrl&&(A=await g.getDownloadURL(O)),u.postProcess&&(A=await u.postProcess(A));let $;T.storagePathOrDownloadUrl=A,T.metadata=I,$=[...C],$=k($),w($);const E=$.filter(L=>!!L.storagePathOrDownloadUrl).map(L=>L.storagePathOrDownloadUrl);i(n?E:E?E[0]:null)},M=O=>{if(n){const T=C.filter(I=>I.storagePathOrDownloadUrl!==O);i(T.filter(I=>!!I.storagePathOrDownloadUrl).map(I=>I.storagePathOrDownloadUrl)),w(T)}else i(null),w([])},q=n?"Drag 'n' drop some files here, or click to select files":"Drag 'n' drop a file here, or click to select one";return t.jsx(Le.DragDropContext,{onDragEnd:_,children:t.jsx(Le.Droppable,{droppableId:`droppable_${o}`,direction:"horizontal",children:(O,T)=>t.jsx(Ha,{storageMeta:u,disabled:l,isDraggingOver:T.isDraggingOver,droppableProvided:O,onExternalDrop:B,multipleFilesSupported:n,autoFocus:s,internalValue:C,property:e,onClear:M,metadata:h,storagePathBuilder:d,onFileUploadComplete:P,size:f,name:o,helpText:q})})})}function Ga({storagePath:e,entry:o,metadata:r,onFileUploadComplete:i,size:n}){const l=Ve(),s=Gt(),u=Ue(),[c,d]=ne.useState(),[g,h]=ne.useState(!1),f=ne.useRef(!1),b=p.useCallback((y,v)=>{d(void 0),h(!0),l.uploadFile({file:y,fileName:v,path:e,metadata:r}).then(async({path:C})=>{console.debug("Upload successful"),await i(C,o,r),f.current&&h(!1)}).catch(C=>{console.error("Upload error",C),f.current&&(d(C.message),h(!1)),u.open({type:"error",title:"Error uploading file",message:C.message})})},[o,r,i,u,l,e]);return ne.useEffect(()=>(f.current=!0,o.file&&b(o.file,o.fileName),()=>{f.current=!1}),[o.file,o.fileName,b]),t.jsx(a.Box,{m:1,children:t.jsxs(a.Paper,{elevation:0,className:n==="regular"?s.uploadItem:s.uploadItemSmall,variant:"outlined",children:[g&&t.jsx(a.Skeleton,{variant:"rectangular",sx:{width:"100%",height:"100%"}}),c&&t.jsxs("p",{children:["Error uploading file: ",c]})]})})}function Ya({name:e,property:o,value:r,onClear:i,disabled:n,size:l}){const s=Gt();return t.jsx(a.Box,{m:1,position:"relative",children:t.jsxs(a.Paper,{elevation:0,className:l==="regular"?s.uploadItem:s.uploadItemSmall,variant:"outlined",children:[!n&&t.jsx("a",{className:s.thumbnailCloseIcon,children:t.jsx(a.IconButton,{size:"small",onClick:u=>{u.stopPropagation(),i(r)},children:t.jsx(Ie.default,{fontSize:"small"})})}),r&&t.jsx(re,{children:t.jsx(de,{name:e,value:r,property:o,size:l})})]})})}const Xa=X.default(e=>J.default({inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)}}));function Xt({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,autoFocus:s,property:u,includeDescription:c,allowInfinity:d,shouldAlwaysRerender:g}){const h=Xa();let f,b;if(u.dataType==="string"){const _=u.config?.url;f=typeof _=="string"?_:void 0,b=u.config?.multiline}pe({property:u,value:o,setValue:r});const y=!!b,v=o??(u.dataType==="string"?"":o===0?0:""),C=v===1/0,w=!C&&u.dataType==="number"?"number":void 0,m=_=>{if(!_)r(null);else if(w==="number"){const k=parseFloat(_);r(k)}else r(_)},S=t.jsx(a.FilledInput,{sx:{minHeight:"64px"},autoFocus:s,type:w,multiline:y,inputProps:{rows:4},value:C?"Infinity":o??"",disabled:l,onChange:_=>{m(_.target.value)}});return t.jsxs(t.Fragment,{children:[t.jsxs(a.FormControl,{variant:"filled",required:u.validation?.required,error:n,disabled:C,fullWidth:!0,children:[t.jsx(a.InputLabel,{classes:{root:h.inputLabel,shrink:h.shrinkInputLabel},children:t.jsx(ve,{property:u})}),S,t.jsxs(a.Box,{display:"flex",children:[t.jsxs(a.Box,{flexGrow:1,children:[n&&t.jsx(a.FormHelperText,{children:i}),c&&t.jsx(be,{property:u})]}),d&&t.jsx(a.FormControlLabel,{checked:C,style:{marginRight:0},labelPlacement:"start",control:t.jsx(a.Switch,{size:"small",type:"checkbox",onChange:_=>{m(_.target.checked?1/0:void 0)}}),disabled:l,label:t.jsx(a.Typography,{variant:"caption",children:"Set value to Infinity"})})]})]}),f&&v&&t.jsx(re,{children:t.jsx(a.Box,{m:1,children:t.jsx(de,{name:e,value:v,property:u,size:"regular"})})})]})}const Ja=X.default(e=>J.default({formControl:{justifyContent:"space-between",margin:0,width:"100%",minHeight:"64px",paddingLeft:"16px",paddingRight:"24px",color:"rgba(0, 0, 0, 0.87)",boxSizing:"border-box",position:"relative",display:"inline-flex",alignItems:"center",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",borderTopLeftRadius:"4px",borderTopRightRadius:"4px",transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms","&::before":{borderBottom:e.palette.mode==="light"?"1px solid rgba(0, 0, 0, 0.42)":"1px solid rgba(255, 255, 255, 0.7)",left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",pointerEvents:"none"},"&::after":{content:'""',transition:"transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",left:0,bottom:0,position:"absolute",right:0,transform:"scaleX(0)",borderBottom:`2px solid ${e.palette.primary.main}`},"&:hover":{backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)"}},focus:{"&::before":{borderBottom:e.palette.mode==="light"?"1px solid rgba(255, 255, 255, 0.7)":"1px solid rgba(0, 0, 0, 0.87)"},"&::after":{transform:"scaleX(1)",pointerEvents:"none"}}})),Ka=N.default.forwardRef(function({name:e,value:o,setValue:r,error:i,showError:n,autoFocus:l,disabled:s,touched:u,property:c,includeDescription:d,shouldAlwaysRerender:g},h){const f=Ja();pe({property:c,value:o,setValue:r});const[b,y]=p.useState(l);return t.jsx(t.Fragment,{children:t.jsxs(a.FormControl,{fullWidth:!0,children:[t.jsx(a.FormControlLabel,{className:fe.default(f.formControl,{[f.focus]:b}),onClick:v=>y(!0),labelPlacement:"start",checked:Boolean(o),inputRef:h,control:t.jsx(a.Switch,{type:"checkbox",color:"secondary",autoFocus:l,disabled:s,onFocus:v=>y(!0),onBlur:v=>y(!1),onChange:v=>{y(!0),r(v.target.checked)}}),disabled:s,label:t.jsx(a.Typography,{color:"textSecondary",children:t.jsx(ve,{property:c})})}),d&&t.jsx(be,{property:c}),n&&t.jsx(a.FormHelperText,{children:i})]})})}),nr=e=>t.jsx(Ka,{...e});function ir({name:e,value:o,setValue:r,autoFocus:i,error:n,showError:l,disabled:s,touched:u,property:c,includeDescription:d,shouldAlwaysRerender:g}){const h=o||null;return pe({property:c,value:o,setValue:r}),t.jsxs(t.Fragment,{children:[t.jsx(Ct.default,{clearable:!0,autoFocus:i,value:h,label:t.jsx(ve,{property:c}),renderInput:f=>t.jsx(a.TextField,{...f,fullWidth:!0,InputProps:{...f.InputProps,sx:{minHeight:"64px"}},error:l,variant:"filled",helperText:l?n:null}),disabled:s,onChange:f=>r(f)}),d&&t.jsx(be,{property:c})]})}const Za=X.default(e=>J.default({root:{elevation:0,width:"100%",padding:e.spacing(1),position:"relative",transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",borderTopLeftRadius:"2px",borderTopRightRadius:"2px",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)","&::before":{borderBottom:e.palette.mode==="light"?"1px solid rgba(0, 0, 0, 0.42)":"1px solid rgba(255, 255, 255, 0.7)",left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",pointerEvents:"none"},"&::after":{content:'""',transition:"transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",left:0,bottom:0,position:"absolute",right:0,transform:"scaleX(0)",borderBottom:`2px solid ${e.palette.primary.main}`},"&:hover":{cursor:"pointer",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)"},color:"#838383",fontWeight:e.typography.fontWeightMedium},disabled:{backgroundColor:"rgba(0, 0, 0, 0.12)",color:e.palette.mode==="light"?"rgba(0, 0, 0, 0.38)":"rgba(255, 255, 255, 0.38)","&::before":{borderBottom:e.palette.mode==="light"?"1px dotted rgba(0, 0, 0, 0.42)":"1px dotted rgba(255, 255, 255, 0.7)"},"&::after":{borderBottom:`2px dotted ${e.palette.primary.main}`},"&:hover":{cursor:"inherit",backgroundColor:"rgba(0, 0, 0, 0.12)"}}}));function lr({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,touched:s,autoFocus:u,property:c,includeDescription:d,context:g,shouldAlwaysRerender:h}){if(typeof c.path!="string")throw Error("Picked the wrong component ReferenceField");pe({property:c,value:o,setValue:r});const f=Za(),[b,y]=N.default.useState(u),v=Pe(),C=Se(),w=p.useMemo(()=>C.getCollectionResolver(c.path),[c.path,C]);if(!w)throw Error(`Couldn't find the corresponding collection for the path: ${c.path}`);const m=w.schemaResolver,S=c.path,_=o&&o instanceof ke,{entity:k,dataLoading:B,dataLoadingError:P}=it({path:_?o.path:void 0,entityId:_?o.id:void 0,schema:m,useCache:!0}),M=$=>{l||(r($?ot($):null),y(!1))},q=()=>{y(!0)},O=$=>{$.stopPropagation(),r(null),y(!1)},T=$=>{$.stopPropagation(),k&&v.open({entityId:k.id,path:S,overrideSchemaRegistry:!1})},I=()=>{y(!1)};function A($){const E=k&&!k.values;let L;if(!$)L=t.jsx(me,{error:"The specified collection does not exist. Check console"});else if(E)L=t.jsx(a.Tooltip,{title:o&&o.path,children:t.jsxs(a.Box,{display:"flex",alignItems:"center",p:1,flexGrow:1,children:[t.jsx(wt.default,{fontSize:"small",color:"error"}),t.jsxs(a.Box,{marginLeft:1,children:["Missing reference ",k&&k.id]})]})});else if(_){const F=$({}),H=Object.keys(F.properties);let W=c.previewProperties?.filter(D=>H.includes(D));(!W||!W.length)&&(W=H),W=W.slice(0,3),L=t.jsx(a.Box,{display:"flex",flexDirection:"column",flexGrow:1,ml:1,mr:1,children:W&&W.map((D,Y)=>{const V=F.properties[D];return V?t.jsx(a.Box,{mt:.5,mb:.5,children:t.jsx(re,{children:k?t.jsx(de,{name:D,value:k.values[D],property:V,size:"tiny"}):t.jsx(Fe,{property:V,size:"tiny"})})},`reference_previews_${D}`):null})})}else L=t.jsxs(a.Box,{p:1,onClick:l?void 0:q,justifyContent:"center",display:"flex",children:[t.jsx(a.Typography,{variant:"body2",sx:F=>({flexGrow:1,textAlign:"center",color:"#838383",fontWeight:F.typography.fontWeightMedium}),children:"No value set"}),!l&&t.jsx(a.Button,{variant:"outlined",color:"primary",children:"Set"})]});return t.jsx(a.Box,{onClick:l?void 0:q,display:"flex",children:t.jsxs(a.Box,{display:"flex",flexDirection:"column",flexGrow:1,children:[t.jsxs(a.Box,{display:"flex",flexDirection:"row",flexGrow:1,children:[t.jsx(a.Box,{flexGrow:1,children:t.jsx(a.FormHelperText,{filled:!0,required:c.validation?.required,children:t.jsx(ve,{property:c})})}),k&&t.jsx(a.Box,{alignSelf:"center",m:1,children:t.jsx(a.Tooltip,{title:o&&o.path,children:t.jsx(a.Typography,{variant:"caption",className:"mono",children:k.id})})}),!E&&k&&o&&t.jsx(a.Box,{children:t.jsx(a.Tooltip,{title:`See details for ${k.id}`,children:t.jsx("span",{children:t.jsx(a.IconButton,{onClick:T,size:"large",children:t.jsx(ho.default,{})})})})}),o&&t.jsx(a.Box,{children:t.jsx(a.Tooltip,{title:"Clear",children:t.jsx("span",{children:t.jsx(a.IconButton,{disabled:l,onClick:l?void 0:O,size:"large",children:t.jsx(Ie.default,{})})})})})]}),L]})})}return t.jsxs(a.FormControl,{error:n,fullWidth:!0,children:[t.jsxs("div",{className:`${f.root} ${l?f.disabled:""}`,children:[m&&A(m),w&&t.jsx(dt,{open:b,collectionResolver:w,multiselect:!1,path:S,onClose:I,onSingleEntitySelected:M})]}),d&&t.jsx(be,{property:c}),n&&t.jsx(a.FormHelperText,{children:i})]})}function ar({name:e,value:o,error:r,showError:i,isSubmitting:n,setValue:l,tableMode:s,property:u,includeDescription:c,underlyingValueHasChanged:d,context:g,disabled:h,shouldAlwaysRerender:f}){if(!u.of)throw Error("ArrayDefaultField misconfiguration. Property `of` not set");const b=u.of,[y,v]=p.useState();pe({property:u,value:o,setValue:l});const C=(w,m)=>He({name:`${e}[${w}]`,disabled:h,property:b,includeDescription:c,underlyingValueHasChanged:d,context:g,tableMode:!1,partOfArray:!0,autoFocus:m===y,shouldAlwaysRerender:!1});return t.jsxs(a.FormControl,{fullWidth:!0,error:i,children:[!s&&t.jsx(a.FormHelperText,{filled:!0,required:u.validation?.required,children:t.jsx(ve,{property:u})}),t.jsx(a.Paper,{variant:"outlined",sx:w=>({elevation:0,padding:w.spacing(2),[w.breakpoints.up("md")]:{padding:w.spacing(2)}}),children:t.jsx(ct,{value:o,name:e,buildEntry:C,onInternalIdAdded:v,disabled:n||Boolean(u.disabled),includeAddButton:!u.disabled})}),c&&t.jsx(be,{property:u}),i&&typeof r=="string"&&t.jsx(a.FormHelperText,{children:r})]})}function sr({name:e,value:o,error:r,showError:i,isSubmitting:n,setValue:l,tableMode:s,property:u,includeDescription:c,underlyingValueHasChanged:d,context:g,disabled:h,shouldAlwaysRerender:f}){if(!u.oneOf)throw Error("ArrayOneOfField misconfiguration. Property `oneOf` not set");pe({property:u,value:o,setValue:l});const[b,y]=p.useState(),v=(C,w)=>t.jsx(Qa,{name:`${e}[${C}]`,index:C,value:o[C],typeField:u.oneOf.typeField??"type",valueField:u.oneOf.valueField??"value",properties:u.oneOf.properties,autoFocus:w===b,context:g},`array_one_of_${C}`);return t.jsxs(a.FormControl,{fullWidth:!0,error:i,children:[!s&&t.jsx(a.FormHelperText,{filled:!0,required:u.validation?.required,children:t.jsx(ve,{property:u})}),t.jsx(a.Paper,{variant:"outlined",sx:C=>({elevation:0,padding:C.spacing(2),[C.breakpoints.up("md")]:{padding:C.spacing(2)}}),children:t.jsx(ct,{value:o,name:e,buildEntry:v,onInternalIdAdded:y,disabled:n||Boolean(u.disabled),includeAddButton:!u.disabled})}),c&&t.jsx(be,{property:u}),i&&typeof r=="string"&&t.jsx(a.FormHelperText,{children:r})]})}function Qa({name:e,index:o,value:r,typeField:i,valueField:n,properties:l,autoFocus:s,context:u}){const c=r&&r[i],[d,g]=p.useState(c??void 0);p.useEffect(()=>{c!==d&&g(c)},[c]);const h=d?l[d]:void 0,f=Object.entries(l).map(([v,C])=>({[v]:C.title??v})).reduce((v,C)=>({...v,...C})),b=`${e}[${i}]`,y=`${e}[${n}]`;return t.jsxs(a.Paper,{sx:v=>({elevation:0,padding:v.spacing(2),[v.breakpoints.up("md")]:{padding:v.spacing(2)}}),elevation:0,children:[t.jsx(we.FastField,{required:!0,name:b,children:v=>t.jsxs(a.FormControl,{fullWidth:!0,children:[t.jsx(a.InputLabel,{id:`${e}_${o}_select_label`,children:t.jsx("span",{children:"Type"})}),t.jsx(a.Select,{fullWidth:!0,sx:{marginBottom:2},labelId:`${e}_${o}_select_label`,value:v.field.value!==void 0&&v.field.value!==null?v.field.value:"",onChange:C=>{const w=C.target.value;v.form.setFieldTouched(b),g(w),v.form.setFieldValue(b,w),v.form.setFieldValue(y,null)},renderValue:C=>t.jsx(xe,{enumKey:C,enumValues:f,small:!0}),children:Ne(f).map(([C,w])=>t.jsx(a.MenuItem,{value:C,children:t.jsx(xe,{enumKey:C,enumValues:f,small:!0})},`select_${e}_${o}_${C}`))})]})}),h&&t.jsx(a.FormControl,{fullWidth:!0,children:He({name:y,property:h,context:u,autoFocus:s})},`form_control_${e}_${d}`)]})}function Jt({name:e,value:o,setValue:r,error:i,showError:n,isSubmitting:l,touched:s,tableMode:u,property:c,includeDescription:d,context:g}){return t.jsxs(a.FormControl,{fullWidth:!0,error:n,children:[!u&&t.jsx(a.FormHelperText,{filled:!0,required:c.validation?.required,children:t.jsx(ve,{property:c})}),t.jsx(a.Paper,{sx:h=>({minHeight:"64px",elevation:0,padding:h.spacing(2),[h.breakpoints.up("md")]:{padding:h.spacing(3)}}),variant:"outlined",children:t.jsx(re,{children:t.jsx(de,{name:e,value:o,property:c,size:"regular"})})}),n&&typeof i=="string"&&t.jsx(a.FormHelperText,{children:i}),d&&t.jsx(be,{property:c})]})}const Ra=X.default(e=>J.default({root:{"& .w-md-editor-toolbar li > button":{color:e.palette.text.secondary},"& .w-md-editor-toolbar li.active > button":{color:e.palette.primary.main},"& .w-md-editor-text-pre, & .w-md-editor-text-pre .title, & .w-md-editor-text-pre .bold":{color:"inherit !important"},"& .wmde-markdown-color code.language-markdown":{color:"inherit"},"& .w-md-editor":{color:"inherit",backgroundColor:e.palette.mode==="light"?"rgb(240, 240, 240)":"#323232"},"& .w-md-editor-toolbar":{borderBottom:"inherit",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.09)"}}}));function cr({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,autoFocus:s,touched:u,property:c,tableMode:d,includeDescription:g,context:h,shouldAlwaysRerender:f}){const b=Ra();pe({property:c,value:o,setValue:r});const y=v=>{r(v||null)};return t.jsxs(a.FormControl,{required:c.validation?.required,error:n,fullWidth:!0,children:[!d&&t.jsx(a.FormHelperText,{filled:!0,required:c.validation?.required,children:t.jsx(ve,{property:c})}),t.jsx("div",{className:b.root,children:t.jsx(Zi.default,{value:typeof o=="string"?o:"",preview:"edit",onChange:v=>y(v)})}),t.jsx(a.Box,{display:"flex",children:t.jsxs(a.Box,{flexGrow:1,children:[n&&typeof i=="string"&&t.jsx(a.FormHelperText,{children:i}),g&&t.jsx(be,{property:c})]})})]})}function dr({name:e,value:o,error:r,showError:i,isSubmitting:n,tableMode:l,property:s,includeDescription:u,setValue:c}){const d=s.of;if(d.dataType!=="reference")throw Error("ArrayOfReferencesField expected a property containing references");const[g,h]=N.default.useState(!1),[f,b]=N.default.useState(!1),y=o&&Array.isArray(o)?o.map(k=>k.id):[];pe({property:s,value:o,setValue:c});const v=Se(),C=p.useMemo(()=>d.path?v.getCollectionResolver(d.path):void 0,[d.path]);if(!C)throw Error(`Couldn't find the corresponding collection for the path: ${d.path}`);const w=()=>{h(!0)},m=()=>{h(!1)},S=k=>{c(k.map(B=>ot(B)))},_=(k,B)=>{const P=o&&o.length>k?o[k]:void 0;return P?t.jsx("div",{onMouseEnter:()=>b(!0),onMouseMove:()=>b(!0),onMouseLeave:()=>b(!1),children:t.jsx(We,{value:P,property:d,onHover:f,size:"regular",onClick:w})}):t.jsx("div",{children:"Internal ERROR"})};return t.jsxs(t.Fragment,{children:[t.jsxs(a.FormControl,{fullWidth:!0,error:i,children:[!l&&t.jsx(a.FormHelperText,{filled:!0,required:s.validation?.required,children:t.jsx(ve,{property:s})}),t.jsxs(a.Paper,{variant:"outlined",sx:k=>({elevation:0,padding:k.spacing(2),[k.breakpoints.up("md")]:{padding:k.spacing(2)}}),children:[!C&&t.jsx(me,{error:"The specified collection does not exist. Check console"}),C&&t.jsxs(t.Fragment,{children:[t.jsx(ct,{value:o,name:e,buildEntry:_,disabled:n}),t.jsx(a.Box,{p:1,justifyContent:"center",textAlign:"left",children:t.jsxs(a.Button,{variant:"outlined",color:"primary",disabled:n,onClick:w,children:["Edit ",s.title]})})]})]}),u&&t.jsx(be,{property:s}),i&&typeof r=="string"&&t.jsx(a.FormHelperText,{children:r})]}),C&&d.path&&t.jsx(dt,{open:g,multiselect:!0,collectionResolver:C,path:d.path,onClose:m,onMultipleEntitiesSelected:S,selectedEntityIds:y})]})}function He({name:e,property:o,context:r,includeDescription:i,underlyingValueHasChanged:n,disabled:l,tableMode:s,partOfArray:u,autoFocus:c,shouldAlwaysRerender:d}){let g;if(Ke(o))g=Jt;else if(o.config?.Field)g=o.config?.Field;else if(o.dataType==="array"){const h=o.of;h&&((h.dataType==="string"||h.dataType==="number")&&h.config?.enumValues?g=rr:h.dataType==="string"&&h.config?.storageMeta?g=Yt:h.dataType==="reference"?g=dr:g=ar);const f=o.oneOf;if(f&&(g=sr),!h&&!f)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${e}`)}else o.dataType==="map"?g=ur:o.dataType==="reference"?o.path?g=lr:g=Jt:o.dataType==="timestamp"?g=ir:o.dataType==="boolean"?g=nr:o.dataType==="number"?o.config?.enumValues?g=jt:g=Xt:o.dataType==="string"&&(o.config?.storageMeta?g=Yt:o.config?.markdown?g=cr:o.config?.enumValues?g=jt:g=Xt);if(g){const h={name:e,property:o,includeDescription:i,underlyingValueHasChanged:n,context:r,disabled:l,tableMode:s,partOfArray:u,autoFocus:c,shouldAlwaysRerender:d},f=d||o.config?.Field?we.Field:we.FastField;return t.jsx(f,{required:o.validation?.required,name:`${e}`,children:b=>t.jsx(es,{component:g,componentProps:h,fieldProps:b})})}return t.jsx("div",{children:`Currently the field ${o.dataType} is not supported`})}function es({component:e,componentProps:{name:o,property:r,includeDescription:i,underlyingValueHasChanged:n,tableMode:l,partOfArray:s,autoFocus:u,context:c,disabled:d,shouldAlwaysRerender:g},fieldProps:h}){const f=r.config?.customProps,b=h.field.value,y=h.meta.initialValue,v=we.getIn(h.form.errors,o),C=we.getIn(h.form.touched,o),w=v&&(h.form.submitCount>0||r.validation?.unique)&&(!Array.isArray(v)||!!v.filter(B=>!!B).length),m=h.form.isSubmitting,[S,_]=p.useState(b);p.useEffect(()=>{const B=setTimeout(()=>{h.form.setFieldValue(o,S)},50);return()=>{clearTimeout(B)}},[S]),p.useEffect(()=>{Te.default(b,S)||_(b)},[b]);const k={name:o,value:S,initialValue:y,setValue:B=>{h.form.setFieldTouched(o,!0,!1),_(B)},error:v,touched:C,showError:w,isSubmitting:m,includeDescription:i??!0,property:r,disabled:d??!1,underlyingValueHasChanged:n??!1,tableMode:l??!1,partOfArray:s??!1,autoFocus:u??!1,customProps:f,context:c,shouldAlwaysRerender:g??!0};return t.jsxs(t.Fragment,{children:[N.default.createElement(e,k),n&&!m&&t.jsx(a.FormHelperText,{children:"This value has been updated elsewhere"})]})}function ur({name:e,value:o,showError:r,disabled:i,property:n,setValue:l,tableMode:s,includeDescription:u,underlyingValueHasChanged:c,context:d}){const g=n.config?.pickOnlySomeKeys||!1;if(!n.properties)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);let h;g?o?h=fl(n.properties,...Object.keys(o).filter(b=>b in n.properties)):h={}:h=n.properties,pe({property:n,value:o,setValue:l});function f(){const b=Object.keys(n.properties).filter(v=>!o||!(v in o)),y=v=>{l({...o,[v.target.value]:null})};return b.length?t.jsx(a.Box,{m:1,children:t.jsxs(a.FormControl,{fullWidth:!0,children:[t.jsx(a.InputLabel,{children:"Add property"}),t.jsx(a.Select,{variant:"standard",value:"",disabled:i,onChange:y,children:b.map(v=>t.jsx(a.MenuItem,{value:v,children:n.properties[v].title||v},v))})]})}):t.jsx(t.Fragment,{})}return t.jsxs(a.FormControl,{fullWidth:!0,error:r,children:[!s&&t.jsx(a.FormHelperText,{filled:!0,required:n.validation?.required,children:t.jsx(ve,{property:n})}),t.jsxs(a.Paper,{elevation:0,variant:"outlined",sx:b=>({elevation:0,padding:b.spacing(2),[b.breakpoints.up("md")]:{padding:b.spacing(2)}}),children:[t.jsx(a.Grid,{container:!0,spacing:2,children:Object.entries(h).filter(([b,y])=>!Io(y)).map(([b,y],v)=>t.jsx(a.Grid,{item:!0,sm:12,xs:12,children:He({name:`${e}[${b}]`,disabled:i,property:y,includeDescription:u,underlyingValueHasChanged:c,context:d,tableMode:s,partOfArray:!1,autoFocus:!1,shouldAlwaysRerender:!1})},`map-${e}-${v}`))}),g&&f()]}),u&&t.jsx(be,{property:n})]})}const ts=({containerRef:e})=>{const{isSubmitting:o,isValidating:r,errors:i}=we.useFormikContext();return p.useEffect(()=>{const n=Object.keys(i);if(n.length>0&&o&&!r){const l=e?.current?.querySelector(`#form_field_${n[0]}`);if(l&&e?.current){const s=fr(e.current);if(s){const c=l.getBoundingClientRect().top;s.scrollTo({top:s.scrollTop+c-64,behavior:"smooth"})}const u=l.querySelector("input");u&&u.focus()}}},[o,r,i,e]),null},os=e=>{const o=e&&e.scrollHeight>e.clientHeight,r=e?window.getComputedStyle(e).overflowY:null,i=r&&r.indexOf("hidden")!==-1;return o&&!i},fr=e=>!e||e===document.body?document.body:os(e)?e:fr(e.parentNode),rs=X.default(e=>J.default({paper:{elevation:0,padding:e.spacing(2),[e.breakpoints.up("md")]:{padding:e.spacing(2)}},largePadding:{padding:e.spacing(2),[e.breakpoints.up("md")]:{padding:e.spacing(3)}},inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)},buttons:{display:"flex",justifyContent:"flex-end"},button:{margin:e.spacing(1)},form:{marginTop:e.spacing(2)},input:{minHeight:"64px"},select:{paddingTop:e.spacing(1/2)},oneOfInput:{marginBottom:e.spacing(2)}}));function ns({schema:e,status:o,onChange:r,error:i,entity:n}){const l=rs(),s=o==="existing"||!e.customId,u=o!=="existing"&&!e.customId,c=typeof e.customId=="object",d=Ue(),{copy:g}=Uo({onSuccess:y=>d.open({type:"success",message:`Copied ${y}`})}),h=ce(),f={className:l.input,endAdornment:n?t.jsxs(a.InputAdornment,{position:"end",children:[t.jsx(a.IconButton,{onClick:y=>g(n.id),"aria-label":"copy-id",size:"large",children:t.jsx(a.Tooltip,{title:"Copy",children:t.jsx("svg",{className:"MuiSvgIcon-root MuiSvgIcon-fontSizeSmall",fill:"currentColor",width:"20",height:"20",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})})})}),h?.entityLinkBuilder&&t.jsx("a",{href:h.entityLinkBuilder({entity:n}),rel:"noopener noreferrer",target:"_blank",children:t.jsx(a.IconButton,{onClick:y=>y.stopPropagation(),"aria-label":"go-to-datasource",size:"large",children:t.jsx(a.Tooltip,{title:"Open in the console",children:t.jsx(tt.default,{fontSize:"small"})})})})]}):void 0},b={label:u?"ID is set automatically":"ID",disabled:s,name:"id",type:null,value:n&&o==="existing"?n.id:void 0,variant:"filled"};return ti.createElement(a.FormControl,{fullWidth:!0,error:i,...b,key:"custom-id-field"},c&&e.customId&&t.jsxs(t.Fragment,{children:[t.jsx(a.InputLabel,{id:"id-label",children:b.label}),t.jsx(a.Select,{labelId:"id-label",className:l.select,error:i,...b,onChange:y=>r(y.target.value),children:Object.entries(e.customId).map(([y,v])=>t.jsx(a.MenuItem,{value:y,children:`${y} - ${v}`},`custom-id-item-${y}`))})]}),!c&&t.jsx(a.TextField,{...b,error:i,InputProps:f,helperText:e.customId==="optional"?"Leave this blank to autogenerate an ID":"ID of the new document",onChange:y=>{let v=y.target.value;return v&&(v=v.trim()),r(v.length?v:void 0)}}),t.jsx(we.ErrorMessage,{name:"id",component:"div",children:y=>"You need to specify an ID"}))}const hr=X.default(e=>J.default({stickyButtons:{marginTop:e.spacing(2),background:e.palette.mode==="light"?"rgba(255,255,255,0.6)":"rgba(255, 255, 255, 0)",backdropFilter:"blur(4px)",borderTop:e.palette.divider,position:"sticky",bottom:0,zIndex:200},container:{padding:e.spacing(4),marginTop:e.spacing(2),marginBottom:e.spacing(2),[e.breakpoints.down("lg")]:{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),paddingTop:e.spacing(3),paddingBottom:e.spacing(3)},[e.breakpoints.down("md")]:{padding:e.spacing(2)}},button:{margin:e.spacing(1)},form:{marginTop:e.spacing(2)}}));function Kt({status:e,path:o,schemaOrResolver:r,entity:i,onEntitySave:n,onDiscard:l,onModified:s,onValuesChanged:u}){const c=hr(),d=_e(),g=e==="existing"?i?.id:void 0,h=p.useMemo(()=>he({schemaOrResolver:r,path:o,entityId:g}),[o,g]),f=p.useMemo(()=>{const $=h.properties;if((e==="existing"||e==="copy")&&i)return i.values??_t($,h.defaultValues);if(e==="new")return _t($,h.defaultValues);throw console.error({status:e,entity:i}),new Error("Form has not been initialised with the correct parameters")},[e,h,i]),b=N.default.useRef(null),[y,v]=N.default.useState(void 0),[C,w]=N.default.useState(!1),[m,S]=N.default.useState(),_=N.default.useRef(i?.values??f),k=_.current,[B,P]=p.useState(k),M=p.useMemo(()=>he({schemaOrResolver:r,path:o,entityId:g,values:B,previousValues:k}),[r,o,g,B]),q=(e==="new"||e==="copy")&&!!M.customId&&M.customId!=="optional",O=p.useMemo(()=>k&&e==="existing"?Object.keys(M.properties).map($=>{const E=k[$],L=f[$];return Te.default(E,L)?{}:{[$]:L}}).reduce(($,E)=>({...$,...E}),{}):{},[k,f]),T=p.useCallback(($,E)=>{if(q&&!y){console.error("Missing custom Id"),w(!0),E.setSubmitting(!1);return}S(null),w(!1);let L;if(e==="existing"){if(!i?.id)throw Error("Form misconfiguration when saving, no id for existing entity");L=i.id}else if(e==="new"||e==="copy"){if(M.customId){if(M.customId!=="optional"&&!y)throw Error("Form misconfiguration when saving, customId should be set");L=y}}else throw Error("New FormType added, check EntityForm");n&&n({schema:M,path:o,entityId:L,values:$,previousValues:i?.values}).then(F=>{_.current=$,E.setTouched({})}).catch(F=>{console.error(F),S(F)}).finally(()=>{E.setSubmitting(!1)})},[e,o,M,i,n,q,y]),I=p.useCallback(({name:$,value:E,property:L})=>d.checkUniqueField(o,$,E,L,g),[d,o,g]),A=p.useMemo(()=>tr(M.properties,I),[M.properties]);return t.jsx(we.Formik,{initialValues:k,onSubmit:T,validationSchema:A,validate:$=>console.debug("Validating",$),onReset:()=>l&&l(),children:({values:$,touched:E,setFieldValue:L,handleSubmit:F,isSubmitting:H,dirty:W})=>t.jsx(is,{baseDataSourceValues:f,values:$,onModified:s,setInternalValue:P,onValuesChanged:u,underlyingChanges:O,entityId:g,entity:i,touched:E,setFieldValue:L,schema:M,isSubmitting:H,classes:c,formRef:b,status:e,setCustomId:v,customIdError:C,handleSubmit:F,savingError:m})})}function is({baseDataSourceValues:e,values:o,onModified:r,setInternalValue:i,onValuesChanged:n,underlyingChanges:l,entity:s,touched:u,setFieldValue:c,schema:d,entityId:g,isSubmitting:h,classes:f,formRef:b,status:y,setCustomId:v,customIdError:C,handleSubmit:w,savingError:m}){const S=p.useMemo(()=>!Te.default(e,o),[e,o]);p.useEffect(()=>{r&&r(S),i(o),n&&n(o)},[S,o]),l&&s&&Object.entries(l).forEach(([B,P])=>{const M=o[B];!Te.default(P,M)&&!u[B]&&(console.debug("Updated value from the datasource:",B,P),c(B,P!==void 0?P:null))});const _={schema:d,entityId:g,values:o},k=t.jsx(a.Grid,{container:!0,spacing:4,children:Object.entries(d.properties).filter(([B,P])=>!Io(P)).map(([B,P])=>{const M=!!l&&Object.keys(l).includes(B)&&!!u[B],q=typeof d.originalSchema.properties[B]=="function",O=h||Ke(P)||Boolean(P.disabled),T={name:B,disabled:O,property:P,includeDescription:!0,underlyingValueHasChanged:M,context:_,tableMode:!1,partOfArray:!1,autoFocus:!1,shouldAlwaysRerender:q};return t.jsx(a.Grid,{item:!0,xs:12,id:`form_field_${B}`,children:He(T)},`field_${d.name}_${B}`)})});return t.jsxs(a.Container,{maxWidth:"sm",className:f.container,ref:b,children:[t.jsx(ns,{schema:d,status:y,onChange:v,error:C,entity:s}),t.jsxs(we.Form,{className:f.form,onSubmit:w,noValidate:!0,children:[t.jsx(a.Box,{pt:3,children:k}),t.jsxs("div",{className:f.stickyButtons,children:[m&&t.jsx(a.Box,{textAlign:"right",children:t.jsx(a.Typography,{color:"error",children:m.message})}),ls(f,h,S,y)]})]}),t.jsx(ts,{containerRef:b})]})}function ls(e,o,r,i){const n=o||!r&&i==="existing";return t.jsxs(a.Box,{textAlign:"right",children:[i==="existing"&&t.jsx(a.Button,{variant:"text",color:"primary",disabled:n,className:e.button,type:"reset",children:"Discard"}),t.jsxs(a.Button,{variant:"contained",color:"primary",type:"submit",disabled:n,className:e.button,children:[i==="existing"&&"Save",i==="copy"&&"Create copy",i==="new"&&"Create"]})]})}var as=Object.freeze(Object.defineProperty({__proto__:null,useStyles:hr,EntityForm:Kt,default:Kt},Symbol.toStringTag,{value:"Module"}));const ss=({onResize:e})=>{const o=p.useRef(0),r=p.useRef(null),i=p.useRef(e);i.current=e;const n=p.useCallback(s=>{o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{i.current(s)})},[]),l=p.useCallback(()=>{const s=r.current;s&&s.contentDocument&&s.contentDocument.defaultView&&s.contentDocument.defaultView.addEventListener("resize",n)},[n]);return p.useEffect(()=>{const s=r.current;return()=>{s&&s.contentDocument&&s.contentDocument.defaultView&&s.contentDocument.defaultView.removeEventListener("resize",n)}},[n]),t.jsx("object",{onLoad:l,ref:r,tabIndex:-1,type:"text/html",data:"about:blank",title:"",style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",pointerEvents:"none",zIndex:-1,opacity:0}})},cs=X.default(e=>J.default({form:{display:"flex",flexDirection:"column"},button:{marginTop:e.spacing(1),alignSelf:"flex-end",position:"sticky",bottom:0},popup:{display:"inline-block",userSelect:"none",position:"fixed",zIndex:1300,boxShadow:"0 0 0 2px rgba(128,128,128,0.2)",borderRadius:"4px",backgroundColor:e.palette.background.paper},popupInner:{padding:e.spacing(2),overflow:"auto",cursor:"inherit"},hidden:{visibility:"hidden",zIndex:-1}}));function ds({tableKey:e,entity:o,customFieldValidator:r,name:i,schemaResolver:n,path:l,cellRect:s,setPreventOutsideClick:u,open:c,onClose:d,columnIndex:g,onCellValueChange:h}){const[f,b]=N.default.useState(),[y,v]=p.useState(),[C,w]=p.useState(o?.values),m=cs(),S=Va(),_=N.default.useRef(null),k=N.default.useRef(null),B=N.default.useRef(!1),P=_.current?.getBoundingClientRect();za({containerRef:k,ref:_,x:y?.x,y:y?.y,onMove:(F,H)=>A({x:F,y:H})}),p.useEffect(()=>{B.current=!1},[i,o]);const M=p.useCallback(()=>{if(!s)throw Error("getInitialLocation error");return{x:s.left<S.width-s.right?s.x+s.width/2:s.x-s.width/2,y:s.top<S.height-s.bottom?s.y+s.height/2:s.y-s.height/2}},[s,S.height,S.width]),q=p.useCallback(({x:F,y:H})=>{if(!P)throw Error("normalizePosition called before draggableBoundingRect is set");return{x:Math.max(0,Math.min(F,S.width-P.width)),y:Math.max(0,Math.min(H,S.height-P.height))}},[P,S]),O=p.useCallback(F=>{if(!s||!P)return;const H=q(F??M());(!y||H.x!==y.x||H.y!==y.y)&&v(H)},[s,P,M,q,y]);p.useEffect(()=>{!s||!P||B.current||(B.current=!0,O(M()))},[s,P,M,O]),p.useLayoutEffect(()=>{O(y)},[S,s]),p.useEffect(()=>{u(c)},[c]);const T=p.useMemo(()=>{if(!n)return;const F=he({schemaOrResolver:n,path:l,values:C,previousValues:o?.values});return tr(i&&F.properties[i]?{[i]:F.properties[i]}:{},r)},[l,C,i]),I=()=>{if(!!P)return O(y)},A=F=>{if(!!P)return O(F)},$=async F=>(b(null),o&&h&&i?h({value:F[i],name:i,entity:o,setError:b,setSaved:()=>{}}):Promise.resolve());if(!o)return t.jsx(t.Fragment,{});const E=o&&t.jsxs("div",{style:{width:520,maxWidth:"100vw",maxHeight:"85vh"},children:[t.jsx(we.Formik,{initialValues:o.values,validationSchema:T,validate:F=>console.debug("Validating",F),onSubmit:(F,H)=>{$(F).then(()=>d()).finally(()=>H.setSubmitting(!1))},children:({handleChange:F,values:H,errors:W,touched:D,dirty:Y,setFieldValue:V,setFieldTouched:K,handleSubmit:te,isSubmitting:j})=>{if(Te.default(H,C)||w(H),!o)return t.jsx(me,{error:"PopupFormField misconfiguration"});if(!n)return t.jsx(t.Fragment,{});const Z=j,ie=he({schemaOrResolver:n,path:l,values:H,previousValues:o?.values}),R={schema:ie,entityId:o.id,values:H},G=ie.properties[i];return t.jsxs(we.Form,{className:m.form,onSubmit:te,noValidate:!0,children:[i&&G&&He({name:i,disabled:j||Ke(G)||!!G.disabled,property:G,includeDescription:!1,underlyingValueHasChanged:!1,context:R,tableMode:!0,partOfArray:!1,autoFocus:c,shouldAlwaysRerender:!0}),t.jsx(a.Button,{className:m.button,variant:"contained",color:"primary",type:"submit",disabled:Z,children:"Save"})]})}}),f&&t.jsx(a.Typography,{color:"error",children:f.message})]},`popup_form_${e}_${o.id}_${g}`),L=t.jsxs("div",{className:fe.default(m.popup,{[m.hidden]:!c}),ref:k,children:[t.jsx(ss,{onResize:I}),t.jsxs("div",{className:m.popupInner,ref:_,children:[E,t.jsx(a.IconButton,{size:"small",style:{position:"absolute",top:-14,right:-14,backgroundColor:"#666"},onClick:F=>{F.stopPropagation(),d()},children:t.jsx(Ie.default,{style:{color:"white"},fontSize:"small"})})]})]},`draggable_${i}_${o.id}`);return t.jsx(Ln.Portal,{container:document.body,children:L})}function us(e,o){return typeof e=="boolean"?e:typeof e=="function"?e(o):!0}function fs({schemaResolver:e,additionalColumns:o,displayedProperties:r,path:i,inlineEditing:n,size:l,onCellValueChange:s,uniqueFieldValidator:u}){const c=ce(),[d,g]=N.default.useState(void 0),[h,f]=N.default.useState(void 0),[b,y]=N.default.useState(!1),[v,C]=N.default.useState(!1),w=N.default.useRef(Math.random().toString(36)),m=p.useMemo(()=>o?o.map(E=>({[E.id]:E})).reduce((E,L)=>({...E,...L}),[]):{},[o]);p.useEffect(()=>{const E=L=>{L.keyCode===27&&_()};return document.addEventListener("keydown",E,!1),()=>{document.removeEventListener("keydown",E,!1)}});const S=p.useCallback(E=>{g(E),y(!0)},[]),_=p.useCallback(()=>{g(void 0),y(!1),C(!1)},[]),k=p.useCallback(()=>{f(void 0),y(!0)},[]),B=p.useCallback(E=>Ne(E).filter(([L,F])=>!Ze(F)).map(([L,F])=>({[L]:$o(F)})).reduce((L,F)=>({...L,...F}),{}),[]),P=p.useCallback((E,L=!1)=>{if(E.dataType==="number"||E.dataType==="string"){const F=E.title,H=E.config?.enumValues;return{dataType:E.dataType,isArray:L,title:F,enumValues:H?B(H):void 0}}else{if(E.dataType==="array"&&E.of)return P(E.of,!0);if(E.dataType==="boolean"){const F=E.title;return{dataType:E.dataType,isArray:L,title:F}}else if(E.dataType==="timestamp"){const F=E.title;return{dataType:E.dataType,isArray:L,title:F}}}},[B]),M=p.useMemo(()=>he({schemaOrResolver:e,path:i}),[e,i]),q=({column:E,columnIndex:L,rowData:F,rowIndex:H})=>{const W=F,D=E.dataKey,V=e({entityId:W.id,values:W.values}).properties[D];if(!V)return null;if(us(n,W)){const te=U=>{f(U?{columnIndex:L,width:E.width,height:E.height,entity:W,cellRect:U,name:D,schemaResolver:e}:void 0)},j=U=>{S(U?{columnIndex:L,width:E.width,height:E.height,entity:W,cellRect:U,name:D,schemaResolver:e}:void 0)},Z=d?.columnIndex===L&&d?.entity.id===W.id,ie=Z&&b,G=st({property:V,customFieldValidator:u?({name:U,value:ee,property:ae})=>u({name:U,value:ee,property:ae,entityId:W.id}):void 0,name:D}),ye=s?U=>s({...U,entity:W}):void 0;return W?t.jsx(Na,{size:l,align:E.align,name:D,validation:G,onValueChange:ye,selected:Z,focused:ie,setPreventOutsideClick:C,setFocused:y,value:W?.values?W.values[D]:void 0,property:V,openPopup:te,select:j,width:E.width,height:E.height,entityId:W.id,entityValues:W.values},`table_cell_${D}_${H}_${L}`):t.jsx(Fe,{property:V,size:Be(l)})}else return t.jsx(Ut,{size:l,value:W.values[D],align:E.align,disabled:!0,children:t.jsx(de,{width:E.width,height:E.height,name:`preview_${D}_${H}_${L}`,property:V,value:W.values[D],size:Be(l)})},`preview_cell_${D}_${H}_${L}`)},O=({column:E,columnIndex:L,rowData:F,rowIndex:H})=>{const W=F,D=m[E.dataKey],Y=D.dependencies?Object.entries(W.values).filter(([V,K])=>D.dependencies.includes(V)).reduce((V,K)=>({...V,...K}),{}):void 0;return t.jsx(Ut,{value:Y,focused:!1,selected:!1,disabled:!0,size:l,align:"left",allowScroll:!1,showExpandIcon:!1,disabledTooltip:"Additional columns can't be edited directly",children:t.jsx(re,{children:D.builder({entity:W,context:c})})})},T=Object.keys(M.properties).map(E=>{const L=M.properties[E];return{key:E,property:L,align:la(L),icon:F=>lt(L,F?void 0:"disabled","small"),label:L.title||E,sortable:!0,filter:P(L),width:Ro(L),cellRenderer:q}});if(o){const E=o.map(L=>({key:L.id,type:"additional",align:"left",sortable:!1,label:L.title,width:L.width??200,cellRenderer:O}));T.push(...E)}const I=r.map(E=>T.find(L=>L.key===E)).filter(E=>!!E),A=u?({name:E,value:L,property:F})=>u({name:E,value:L,property:F,entityId:d?.entity.id}):void 0,$=t.jsx(ds,{open:Boolean(h),onClose:k,cellRect:h?.cellRect,columnIndex:h?.columnIndex,name:h?.name,schemaResolver:h?.schemaResolver,entity:h?.entity,tableKey:w.current,customFieldValidator:A,path:i,onCellValueChange:s,setPreventOutsideClick:C});return{columns:I,popupFormField:$}}const hs=50,gs=bt.makeStyles(e=>J.default({root:{height:"100%",width:"100%",display:"flex",flexDirection:"column"}})),Zt=N.default.memo(bs,ps);function ps(e,o){return e.path===o.path&&e.collection===o.collection&&e.title===o.title&&e.toolbarActionsBuilder===o.toolbarActionsBuilder&&e.tableRowActionsBuilder===o.tableRowActionsBuilder&&e.inlineEditing===o.inlineEditing}function bs({path:e,collection:o,schemaResolver:r,inlineEditing:i,toolbarActionsBuilder:n,title:l,tableRowActionsBuilder:s,entitiesDisplayedFirst:u,onEntityClick:c,onColumnResize:d,onSizeChanged:g,hoverRow:h=!0}){const f=ce(),b=_e(),y=Pe(),v=a.useTheme(),C=a.useMediaQuery(v.breakpoints.up("md")),[w,m]=N.default.useState(o.defaultSize??"m"),S=o.initialFilter,_=o.initialSort,k=o.filterCombinations,B=o.textSearchEnabled,P=o.pagination===void 0||Boolean(o.pagination),M=typeof o.pagination=="number"?o.pagination:hs,[q,O]=N.default.useState(P?M:void 0),[T,I]=N.default.useState(S||{}),[A,$]=N.default.useState(_),E=!!T&&Object.keys(T).length>0,L=gs(),F=p.useMemo(()=>{const ue=o.subcollections?.map(ge=>({id:er(ge),title:ge.name,width:200,dependencies:[],builder:({entity:Ge})=>t.jsx(a.Button,{color:"primary",onClick:Re=>{Re.stopPropagation(),y.open({path:e,entityId:Ge.id,selectedSubpath:ge.path,permissions:o.permissions,schema:r,subcollections:o.subcollections,callbacks:o.callbacks,overrideSchemaRegistry:!1})},children:(ge.buttonContent&&ge.buttonContent({entity:Ge}))??ge.name})}))??[];return[...o.additionalColumns??[],...ue]},[o,e]),H=p.useMemo(()=>r({}),[]),W=aa(o,H,!0),D=p.useCallback(({name:ue,value:ge,property:Ge,entityId:Re})=>b.checkUniqueField(e,ue,ge,Ge,Re),[e,b]),Y=p.useCallback(({value:ue,name:ge,setSaved:Ge,setError:Re,entity:lo})=>{const Tc={path:e,entityId:lo.id,values:{...lo.values,[ge]:ue},previousValues:lo.values,schema:r,status:"existing"};return Dt({...Tc,callbacks:o.callbacks,dataSource:b,context:f,onSaveSuccess:()=>Ge(!0),onSaveFailure:kc=>{Re(kc)}})},[e,o,r]),{columns:V,popupFormField:K}=fs({schemaResolver:r,additionalColumns:F,displayedProperties:W,path:e,inlineEditing:i,size:w,onCellValueChange:Y,uniqueFieldValidator:D}),[te,j]=N.default.useState(),{data:Z,dataLoading:ie,noMoreToLoad:R,dataLoadingError:G}=Ot({entitiesDisplayedFirst:u,path:e,schemaResolver:r,filterValues:T,sortBy:A,searchString:te,itemCount:q}),ye=p.useMemo(()=>n&&n({size:w,data:Z}),[n,w,Z]),U=p.useCallback(()=>{!P||ie||R||q!==void 0&&O(q+M)},[ie,q,R,M,P]),ee=p.useCallback(()=>{O(M)},[M]),ae=p.useCallback(()=>I({}),[]),gt=p.useCallback(({entry:ue,size:ge})=>s?s({entity:ue,size:ge}):t.jsx(zt,{entity:ue,size:ge,data:Z}),[s]),pt=p.useCallback(({rowData:ue})=>{},[c]),xc=p.useCallback(ue=>{g&&g(ue),m(ue)},[]),Sc=p.useCallback(ue=>j(ue),[]);return t.jsxs(a.Paper,{className:L.root,children:[t.jsx(ua,{filterIsSet:E,onTextSearch:B?Sc:void 0,clearFilter:ae,actions:ye,size:w,onSizeChanged:xc,title:l,loading:ie}),t.jsx(Sr,{data:Z,columns:V,onRowClick:pt,onEndReached:U,onResetPagination:ee,idColumnBuilder:gt,error:G,paginationEnabled:P,onColumnResize:d,frozenIdColumn:C,size:w,loading:ie,filter:T,onFilterUpdate:I,sortBy:A,onSortByUpdate:$,hoverRow:h,checkFilterCombination:(ue,ge)=>vs(ue,k,ge),collection:o}),K]})}function vs(e,o,r){const i=r?r[0]:void 0,n=r?r[1]:void 0,l=Object.values(e);if(i&&l.map(c=>c[0]).includes("=="))return!1;const s=Object.keys(e),u=s.length;return u===1&&(!i||i===s[0])?!0:!o&&u>1||i&&u===1&&s[0]!==i?!1:!!o&&o.filter(c=>!i||i in c).find(c=>Object.entries(e).every(([d,g])=>c[d]!==void 0&&(!n||c[d]===n)))!==void 0}const ys=X.default(e=>J.default({dialogBody:{flexGrow:1,overflow:"auto",minWidth:"85vw"},paper:{height:"100%"}}));function dt({onSingleEntitySelected:e,onMultipleEntitiesSelected:o,onClose:r,open:i,multiselect:n,collectionResolver:l,path:s,selectedEntityIds:u}){const c=ys(),d=_e(),g=l,h=l.schema,f=l.schemaResolver,[b,y]=p.useState();p.useEffect(()=>{let k=!1;return u?Promise.all(u.map(B=>d.fetchEntity({path:s,entityId:B,schema:f}))).then(B=>{k||y(B)}):y([]),()=>{k=!0}},[d,s,u]);const v=k=>{!n&&e?e(k):w(k)},C=()=>{!n&&e?e(null):o&&o([])},w=k=>{console.log("tooooooogle1");let B;b&&(b.map(P=>P.id).indexOf(k.id)>-1?B=b.filter(P=>P.id!==k.id):B=[...b,k],y(B),o&&o(B))},m=({entity:k,size:B})=>{const P=u&&u.indexOf(k.id)>-1;return t.jsx(zt,{entity:k,size:B,isSelected:P,selectionEnabled:n,toggleEntitySelection:w})},S=()=>t.jsx(a.Button,{onClick:C,color:"primary",children:"Clear"}),_=t.jsx(a.Typography,{variant:"h6",children:`Select ${h.name}`});return t.jsxs(a.Dialog,{onClose:r,classes:{paper:c.paper},maxWidth:"xl",scroll:"paper",open:i,children:[t.jsx("div",{className:c.dialogBody,children:b&&t.jsx(Zt,{path:s,collection:g,schemaResolver:f,inlineEditing:!1,toolbarActionsBuilder:S,onEntityClick:v,tableRowActionsBuilder:m,title:_,entitiesDisplayedFirst:b})}),t.jsx(a.Divider,{}),t.jsx(a.DialogActions,{children:t.jsx(a.Button,{onClick:k=>{k.stopPropagation(),r()},color:"primary",variant:"contained",children:"Close"})})]})}function ws({entityOrEntitiesToDelete:e,schemaResolver:o,onClose:r,open:i,callbacks:n,onEntityDelete:l,onMultipleEntitiesDelete:s,path:u,...c}){const d=_e(),g=Ue(),[h,f]=p.useState(!1),[b,y]=N.default.useState(),[v,C]=N.default.useState(),w=ce(),m=p.useMemo(()=>o({}),[]);N.default.useEffect(()=>{if(e){const I=Array.isArray(e)&&e.length===1?e[0]:e;y(I),C(Array.isArray(I))}},[e]);const S=p.useCallback(()=>{r()},[r]),_=p.useCallback(I=>{console.debug("Deleted",I)},[]),k=p.useCallback((I,A)=>{g.open({type:"error",title:`${m.name}: Error deleting`,message:A?.message}),console.error("Error deleting entity"),console.error(A)},[m.name]),B=p.useCallback((I,A)=>{g.open({type:"error",title:`${m.name}: Error before deleting`,message:A?.message}),console.error(A)},[m.name]),P=p.useCallback((I,A)=>{g.open({type:"error",title:`${m.name}: Error after deleting (entity is deleted)`,message:A?.message}),console.error(A)},[m.name]),M=p.useCallback(I=>zo({dataSource:d,entity:I,schema:m,callbacks:n,onDeleteSuccess:_,onDeleteFailure:k,onPreDeleteHookError:B,onDeleteSuccessHookError:P,context:w}),[d,m,n,_,k,B,P,w]),q=p.useCallback(async()=>{b&&(f(!0),v?Promise.all(b.map(M)).then(I=>{f(!1),s&&b&&s(u,b),I.every(Boolean)?g.open({type:"success",message:`${m.name}: multiple deleted`}):I.some(Boolean)?g.open({type:"warning",message:`${m.name}: Some of the entities have been deleted, but not all`}):g.open({type:"error",message:`${m.name}: Error deleting entities`}),r()}):M(b).then(I=>{f(!1),I&&(l&&b&&l(u,b),g.open({type:"success",message:`${m.name} deleted`}),r())}))},[b,v,M,s,u,r,g,m.name,l]);let O;if(b&&v)O=t.jsx("div",{children:"Multiple entities"});else{const I=b,A=o({entityId:I?.id,values:I?.values});O=I?t.jsx(at,{entity:I,schema:A,path:u}):t.jsx(t.Fragment,{})}const T=v?`${m.name}: Confirm multiple delete?`:`Would you like to delete this ${m.name}?`;return t.jsxs(a.Dialog,{maxWidth:"md","aria-labelledby":"delete-dialog",open:i,onBackdropClick:r,...c,children:[t.jsx(a.DialogTitle,{id:"delete-dialog-title",children:T}),!v&&t.jsx(a.DialogContent,{dividers:!0,children:O}),t.jsxs(a.DialogActions,{children:[h&&t.jsx(a.CircularProgress,{size:16,thickness:8}),t.jsx(a.Button,{onClick:S,disabled:h,color:"primary",children:"Cancel"}),t.jsx(a.Button,{autoFocus:!0,disabled:h,onClick:q,color:"primary",children:"Ok"})]})]})}function Cs(e,o,r,i,n){const l=r.properties,s=xs(l,i,n),u=ms(e,o,l,s),c=vr(s.map(g=>g.label)),d=u.map(g=>vr(g));Ss([c,...d],`${r.name}.csv`,"text/csv")}function ms(e,o,r,i){const n=e.map(l=>({id:l.id,...br(l.values,r)}));return o&&o.forEach((l,s)=>{n[s]={...n[s],...l}}),n&&n.map(l=>i.map(s=>kt(l,s.key)))}function xs(e,o,r){const i=[{label:"id",key:"id"},...Object.entries(e).map(([n,l])=>gr(l,n,"")).flat()];return r?.additionalColumns&&i.push(...r.additionalColumns.map(n=>({label:n.key,key:n.key}))),i}function gr(e,o,r=""){const i=r?`${r}.${o}`:o;return e.dataType==="map"&&e.properties?Object.entries(e.properties).map(([n,l])=>gr(l,n,i)).flat():[{label:i,key:i}]}function pr(e,o){let r;if(o.dataType==="map"&&o.properties)r=br(e,o.properties);else if(o.dataType==="array")o.of&&Array.isArray(e)?o.of.dataType==="map"?r=e.map(i=>JSON.stringify(i)):r=e.map(i=>pr(i,o.of)):r=e;else if(o.dataType==="reference"){const i=e||void 0;r=i?i.pathWithId:null}else o.dataType==="timestamp"?r=e?e.getTime():null:r=e;return r}function br(e,o){const r=Object.entries(o).map(([i,n])=>{const l=e&&e[i],s=pr(l,n);return s===void 0?{}:{[i]:s}}).reduce((i,n)=>({...i,...n}),{});return{...e,...r}}function vr(e){return e.map(o=>{if(o==null)return"";const r=String(o);return'"'+r.replaceAll('"','""')+'"'}).join(",")+`\r
`}function Ss(e,o,r){const i=new Blob(e,{type:r}),n=URL.createObjectURL(i),l=document.createElement("a");l.href=n,l.setAttribute("download",o),l.click()}const Qt=200;function Ts({schema:e,schemaResolver:o,path:r,exportConfig:i}){const n=_e(),l=ce(),s=p.useRef(),u=p.useRef(),[c,d]=N.default.useState(!1),[g,h]=N.default.useState(),[f,b]=N.default.useState(!1),[y,v]=N.default.useState(!1),[C,w]=N.default.useState(!1),m=p.useCallback(()=>{w(!0)},[w]),S=p.useCallback(()=>{w(!1)},[w]),_=p.useCallback((P,M,q,O,T,I)=>{if(!P)throw Error("Trying to perform export without loading data first");const A=O({});Cs(P,M,A,T,I)},[]);p.useEffect(()=>{if(!C)return;d(!0);const P=async O=>{O.length>=Qt&&b(!0);const T=s.current&&O.length>s.current.length&&y;s.current=O;const I=await M(O);u.current=I,d(!1),h(void 0),T&&(_(O,I,e,o,r,i),S())},M=async O=>{if(!i?.additionalColumns)return;const T=i.additionalColumns;return await Promise.all(O.map(async A=>(await Promise.all(T.map(async $=>({[$.key]:await $.builder({entity:A,context:l})})))).reduce(($,E)=>({...$,...E}),{})))},q=O=>{console.error("ERROR",O),d(!1),h(O)};n.fetchCollection({path:r,schema:o,limit:y?void 0:Qt}).then(P).catch(q)},[r,y,e,C,n,o,_,i,S,l]);const k=f&&!y,B=p.useCallback(()=>{k?v(!0):(_(s.current,u.current,e,o,r,i),S())},[k,_,e,o,r,i,S]);return t.jsxs(t.Fragment,{children:[t.jsx(a.Tooltip,{title:"Export",children:t.jsx(a.IconButton,{color:"primary",onClick:m,size:"large",children:t.jsx(ui.default,{})})}),t.jsxs(a.Dialog,{open:C,onClose:S,children:[t.jsx(a.DialogTitle,{children:"Export data"}),t.jsx(a.DialogContent,{children:t.jsxs(a.DialogContentText,{children:[t.jsx("div",{children:"Download the the content of this table as a CSV"}),t.jsx("br",{}),k&&t.jsxs(a.Alert,{elevation:1,variant:"filled",severity:"warning",children:[t.jsxs("div",{children:["This collections has a large number of documents (more than ",Qt,")."]}),t.jsx("div",{children:"Would you like to proceed?"})]})]})}),t.jsxs(a.DialogActions,{children:[c&&t.jsx(a.CircularProgress,{size:16,thickness:8}),t.jsx(a.Button,{color:"primary",onClick:S,children:"Cancel"}),t.jsx(a.Button,{color:"primary",disabled:c,onClick:B,children:"Download"})]})]})]})}const ut={edit:!0,create:!0,delete:!0};function Rt(e,o,r,i,n){if(e===void 0)return ut;if(typeof e=="object")return e;if(typeof e=="function")return e({user:r.user,authController:r,entity:o,path:i,context:n});throw Error("New type of HasPermission added and not mapped")}function eo(e,o,r,i,n){return Rt(e,o,r,i,n).edit??ut.edit}function yr(e,o,r,i){return Rt(e,null,o,r,i).create??ut.create}function wr(e,o,r,i,n){return Rt(e,o,r,i,n).delete??ut.delete}function to(e){const[o,r]=p.useState([]),i=Ot({path:e.path,schemaResolver:e.schemaResolver}),n=p.useCallback(c=>{console.log("tooooooogle2",c);let d;o.map(g=>g.id).includes(c.id)?d=o.filter(g=>g.id!==c.id):d=[...o,c],console.log("newValue A",d),r(d)},[o]),l=p.useCallback(c=>{console.log("collection1",e),console.log("kjkkkkkkkk",i),console.log("selectedEntities A",o);let d=i;if(d.data.length||(d=i),o.length===d.data.length&&o.length!==0)r([]);else if(d.data){const g=d.data;r(g)}console.log("selectedEntities B",o)},[o]),s=p.useCallback(c=>o.map(d=>d.id).includes(c.id),[o]),u=p.useCallback(()=>(console.log("selectedEntities.length1",o.length),console.log("data1.data.length1",i.data.length),console.log("selectedEntities.length === data1.data.length",o.length===i.data.length),o.length===i.data.length&&o.length!==0),[o,i]);return{selectedEntities:o,setSelectedEntities:r,isEntitySelected:s,isAllEntitiesSelected:u,toggleEntitySelection:n,selectAll:l}}function ft({path:e,collection:o}){const r=Pe(),i=ce(),n=Qe(),l=Se(),s=a.useTheme(),u=a.useMediaQuery(s.breakpoints.up("md")),[c,d]=N.default.useState(void 0),g=l.getCollectionResolver(e);if(!g)throw Error(`Couldn't find the corresponding collection view for the path: ${e}`);const h=p.useCallback(V=>{l.onCollectionModifiedForUser(e,V)},[e]),f=g??o,{schemaResolver:b}=g,y=f.exportable===void 0||f.exportable,v=f.selectionEnabled===void 0||f.selectionEnabled,C=f.inlineEditing!==void 0&&!f.inlineEditing,[w,m]=N.default.useState(null),S=to(f),_=f.selectionController??S,{selectedEntities:k,toggleEntitySelection:B,selectAll:P,isAllEntitiesSelected:M,isEntitySelected:q,setSelectedEntities:O}=_;p.useEffect(()=>{d(void 0)},[k]);const T=p.useCallback(V=>r.open({entityId:V.id,path:e,permissions:f.permissions,schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1}),[e,f,r]),I=p.useCallback(V=>(V.stopPropagation(),r.open({path:e,permissions:f.permissions,schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1})),[e,f,r]),A=p.useCallback((V,K)=>{O(k.filter(te=>te.id!==K.id))},[k,O]),$=p.useCallback((V,K)=>{O([]),d(void 0)},[O]),E=p.useCallback(V=>eo(f.permissions,V,n,e,i)?f.inlineEditing===void 0||f.inlineEditing:!1,[f.inlineEditing,f.permissions,e]),L=p.useCallback(({width:V,key:K})=>{if(!f.schema.properties[K])return;const te={columnWidth:V},j={schema:{properties:{[K]:te}}};h&&h(j)},[f.schema.properties,h]),F=p.useCallback(V=>{h&&h({defaultSize:V})},[h]),H=w!=null,W=p.useMemo(()=>t.jsxs("div",{style:{padding:"4px"},children:[t.jsx(a.Typography,{variant:"h6",style:{lineHeight:"1.0",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"160px",cursor:f.description?"pointer":"inherit"},onClick:f.description?V=>{m(V.currentTarget),V.stopPropagation()}:void 0,children:`${f.name}`}),t.jsx(a.Typography,{style:{display:"block",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"160px",direction:"rtl",textAlign:"left"},variant:"caption",color:"textSecondary",children:`/${e}`}),f.description&&t.jsx(a.Popover,{id:"info-dialog",open:H,anchorEl:w,elevation:1,onClose:()=>{m(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(a.Box,{m:2,children:t.jsx(nt,{source:f.description})})})]}),[f.description,f.name,e,H,w]),D=p.useCallback(({entity:V,size:K})=>{const te=q(V),j=M(),Z=yr(f.permissions,n,e,i),ie=eo(f.permissions,V,n,e,i),R=wr(f.permissions,V,n,e,i),G=U=>r.open({entityId:U.id,path:e,copy:!0,permissions:{edit:ie,create:Z,delete:R},schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1}),ye=U=>r.open({entityId:U.id,path:e,permissions:{edit:ie,create:Z,delete:R},schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1});return t.jsx(zt,{entity:V,isSelected:te,isAllSelected:j,selectionEnabled:v,size:K,toggleEntitySelection:B,selectAll:P,onEditClicked:ye,onCopyClicked:Z?G:void 0,onDeleteClicked:R?d:void 0})},[_,r,f.permissions,n,e]),Y=p.useCallback(V=>{const K=yr(f.permissions,n,e,i)&&I&&(u?t.jsxs(a.Button,{onClick:I,startIcon:t.jsx(Oe.Add,{}),size:"large",variant:"contained",color:"primary",children:["Add ",f.schema.name]}):t.jsx(a.Button,{onClick:I,size:"medium",variant:"contained",color:"primary",children:t.jsx(Oe.Add,{})})),te=k.every(G=>wr(f.permissions,G,n,e,i)),j=G=>{G.stopPropagation(),d(k)},Z=v&&t.jsx(a.Tooltip,{title:te?"Multiple delete":"You have selected one entity you cannot delete",children:t.jsxs("span",{children:[u&&t.jsx(a.Button,{disabled:!k?.length||!te,startIcon:t.jsx(Oe.Delete,{}),onClick:j,color:"primary",children:t.jsxs("p",{style:{minWidth:24},children:["(",k?.length,")"]})}),!u&&t.jsx(a.IconButton,{color:"primary",disabled:!k?.length||!te,onClick:j,size:"large",children:t.jsx(Oe.Delete,{})})]})}),ie=f.extraActions?f.extraActions({path:e,collection:f,selectionController:_,context:i}):void 0,R=y&&t.jsx(Ts,{schema:f.schema,schemaResolver:b,exportConfig:typeof f.exportable=="object"?f.exportable:void 0,path:e});return t.jsxs(t.Fragment,{children:[ie,Z,R,K]})},[_,e,f,u]);return t.jsxs(t.Fragment,{children:[t.jsx(Zt,{title:W,path:e,collection:f,schemaResolver:b,onSizeChanged:F,inlineEditing:E,onEntityClick:T,onColumnResize:L,tableRowActionsBuilder:D,toolbarActionsBuilder:Y,hoverRow:C},`collection_table_${e}`),c&&t.jsx(ws,{entityOrEntitiesToDelete:c,path:e,schema:f.schema,schemaResolver:b,callbacks:f.callbacks,open:!!c,onEntityDelete:A,onMultipleEntitiesDelete:$,onClose:()=>d(void 0)})]})}var ks=Object.freeze(Object.defineProperty({__proto__:null,useSelectionController:to,EntityCollectionView:ft,default:ft},Symbol.toStringTag,{value:"Module"}));function Ee(e){return t.jsx(a.Box,{display:"flex",width:"100%",maxHeight:"100%",height:"100vh",children:t.jsx(a.Box,{m:"auto",children:t.jsx(a.CircularProgress,{...e})})})}const _s=X.default(e=>J.default({card:{display:"flex",flexDirection:"column",alignItems:"flex-start",minHeight:248},flexGrow:{flexGrow:1}}));function Cr(){const e=_s(),o=Se();if(!o.navigation)return t.jsx(t.Fragment,{});const{navigationEntries:r,groups:i}=ko(o,!1),n=[...i];r.filter(s=>!s.group).length>0&&n.push(null);function l(s){return t.jsx(a.Grid,{item:!0,xs:12,sm:6,md:4,children:t.jsx(a.Paper,{variant:"outlined",children:t.jsxs(a.CardActionArea,{className:e.card,component:se.Link,to:s.url,children:[t.jsxs(a.CardContent,{className:e.flexGrow,children:[t.jsx(vi.default,{color:"disabled"}),t.jsx(a.Typography,{gutterBottom:!0,variant:"h5",component:"h2",children:s.name}),s.description&&t.jsx(a.Typography,{variant:"body2",color:"textSecondary",component:"div",children:t.jsx(nt,{source:s.description})})]}),t.jsx(a.CardActions,{style:{alignSelf:"flex-end"},children:t.jsx(a.Box,{p:1,children:t.jsx(bi.default,{color:"primary"})})})]})})},`nav_${s.group}_${s.name}`)}return t.jsx(a.Container,{children:n.map((s,u)=>t.jsxs(a.Box,{mt:6,mb:6,children:[n.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(a.Typography,{color:"textSecondary",className:"weight-500",children:s?.toUpperCase()??"Collections".toUpperCase()}),t.jsx(a.Divider,{})]}),t.jsx(a.Box,{mt:2,children:t.jsxs(a.Grid,{container:!0,spacing:2,children:[s&&r.filter(c=>c.group===s).map(c=>l(c)),!s&&r.filter(c=>!c.group).map(c=>l(c))]})})]},`group_${u}`))})}const Es={name:"1oajfbb",styles:"& .BaseTable{box-shadow:0 2px 4px 0 rgba(128, 128, 128, 0.2);contain:strict;position:relative;box-sizing:border-box;font-size:13px;}& .BaseTable--disabled{opacity:0.7;pointer-events:none;}& .BaseTable--dynamic .BaseTable__row{overflow:hidden;align-items:stretch;}& .BaseTable:not(.BaseTable--dynamic) .BaseTable__row-cell-text,& .BaseTable .BaseTable__row--frozen .BaseTable__row-cell-text{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}& .BaseTable__table{position:absolute;top:0;display:flex;flex-direction:column-reverse;}& .BaseTable__table-main{outline:1px solid rgba(128, 128, 128, 0.1);left:0;}& .BaseTable__table-main .BaseTable__header-cell:first-of-type,.BaseTable__table-main .BaseTable__row-cell:first-of-type{padding:0;}& .BaseTable__table-frozen-left .BaseTable__body{backdrop-filter:blur(4px);}& .BaseTable__table-frozen-left .BaseTable__header,& .BaseTable__table-frozen-left .BaseTable__body,.BaseTable__table-frozen-right .BaseTable__header,& .BaseTable__table-frozen-right .BaseTable__body{overflow:hidden!important;}& .BaseTable__table-frozen-left{box-shadow:2px 0 4px 0 rgba(128, 128, 128, 0.1);top:0;left:0;}& .BaseTable__table-frozen-left .BaseTable__header-cell:first-of-type,.BaseTable__table-frozen-left .BaseTable__row-cell:first-of-type{padding:0;}& .BaseTable__table-frozen-left .BaseTable__header-row,& .BaseTable__table-frozen-left .BaseTable__row{padding-right:0!important;}& .BaseTable__table-frozen-left .BaseTable__body{overflow-y:auto!important;}& .BaseTable__table-frozen-right{box-shadow:-2px 0 4px 0 rgba(128, 128, 128, 0.3);top:0;right:0;}& .BaseTable__table-frozen-right .BaseTable__header-cell:last-child,.BaseTable__table-frozen-right .BaseTable__row-cell:last-child{padding-right:15px;}& .BaseTable__table-frozen-right .BaseTable__header-row,& .BaseTable__table-frozen-right .BaseTable__row{padding-left:0!important;}& .BaseTable__table-frozen-right .BaseTable__body{overflow-y:auto!important;}& .BaseTable__header{overflow:hidden!important;}& .BaseTable .BaseTable__header,& .BaseTable .BaseTable__body{outline:none;}& .BaseTable__header-row,.BaseTable__row{display:flex;align-items:center;border-bottom:1px solid rgba(128, 128, 128, 0.1);box-sizing:border-box;}& .BaseTable__header-row{font-weight:700;}& .BaseTable__row{}& .BaseTable__row:hover,.BaseTable__row--hovered{}& .BaseTable__row-expanded{}& .BaseTable__header-cell,.BaseTable__row-cell{min-width:0;height:100%;display:flex;align-items:center;padding:0 7.5px;box-sizing:border-box;}& .BaseTable__header-cell--align-center,.BaseTable__row-cell--align-center{justify-content:center;text-align:center;}& .BaseTable__header-cell--align-right,.BaseTable__row-cell--align-right{justify-content:flex-end;text-align:right;}& .BaseTable__header-cell{position:relative;cursor:default;}& .BaseTable__header-cell:hover .BaseTable__column-resizer{visibility:visible;opacity:0.5;}& .BaseTable__header-cell:hover .BaseTable__column-resizer:hover{opacity:1;}& .BaseTable__header-cell .BaseTable__sort-indicator{display:none;}& .BaseTable__header-cell--sortable:hover{background-color:#f3f3f3;cursor:pointer;}& .BaseTable__header-cell--sortable:not(.BaseTable__header-cell--sorting):hover .BaseTable__sort-indicator{display:block;color:#888888;}& .BaseTable__header-cell--sorting .BaseTable__sort-indicator,.BaseTable__header-cell--sorting:hover .BaseTable__sort-indicator{display:block;}& .BaseTable__header-cell--resizing .BaseTable__column-resizer{visibility:visible;opacity:1;}& .BaseTable__header-cell--resizing .BaseTable__column-resizer::after{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;content:'';left:-9999px;}& .BaseTable__header-cell-text{overflow:hidden;text-overflow:ellipsis;white-space:normal;}& .BaseTable__header-row--resizing .BaseTable__header-cell{background-color:transparent;cursor:col-resize;}& .BaseTable__header-row--resizing .BaseTable__header-cell:not(.BaseTable__header-cell--sorting) .BaseTable__sort-indicator{display:none;}& .BaseTable__header-row--resizing .BaseTable__header-cell:not(.BaseTable__header-cell--resizing) .BaseTable__column-resizer{visibility:hidden;}& .BaseTable__column-resizer{width:3px;visibility:hidden;background-color:#cccccc;}& .BaseTable__column-resizer:hover{visibility:visible;opacity:1;}& .BaseTable__footer{position:absolute;left:0;right:0;bottom:0;overflow:hidden;background-color:#ffffff;}& .BaseTable__resizing-line{cursor:col-resize;position:absolute;top:0;background-color:#cccccc;width:3px;transform:translateX(-100%);}& .BaseTable__empty-layer{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;}& .BaseTable__overlay{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;pointer-events:none;}& .BaseTable__overlay>*{pointer-events:auto;}"},Is={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"in","array-contains":"Contains","array-contains-any":"Any"},oo=["array-contains-any","in"];function Bs({name:e,value:o,setValue:r,dataType:i,isArray:n,enumValues:l,title:s}){const u=n?["array-contains"]:["==","!=",">","<",">=","<="];l&&(n?u.push("array-contains-any"):u.push("in"));const[c,d]=o||[u[0],void 0],[g,h]=p.useState(c),[f,b]=p.useState(d);function y(C,w){let m=w;const S=oo.includes(g),_=oo.includes(C);S!==_&&(m=_?typeof w=="string"||typeof w=="number"?[w]:[]:""),typeof m=="number"&&isNaN(m)&&(m=void 0),h(C),b(m);const k=m!==null&&Array.isArray(m)?m.length>0:m!==void 0;r(C&&k?[C,m]:void 0)}const v=oo.includes(g);return t.jsxs(a.Box,{display:"flex",width:340,alignItems:"center",children:[t.jsx(a.Box,{width:80,children:t.jsx(a.FormControl,{fullWidth:!0,children:t.jsx(a.Select,{value:g,fullWidth:!0,onChange:C=>{y(C.target.value,f)},children:u.map(C=>t.jsx(a.MenuItem,{value:C,children:Is[C]},`filter_op_${e}_${C}`))})})}),t.jsx(a.Box,{flexGrow:1,ml:1,children:t.jsxs(a.FormControl,{fullWidth:!0,children:[!l&&t.jsx(a.OutlinedInput,{fullWidth:!0,type:i==="number"?"number":void 0,value:f!==void 0?f:"",onChange:C=>{const w=i==="number"?parseFloat(C.target.value):C.target.value;y(g,w)}},`filter_${e}`),l&&t.jsx(a.Select,{fullWidth:!0,multiple:v,value:f!==void 0?f:n?[]:"",onChange:C=>y(g,i==="number"?parseInt(C.target.value):C.target.value),renderValue:v?C=>t.jsx("div",{children:C.map(w=>t.jsx(xe,{enumKey:w,enumValues:l,small:!0},`select_value_${e}_${w}`))}):void 0,children:Object.entries(l).map(([C,w])=>t.jsx(a.MenuItem,{value:C,children:t.jsx(xe,{enumKey:C,enumValues:l,small:!0})},`select_${e}_${C}`))},`filter-select-${v}-${e}`)]})}),f!==void 0&&t.jsx(a.Box,{ml:1,children:t.jsx(a.IconButton,{onClick:C=>y(g,void 0),size:"small",children:t.jsx(bo.default,{title:`Clear ${s}`,children:t.jsx(Ie.default,{fontSize:"small"})})})})]})}const Ps=X.default(e=>J.default({formControl:{width:"200px"},label:{width:"100%",height:"100%"}}));function Fs({name:e,title:o,value:r,setValue:i}){const n=Ps();function l(c){i(c!==void 0?["==",c]:void 0)}const s=r&&r[1],u=!!r;return t.jsx(a.FormControlLabel,{className:n.formControl,labelPlacement:"end",checked:u&&s,control:t.jsx(a.Checkbox,{indeterminate:!u,onChange:c=>{l(s?!1:u?void 0:!0)}},`filter-${e}`),label:u?s?`${o} is true`:`${o} is false`:"No filter"})}const As={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"in","array-contains":"Contains","array-contains-any":"Any"},mr=["array-contains-any","in"];function Os({name:e,isArray:o,value:r,setValue:i,title:n}){const l=o?["array-contains"]:["==","!=",">","<",">=","<="],[s,u]=r||[l[0],void 0],[c,d]=p.useState(s),[g,h]=p.useState(u);function f(b,y){let v=y;const C=mr.includes(c),w=mr.includes(b);C!==w&&(v=w?y?[y]:[]:""),d(b),h(v===null?void 0:v);const m=v!==null&&Array.isArray(v)?v.length>0:v!==void 0;i(b&&m?[b,v]:void 0)}return t.jsxs(a.Box,{display:"flex",width:340,alignItems:"center",children:[t.jsx(a.Box,{width:80,children:t.jsx(a.FormControl,{fullWidth:!0,children:t.jsx(a.Select,{value:c,fullWidth:!0,onChange:b=>{f(b.target.value,g)},children:l.map(b=>t.jsx(a.MenuItem,{value:b,children:As[b]},`filter_op_${e}_${b}`))})})}),t.jsx(a.Box,{flexGrow:1,ml:1,children:t.jsx(Ct.default,{clearable:!0,InputProps:{},renderInput:b=>t.jsx(a.Input,{startAdornment:t.jsx(xi.default,{fontSize:"small"})}),value:g??null,onChange:b=>{f(c,b===null?void 0:b)}})}),g!==void 0&&t.jsx(a.Box,{ml:1,children:t.jsx(a.IconButton,{onClick:b=>f(c,void 0),size:"small",children:t.jsx(bo.default,{title:`Clear ${n}`,children:t.jsx(Ie.default,{fontSize:"small"})})})})]})}const xr=X.default(e=>J.default({header:({onHover:o})=>({width:"calc(100% + 24px)",margin:"0px -12px",padding:"0px 12px",color:o?e.palette.text.primary:e.palette.text.secondary,backgroundColor:o?a.darken(e.palette.background.default,.05):e.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600}),headerInternal:({align:o})=>({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:o==="right"?"flex-end":o==="center"?"center":"flex-start"}),headerTitle:({align:o})=>({overflow:"hidden",flexShrink:1}),headerTitleInternal:({align:o})=>({margin:"0px 4px",overflow:"hidden",justifyContent:o,flexShrink:1}),headerIcon:{paddingTop:"4px"},headerIconButton:{backgroundColor:e.palette.mode==="light"?"#f5f5f5":e.palette.background.default},headerTypography:{fontSize:"0.750rem",fontWeight:600,textTransform:"uppercase"}})),$s=N.default.memo(Ds);function Ds({sort:e,onColumnSort:o,onFilterUpdate:r,filter:i,column:n}){const[l,s]=p.useState(!1),u=p.useRef(null),c=xr({onHover:l,align:n.align}),[d,g]=N.default.useState(!1),h=p.useCallback(y=>{g(!0)},[]),f=p.useCallback(()=>{g(!1)},[]),b=p.useCallback(y=>{r(y),g(!1)},[]);return t.jsxs(re,{children:[t.jsxs(a.Grid,{className:c.header,ref:u,wrap:"nowrap",alignItems:"center",onMouseEnter:()=>s(!0),onMouseMove:()=>s(!0),onMouseLeave:()=>s(!1),container:!0,children:[t.jsx(a.Grid,{item:!0,xs:!0,className:c.headerTitle,children:t.jsxs("div",{className:c.headerInternal,children:[t.jsx("div",{className:c.headerIcon,children:n.icon&&n.icon(l||d)}),t.jsx("div",{className:c.headerTitleInternal,children:n.label})]})}),n.sortable&&(e||l||d)&&t.jsx(a.Grid,{item:!0,children:t.jsx(a.Badge,{color:"secondary",variant:"dot",overlap:"circular",invisible:!e,children:t.jsxs(a.IconButton,{size:"small",className:c.headerIconButton,onClick:()=>{o(n.key)},children:[!e&&t.jsx(po.default,{fontSize:"small"}),e==="asc"&&t.jsx(po.default,{fontSize:"small"}),e==="desc"&&t.jsx(Ci.default,{fontSize:"small"})]})})}),n.filter&&t.jsx(a.Grid,{item:!0,children:t.jsx(a.Badge,{color:"secondary",variant:"dot",overlap:"circular",invisible:!i,children:t.jsx(a.IconButton,{className:c.headerIconButton,size:"small",onClick:h,children:t.jsx(mi.default,{fontSize:"small",color:l||d?void 0:"disabled"})})})})]}),n.sortable&&t.jsx(a.Popover,{id:d?`popover_${n.key}`:void 0,open:d,elevation:2,anchorEl:u.current,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsx(Ls,{column:n,filter:i,onFilterUpdate:b})})]})}function Ls({column:e,onFilterUpdate:o,filter:r}){const i=e.key,n=xr({}),[l,s]=p.useState(r),u=h=>{o(l)},c=h=>{o(void 0)},d=!!r;function g(h,f,b,y){if(f.dataType==="number"||f.dataType==="string"){const v=f.dataType,C=f.title,w=f.enumValues;return t.jsx(Bs,{value:b,setValue:y,name:h,dataType:v,isArray:f.isArray,enumValues:w,title:C})}else if(f.dataType==="boolean"){const v=f.title;return t.jsx(Fs,{value:b,setValue:y,name:h,title:v})}else if(f.dataType==="timestamp"){const v=f.title;return t.jsx(Os,{value:b,setValue:y,name:h,isArray:f.isArray,title:v})}return t.jsx("div",{children:`Currently the field ${f.dataType} is not supported`})}return t.jsxs(t.Fragment,{children:[t.jsx(a.Box,{p:2,className:n.headerTypography,children:e.label??i}),t.jsx(a.Divider,{}),e.filter&&t.jsx(a.Box,{p:2,children:g(i,e.filter,l,s)}),t.jsxs(a.Box,{display:"flex",justifyContent:"flex-end",m:2,children:[t.jsx(a.Box,{mr:1,children:t.jsx(a.Button,{disabled:!d,color:"primary",type:"reset","aria-label":"filter clear",onClick:c,children:"Clear"})}),t.jsx(a.Button,{variant:"outlined",color:"primary",onClick:u,children:"Filter"})]})]})}const Ms=1200,Ns=X.default(e=>J.default({tableContainer:{width:"100%",height:"100%",flexGrow:1},header:{width:"calc(100% + 24px)",margin:"0px -12px",padding:"0px 12px",color:e.palette.text.secondary,backgroundColor:e.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600},tableRow:{cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.875rem"},tableRowClickable:{"&:hover":{backgroundColor:e.palette.mode==="dark"?a.alpha(e.palette.background.default,.6):a.alpha(e.palette.background.default,.5)}},column:{padding:"0px !important"}}));function Sr({data:e,idColumnBuilder:o,onResetPagination:r,onEndReached:i,size:n,columns:l,frozenIdColumn:s,onRowClick:u,onColumnResize:c,filter:d,checkFilterCombination:g,collection:h,onFilterUpdate:f,sortBy:b,error:y,emptyMessage:v,onSortByUpdate:C,loading:w,hoverRow:m=!0}){const S=b?b[0]:void 0,_=b?b[1]:void 0,[k,B]=N.default.useState(),P=p.useRef(null),M=p.useRef(0),q=p.useRef(0),O=Ns();p.useEffect(()=>{P.current&&e?.length&&P.current.scrollToTop(M.current)},[e?.length]);const T=R=>{const G=S===R&&_==="desc",U=S===R&&_==="asc"?"desc":G?void 0:"asc",ee=G?void 0:R,ae=U&&ee?[ee,U]:void 0;d&&g&&!g(d,ae)&&f&&f(void 0),r&&r(),C&&C(ae),D()},A=Se().getCollectionResolver(h.path);console.log("collcollcoll",A),console.log("selectionController",A.selectionController);const[$,E]=N.default.useState(),[L,F]=N.default.useState(),H=()=>{console.log("entityOrEntitiesentityOrEntities",$),console.log("multipleEntitiesmultipleEntities",L),console.log("{idColumnBuilder}",o)},W=()=>{C&&C(void 0)},D=()=>{P.current&&(M.current=0,P.current.scrollToTop(0))};console.log("idColumnBuilder",o);const Y=({scrollTop:R,scrollUpdateWasRequested:G})=>{const ye=Date.now()-q.current>3e3;!G&&ye&&(M.current=R)},V=()=>{q.current=Date.now(),i&&i()},K=R=>{!u||u(R)},te=({columnIndex:R})=>{const G=l[R-1],ye=G&&d&&d[G.key]?d[G.key]:void 0,U=ee=>{let ae=d?{...d}:{};ee?ae[G.key]=ee:delete ae[G.key],!g||g(ae,S&&_?[S,_]:void 0)||(ae=ee?{[G.key]:ee}:{}),f&&f(ae),G.key!==S&&W()};return t.jsx(re,{children:R===0?t.jsxs("div",{className:O.header,style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",padding:0},children:[t.jsx("p",{style:{margin:0,width:"45px"},children:"ID"}),t.jsx(a.Checkbox,{checked:!1,onChange:H})]}):t.jsx($s,{onFilterUpdate:U,filter:ye,sort:S===G.key?_:void 0,onColumnSort:T,column:G})})};function j(){return t.jsxs(a.Box,{display:"flex",flexDirection:"column",justifyContent:"center",margin:6,children:[t.jsx(a.Typography,{variant:"h6",children:"Error fetching data from the data source"}),y?.name&&t.jsx(a.Typography,{children:y?.name}),y?.message&&t.jsx(a.Typography,{children:y?.message})]})}function Z(){return w?t.jsx(Ee,{}):t.jsxs(a.Box,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:2,children:[t.jsx(a.Box,{padding:1,children:t.jsx(wi.default,{})}),t.jsx(a.Typography,{children:v})]})}const ie=p.useCallback(({column:R,width:G})=>{c&&c({width:G,key:R.key,column:R})},[c]);return t.jsx(t.Fragment,{children:t.jsx(go.default,{bounds:!0,onResize:B,children:({measureRef:R})=>t.jsx("div",{ref:R,className:O.tableContainer,css:Es,children:k?.bounds&&t.jsxs(yi.default,{rowClassName:fe.default(O.tableRow,{[O.tableRowClickable]:m}),data:e,onColumnResizeEnd:ie,width:k.bounds.width,height:k.bounds.height,emptyRenderer:y?j():Z(),fixed:!0,ignoreFunctionInColumnCompare:!1,rowHeight:Vt(n),ref:P,onScroll:Y,overscanRowCount:2,onEndReachedThreshold:Ms,onEndReached:V,rowEventHandlers:{onClick:K},children:[t.jsx(vt.Column,{headerRenderer:te,cellRenderer:({rowData:G})=>o?o({size:n,entry:G}):null,align:"center",dataKey:"id",flexShrink:0,frozen:s?"left":void 0,width:160},"header-id"),l.map(G=>t.jsx(vt.Column,{title:G.label,className:O.column,headerRenderer:te,cellRenderer:G.cellRenderer,height:Vt(n),align:G.align,flexGrow:1,flexShrink:0,resizable:!0,size:n,dataKey:G.key,width:G.width},G.key))]})})})})}const Tr=()=>p.useContext(xo);function qs(){return t.jsx(a.Box,{display:"flex",width:"100%",height:"100%",children:t.jsxs(a.Box,{m:"auto",children:[t.jsx(a.Typography,{variant:"h4",align:"center",gutterBottom:!0,children:"Page not found"}),t.jsx(a.Typography,{align:"center",children:"This page does not exist or you may not have access to it"})]})})}function kr({HomePage:e}){const o=se.useLocation(),r=Se(),i=r.navigation;if(!i)return t.jsx(t.Fragment,{});const n=o.state,l=n&&n.base_location?n.base_location:o,s=[];if(i.views){const g=(h,f)=>t.jsx(se.Route,{path:h,element:t.jsx(ro,{path:h,title:f.name,children:f.view},`navigation_${h}`)},"navigation_view_"+h);i.views.forEach(h=>{Array.isArray(h.path)?s.push(...h.path.map(f=>g(f,h))):s.push(g(h.path,h))})}const u=[...i.collections].sort((g,h)=>h.path.length-g.path.length).map(g=>{const h=r.buildUrlCollectionPath(g.path);return t.jsx(se.Route,{path:h+"/*",element:t.jsx(ro,{path:h,title:g.name,children:t.jsx(ft,{path:g.path,collection:g})})},`navigation_${g.path}`)}),c=t.jsx(se.Route,{path:"/",element:t.jsx(ro,{path:"/",title:"Home",children:e?t.jsx(e,{}):t.jsx(Cr,{})},"navigation_home")}),d=t.jsx(se.Route,{path:"*",element:t.jsx(qs,{})});return t.jsxs(se.Routes,{location:l,children:[u,s,c,d]})}function ro({children:e,title:o,path:r}){const i=Tr();return N.default.useEffect(()=>{i.set({breadcrumbs:[{title:o,url:r}]})},[r,o]),t.jsx(t.Fragment,{children:e})}function _r(){return t.jsxs("svg",{width:"232",height:"232",viewBox:"0 0 599 599",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[t.jsxs("defs",{children:[t.jsxs("radialGradient",{cx:"28.6213569%",cy:"43.1133328%",fx:"28.6213569%",fy:"43.1133328%",r:"71.5003456%",gradientTransform:"translate(0.286214,0.431133),rotate(3.343450),scale(1.000000,0.996175),translate(-0.286214,-0.431133)",id:"radialGradient-1",children:[t.jsx("stop",{stopColor:"#FF5B79",offset:"0%"}),t.jsx("stop",{stopColor:"#FA5574",offset:"28.0930803%"}),t.jsx("stop",{stopColor:"#EC4C51",offset:"44.7242531%"}),t.jsx("stop",{stopColor:"#9543C1",offset:"71.4578165%"}),t.jsx("stop",{stopColor:"#3857B3",offset:"100%"})]}),t.jsxs("radialGradient",{cx:"53.6205516%",cy:"47.2473036%",fx:"53.6205516%",fy:"47.2473036%",r:"50.8229649%",gradientTransform:"translate(0.536206,0.472473),rotate(90.000000),scale(1.000000,1.206631),translate(-0.536206,-0.472473)",id:"radialGradient-2",children:[t.jsx("stop",{stopColor:"#68294F",stopOpacity:"0",offset:"0%"}),t.jsx("stop",{stopColor:"#5E2548",stopOpacity:"0.04641108",offset:"75.3503173%"}),t.jsx("stop",{stopColor:"#0D060B",stopOpacity:"0.437431709",offset:"100%"})]}),t.jsxs("radialGradient",{cx:"53.8605015%",cy:"48.1990423%",fx:"53.8605015%",fy:"48.1990423%",r:"59.9151549%",gradientTransform:"translate(0.538605,0.481990),rotate(180.000000),scale(1.000000,0.925027),translate(-0.538605,-0.481990)",id:"radialGradient-3",children:[t.jsx("stop",{stopColor:"#68294F",stopOpacity:"0",offset:"0%"}),t.jsx("stop",{stopColor:"#5E2548",stopOpacity:"0.04641108",offset:"84.0867343%"}),t.jsx("stop",{stopColor:"#FF0000",stopOpacity:"0.567324765",offset:"100%"})]})]}),t.jsx("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:t.jsxs("g",{id:"firecms_logo",children:[t.jsx("circle",{fill:"url(#radialGradient-1)",cx:"299.5",cy:"299.5",r:"299.5"}),t.jsx("circle",{fill:"url(#radialGradient-2)",cx:"299.5",cy:"299.5",r:"299.5"}),t.jsx("circle",{fill:"url(#radialGradient-3)",cx:"299.5",cy:"299.5",r:"299.5"})]})})]})}const zs=X.default(e=>J.default({logo:{padding:e.spacing(3),maxWidth:280}}));function Er({logo:e,closeDrawer:o}){const r=zs(),i=Se(),{navigationEntries:n,groups:l}=p.useMemo(()=>ko(i,!1),[i]),s=Object.values(n).filter(d=>!d.group),u=p.useCallback((d,g,h)=>t.jsx(a.ListItem,{button:!0,component:se.NavLink,onClick:o,style:({isActive:f})=>({fontWeight:f?"600":"500",background:f?"rgba(128,128,128,0.1)":"inherit"}),to:h.url,children:t.jsx(a.Typography,{variant:"subtitle2",sx:{fontWeight:"inherit",py:.5},children:h.name.toUpperCase()})},`navigation_${d}`),[o]);let c;return e?c=t.jsx("img",{className:r.logo,src:e,alt:"Logo"}):c=t.jsx("div",{className:r.logo,children:t.jsx(_r,{})}),t.jsxs(t.Fragment,{children:[t.jsx(a.Link,{color:"inherit",onClick:o,component:se.NavLink,to:i.homeUrl,children:c},"breadcrumb-home"),t.jsxs(a.List,{children:[l.map(d=>t.jsxs(N.default.Fragment,{children:[t.jsx(a.Divider,{},`divider_${d}`),t.jsx(a.Box,{pt:2,pl:2,pr:2,pb:.5,children:t.jsx(a.Typography,{variant:"caption",color:"textSecondary",className:"weight-500",children:d.toUpperCase()})}),Object.values(n).filter(g=>g.group===d).map((g,h)=>u(h,d,g))]},`drawer_group_${d}`)),s.length>0&&t.jsx(a.Divider,{},"divider_ungrouped"),s.map((d,g)=>u(g,"none",d))]})]})}const Vs=X.default(e=>J.default({appbar:{},menuButton:{marginRight:e.spacing(2)},breadcrumb:{backgroundColor:e.palette.grey[100],height:e.spacing(3),color:e.palette.grey[800],fontWeight:e.typography.fontWeightMedium,"&:hover, &:focus":{cursor:"pointer",backgroundColor:e.palette.grey[300]},"&:active":{boxShadow:e.shadows[1],backgroundColor:e.palette.grey[400]}}}));function Us({title:e,handleDrawerToggle:o,toolbarExtraWidget:r}){const i=Vs(),n=Tr(),{breadcrumbs:l}=n,s=Qe(),{mode:u,toggleMode:c}=Lt(),d=s.user?.displayName?s.user.displayName[0].toUpperCase():s.user?.email?s.user.email[0].toUpperCase():"A";return t.jsx(a.Slide,{direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:t.jsx(a.AppBar,{className:i.appbar,position:"relative",elevation:1,children:t.jsxs(a.Toolbar,{children:[t.jsx(a.IconButton,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:o,className:i.menuButton,size:"large",children:t.jsx(Si.default,{})}),t.jsx(a.Hidden,{lgDown:!0,children:t.jsx(a.Box,{mr:3,children:t.jsx(a.Link,{underline:"none",color:"inherit",component:se.Link,to:"/",children:t.jsx(a.Typography,{variant:"h6",noWrap:!0,children:e})},"breadcrumb-home")})}),t.jsx(a.Box,{mr:2,children:t.jsx(a.Breadcrumbs,{separator:t.jsx(_i.default,{htmlColor:"rgb(0,0,0,0.87)",fontSize:"small"}),"aria-label":"breadcrumb",children:l.map((g,h)=>t.jsx(a.Link,{underline:"none",color:"inherit",component:se.Link,to:g.url,children:t.jsx(a.Chip,{classes:{root:i.breadcrumb},label:g.title})},`breadcrumb-${h}`))})}),t.jsx(a.Box,{flexGrow:1}),r&&t.jsx(re,{children:r}),t.jsx(a.Box,{p:1,mr:1,children:t.jsx(a.IconButton,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:()=>c(),size:"large",children:u==="dark"?t.jsx(ki.default,{}):t.jsx(Ti.default,{})})}),t.jsx(a.Box,{p:1,mr:1,children:s.user&&s.user.photoURL?t.jsx(a.Avatar,{src:s.user.photoURL}):t.jsx(a.Avatar,{children:d})}),t.jsx(a.Button,{variant:"text",color:"inherit",onClick:s.signOut,children:"Log Out"})]})})})}const Ws=bt.makeStyles(e=>bt.createStyles({main:{display:"flex",flexDirection:"column",width:"100vw",height:"100vh"},content:{flexGrow:1,width:"100%",height:"100%",overflow:"auto"},drawerPaper:{width:280}}));function Ir(e){const{children:o,name:r,logo:i,toolbarExtraWidget:n,Drawer:l}=e,s=Ws(),u=Se(),[c,d]=N.default.useState(!1),g=()=>d(!c),h=()=>d(!1),f=l||Er;return t.jsxs(t.Fragment,{children:[t.jsx("nav",{children:t.jsx(a.Drawer,{variant:"temporary",anchor:"left",open:c,onClose:h,classes:{paper:s.drawerPaper},ModalProps:{keepMounted:!0},children:u.navigation?t.jsx(f,{logo:i,closeDrawer:h}):t.jsx(Ee,{})})}),t.jsxs("div",{className:s.main,children:[t.jsx(Us,{title:r,handleDrawerToggle:g,toolbarExtraWidget:n}),t.jsx("main",{className:s.content,children:o})]})]})}function Hs(e){const o=e.getBoundingClientRect(),r=a.ownerWindow(e);let i;if(e.fakeTransform)i=e.fakeTransform;else{const l=r.getComputedStyle(e);i=l.getPropertyValue("-webkit-transform")||l.getPropertyValue("transform")}let n=0;if(i&&i!=="none"&&typeof i=="string"){const l=i.split("(")[1].split(")")[0].split(",");n=parseInt(l[4],10)}return`translateX(${r.innerWidth}px) translateX(${n-o.left}px)`}function ht(e){const o=Hs(e);o&&(e.style.webkitTransform=o,e.style.transform=o)}const js=ne.forwardRef(function(o,r){const{children:i,in:n,timeout:l,onExitAnimation:s,...u}=o,c=a.useTheme(),d=ne.useRef(null),g=a.useForkRef(i.ref,d),h=a.useForkRef(g,r),f=m=>S=>{m&&(S===void 0?m(d.current):m(d.current,S))},b=f(m=>{ht(m),Gs(m)}),y=f(m=>{const S=Br({timeout:l},{mode:"enter"});m.style.webkitTransition=c.transitions.create("-webkit-transform",{...S,easing:c.transitions.easing.easeOut}),m.style.transition=c.transitions.create("transform",{...S,easing:c.transitions.easing.easeOut}),m.style.webkitTransform="none",m.style.transform="none",m.style.opacity=1}),v=f(m=>{const S=Br({timeout:l},{mode:"exit"});m.style.opacity=.5,m.style.webkitTransition=c.transitions.create(["-webkit-transform","opacity"],{...S,easing:c.transitions.easing.sharp}),m.style.transition=c.transitions.create(["transform","opacity"],{...S,easing:c.transitions.easing.sharp}),ht(m)}),C=f(m=>{m.style.webkitTransition="",m.style.transition=""}),w=ne.useCallback(()=>{d.current&&ht(d.current)},[]);return ne.useEffect(()=>{if(n)return;const m=a.debounce(()=>{d.current&&ht(d.current)}),S=a.ownerWindow(d.current);return S.addEventListener("resize",m),()=>{m.clear(),S.removeEventListener("resize",m)}},[n]),ne.useEffect(()=>{n||w()},[n,w]),t.jsx(Sn.Transition,{nodeRef:d,onEnter:b,onEntering:y,onExit:v,onExited:C,appear:!0,in:n,timeout:l,...u,children:(m,S)=>ne.cloneElement(i,{ref:h,style:{visibility:m==="exited"&&!n?"hidden":void 0,...i.props.style},...S})})}),Gs=e=>e.scrollTop;function Br(e,o){const{timeout:r}=e;return{duration:typeof r=="number"?r:r[o.mode]||0}}const Ys=X.default(e=>J.default({root:{},paper:{height:"100%",WebkitOverflowScrolling:"touch",position:"fixed",outline:0},paperAnchorRight:({offsetPosition:o})=>({left:"auto",right:0}),modal:{}})),Pr={enter:225,exit:175},Fr=N.default.forwardRef(function(o,r){const{children:i,onClose:n,open:l,offsetPosition:s,onExitAnimation:u}=o,c=Ys({offsetPosition:s}),d=t.jsx(a.Paper,{elevation:1,square:!0,style:{transition:"transform 1000ms cubic-bezier(0.33, 1, 0.68, 1)",transform:`translateX(-${s*240}px)`},className:fe.default(c.paper,c.paperAnchorRight),children:i}),g=t.jsx(js,{in:l,timeout:Pr,onExitAnimation:u,children:d});return t.jsx(a.Modal,{BackdropProps:{transitionDuration:Pr},BackdropComponent:a.Backdrop,className:fe.default(c.root,c.modal),open:l,onClose:n,ref:r,keepMounted:!0,disableEnforceFocus:!0,children:g})}),Ar="560px",je="100vw",no="55vw",Xs=p.lazy(()=>Promise.resolve().then(function(){return ks})),Js=p.lazy(()=>Promise.resolve().then(function(){return as})),Ks=p.lazy(()=>Promise.resolve().then(function(){return ia})),Zs=X.default(e=>J.default({container:({containerWidth:o})=>({display:"flex",flexDirection:"column",width:o,height:"100%",[e.breakpoints.down("sm")]:{width:je},transition:"width 250ms ease-in-out"}),containerWide:({containerWidth:o})=>({width:`calc(${no} + ${o})`,[e.breakpoints.down("lg")]:{width:je}}),subcollectionPanel:{width:no,height:"100%",overflow:"auto",borderLeft:`1px solid ${e.palette.divider}`,[e.breakpoints.down("lg")]:{borderLeft:"inherit",width:je}},tabsContainer:({containerWidth:o})=>({flexGrow:1,height:"100%",width:`calc(${no} + ${o})`,[e.breakpoints.down("lg")]:{width:je},display:"flex",overflow:"auto",flexDirection:"row"}),form:({containerWidth:o})=>({width:o,maxWidth:"100%",height:"100%",overflow:"auto",[e.breakpoints.down("sm")]:{maxWidth:je,width:je}}),tabBar:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1),paddingTop:e.spacing(0)},tab:{fontSize:"0.875rem",minWidth:"140px"}}));function Qs({path:e,entityId:o,callbacks:r,selectedSubpath:i,copy:n,permissions:l,schema:s,subcollections:u,onModifiedValues:c,width:d}){const g=typeof d=="number"?`${d}px`:d,h=Zs({containerWidth:g??Ar}),f=_e(),b=Pe(),y=Ue(),v=ce(),C=Qe(),[w,m]=p.useState(n?"copy":o?"existing":"new"),[S,_]=p.useState(o),[k,B]=p.useState(!1),[P,M]=N.default.useState(-1),[q,O]=p.useState(),{entity:T,dataLoading:I,dataLoadingError:A}=it({path:e,entityId:S,schema:s,useCache:!1}),$=p.useMemo(()=>he({schemaOrResolver:s,path:e,entityId:o,values:q,previousValues:T?.values}),[s,e,o,q]);p.useEffect(()=>{function U(ee){q&&(ee.preventDefault(),ee.returnValue=`You have unsaved changes in this ${$.name}. Are you sure you want to leave this page?`)}return typeof window<"u"&&window.addEventListener("beforeunload",U),()=>{typeof window<"u"&&window.removeEventListener("beforeunload",U)}},[q,window]);const E=$.views,L=E?.length??0;p.useEffect(()=>{T&&B(!eo(l,T,C,e,v))},[T,l]);const F=a.useTheme(),H=a.useMediaQuery(F.breakpoints.up("lg"));p.useEffect(()=>{if(i||M(-1),E){const U=E.map(ee=>ee.path).findIndex(ee=>ee===i);M(U)}if(u&&i){const U=u.map(ee=>ee.path).findIndex(ee=>ee===i);M(U+L)}},[i]);const W=p.useCallback(U=>{y.open({type:"error",title:"Error before saving",message:U?.message}),console.error(U)},[]),D=p.useCallback(U=>{y.open({type:"error",title:`${$.name}: Error after saving (entity is saved)`,message:U?.message}),console.error(U)},[]),Y=p.useCallback(U=>{_(U.id),y.open({type:"success",message:`${$.name}: Saved correctly`}),m("existing"),c(!1),P===-1&&b.close()},[]),V=p.useCallback(U=>{y.open({type:"error",title:`${$.name}: Error saving`,message:U?.message}),console.error("Error saving entity",e,o),console.error(U)},[]),K=p.useCallback(async({schema:U,path:ee,entityId:ae,values:gt,previousValues:pt})=>{if(!!w)return Dt({path:ee,entityId:ae,callbacks:r,values:gt,previousValues:pt,schema:U,status:w,dataSource:f,context:v,onSaveSuccess:Y,onSaveFailure:V,onPreSaveHookError:W,onSaveSuccessHookError:D})},[w,r,f,v,Y,V,W,D]),te=p.useCallback(()=>{P===-1&&b.close()},[b,P]),j=k?t.jsx(p.Suspense,{fallback:t.jsx(Ee,{}),children:t.jsx(Ks,{entity:T,path:e,schema:$})}):t.jsx(p.Suspense,{fallback:t.jsx(Ee,{}),children:t.jsx(Js,{status:w,path:e,schemaOrResolver:s,onEntitySave:K,onDiscard:te,onValuesChanged:O,onModified:c,entity:T},`form_${e}_${T?.id??"new"}`)}),Z=E&&E.map((U,ee)=>t.jsx(a.Box,{className:h.subcollectionPanel,role:"tabpanel",flexGrow:1,height:"100%",width:"100%",hidden:P!==ee,children:t.jsx(re,{children:U.builder({schema:$,entity:T,modifiedValues:q??T?.values})})},`custom_view_${U.path}_${ee}`)),ie=u&&u.map((U,ee)=>{const ae=T?`${T?.path}/${T?.id}/${le(U.path)}`:void 0;return t.jsx(a.Box,{className:h.subcollectionPanel,role:"tabpanel",flexGrow:1,hidden:P!==ee+L,children:T&&ae?t.jsx(p.Suspense,{fallback:t.jsx(Ee,{}),children:t.jsx(Xs,{path:ae,collection:U})}):t.jsx(a.Box,{m:3,display:"flex",alignItems:"center",justifyContent:"center",children:t.jsx(a.Box,{children:"You need to save your entity before adding additional collections"})})},`subcol_${U.name}_${ee}`)}),R=p.useCallback(U=>{if(U!==-1){if(E&&U<L)return E[U].path;if(u)return u[U-L].path;throw Error("Something is wrong in getSelectedSubpath")}},[E]),G=p.useCallback(U=>{M(U),o&&b.open({path:e,entityId:o,selectedSubpath:R(U),overrideSchemaRegistry:!1})},[]),ye=t.jsxs(a.Box,{sx:{paddingLeft:2,paddingRight:2,paddingTop:2,display:"flex",alignItems:"center",backgroundColor:F.palette.mode==="light"?F.palette.background.default:F.palette.background.paper},children:[t.jsx(a.IconButton,{onClick:U=>b.close(),size:"large",children:t.jsx(Ei.default,{})}),t.jsx(a.Tabs,{value:P===-1?0:!1,indicatorColor:"secondary",textColor:"inherit",scrollButtons:"auto",children:t.jsx(a.Tab,{label:$.name,classes:{root:h.tab},wrapped:!0,onClick:()=>{G(-1)}})}),t.jsx(a.Box,{flexGrow:1}),I&&t.jsx(a.CircularProgress,{size:16,thickness:8}),t.jsxs(a.Tabs,{value:P>=0?P:!1,indicatorColor:"secondary",textColor:"inherit",onChange:(U,ee)=>{G(ee)},className:h.tabBar,variant:"scrollable",scrollButtons:"auto",children:[E&&E.map(U=>t.jsx(a.Tab,{classes:{root:h.tab},wrapped:!0,label:U.name},`entity_detail_custom_tab_${U.name}`)),u&&u.map(U=>t.jsx(a.Tab,{classes:{root:h.tab},wrapped:!0,label:U.name},`entity_detail_collection_tab_${U.name}`))]})]});return t.jsx("div",{className:fe.default(h.container,{[h.containerWide]:P!==-1}),children:I?t.jsx(Ee,{}):t.jsxs(t.Fragment,{children:[ye,t.jsx(a.Divider,{}),t.jsxs("div",{className:h.tabsContainer,children:[t.jsx(a.Box,{role:"tabpanel",hidden:!H&&P!==-1,className:h.form,children:j}),Z,ie]})]})})}function Rs(e,o){const[r,i]=N.default.useState(),{navigator:n}=N.default.useContext(se.UNSAFE_NavigationContext),l=se.useNavigate(),s=()=>{i(void 0)},u=()=>{o(),i(void 0),l(-1)},c=p.useCallback(({action:d,location:g,retry:h})=>{switch(d){case"REPLACE":{h();return}case"POP":i(g)}},[]);return N.default.useEffect(()=>{if(!e||r||!("block"in n))return;const d=n.block(g=>{const h={...g,retry(){d(),g.retry()}};c(h)});return d},[n,c,e,r]),{navigationWasBlocked:Boolean(r),handleCancel:s,handleOk:u}}function ec({open:e,handleOk:o,handleCancel:r,schemaName:i}){return t.jsxs(Ii.default,{open:e,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[t.jsx(Fi.default,{id:"alert-dialog-title",children:"Unsaved changes"}),t.jsxs(Pi.default,{children:[t.jsxs(yo.default,{id:"alert-dialog-description",children:["You have unsaved changes in this ",t.jsx("b",{children:i}),"."]}),t.jsx(yo.default,{id:"alert-dialog-description",children:"Are you sure you want to leave this page?"})]}),t.jsxs(Bi.default,{children:[t.jsx(vo.default,{onClick:r,autoFocus:!0,children:" Cancel "}),t.jsx(vo.default,{onClick:o,children:" Ok "})]})]})}function Or(){const o=Pe().sidePanels,r=[...o,void 0];return t.jsx(t.Fragment,{children:r.map((i,n)=>t.jsx(tc,{panel:i,offsetPosition:o.length-n-1},`side_entity_dialog_${n}`))})}function tc({panel:e,offsetPosition:o}){const[r,i]=p.useState(!1),[n,l]=p.useState(!1),{navigationWasBlocked:s,handleOk:u,handleCancel:c}=Rs(r&&!n,()=>i(!1)),d=()=>{i(!1),l(!1),h.close()},g=()=>{l(!1)},h=Pe(),f=Se(),b=e?f.getCollectionResolver(e.path,e.entityId):void 0;if(e&&!b)throw Error("ERROR: You are trying to open an entity with no schema defined.");const y=p.useMemo(()=>{if(!!e)return he({schemaOrResolver:b.schemaResolver,path:e.path,entityId:e.entityId})},[e,b]);return!e||!y?t.jsx(Fr,{open:!1,offsetPosition:o,children:t.jsx("div",{style:{width:Ar}})}):t.jsxs(t.Fragment,{children:[t.jsx(Fr,{open:Boolean(e),onClose:()=>{r?l(!0):h.close()},offsetPosition:o,children:t.jsx(re,{children:t.jsx(Qs,{...b,...e,schema:b.schemaResolver,onModifiedValues:i})})}),t.jsx(ec,{open:s||n,handleOk:n?d:u,handleCancel:n?g:c,schemaName:y.name})]})}const $r=({mode:e,primaryColor:o,secondaryColor:r,fontFamily:i})=>({...a.createTheme({palette:{mode:e,background:{default:e==="dark"?"#242424":"#f6f7f8"},primary:{main:o||"#0070f4"},secondary:{main:r||ao.pink["400"]},error:{main:ao.red.A400}},typography:{fontFamily:i||'"Rubik", "Roboto", "Helvetica", "Arial", sans-serif',fontWeightMedium:500,h6:{fontWeight:500,fontSize:"1.15rem"}},components:{MuiButton:{styleOverrides:{root:{borderRadius:4}}},MuiTableRow:{styleOverrides:{root:{"&:last-child td":{borderBottom:0}}}},MuiTypography:{styleOverrides:{root:{"&.mono":{fontFamily:"'Space Mono', 'Lucida Console', monospace"},"&.weight-500":{fontWeight:500}}}},MuiInputBase:{styleOverrides:{root:{"&.mono":{fontFamily:"'Space Mono', 'Lucida Console', monospace"}}}}}})});function oc(e){return e}function rc(e){return e}function nc(e){return e}function ic(e){return e}function lc(e){return e}function ac(e){return e}function sc(e){return e}function cc(e){return e}function dc(e){return e}function uc(e){return e}const Dr=({firebaseApp:e,signInOptions:o})=>{const[r,i]=p.useState(void 0),[n,l]=p.useState(),[s,u]=p.useState(!0),[c,d]=p.useState(!0),[g,h]=p.useState(!1);function f(){h(!0),i(null)}p.useEffect(()=>{if(!e)return;const T=oe.getAuth(e);return i(T.currentUser),oe.onAuthStateChanged(T,b,I=>l(I))},[e]);const b=async T=>{i(T),u(!1),d(!1)};function y(){const T=oe.getAuth(e);oe.signOut(T).then(I=>{i(null),l(null)}),h(!1)}const v=T=>o.find(I=>{if(I===null)throw Error("useFirebaseAuthDelegate");if(typeof I=="object"&&I.provider===T)return I}),C=()=>{const T=new oe.GoogleAuthProvider,I=v("google.com");I?.scopes&&I.scopes.forEach($=>T.addScope($)),I?.customParameters&&T.setCustomParameters(I.customParameters);const A=oe.getAuth();oe.signInWithPopup(A,T).catch(l)};function w(T,I){d(!0),oe.signInWithPopup(T,I).catch(l).then(()=>d(!1))}return{user:r??null,authError:n,authLoading:c,initialLoading:s,signOut:y,loginSkipped:g,skipLogin:f,googleLogin:C,anonymousLogin:()=>{const T=oe.getAuth();d(!0),co.signInAnonymously(T).catch(l).then(()=>d(!1))},appleLogin:()=>{const T=new oe.OAuthProvider("apple.com"),I=v("apple.com");I?.scopes&&I.scopes.forEach($=>T.addScope($)),I?.customParameters&&T.setCustomParameters(I.customParameters);const A=oe.getAuth();w(A,T)},facebookLogin:()=>{const T=new oe.FacebookAuthProvider,I=v("facebook.com");I?.scopes&&I.scopes.forEach($=>T.addScope($)),I?.customParameters&&T.setCustomParameters(I.customParameters);const A=oe.getAuth();w(A,T)},githubLogin:()=>{const T=new oe.GithubAuthProvider,I=v("github.com");I?.scopes&&I.scopes.forEach($=>T.addScope($)),I?.customParameters&&T.setCustomParameters(I.customParameters);const A=oe.getAuth();w(A,T)},microsoftLogin:()=>{const T=new oe.OAuthProvider("microsoft.com"),I=v("microsoft.com");I?.scopes&&I.scopes.forEach($=>T.addScope($)),I?.customParameters&&T.setCustomParameters(I.customParameters);const A=oe.getAuth();w(A,T)},twitterLogin:()=>{const T=new oe.TwitterAuthProvider,I=v("twitter.com");I?.customParameters&&T.setCustomParameters(I.customParameters);const A=oe.getAuth();w(A,T)},emailPasswordLogin:(T,I)=>{const A=oe.getAuth();d(!0),oe.signInWithEmailAndPassword(A,T,I).catch(l).then(()=>d(!1))},fetchSignInMethodsForEmail:T=>{const I=oe.getAuth();return d(!0),oe.fetchSignInMethodsForEmail(I,T).then(A=>(d(!1),A))},createUserWithEmailAndPassword:(T,I)=>{const A=oe.getAuth();d(!0),co.createUserWithEmailAndPassword(A,T,I).catch(l).then(()=>d(!1))}}};function Lr({firebaseApp:e,textSearchController:o}){const r=p.useRef(),i=r.current;p.useEffect(()=>{!e||(r.current=Q.getFirestore(e))},[e]);function n(c,d,g){const h=Mr(c.data()),f=c.data()?g.properties?bl(h,g.properties):c.data():void 0;return{id:c.id,path:Nr(c.ref.path),values:f}}function l(c,d,g,h,f,b){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");const y=Q.collection(i,c),v=[];return d&&Object.entries(d).filter(([C,w])=>!!w).forEach(([C,w])=>{const[m,S]=w;v.push(Q.where(C,m,io(S,i)))}),d&&g&&h&&Object.entries(d).forEach(([C,w])=>{C!==g&&v.push(Q.orderBy(C,"asc"))}),g&&h&&v.push(Q.orderBy(g,h)),f&&v.push(Q.startAfter(f)),b&&v.push(Q.limit(b)),Q.query(y,...v)}function s(c,d,g){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");return Q.getDoc(Q.doc(i,c,d)).then(h=>{const f=he({schemaOrResolver:g,entityId:h.id,path:c});return n(h,c,f)})}async function u(c,d,g){if(!o)throw Error("Trying to make text search without specifying a FirestoreTextSearchController");const h=await o({path:c,searchString:d});if(h===void 0)throw Error("The current path is not supported by the specified FirestoreTextSearchController");const f=h.map(async b=>{try{return await s(c,b,g)}catch(y){return console.error(y),null}});return Promise.all(f).then(b=>b.filter(y=>y!==null&&y.values))}return{fetchCollection({path:c,schema:d,filter:g,limit:h,startAfter:f,searchString:b,orderBy:y,order:v}){if(b)return u(c,b,d);console.debug("Fetching collection",c,h,g,f,y,v);const C=l(c,g,y,v,f,h),w=he({schemaOrResolver:d,path:c});return Q.getDocs(C).then(m=>m.docs.map(S=>n(S,c,w)))},listenCollection({path:c,schema:d,filter:g,limit:h,startAfter:f,searchString:b,orderBy:y,order:v,onUpdate:C,onError:w}){console.debug("Listening collection",c,h,g,f,y,v);const m=l(c,g,y,v,f,h);if(b)return u(c,b,d).then(C).catch(_=>{w&&w(_)}),()=>{};const S=he({schemaOrResolver:d,path:c});return Q.onSnapshot(m,{next:_=>{C(_.docs.map(k=>n(k,c,S)))},error:w})},fetchEntity({path:c,entityId:d,schema:g}){return s(c,d,g)},listenEntity({path:c,entityId:d,schema:g,onUpdate:h,onError:f}){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");return Q.onSnapshot(Q.doc(i,c,d),{next:b=>{const y=he({schemaOrResolver:g,entityId:b.id,path:c});h(n(b,c,y))},error:f})},saveEntity:async function({path:c,entityId:d,values:g,schema:h,status:f}){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");const y=he({schemaOrResolver:h,entityId:d,path:c}).properties,v=Q.collection(i,c),C=pl({inputValues:g,properties:y,status:f,timestampNowValue:Q.serverTimestamp(),referenceConverter:m=>Q.doc(i,m.path,m.id),geopointConverter:m=>new Q.GeoPoint(m.latitude,m.longitude)});console.debug("Saving entity",c,d,C);let w;return d?w=Q.doc(v,d):w=Q.doc(v),Q.setDoc(w,C,{merge:!0}).then(()=>({id:w.id,path:w.path,values:Mr(C)}))},async deleteEntity({entity:c}){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");return Q.deleteDoc(Q.doc(i,c.path,c.id))},checkUniqueField(c,d,g,h,f){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");if(console.debug("Check unique field entity",c,d,g,f),h.dataType==="array"&&console.error("checkUniqueField received an array"),g==null)return Promise.resolve(!0);const b=Q.query(Q.collection(i,c),Q.where(d,"==",g));return Q.getDocs(b).then(y=>y.docs.filter(v=>v.id!==f).length===0)}}}function Mr(e){const o=r=>{if(r==null)return r;if(Q.serverTimestamp().isEqual(r))return null;if(r instanceof Q.Timestamp)return r.toDate();if(r instanceof Me)return new Me(r.latitude,r.longitude);if(r instanceof Q.DocumentReference)return new ke(r.id,Nr(r.path));if(Array.isArray(r))return r.map(o);if(typeof r=="object"){const i={};for(const n of Object.keys(r))i[n]=o(r[n]);return i}return r};return o(e)}function io(e,o){return Array.isArray(e)?e.map(r=>io(r,o)):e instanceof ke?Q.doc(o,e.path,e.id):e instanceof Me?new Q.GeoPoint(e.latitude,e.longitude):typeof e=="object"?Object.entries(e).map(([r,i])=>({[r]:io(i,o)})).reduce((r,i)=>({...r,...i}),{}):e}function Nr(e){let o=e.lastIndexOf("/");return o=o===-1?e.length:o,e.substring(0,o)}function qr({firebaseApp:e}){const[o,r]=p.useState();p.useEffect(()=>{!e||r(Xe.getStorage(e))},[e]);const i={};return{uploadFile({file:n,fileName:l,path:s,metadata:u}){if(!o)throw Error("useFirebaseStorageSource Firebase not initialised");const c=l??n.name;return console.debug("Uploading file",c,n,s,u),Xe.uploadBytes(Xe.ref(o,`${s}/${c}`),n,u).then(d=>({path:d.ref.fullPath}))},getDownloadURL(n){if(!o)throw Error("useFirebaseStorageSource Firebase not initialised");if(i[n])return i[n];const l=Xe.getDownloadURL(Xe.ref(o,n));return i[n]=l,l}}}function zr({firebaseConfig:e,onFirebaseInit:o}){const[r,i]=N.default.useState(),[n,l]=N.default.useState(!1),[s,u]=N.default.useState(),[c,d]=N.default.useState(),g=p.useCallback(h=>{try{const f=oi.initializeApp(h);d(void 0),l(!1),o&&o(h),i(f)}catch(f){console.error(f),d(f)}},[o]);return p.useEffect(()=>{l(!0),e?(console.log("Using specified config",e),g(e)):fetch("/__/firebase/init.json").then(async h=>{if(console.debug("Firebase init response",h.status),h&&h.status<300){const f=await h.json();console.log("Using configuration fetched from Firebase Hosting",f),g(f)}}).catch(h=>{l(!1),u("Could not load Firebase configuration from Firebase hosting. If the app is not deployed in Firebase hosting, you need to specify the configuration manually"+h.toString())})},[e,g]),{firebaseApp:r,firebaseConfigLoading:n,configError:s,firebaseConfigError:c}}const fc=e=>t.jsx(t.Fragment,{children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:32,height:32,children:[t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJb",x1:"29.401",x2:"29.401",y1:"4.064",y2:"106.734",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#ff5840"}),t.jsx("stop",{offset:".007",stopColor:"#ff5840"}),t.jsx("stop",{offset:".989",stopColor:"#fa528c"}),t.jsx("stop",{offset:"1",stopColor:"#fa528c"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJb)",d:"M47.46,15.5l-1.37,1.48c-1.34,1.44-3.5,1.67-5.15,0.6c-2.71-1.75-6.43-3.13-11-2.37 c-4.94,0.83-9.17,3.85-11.64, 7.97l-8.03-6.08C14.99,9.82,23.2,5,32.5,5c5,0,9.94,1.56,14.27,4.46 C48.81,10.83,49.13,13.71,47.46,15.5z"}),t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJc",x1:"12.148",x2:"12.148",y1:".872",y2:"47.812",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#feaa53"}),t.jsx("stop",{offset:".612",stopColor:"#ffcd49"}),t.jsx("stop",{offset:"1",stopColor:"#ffde44"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJc)",d:"M16.01,30.91c-0.09,2.47,0.37,4.83,1.27,6.96l-8.21,6.05c-1.35-2.51-2.3-5.28-2.75-8.22 c-1.06-6.88,0.54-13.38, 3.95-18.6l8.03,6.08C16.93,25.47,16.1,28.11,16.01,30.91z"}),t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJd",x1:"29.76",x2:"29.76",y1:"32.149",y2:"-6.939",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#42d778"}),t.jsx("stop",{offset:".428",stopColor:"#3dca76"}),t.jsx("stop",{offset:"1",stopColor:"#34b171"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJd)",d:"M50.45,51.28c-4.55,4.07-10.61,6.57-17.36,6.71C22.91,58.2,13.66,52.53,9.07,43.92l8.21-6.05 C19.78,43.81, 25.67,48,32.5,48c3.94,0,7.52-1.28,10.33-3.44L50.45,51.28z"}),t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJe",x1:"46",x2:"46",y1:"3.638",y2:"35.593",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#155cde"}),t.jsx("stop",{offset:".278",stopColor:"#1f7fe5"}),t.jsx("stop",{offset:".569",stopColor:"#279ceb"}),t.jsx("stop",{offset:".82",stopColor:"#2cafef"}),t.jsx("stop",{offset:"1",stopColor:"#2eb5f0"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJe)",d:"M59,31.97c0.01,7.73-3.26,14.58-8.55,19.31l-7.62-6.72c2.1-1.61,3.77-3.71,4.84-6.15 c0.29-0.66-0.2-1.41-0.92-1.41H37c-2.21,0-4-1.79-4-4v-2c0-2.21,1.79-4,4-4h17C56.75,27,59,29.22,59,31.97z"})]})}),hc=e=>t.jsx("svg",{width:32,height:32,viewBox:"0 0 56 56",style:{transform:"scale(2.8)"},version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("g",{stroke:e==="light"?"#424245":"white",strokeWidth:"0.5",fillRule:"evenodd",children:t.jsx("path",{d:"M28.2226562,20.3846154 C29.0546875,20.3846154 30.0976562,19.8048315 30.71875,19.0317864 C31.28125,18.3312142 31.6914062,17.352829 31.6914062,16.3744437 C31.6914062,16.2415766 31.6796875,16.1087095 31.65625,16 C30.7304687,16.0362365 29.6171875,16.640178 28.9492187,17.4494596 C28.421875,18.06548 27.9414062,19.0317864 27.9414062,20.0222505 C27.9414062,20.1671964 27.9648438,20.3121424 27.9765625,20.3604577 C28.0351562,20.3725366 28.1289062,20.3846154 28.2226562,20.3846154 Z M25.2929688,35 C26.4296875,35 26.9335938,34.214876 28.3515625,34.214876 C29.7929688,34.214876 30.109375,34.9758423 31.375,34.9758423 C32.6171875,34.9758423 33.4492188,33.792117 34.234375,32.6325493 C35.1132812,31.3038779 35.4765625,29.9993643 35.5,29.9389701 C35.4179688,29.9148125 33.0390625,28.9122695 33.0390625,26.0979021 C33.0390625,23.6579784 34.9140625,22.5588048 35.0195312,22.474253 C33.7773438,20.6382708 31.890625,20.5899555 31.375,20.5899555 C29.9804688,20.5899555 28.84375,21.4596313 28.1289062,21.4596313 C27.3554688,21.4596313 26.3359375,20.6382708 25.1289062,20.6382708 C22.8320312,20.6382708 20.5,22.5950413 20.5,26.2911634 C20.5,28.5861411 21.3671875,31.013986 22.4335938,32.5842339 C23.3476562,33.9129053 24.1445312,35 25.2929688,35 Z",fill:e==="light"?"#424245":"white",fillRule:"nonzero"})})}),gc=e=>t.jsx("svg",{fill:e==="light"?"#1c1e21":"white",role:"img",viewBox:"0 0 24 24",width:28,height:28,xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"})}),pc=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 90 90",children:t.jsx("g",{children:t.jsx("path",{d:"M90,15.001C90,7.119,82.884,0,75,0H15C7.116,0,0,7.119,0,15.001v59.998   C0,82.881,7.116,90,15.001,90H45V56H34V41h11v-5.844C45,25.077,52.568,16,61.875,16H74v15H61.875C60.548,31,59,32.611,59,35.024V41   h15v15H59v34h16c7.884,0,15-7.119,15-15.001V15.001z",fill:e==="light"?"#39569c":"white"})})}),bc=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 480 480",children:t.jsx("g",{children:t.jsx("path",{d:"M0.176,224L0.001,67.963l192-26.072V224H0.176z M224.001,37.241L479.937,0v224H224.001V37.241z M479.999,256l-0.062,224   l-255.936-36.008V256H479.999z M192.001,439.918L0.157,413.621L0.147,256h191.854V439.918z",fill:e==="light"?"#00a2ed":"white"})})}),vc=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 24 24",children:t.jsx("path",{fill:e==="light"?"#00acee":"white",d:"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"})}),yc=X.default(e=>J.default({logo:{padding:e.spacing(3),width:260,height:260}}));function Vr({allowSkipLogin:e,logo:o,signInOptions:r,firebaseApp:i,authDelegate:n,NoUserComponent:l,disableSignupScreen:s=!1}){const u=yc(),c=Qe(),d=Lt(),[g,h]=p.useState(!1),f=r.map(C=>typeof C=="object"?C.provider:C);function b(){let C;const w=["auth/popup-closed-by-user","auth/cancelled-popup-request"];return n.authError&&(n.authError.code==="auth/operation-not-allowed"?C=t.jsxs(t.Fragment,{children:[t.jsx(a.Box,{p:1,children:t.jsx(me,{error:"You need to enable the corresponding login provider in your Firebase project"})}),i&&t.jsx(a.Box,{p:1,children:t.jsx("a",{href:`https://console.firebase.google.com/project/${i.options.projectId}/authentication/providers`,rel:"noopener noreferrer",target:"_blank",children:t.jsx(a.Button,{variant:"text",color:"primary",children:"Open Firebase configuration"})})})]}):w.includes(n.authError.code)||(console.error(n.authError),C=t.jsx(a.Box,{p:1,children:t.jsx(me,{error:n.authError.message})}))),C}let y;o?y=t.jsx("img",{className:u.logo,src:o,alt:"Logo"}):y=t.jsx("div",{className:u.logo,children:t.jsx(_r,{})});let v;return c.notAllowedError&&(typeof c.notAllowedError=="string"?v=c.notAllowedError:c.notAllowedError instanceof Error?v=c.notAllowedError.message:v="It looks like you don't have access to the CMS, based on the specified Authenticator configuration"),t.jsx(a.Fade,{in:!0,timeout:500,mountOnEnter:!0,unmountOnExit:!0,children:t.jsx(a.Box,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",p:2},children:t.jsxs(a.Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",maxWidth:340},children:[t.jsx(a.Box,{m:1,children:y}),v&&t.jsx(a.Box,{p:2,children:t.jsx(me,{error:v})}),b(),!g&&t.jsxs(t.Fragment,{children:[Ur(n,f,d.mode),f.includes("password")&&t.jsx(Ae,{text:"Email/password",icon:t.jsx(Qi.default,{fontSize:"large"}),onClick:()=>h(!0)}),f.includes("anonymous")&&t.jsx(Ae,{text:"Log in anonymously",icon:t.jsx(Ri.default,{fontSize:"large"}),onClick:n.anonymousLogin}),e&&t.jsx(a.Box,{m:1,children:t.jsx(a.Button,{onClick:n.skipLogin,children:"Skip login"})})]}),g&&t.jsx(wc,{authDelegate:n,onClose:()=>h(!1),mode:d.mode,NoUserComponent:l,disableSignupScreen:s})]})})})}function Ae({icon:e,onClick:o,text:r}){return t.jsx(a.Box,{m:.5,width:"100%",children:t.jsx(a.Button,{fullWidth:!0,variant:"outlined",onClick:o,children:t.jsxs(a.Box,{sx:{p:"1",display:"flex",width:"240px",height:"32px",alignItems:"center",justifyItems:"center"},children:[t.jsx(a.Box,{sx:{display:"flex",flexDirection:"column",width:"32px",alignItems:"center",justifyItems:"center"},children:e}),t.jsx(a.Box,{sx:{flexGrow:1,pl:2,textAlign:"center"},children:r})]})})})}function wc({onClose:e,authDelegate:o,mode:r,NoUserComponent:i,disableSignupScreen:n}){const l=p.useRef(null),[s,u]=p.useState(),[c,d]=p.useState(),[g,h]=p.useState(),f=c===void 0,b=c&&c.includes("password"),y=c&&!c.includes("password")&&c.length>0,v=c&&!c.includes("password");p.useEffect(()=>{console.log("loginMode",b),(b||v)&&l.current&&l.current.focus()},[b,v]),p.useEffect(()=>{if(!document)return;const P=M=>{M.keyCode===27&&e()};return document.addEventListener("keydown",P,!1),()=>{document.removeEventListener("keydown",P,!1)}},[document]);function C(){s&&o.fetchSignInMethodsForEmail(s).then(P=>{console.log(P),d(P)})}function w(){s&&g&&o.emailPasswordLogin(s,g)}function m(){s&&g&&o.createUserWithEmailAndPassword(s,g)}const S=()=>{f?e():d(void 0)},_=P=>{P.preventDefault(),f?C():b?w():v&&m()},k=v?"No user found with that email. Pick a password to create a new account":b?"Please enter your password":"Please enter your email",B=v?"Create account":b?"Login":"Ok";return y?t.jsxs(a.Grid,{container:!0,spacing:1,children:[t.jsx(a.Grid,{item:!0,xs:12,children:t.jsx(a.IconButton,{onClick:S,children:t.jsx(Co.default,{sx:{width:20,height:20}})})}),t.jsxs(a.Grid,{item:!0,xs:12,sx:{p:1},children:[t.jsx(a.Typography,{align:"center",variant:"subtitle2",children:"You already have an account"}),t.jsxs(a.Typography,{align:"center",variant:"body2",children:["You can use one of these methods to login with ",s]})]}),t.jsx(a.Grid,{item:!0,xs:12,children:c&&Ur(o,c,r)})]}):t.jsx(a.Slide,{direction:"up",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:t.jsx("form",{onSubmit:_,children:t.jsxs(a.Grid,{container:!0,spacing:1,children:[t.jsx(a.Grid,{item:!0,xs:12,children:t.jsx(a.IconButton,{onClick:S,children:t.jsx(Co.default,{sx:{width:20,height:20}})})}),t.jsx(a.Grid,{item:!0,xs:12,sx:{p:1,display:v&&n?"none":"flex"},children:t.jsx(a.Typography,{align:"center",variant:"subtitle2",children:k})}),t.jsx(a.Grid,{item:!0,xs:12,sx:{display:f?"inherit":"none"},children:t.jsx(a.TextField,{placeholder:"Email",fullWidth:!0,autoFocus:!0,value:s,disabled:o.authLoading,type:"email",onChange:P=>u(P.target.value)})}),t.jsx(a.Grid,{item:!0,xs:12,children:v&&i}),t.jsx(a.Grid,{item:!0,xs:12,sx:{display:b||v&&!n?"inherit":"none"},children:t.jsx(a.TextField,{placeholder:"Password",fullWidth:!0,value:g,disabled:o.authLoading,inputRef:l,type:"password",onChange:P=>h(P.target.value)})}),t.jsx(a.Grid,{item:!0,xs:12,children:t.jsxs(a.Box,{sx:{display:v&&n?"none":"flex",justifyContent:"end",alignItems:"center",width:"100%"},children:[o.authLoading&&t.jsx(a.CircularProgress,{sx:{p:1},size:16,thickness:8}),t.jsx(a.Button,{type:"submit",children:B})]})})]})})})}function Ur(e,o,r){return t.jsxs(t.Fragment,{children:[o.includes("google.com")&&t.jsx(Ae,{text:"Sign in with Google",icon:fc(),onClick:e.googleLogin}),o.includes("microsoft.com")&&t.jsx(Ae,{text:"Sign in with Microsoft",icon:bc(r),onClick:e.microsoftLogin}),o.includes("apple.com")&&t.jsx(Ae,{text:"Sign in with Apple",icon:hc(r),onClick:e.appleLogin}),o.includes("github.com")&&t.jsx(Ae,{text:"Sign in with Github",icon:gc(r),onClick:e.githubLogin}),o.includes("facebook.com")&&t.jsx(Ae,{text:"Sign in with Facebook",icon:pc(r),onClick:e.facebookLogin}),o.includes("twitter.com")&&t.jsx(Ae,{text:"Sign in with Twitter",icon:vc(r),onClick:e.twitterLogin})]})}const Wr=[oe.GoogleAuthProvider.PROVIDER_ID];function Cc({name:e,logo:o,toolbarExtraWidget:r,authentication:i,schemaOverrideHandler:n,navigation:l,textSearchController:s,allowSkipLogin:u,signInOptions:c=Wr,firebaseConfig:d,onFirebaseInit:g,primaryColor:h,secondaryColor:f,fontFamily:b,dateTimeFormat:y,locale:v,HomePage:C,basePath:w,baseCollectionPath:m,LoginViewProps:S}){const{firebaseApp:_,firebaseConfigLoading:k,configError:B,firebaseConfigError:P}=zr({onFirebaseInit:g,firebaseConfig:d}),M=Dr({firebaseApp:_,signInOptions:c}),q=Lr({firebaseApp:_,textSearchController:s}),O=qr({firebaseApp:_});return B?t.jsxs("div",{children:[" ",B," "]}):P?t.jsx("div",{children:"It seems like the provided Firebase config is not correct. If you are using the credentials provided automatically by Firebase Hosting, make sure you link your Firebase app to Firebase Hosting."}):k||!_?t.jsxs(t.Fragment,{children:[t.jsx(a.CssBaseline,{}),t.jsx(Ee,{})]}):t.jsx(se.BrowserRouter,{basename:w,children:t.jsx(Ao,{navigation:l,authDelegate:M,authentication:i,schemaOverrideHandler:n,dateTimeFormat:y,dataSource:q,storageSource:O,entityLinkBuilder:({entity:T})=>`https://console.firebase.google.com/project/${_.options.projectId}/firestore/data/${T.path}/${T.id}`,locale:v,basePath:w,baseCollectionPath:m,children:({context:T,mode:I,loading:A})=>{const $=$r({mode:I,primaryColor:h,secondaryColor:f,fontFamily:b});let E;return A?E=t.jsx(Ee,{}):T.authController.canAccessMainView?E=t.jsxs(Ir,{name:e,logo:o,toolbarExtraWidget:r,children:[t.jsx(kr,{HomePage:C}),t.jsx(Or,{})]}):E=t.jsx(Vr,{logo:o,allowSkipLogin:u,signInOptions:c??Wr,firebaseApp:_,authDelegate:M,...S}),t.jsxs(a.ThemeProvider,{theme:$,children:[t.jsx(a.CssBaseline,{}),E]})}})})}function mc(e,o){return console.log("Performing Algolia query",e,o),e.search(o).then(({hits:r})=>r.map(i=>i.objectID)).catch(r=>(console.log(r),[]))}x.ArrayContainer=ct,x.ArrayDefaultField=ar,x.ArrayEnumPreview=rt,x.ArrayEnumSelect=rr,x.ArrayOfMapsPreview=No,x.ArrayOfReferencesField=dr,x.ArrayOfReferencesPreview=Xo,x.ArrayOfStorageComponentsPreview=Yo,x.ArrayOfStringsPreview=Do,x.ArrayOneOfField=sr,x.ArrayOneOfPreview=Zo,x.ArrayPreview=Ko,x.ArrayPropertyEnumPreview=At,x.AsyncPreviewComponent=Tl,x.BooleanPreview=Lo,x.CircularProgressCenter=Ee,x.CollectionTable=Zt,x.CustomChip=Pt,x.DateTimeField=ir,x.Drawer=Er,x.EmptyValue=qe,x.EntityCollectionView=ft,x.EntityForm=Kt,x.EntityPreview=at,x.EntityReference=ke,x.ErrorView=me,x.FieldDescription=be,x.FireCMS=Ao,x.FireCMSHomePage=Cr,x.FirebaseCMSApp=Cc,x.FirebaseLoginView=Vr,x.GeoPoint=Me,x.ImagePreview=Mo,x.LabelWithIcon=ve,x.MapField=ur,x.MapPreview=Jo,x.Markdown=nt,x.MarkdownField=cr,x.NavigationRoutes=kr,x.NumberPreview=qo,x.PreviewComponent=de,x.ReadOnlyField=Jt,x.ReferenceDialog=dt,x.ReferenceField=lr,x.ReferencePreview=We,x.Scaffold=Ir,x.Select=jt,x.SideEntityDialogs=Or,x.SkeletonComponent=Fe,x.StorageThumbnail=Go,x.StorageUploadField=Yt,x.StringPreview=Ft,x.SwitchField=nr,x.Table=Sr,x.TextField=Xt,x.TimestampPreview=Wo,x.UrlComponentPreview=Mt,x.buildAdditionalColumnDelegate=uc,x.buildCollection=rc,x.buildEntityCallbacks=dc,x.buildEnumValueConfig=cc,x.buildEnumValues=sc,x.buildNavigation=oc,x.buildProperties=lc,x.buildPropertiesOrBuilder=ac,x.buildProperty=ic,x.buildPropertyField=He,x.buildSchema=nc,x.createCMSDefaultTheme=$r,x.deleteEntityWithCallbacks=zo,x.performAlgoliaTextSearch=mc,x.resolveNavigationFrom=Vo,x.saveEntityWithCallbacks=Dt,x.useAuthController=Qe,x.useClearRestoreValue=pe,x.useClipboard=Uo,x.useCollectionFetch=Ot,x.useDataSource=_e,x.useEntityFetch=it,x.useFireCMSContext=ce,x.useFirebaseAuthDelegate=Dr,x.useFirebaseStorageSource=qr,x.useFirestoreDataSource=Lr,x.useInitialiseFirebase=zr,x.useModeState=Lt,x.useNavigation=Se,x.useResolvedNavigationFrom=Nl,x.useSelectionController=to,x.useSideEntityController=Pe,x.useSnackbarController=Ue,x.useStorageSource=Ve,Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map

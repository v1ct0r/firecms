(function(x,Je){typeof exports=="object"&&typeof module<"u"?Je(exports,require("@mui/lab/AdapterDateFns"),require("@mui/lab/LocalizationProvider"),require("@date-io/date-fns"),require("date-fns/locale"),require("react"),require("@mui/material"),require("@emotion/react/jsx-runtime"),require("react-router-dom"),require("object-hash"),require("clsx"),require("@mui/icons-material/Error"),require("@mui/styles/createStyles"),require("@mui/styles/makeStyles"),require("@mui/styles"),require("@mui/material/InputBase"),require("@mui/material/styles"),require("@mui/icons-material/Search"),require("@mui/icons-material/Clear"),require("@mui/icons-material"),require("@mui/icons-material/GetApp"),require("@uiw/react-markdown-preview"),require("@mui/icons-material/ContentPaste"),require("@mui/icons-material/OpenInNew"),require("date-fns/format"),require("@mui/icons-material/DescriptionOutlined"),require("@mui/icons-material/KeyboardTab"),require("@mui/icons-material/ArrowForward"),require("@mui/icons-material/PlaylistPlay"),require("react-base-table"),require("react-measure"),require("@mui/icons-material/Assignment"),require("@mui/icons-material/ArrowUpward"),require("@mui/icons-material/ArrowDownward"),require("@mui/icons-material/ArrowDropDownCircle"),require("@mui/material/Tooltip/Tooltip"),require("@mui/lab/DateTimePicker"),require("@mui/icons-material/CalendarToday"),require("@mui/icons-material/Menu"),require("@mui/icons-material/Brightness5"),require("@mui/icons-material/Brightness3"),require("@mui/icons-material/NavigateNext"),require("react-transition-group"),require("@mui/icons-material/Close"),require("@mui/material/Button"),require("@mui/material/Dialog"),require("@mui/material/DialogActions"),require("@mui/material/DialogContent"),require("@mui/material/DialogContentText"),require("@mui/material/DialogTitle"),require("@mui/material/colors"),require("@mui/icons-material/ErrorOutline"),require("@mui/icons-material/RemoveCircle"),require("react-fast-compare"),require("yup"),require("@mui/icons-material/Edit"),require("react-dropzone"),require("@mui/base"),require("formik"),require("@mui/icons-material/DragHandle"),require("react-beautiful-dnd"),require("@mui/icons-material/InfoOutlined"),require("@mui/icons-material/ShortText"),require("@mui/icons-material/Subject"),require("@mui/icons-material/Attachment"),require("@mui/icons-material/Crop75"),require("@mui/icons-material/List"),require("@mui/icons-material/Schedule"),require("@mui/icons-material/ListAlt"),require("@mui/icons-material/Room"),require("@mui/icons-material/ViewList"),require("@mui/icons-material/Link"),require("@mui/icons-material/Equalizer"),require("@mui/icons-material/Photo"),require("@mui/icons-material/Http"),require("@mui/icons-material/Flag"),require("@mui/icons-material/Adjust"),require("@uiw/react-md-editor"),require("@emotion/react"),require("firebase/auth"),require("@firebase/auth"),require("firebase/firestore"),require("firebase/storage"),require("firebase/app"),require("@mui/icons-material/Email"),require("@mui/icons-material/ArrowBack"),require("@mui/icons-material/PersonOutline")):typeof define=="function"&&define.amd?define(["exports","@mui/lab/AdapterDateFns","@mui/lab/LocalizationProvider","@date-io/date-fns","date-fns/locale","react","@mui/material","@emotion/react/jsx-runtime","react-router-dom","object-hash","clsx","@mui/icons-material/Error","@mui/styles/createStyles","@mui/styles/makeStyles","@mui/styles","@mui/material/InputBase","@mui/material/styles","@mui/icons-material/Search","@mui/icons-material/Clear","@mui/icons-material","@mui/icons-material/GetApp","@uiw/react-markdown-preview","@mui/icons-material/ContentPaste","@mui/icons-material/OpenInNew","date-fns/format","@mui/icons-material/DescriptionOutlined","@mui/icons-material/KeyboardTab","@mui/icons-material/ArrowForward","@mui/icons-material/PlaylistPlay","react-base-table","react-measure","@mui/icons-material/Assignment","@mui/icons-material/ArrowUpward","@mui/icons-material/ArrowDownward","@mui/icons-material/ArrowDropDownCircle","@mui/material/Tooltip/Tooltip","@mui/lab/DateTimePicker","@mui/icons-material/CalendarToday","@mui/icons-material/Menu","@mui/icons-material/Brightness5","@mui/icons-material/Brightness3","@mui/icons-material/NavigateNext","react-transition-group","@mui/icons-material/Close","@mui/material/Button","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/DialogTitle","@mui/material/colors","@mui/icons-material/ErrorOutline","@mui/icons-material/RemoveCircle","react-fast-compare","yup","@mui/icons-material/Edit","react-dropzone","@mui/base","formik","@mui/icons-material/DragHandle","react-beautiful-dnd","@mui/icons-material/InfoOutlined","@mui/icons-material/ShortText","@mui/icons-material/Subject","@mui/icons-material/Attachment","@mui/icons-material/Crop75","@mui/icons-material/List","@mui/icons-material/Schedule","@mui/icons-material/ListAlt","@mui/icons-material/Room","@mui/icons-material/ViewList","@mui/icons-material/Link","@mui/icons-material/Equalizer","@mui/icons-material/Photo","@mui/icons-material/Http","@mui/icons-material/Flag","@mui/icons-material/Adjust","@uiw/react-md-editor","@emotion/react","firebase/auth","@firebase/auth","firebase/firestore","firebase/storage","firebase/app","@mui/icons-material/Email","@mui/icons-material/ArrowBack","@mui/icons-material/PersonOutline"],Je):(x=typeof globalThis<"u"?globalThis:x||self,Je(x.FireCMS={},x.AdapterDateFns,x.LocalizationProvider,x.DateFnsUtils,x.locales,x.React,x.material,x.jsxRuntime,x.reactRouterDom,x.hash,x.clsx,x.ErrorIcon,x.createStyles,x.makeStyles,x.styles$1,x.InputBase,x.styles,x.SearchIcon,x.ClearIcon,x.iconsMaterial,x.GetAppIcon,x.MarkdownPreview,x.ContentPasteIcon,x.OpenInNewIcon,x.format,x.DescriptionOutlinedIcon,x.KeyboardTabIcon,x.ArrowForwardIcon,x.PlaylistPlayIcon,x.BaseTable,x.Measure,x.AssignmentIcon,x.ArrowUpwardIcon,x.ArrowDownwardIcon,x.ArrowDropDownCircleIcon,x.Tooltip,x.DateTimePicker,x.CalendarTodayIcon,x.MenuIcon,x.Brightness5Icon,x.Brightness3Icon,x.NavigateNextIcon,x.reactTransitionGroup,x.CloseIcon,x.Button,x.Dialog,x.DialogActions,x.DialogContent,x.DialogContentText,x.DialogTitle,x.colors,x.ErrorOutlineIcon,x.RemoveCircleIcon,x.isEqual,x.yup,x.EditIcon,x.reactDropzone,x.base,x.formik,x.DragHandleIcon,x.reactBeautifulDnd,x.InfoIcon,x.ShortTextIcon,x.SubjectIcon,x.AttachmentIcon,x.Crop75Icon,x.ListIcon,x.ScheduleIcon,x.ListAltIcon,x.RoomIcon,x.ViewListIcon,x.LinkIcon,x.EqualizerIcon,x.PhotoIcon,x.HttpIcon,x.FlagIcon,x.AdjustIcon,x.MDEditor,x.react,x.auth,x.auth$1,x.firestore,x.storage,x.app,x.EmailIcon,x.ArrowBackIcon,x.PersonOutlineIcon))})(this,function(x,Je,jr,Gr,Yr,p,a,t,se,Xr,Jr,Kr,Zr,Qr,vt,Rr,ot,en,tn,Oe,on,rn,nn,ln,an,sn,cn,dn,un,yt,fn,hn,gn,pn,bn,vn,yn,wn,Cn,mn,xn,Sn,Tn,kn,_n,En,In,Bn,Pn,Fn,so,An,$n,On,Dn,Ln,co,Mn,we,Nn,Me,qn,zn,Vn,Un,Wn,Hn,jn,Gn,Yn,Xn,Jn,Kn,Zn,Qn,Rn,ei,ti,oi,te,uo,Q,Ke,ri,ni,ii,li){"use strict";function V(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function wt(e){if(e&&e.__esModule)return e;var o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(o,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}}),o.default=e,Object.freeze(o)}var ai=V(Je),si=V(jr),ci=V(Gr),fo=wt(Yr),z=V(p),ie=wt(p),ho=V(Xr),ue=V(Jr),Ct=V(Kr),K=V(Zr),J=V(Qr),di=V(Rr),ui=V(en),Ie=V(tn),fi=V(on),hi=V(rn),gi=V(nn),rt=V(ln),pi=V(an),bi=V(sn),go=V(cn),vi=V(dn),yi=V(un),wi=V(yt),po=V(fn),Ci=V(hn),bo=V(gn),mi=V(pn),xi=V(bn),vo=V(vn),mt=V(yn),Si=V(wn),Ti=V(Cn),ki=V(mn),_i=V(xn),Ei=V(Sn),Ii=V(kn),yo=V(_n),Bi=V(En),Pi=V(In),Fi=V(Bn),wo=V(Pn),Ai=V(Fn),$i=V(An),Oi=V($n),Se=V(On),Ce=wt(Dn),Di=V(Ln),Li=V(Nn),Mi=V(qn),Ni=V(zn),qi=V(Vn),zi=V(Un),Vi=V(Wn),Ui=V(Hn),Wi=V(jn),Co=V(Gn),Hi=V(Yn),ji=V(Xn),Gi=V(Jn),Yi=V(Kn),Xi=V(Zn),Ji=V(Qn),Ki=V(Rn),Zi=V(ei),Qi=V(ti),Ri=V(ni),mo=V(ii),el=V(li);const tl={isOpen:!1,close:()=>{},open:e=>{}},xt=z.default.createContext(tl),ol=({children:e})=>{const[o,r]=p.useState(!1),[i,n]=p.useState(void 0),[l,s]=p.useState(void 0),[d,c]=p.useState(void 0),u=()=>{r(!1),n(void 0),s(void 0),c(void 0)},g=h=>{const{type:f,message:b,title:y}=h;c(f),s(b),n(y),r(!0)};return t.jsxs(xt.Provider,{value:{isOpen:o,close:u,open:g},children:[e,t.jsx(a.Snackbar,{open:o,autoHideDuration:3e3,onClose:h=>u(),children:t.jsxs(a.Alert,{elevation:1,variant:"filled",onClose:h=>u(),severity:d,children:[i&&t.jsx("div",{children:i}),l&&t.jsx("div",{children:l})]})})]})},xo=z.default.createContext({sideEntityController:{},navigationContext:{},dataSource:{},storageSource:{},authController:{},snackbarController:{}}),rl=({children:e,...o})=>t.jsx(xo.Provider,{value:o,children:e}),nl={breadcrumbs:[],set:e=>{}},So=z.default.createContext(nl),il=({children:e})=>{const[o,r]=p.useState([]),i=n=>{r(n.breadcrumbs)};return t.jsx(So.Provider,{value:{breadcrumbs:o,set:i},children:e})},ll={mode:"light",setMode:e=>{},toggleMode:()=>{}},St=z.default.createContext(ll),al=({children:e})=>{const o=a.useMediaQuery("(prefers-color-scheme: dark)"),i=(localStorage.getItem("prefers-dark-mode")!=null?localStorage.getItem("prefers-dark-mode")==="true":null)??o,[n,l]=p.useState(i?"dark":"light");p.useEffect(()=>{l(i?"dark":"light")},[i]);const s=()=>{n==="light"?(o?localStorage.removeItem("prefers-dark-mode"):localStorage.setItem("prefers-dark-mode","true"),l("dark")):(o?localStorage.setItem("prefers-dark-mode","false"):localStorage.removeItem("prefers-dark-mode"),l("light"))};return t.jsx(St.Provider,{value:{mode:n,setMode:l,toggleMode:s},children:e})};function le(e){return sl(cl(e))}function sl(e){return e.startsWith("/")?e.slice(1):e}function cl(e){return e.endsWith("/")?e.slice(0,-1):e}function dl(e,o){if(!o)return;if(le(e).split("/").length%2===0)throw Error(`Collection paths must have an odd number of segments: ${e}`);return To(le(e),o)}function To(e,o){const r=le(e).split("/"),i=ko(r);let n;for(let l=0;l<i.length;l++){const s=i[l],d=o&&o.find(c=>c.path===s);if(d){if(s===e)n=d;else if(d.subcollections){const c=e.replace(s,"").split("/").slice(2).join("/");c.length>0&&(n=To(c,d.subcollections))}}if(n)break}return n}function ko(e){const o=e.length>0&&e.length%2===0?e.splice(0,e.length-1):e,r=o.length,i=[];for(let n=r;n>0;n=n-2)i.push(o.slice(0,n).join("/"));return i}function _o(e,o){const r=e.navigation;if(!r)throw Error("You can only use `computeTopNavigation` with an initialised navigationContext");const i=[...r.collections.map(l=>({url:e.buildUrlCollectionPath(l.path),name:l.name,description:l.description,group:l.group})),...(r.views??[]).map(l=>o||!l.hideFromNavigation?{url:e.buildCMSUrlPath(Array.isArray(l.path)?l.path[0]:l.path),name:l.name,description:l.description,group:l.group}:void 0).filter(l=>!!l)],n=Array.from(new Set(Object.values(i).map(l=>l.group).filter(Boolean)).values());return{navigationEntries:i,groups:n}}function Tt(e){const{path:o,collections:r,currentFullPath:i}=e,n=le(o).split("/"),l=ko(n),s=[];for(let d=0;d<l.length;d++){const c=l[d],u=r&&r.find(g=>g.path===c);if(u){const g=i&&i.length>0?i+"/"+u.path:u.path;s.push({type:"collection",path:g,collection:u});const h=le(le(o).replace(c,"")),f=h.length>0?h.split("/"):[];if(f.length>0){const b=f[0],y=g+"/"+b;if(s.push({type:"entity",entityId:b,path:g,parentCollection:u}),f.length>1){const v=f.slice(1).join("/"),C=u.schema.views,w=C&&C.find(m=>m.path===v);if(w){const m=i&&i.length>0?i+"/"+w.path:w.path;s.push({type:"custom_view",path:m,view:w})}else u.subcollections&&s.push(...Tt({path:v,customViews:C,collections:u.subcollections,currentFullPath:y}))}}break}}return s}const Eo="new",ul=e=>{const o=se.useLocation(),r=se.useNavigate(),i=p.useRef(!1),[n,l]=p.useState([]),s=e.navigation?.collections,d=o.state,c=d&&d.base_location?d.base_location:o,u=p.useCallback(f=>{l(f),e.removeAllOverridesExcept(f)},[]);p.useEffect(()=>{if(e.initialised)if(o?.state&&d.panels){const f=d.panels;u(f)}else u([])},[o?.state,e.initialised]),p.useEffect(()=>{if(s&&!i.current){if(e.isUrlCollectionPath(o.pathname)){const f=o.hash===`#${Eo}`,b=e.urlPathToDataPath(o.pathname),y=fl(b,s,f);u(y)}i.current=!0}},[o,s,n]);const g=p.useCallback(()=>{if(n.length===0)return;const f=n[n.length-1],b=o?.state&&d.panels;if(b&&b.length>0)[...b.slice(0,-1)],r(-1);else{const y=e.buildUrlCollectionPath(f.path);r(y,{replace:!0})}},[n,o]),h=p.useCallback(({path:f,entityId:b,selectedSubpath:y,copy:v,width:C,...w})=>{if(v&&!b)throw Error("If you want to copy an entity you need to provide an entityId");if(w&&(w.schema!==void 0||w.permissions!==void 0||w.subcollections!==void 0)){const k=w.permissions,I=w.schema,P=w.subcollections,L=w.overrideSchemaRegistry;e.setOverride({path:f,entityId:b,schemaConfig:{permissions:k,schema:typeof I!="function"?I:void 0,schemaResolver:typeof I=="function"?I:void 0,subcollections:P,callbacks:w.callbacks},overrideSchemaRegistry:L})}const m=le(f),S=b?e.buildUrlCollectionPath(`${m}/${b}/${y||""}`):e.buildUrlCollectionPath(`${m}#${Eo}`),_=n.length>0?n[n.length-1]:void 0;if(b&&_&&_.path===f&&_?.entityId===b){const k={..._,selectedSubpath:y},I=[...n.slice(0,-1),k];u(I),r(e.buildUrlCollectionPath(`${m}/${b}/${y||""}`),{replace:!0,state:{base_location:c,panels:I}})}else{const k={path:f,entityId:b,copy:v!==void 0&&v,width:C,selectedSubpath:y},I=[...n,k];u(I),r(S,{state:{base_location:c,panels:I}})}},[n,o]);return{sidePanels:n,close:g,open:h}};function fl(e,o,r){const i=Tt({path:e,collections:o}),n=[];let l="";for(let s=0;s<i.length;s++){const d=i[s];if(d.type==="collection"&&(l=d.path),s>0){const c=i[s-1];if(d.type==="entity")c.type==="collection"&&n.push({path:d.path,entityId:d.entityId,copy:!1});else if(d.type==="custom_view"){if(c.type==="entity"){const u=n[n.length-1];u&&(u.selectedSubpath=d.view.path)}}else if(d.type==="collection"&&c.type==="entity"){const u=n[n.length-1];u&&(u.selectedSubpath=d.collection.path)}}}return r&&n.push({path:l,copy:!1}),n}class ke{id;path;constructor(o,r){this.id=o,this.path=r}get pathWithId(){return`${this.path}/${this.id}`}}class Ne{latitude;longitude;constructor(o,r){this.latitude=o,this.longitude=r}}const hl=(e,...o)=>({...o.reduce((r,i)=>({...r,[i]:e[i]}),{})});function kt(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Ze(e,o){const r=Object.assign({},e);return kt(e)&&kt(o)&&Object.keys(o).forEach(i=>{kt(o[i])?i in e?r[i]=Ze(e[i],o[i]):Object.assign(r,{[i]:o[i]}):Object.assign(r,{[i]:o[i]})}),r}function _t(e,o){if(typeof e=="object"){if(o in e)return e[o];if(o.includes(".")){const r=o.split(".");return _t(e[r[0]],r.slice(1).join("."))}}}function Io(e){if(!e)return null;if(typeof e=="object"){if("id"in e)return e.id;if(e instanceof Date)return e.toLocaleString();if(e instanceof Ne)return ho.default(e)}return ho.default(e,{ignoreUnknown:!0})}function gl({propertyOrBuilder:e,values:o,previousValues:r,path:i,entityId:n,propertyOverride:l}){let s;if(typeof e=="function"){if(s=e({values:o,previousValues:r,entityId:n,path:i}),!s)return console.debug("Property builder not returning `Property` so it is not rendered",i,n,e),null}else s=e;return l&&(s=Ze(s,l)),s}function Qe(e){return e.readOnly||e.dataType==="timestamp"&&e.autoValue?!0:e.dataType==="reference"?!e.path:!1}function Bo(e){return typeof e.disabled=="object"&&Boolean(e.disabled.hidden)}function fe({schemaOrResolver:e,path:o,entityId:r,values:i,previousValues:n}){if(typeof e=="function")return e({entityId:r,values:i,previousValues:n});{const l=Po({propertiesOrBuilder:e.properties,path:o,entityId:r,values:i,previousValues:n});return{...e,properties:l,originalSchema:e}}}function Po({propertiesOrBuilder:e,path:o,entityId:r,values:i,previousValues:n}){return Object.entries(e).map(([l,s])=>{const d=gl({propertyOrBuilder:s,values:i??{},previousValues:n??i??{},path:o,entityId:r});return d===null?null:{[l]:d}}).filter(l=>l!==null).reduce((l,s)=>({...l,...s}),{})}function Et(e,o){return Object.entries(e).map(([r,i])=>{const n=o&&r in o?o[r]:void 0,l=pl(r,i,n);return l===void 0?{}:{[r]:l}}).reduce((r,i)=>({...r,...i}),{})}function pl(e,o,r){let i;return o.dataType==="map"&&o.properties?i=Et(o.properties,r):r!==void 0?i=r:i=void 0,i}function bl({inputValues:e,properties:o,status:r,timestampNowValue:i,referenceConverter:n,geopointConverter:l}){return Fo(e,o,(s,d)=>{if(d.dataType==="timestamp")return r==="existing"&&d.autoValue==="on_update"||(r==="new"||r==="copy")&&(d.autoValue==="on_update"||d.autoValue==="on_create")?i:s;if(n&&d.dataType==="reference"){if(s instanceof ke)return n(s)}else if(l&&d.dataType==="geopoint"){if(s instanceof Ne)return l(s)}else return s})}function vl(e,o){const r=e;return Object.entries(o).forEach(([i,n])=>{e&&e[i]!==void 0?r[i]=e[i]:n.validation?.required&&(r[i]=null)}),r}function nt(e){return new ke(e.id,e.path)}function Fo(e,o,r){const i=Object.entries(o).map(([n,l])=>{const s=e&&e[n],d=It(s,l,r);return d===void 0?{}:{[n]:d}}).reduce((n,l)=>({...n,...l}),{});return{...e,...i}}function It(e,o,r){let i;if(o.dataType==="map"&&o.properties)i=Fo(e,o.properties,r);else if(o.dataType==="array")if(o.of&&Array.isArray(e))i=e.map(n=>It(n,o.of,r));else if(o.oneOf&&Array.isArray(e)){const n=o.oneOf.typeField??"type",l=o.oneOf.valueField??"value";i=e.map(s=>{if(s===null)return null;if(typeof s!="object")return s;const d=s[n],c=o.oneOf.properties[d];return!d||!c?s:{[n]:d,[l]:It(s[l],c,r)}})}else i=e;else i=r(e,o);return i}function yl({basePath:e,baseCollectionPath:o,authController:r,navigationOrBuilder:i,schemaOverrideHandler:n,dateTimeFormat:l,locale:s,dataSource:d,storageSource:c,userConfigPersistence:u}){const[g,h]=p.useState(void 0),[f,b]=p.useState(!1),[y,v]=p.useState(void 0),C=p.useRef({}),w=le(e),m=le(o),S=w?`/${w}`:"/",_=w?`/${w}/${m}`:`/${m}`,k=g?.collections!==void 0;p.useEffect(()=>{!r.canAccessMainView||(b(!0),wl({navigationOrCollections:i,user:r.user,authController:r,dateTimeFormat:l,locale:s,dataSource:d,storageSource:c}).then(D=>{h(D),b(!1)}).catch(v))},[r.user,r.canAccessMainView,i,r,l,s,d,c]);const I=p.useCallback(D=>u?u.getCollectionConfig(D)?.schema:void 0,[u]),P=p.useCallback(({schema:D,path:B})=>({entityId:q,values:F,previousValues:Y})=>{const H=I(B),W=_t(H,"properties"),j=Po({propertiesOrBuilder:D.properties,path:B,entityId:q,values:F??D.defaultValues,previousValues:Y});return{...D,properties:Ze(j,W),originalSchema:D}},[I]),L=p.useCallback(D=>{if(!u)return;const B={...u.getCollectionConfig(D)};return delete B.schema,B},[u]),U=p.useCallback((D,B,q)=>{const F=g?.collections,Y=q??(F&&dl(le(D),F)),H=L(D),W=Y?Ze(Y,H):void 0,j=Bt(D,B);let M={};const Z=C.current[j],oe=n&&n({entityId:B,path:le(D)});if(oe&&(M=oe),Z&&(Z.overrideSchemaRegistry===void 0||Z.overrideSchemaRegistry?M={...Z,permissions:M.permissions||Z.permissions,schemaResolver:M.schemaResolver||Z.schemaResolver,subcollections:M.subcollections||Z.subcollections,callbacks:M.callbacks||Z.callbacks}:M={...M,permissions:Z.permissions??M.permissions,schemaResolver:Z.schemaResolver??M.schemaResolver,subcollections:Z.subcollections??M.subcollections,callbacks:Z.callbacks??M.callbacks}),W){const re=W.schema,R=W.subcollections,ve=W.callbacks,G=W.permissions;M={...M,schemaResolver:M.schemaResolver??P({schema:re,path:D}),subcollections:M.subcollections??R,callbacks:M.callbacks??ve,permissions:M.permissions??G}}if(!M.schemaResolver){if(!M.schema)throw Error(`Not able to resolve schema for ${j}`);M.schemaResolver=P({schema:M.schema,path:D})}return{...W,...M}},[g?.collections,L,n,P]),$=p.useCallback(({path:D,entityId:B,schemaConfig:q,overrideSchemaRegistry:F})=>{const Y=Bt(D,B);if(q)return C.current[Y]={...q,overrideSchemaRegistry:F},Y;delete C.current[Y]},[]),T=p.useCallback(D=>{const B=D.map(({path:q,entityId:F})=>Bt(q,F));Object.keys(C.current).forEach(q=>{B.includes(q)||delete C.current[q]})},[]),E=p.useCallback(D=>le(D+"/").startsWith(le(_)+"/"),[_]),A=p.useCallback(D=>{if(D.startsWith(_))return D.replace(_,"");throw Error("Expected path starting with "+_)},[_]),O=p.useCallback(D=>`${o}/${le(D)}`,[o]),N=p.useCallback(D=>`/${le(D)}`,[]),X=p.useCallback((D,B)=>{if(u){const q=u.getCollectionConfig(D);u.onCollectionModified(D,Ze(q,B))}},[u]);return{navigation:g,loading:f,navigationLoadingError:y,homeUrl:S,basePath:e,baseCollectionPath:o,onCollectionModifiedForUser:X,initialised:k,getCollectionResolver:U,setOverride:$,removeAllOverridesExcept:T,isUrlCollectionPath:E,urlPathToDataPath:A,buildUrlCollectionPath:O,buildCMSUrlPath:N}}const wl=async({navigationOrCollections:e,user:o,authController:r,dateTimeFormat:i,locale:n,dataSource:l,storageSource:s})=>Array.isArray(e)?{collections:e}:typeof e=="function"?e({user:o,authController:r,dateTimeFormat:i,locale:n,dataSource:l,storageSource:s}):e;function Bt(e,o){return o?`${le(e)}/${le(o)}`:le(e)}function Cl({authDelegate:e,authentication:o,dateTimeFormat:r,locale:i,dataSource:n,storageSource:l}){const[s,d]=p.useState(null),[c,u]=p.useState(!1),[g,h]=p.useState(!1),[f,b]=p.useState(),y=e.loginSkipped,C=(!(o===void 0||!!o)||Boolean(s)||Boolean(y))&&!g,w=p.useMemo(()=>({user:s,loginSkipped:y,canAccessMainView:C,initialLoading:e.initialLoading??!1,authLoading:c,notAllowedError:g,signOut:e.signOut,extra:f,setExtra:b,authDelegate:e}),[e,c,C,f,y,g,s]),m=p.useCallback(async()=>{const S=e.user;if(o instanceof Function&&S){u(!0);try{await o({user:S,authController:w,dateTimeFormat:r,locale:i,dataSource:n,storageSource:l})?d(S):h(!0)}catch(_){h(_),e.signOut()}u(!1)}else d(S)},[e.user]);return p.useEffect(()=>{m()},[e.user,m]),w}function Ao(e){return e.split("/").filter((o,r)=>r%2===0).reduce((o,r)=>`${o}/${r}`)}function ml(){function e(r,i){const n=`collection_config_${Ao(r)}`;localStorage.setItem(n,JSON.stringify(i))}function o(r){const i=`collection_config_${Ao(r)}`,n=localStorage.getItem(i);return n?JSON.parse(n):{}}return{onCollectionModified:e,getCollectionConfig:o}}const xl="/c";function $o(e){const{children:o,navigation:r,entityLinkBuilder:i,authentication:n,dateTimeFormat:l,locale:s,authDelegate:d,schemaOverrideHandler:c,storageSource:u,dataSource:g,basePath:h,baseCollectionPath:f}=e,b=h??"/",y=f??xl,v=s?fo[s]:void 0,C=Cl({authDelegate:d,authentication:n,dateTimeFormat:l,locale:s,dataSource:g,storageSource:u}),w=ml(),m=yl({basePath:b,baseCollectionPath:y,authController:C,navigationOrBuilder:r,dateTimeFormat:l,locale:s,dataSource:g,storageSource:u,schemaOverrideHandler:c,userConfigPersistence:w}),S=ul(m),_=C.authLoading||C.initialLoading||m.loading;return m.navigationLoadingError?t.jsxs("div",{children:[t.jsx("p",{children:"There was an error while loading your navigation config"}),t.jsx("p",{children:m.navigationLoadingError})]}):t.jsx(al,{children:t.jsx(ol,{children:t.jsx(xt.Consumer,{children:k=>{const I={authController:C,sideEntityController:S,entityLinkBuilder:i,dateTimeFormat:l,locale:s,navigationContext:m,dataSource:g,storageSource:u,snackbarController:k};return t.jsx(rl,{...I,children:t.jsx(il,{children:t.jsx(si.default,{dateAdapter:ai.default,utils:ci.default,locale:v,children:t.jsx(St.Consumer,{children:({mode:P})=>o({context:I,mode:P,loading:_})})})})})}})})})}const Sl=J.default(e=>K.default({flexCenter:{display:"flex",alignItems:"center"},smallMargin:{margin:e.spacing(1)},text:{paddingLeft:e.spacing(2)}}));function me({error:e,tooltip:o}){const r=Sl(),i=t.jsxs("div",{className:ue.default(r.flexCenter,r.smallMargin),children:[t.jsx(Ct.default,{fontSize:"small",color:"error"}),t.jsx("div",{className:r.text,children:e})]});return o?t.jsx(a.Tooltip,{title:o,children:i}):i}function Tl({builder:e}){const[o,r]=p.useState(!0),[i,n]=p.useState(null);return p.useEffect(()=>{let l=!1;return e.then(s=>{l||(r(!1),n(s))}).catch(s=>{r(!1),console.error(s)}),()=>{l=!0}},[e]),o?t.jsx(a.Skeleton,{variant:"text"}):t.jsx(ie.Fragment,{children:i})}const kl=ie.memo(Tl);class ne extends z.default.Component{constructor(o){super(o),this.state={hasError:!1}}static getDerivedStateFromError(o){return{hasError:!0}}componentDidCatch(o,r){}render(){return this.state.hasError?t.jsxs(a.Box,{display:"flex",flexDirection:"column",m:.5,children:[t.jsxs(a.Box,{display:"flex",alignItems:"center",m:.5,children:[t.jsx(Ct.default,{color:"error",fontSize:"small"}),t.jsx(a.Box,{marginLeft:1,children:"Error"})]}),t.jsx(a.Typography,{variant:"caption",children:"See the error in the console"})]}):this.props.children}}function _l(e){let o=0,r,i;for(r=0;r<e.length;r++)i=e.charCodeAt(r),o=(o<<5)-o+i,o|=0;return Math.abs(o)}const Pt={blueLighter:{color:"#cfdfff",text:"#102046"},cyanLighter:{color:"#d0f0fd",text:"#04283f"},tealLighter:{color:"#c2f5e9",text:"#012524"},greenLighter:{color:"#d1f7c4",text:"#0b1d05"},yellowLighter:{color:"#ffeab6",text:"#3b2501"},orangeLighter:{color:"#fee2d5",text:"#6b2613"},redLighter:{color:"#ffdce5",text:"#4c0c1c"},pinkLighter:{color:"#ffdaf6",text:"#400832"},purpleLighter:{color:"#ede2fe",text:"#280b42"},grayLighter:{color:"#eee",text:"#040404"},blueLight:{color:"#9cc7ff",text:"#102046"},cyanLight:{color:"#77d1f3",text:"#04283f"},tealLight:{color:"#72ddc3",text:"#012524"},greenLight:{color:"#93e088",text:"#0b1d05"},yellowLight:{color:"#ffd66e",text:"#3b2501"},orangeLight:{color:"#ffa981",text:"#6b2613"},redLight:{color:"#ff9eb7",text:"#4c0c1c"},pinkLight:{color:"#f99de2",text:"#400832"},purpleLight:{color:"#cdb0ff",text:"#280b42"},grayLight:{color:"#ccc",text:"#040404"},blueDark:{color:"#2d7ff9",text:"#fff"},cyanDark:{color:"#18bfff",text:"#fff"},tealDark:{color:"#20d9d2",text:"#fff"},greenDark:{color:"#20c933",text:"#fff"},yellowDark:{color:"#fcb400",text:"#fff"},orangeDark:{color:"#ff6f2c",text:"#fff"},redDark:{color:"#f82b60",text:"#fff"},pinkDark:{color:"#ff08c2",text:"#fff"},purpleDark:{color:"#8b46ff",text:"#fff"},grayDark:{color:"#666",text:"#fff"},blueDarker:{color:"#2750ae",text:"#cfdfff"},cyanDarker:{color:"#0b76b7",text:"#d0f0fd"},tealDarker:{color:"#06a09b",text:"#c2f5e9"},greenDarker:{color:"#338a17",text:"#d1f7c4"},yellowDarker:{color:"#b87503",text:"#ffeab6"},orangeDarker:{color:"#d74d26",text:"#fee2d5"},redDarker:{color:"#ba1e45",text:"#ffdce5"},pinkDarker:{color:"#b2158b",text:"#ffdaf6"},purpleDarker:{color:"#6b1cb0",text:"#ede2fe"},grayDarker:{color:"#444",text:"#eee"}};function El(e){const o=_l(e),r=Object.keys(Pt),i=o%r.length;return Pt[r[i]]}function Il(e){return Pt[e]}function qe(e){return e instanceof Map?Array.from(e.entries()):Object.entries(e)}function Oo(e,o){return e instanceof Map?e.get(o):e[o]}function Bl(e,o){const r=Oo(e,o);if(typeof r=="object"&&"color"in r)return r.color}function Re(e){return typeof e=="object"&&e.disabled}function Do(e){if(e!==void 0)return typeof e=="object"?e.label:e}const Pl=J.default(e=>K.default({root:{maxWidth:"100%",backgroundColor:({schema:o,error:r})=>r?"#eee":o.color},label:{color:({schema:o,error:r})=>r?"red":o.text,fontWeight:e.typography.fontWeightRegular}}));function xe({enumValues:e,enumKey:o,small:r}){const i=o!==void 0?Oo(e,o.toString()):void 0,n=Do(i),l=Bl(e,o.toString());return t.jsx(Ft,{colorSeed:`${o}`,colorSchemaKey:l,label:n!==void 0?n:o,error:!n,outlined:!1,small:r})}function Ft({colorSeed:e,label:o,colorSchemaKey:r,error:i,outlined:n,small:l}){const s=p.useMemo(()=>r?Il(r):El(e),[e,r]),d=Pl({schema:s,error:i});return t.jsx(a.Chip,{classes:{root:d.root,label:d.label},size:l?"small":"medium",variant:n?"outlined":"filled",label:o})}function At({name:e,value:o,property:r,size:i}){if(r.config?.enumValues){const n=o,l=r.config.enumValues;return t.jsx(xe,{enumKey:n,enumValues:l,small:i!=="regular"})}else return r.config?.previewAsTag?t.jsx(ne,{children:t.jsx(Ft,{colorSeed:e??"",label:o,small:i!=="regular"})}):t.jsx(t.Fragment,{children:o&&(o.includes(`
`)?o.split(`
`).map((n,l)=>t.jsx("div",{children:n},`string_preview_${l}`)):o)})}const Fl=J.default(e=>K.default({array:{display:"flex",flexDirection:"column"},arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItem:{margin:e.spacing(.5)}}));function Lo({name:e,value:o,property:r,size:i}){const n=Fl();if(!r.of||r.dataType!=="array"||r.of.dataType!=="string")throw Error("Picked wrong preview component ArrayOfStringsPreview");if(o&&!Array.isArray(o))return t.jsx("div",{children:`Unexpected value: ${o}`});const l=r.of;return t.jsx("div",{className:n.array,children:o&&o.map((s,d)=>t.jsx("div",{className:n.arrayItem,children:t.jsx(ne,{children:t.jsx(At,{name:e,property:l,value:s,size:i})})},`preview_array_strings_${e}_${d}`))})}const Al=J.default(e=>K.default({arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItem:{margin:e.spacing(.5)}}));function it({name:e,value:o,enumValues:r,size:i}){const n=Al();return t.jsx("div",{className:n.arrayWrap,children:o&&o.map((l,s)=>t.jsx("div",{className:n.arrayItem,children:t.jsx(ne,{children:t.jsx(xe,{enumKey:l,enumValues:r,small:i!=="regular"})})},`preview_array_ref_${e}_${s}`))})}function $t({name:e,value:o,property:r,size:i}){if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayEnumPreview");const n=r.of;if(!n.config?.enumValues)throw Error("Picked wrong preview component ArrayEnumPreview");if(!o)return null;const l=n.config?.enumValues;return t.jsx(it,{name:e,value:o,enumValues:l,size:i})}function Mo({name:e,value:o,property:r,size:i}){return o?t.jsx(Oe.CheckBox,{color:"secondary"}):t.jsx(Oe.CheckBoxOutlineBlank,{color:"disabled"})}function lt({source:e}){return t.jsx(hi.default,{source:typeof e=="string"?e:"",style:{fontSize:"inherit",lineHeight:"inherit",fontFamily:"inherit"},components:{a:o=>t.jsx("a",{...o,onClick:r=>r.stopPropagation(),target:"_blank",children:o.children})}})}const $l=J.default(e=>K.default({root:{borderRadius:"9999px",backgroundColor:"rgba(128,128,128,0.1)",width:"18px",height:"6px",display:"inline-block"}}));function ze(){const e=$l();return t.jsx("div",{className:e.root})}const Ol=40,Dl=100,Ll=200;function Ve(e){if(e==="tiny")return Ol;if(e==="small")return Dl;if(e==="regular")return Ll;throw Error("Thumbnail size not mapped")}function Be(e){switch(e){case"xs":case"s":return"tiny";case"m":return"small";case"l":case"xl":return"regular";default:throw Error("Missing mapping value in getPreviewSizeFrom")}}const Ml=J.default(e=>K.default({image:{maxWidth:"100%",maxHeight:"100%",borderRadius:"4px"},imageWrap:{position:"relative",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",width:({imageSize:o})=>o,height:({imageSize:o})=>o},imageTiny:{position:"relative",objectFit:"cover",width:({imageSize:o})=>o,height:({imageSize:o})=>o,borderRadius:"4px",maxHeight:"100%"},copyIcon:{borderRadius:"9999px",position:"absolute",bottom:-4,right:32,backgroundColor:e.palette.common.white},previewIcon:{borderRadius:"9999px",position:"absolute",bottom:-4,right:-4,backgroundColor:e.palette.common.white}}));function No({size:e,url:o}){const[r,i]=p.useState(!1),n=p.useMemo(()=>Ve(e),[e]),l=Ml({imageSize:n});if(e==="tiny")return t.jsx("img",{src:o,className:l.imageTiny},"tiny_image_preview_"+o);const s={maxWidth:"100%",maxHeight:"100%",borderRadius:"4px"};return t.jsxs("div",{className:l.imageWrap,onMouseEnter:()=>i(!0),onMouseMove:()=>i(!0),onMouseLeave:()=>i(!1),children:[t.jsx("img",{src:o,className:l.image,style:s}),r&&t.jsxs(t.Fragment,{children:[t.jsx(a.Tooltip,{title:"Copy url to clipboard",children:t.jsx("div",{className:l.copyIcon,children:t.jsx(a.IconButton,{size:"small",onClick:d=>{d.stopPropagation(),navigator.clipboard.writeText(o)},children:t.jsx(gi.default,{htmlColor:"#666",fontSize:"small"})})})}),t.jsx(a.Tooltip,{title:"Open image in new tab",children:t.jsx("a",{className:l.previewIcon,href:o,rel:"noopener noreferrer",target:"_blank",children:t.jsx(a.IconButton,{size:"small",onClick:d=>d.stopPropagation(),children:t.jsx(rt.default,{htmlColor:"#666",fontSize:"small"})})})})]})]},"image_preview_"+o)}function qo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array"||!r.of||r.of.dataType!=="map")throw Error("Picked wrong preview component ArrayOfMapsPreview");const n=r.of.properties;if(!n)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);const l=o,s=r.of.previewProperties;if(!l)return null;let d=s;return(!d||!d.length)&&(d=Object.keys(n),i&&(d=d.slice(0,3))),t.jsx(a.Table,{size:"small",children:t.jsx(a.TableBody,{children:l&&l.map((c,u)=>t.jsx(a.TableRow,{sx:{"&:last-child th, &:last-child td":{borderBottom:0}},children:d&&d.map(g=>t.jsx(a.TableCell,{component:"th",children:t.jsx(ne,{children:t.jsx(de,{name:g,value:c[g],property:n[g],size:"small"})})},`table-cell-${g}`))},`table_${c}_${u}`))})})}function zo({name:e,value:o,property:r,size:i}){if(r.config?.enumValues){const n=o,l=r.config.enumValues;return t.jsx(xe,{enumKey:n,enumValues:l,small:i!=="regular"})}else return t.jsx(t.Fragment,{children:o})}const Nl="MMMM dd, yyyy, HH:mm:ss",ce=()=>p.useContext(xo);function _e(){return ce().dataSource}function at({path:e,schemaResolver:o,filterValues:r,sortBy:i,itemCount:n,searchString:l,entitiesDisplayedFirst:s}){const d=i?i[0]:void 0,c=i?i[1]:void 0,u=_e(),g=p.useMemo(()=>s?s.filter(_=>!!_.values):[],[s]),[h,f]=p.useState(g),[b,y]=p.useState(!1),[v,C]=p.useState(),[w,m]=p.useState(!1),S=p.useCallback(_=>{if(!g)f(_);else{const k=new Set(g.map(I=>I.id));f([...g,..._.filter(I=>!k.has(I.id))])}},[g]);return p.useEffect(()=>{y(!0);const _=I=>{y(!1),C(void 0),S(I),m(!n||I.length<n)},k=I=>{console.error("ERROR",I),y(!1),f([]),C(I)};return u.listenCollection?u.listenCollection({path:e,schema:o,onUpdate:_,onError:k,searchString:l,filter:r,limit:n,startAfter:void 0,orderBy:d,order:c}):(u.fetchCollection({path:e,schema:o,searchString:l,filter:r,limit:n,startAfter:void 0,orderBy:d,order:c}).then(_).catch(k),()=>{})},[e,n,c,d,r,l]),{data:h,dataLoading:b,dataLoadingError:v,noMoreToLoad:w}}const Ot={};function st({path:e,entityId:o,schema:r,useCache:i=!1}){const n=_e(),[l,s]=p.useState(),[d,c]=p.useState(!0),[u,g]=p.useState();return p.useEffect(()=>{c(!0);const h=b=>{Ot[`${e}/${o}`]=b,s(b),c(!1),g(void 0)},f=b=>{console.error("ERROR fetching entity",b),c(!1),s(void 0),g(b)};return i&&Ot[`${e}/${o}`]?(s(Ot[`${e}/${o}`]),c(!1),g(void 0),()=>{}):o&&e&&r?n.listenEntity?n.listenEntity({path:e,entityId:o,schema:r,onUpdate:h,onError:f}):(n.fetchEntity({path:e,entityId:o,schema:r}).then(h).catch(f),()=>{}):(h(void 0),()=>{})},[o,e]),{entity:l,dataLoading:d,dataLoadingError:u}}async function Dt({schema:e,path:o,entityId:r,callbacks:i,values:n,previousValues:l,status:s,dataSource:d,context:c,onSaveSuccess:u,onSaveFailure:g,onPreSaveHookError:h,onSaveSuccessHookError:f}){let b;if(i?.onPreSave)try{const y=fe({values:l,entityId:r,schemaOrResolver:e,path:o});b=await i.onPreSave({schema:y,path:o,entityId:r,values:n,previousValues:l,status:s,context:c})}catch(y){console.error(y),h&&h(y);return}else b=n;return d.saveEntity({schema:e,path:o,entityId:r,values:b,previousValues:l,status:s}).then(y=>{try{if(i?.onSaveSuccess){const v=fe({values:b,entityId:r,schemaOrResolver:e,path:o});i.onSaveSuccess({schema:v,path:o,entityId:y.id,values:b,previousValues:l,status:s,context:c})}}catch(v){f&&f(v)}u&&u(y)}).catch(y=>{if(i?.onSaveFailure){const v=fe({values:b,entityId:r,schemaOrResolver:e,path:o});i.onSaveFailure({schema:v,path:o,entityId:r,values:b,previousValues:l,status:s,context:c})}g&&g(y)})}async function Vo({dataSource:e,entity:o,schema:r,callbacks:i,onDeleteSuccess:n,onDeleteFailure:l,onPreDeleteHookError:s,onDeleteSuccessHookError:d,context:c}){console.debug("Deleting entity",o.path,o.id);const u={entity:o,schema:r,entityId:o.id,path:o.path,context:c};if(i?.onPreDelete)try{await i.onPreDelete(u)}catch(g){return console.error(g),s&&s(o,g),!1}return e.deleteEntity({entity:o}).then(()=>{n&&n(o);try{return i?.onDelete&&i.onDelete(u),!0}catch(g){return d&&d(o,g),!1}}).catch(g=>(l&&l(o,g),!1))}function ge({property:e,value:o,setValue:r}){const i=p.useRef(null);p.useEffect(()=>{typeof e.disabled=="object"&&Boolean(e.disabled.clearOnDisabled)?o!=null&&(i.current=o,r(null)):i.current&&(r(i.current),i.current=null)},[e])}function Te(){return ce().navigationContext}function Uo({path:e,context:o}){const r=o.dataSource,i=o.navigationContext,n=o.navigationContext.navigation;if(!n)throw Error("Calling getNavigationFrom, but main navigation has not yet been initialised");const s=Tt({path:e,collections:n.collections}).map(d=>{if(d.type==="collection")return Promise.resolve(d);if(d.type==="entity"){const c=i.getCollectionResolver(d.path,d.entityId);if(!c?.schemaResolver)throw Error(`No schema defined in the navigation for the entity with path ${d.path}`);return r.fetchEntity({path:d.path,entityId:d.entityId,schema:c?.schemaResolver}).then(u=>({...d,entity:u}))}else{if(d.type==="custom_view")return Promise.resolve(d);throw Error("Unmapped element in useEntitiesFromPath")}});return Promise.all(s)}function ql({path:e}){const o=ce(),[r,i]=p.useState(),[n,l]=p.useState(!1),[s,d]=p.useState();return p.useEffect(()=>{o.navigationContext.navigation&&(l(!0),d(void 0),Uo({path:e,context:o}).then(u=>{i(u)}).catch(u=>d(u)).finally(()=>l(!1)))},[e,o]),o.navigationContext.navigation?{data:r,dataLoading:n,dataLoadingError:s}:{dataLoading:!0}}function Ue(){return ce().storageSource}function We(){return ce().authController}function Pe(){return ce().sideEntityController}const He=()=>p.useContext(xt),Lt=()=>p.useContext(St),Wo=e=>{const{onSuccess:o,onError:r,disableClipboardAPI:i=!1,copiedDuration:n}=e||{},l=p.useRef(null),[s,d]=p.useState(!1),[c,u]=p.useState("");p.useEffect(()=>{n&&setTimeout(()=>d(!1),n)},[s]);const g=()=>navigator.clipboard!==void 0,h=p.useCallback(m=>{if(r)r(m);else throw new Error(m)},[r]),f=p.useCallback(m=>{o&&o(m),d(!0),u(m)},[o]),b=p.useCallback(m=>{navigator.clipboard.writeText(m).then(()=>f(m)).catch(S=>{h(S),d(!1)})},[h,f]),y=()=>{g()&&navigator.clipboard.writeText("")},v=m=>w("copy",typeof m=="object"?void 0:m),C=()=>w("cut"),w=p.useCallback((m="copy",S)=>{const _=l.current,k=_&&(_.tagName==="INPUT"||_.tagName==="TEXTAREA"),I=l.current;g()&&!i&&(S?b(S):_?k?(b(I.value),m==="cut"&&(I.value="")):b(_.innerText):h("Both the ref & text were undefined"))},[i,b,h]);return{ref:l,isCoppied:s,clipboard:c,clearClipboard:y,isSupported:g,copy:v,cut:C}};function Ho({name:e,value:o,property:r,size:i}){const n=ce(),l=n?.locale?fo[n?.locale]:void 0,s=n?.dateTimeFormat??Nl,d=o?pi.default(o,s,{locale:l}):"";return t.jsx(t.Fragment,{children:d})}const zl=J.default(e=>K.default({flexCenter:{display:"flex",alignItems:"center",justifyContent:"center"},smallMargin:{margin:e.spacing(1)},arrayWrap:{display:"flex",flexWrap:"wrap"},array:{display:"flex",flexDirection:"column"},arrayItem:{margin:e.spacing(.5)},arrayItemBig:{margin:e.spacing(1)},link:{display:"flex",wordBreak:"break-word",fontWeight:e.typography.fontWeightMedium}}));function Mt({value:e,property:o,size:r}){const i=zl();if(!e)return t.jsx("div",{});const n=e;if(typeof o.config?.url=="boolean"&&o.config.url)return t.jsxs(a.Link,{className:i.link,href:n,onMouseDown:s=>{s.preventDefault()},target:"_blank",children:[t.jsx(rt.default,{style:{marginRight:8},fontSize:"small"}),n]});const l=o.config?.url||o.config?.storageMeta?.mediaType;return l==="image"?t.jsx(No,{url:n,size:r},`image_preview_${n}_${r}`):l==="audio"?t.jsxs("audio",{controls:!0,src:n,children:["Your browser does not support the",t.jsx("code",{children:"audio"})," element."]},`audio_preview_${n}_${r}`):l==="video"?t.jsx(a.CardMedia,{style:{maxWidth:r==="small"?300:500},component:"video",controls:!0,image:n},`video_preview_${n}_${r}`):t.jsx("a",{href:n,rel:"noopener noreferrer",target:"_blank",onClick:s=>s.stopPropagation(),children:t.jsx("div",{className:i.flexCenter,style:{width:Ve(r),height:Ve(r)},children:t.jsx(bi.default,{})})},`link_preview_${n}_${r}`)}function Fe({property:e,size:o}){e||console.error("No property assigned for skeleton component",e,o);let r;if(e.dataType==="string"){const i=e;i.config?.url?r=Xl(i,o):i.config?.storageMeta?r=Nt(o):r=De()}else if(e.dataType==="array"){const i=e;i.of&&(i.of.dataType==="map"&&i.of.properties?r=Ul(i.of.properties,o,i.of.previewProperties):i.of.dataType==="string"?i.of.config?.enumValues?r=Hl():i.of.config?.storageMeta?r=jo(i.of):r=Wl():r=jo(i.of))}else e.dataType==="map"?r=Vl(e,o):e.dataType==="timestamp"?r=De():e.dataType==="reference"?r=Yl():(e.dataType,r=De());return r||null}function Vl(e,o){if(!e.properties)return t.jsx(t.Fragment,{});let r;return o?e.previewProperties?r=e.previewProperties:r=Object.keys(e.properties).slice(0,3):r=Object.keys(e.properties),o?t.jsx(a.List,{children:r&&r.map(i=>t.jsx(a.ListItem,{children:t.jsx(Fe,{property:e.properties[i],size:"small"})},e.title+i))}):t.jsx(a.Table,{size:"small",children:t.jsx(a.TableBody,{children:r&&r.map((i,n)=>t.jsxs(a.TableRow,{sx:{"&:last-child th, &:last-child td":{borderBottom:0}},children:[t.jsx(a.TableCell,{component:"th",children:t.jsx(a.Skeleton,{variant:"text"})},`table-cell-title-${i}`),t.jsx(a.TableCell,{component:"th",children:t.jsx(Fe,{property:e.properties[i],size:"small"})},`table-cell-${i}`)]},`table_${e.title}_${n}`))})})}function Ul(e,o,r){let i=r;return(!i||!i.length)&&(i=Object.keys(e),o&&(i=i.slice(0,3))),t.jsx(a.Table,{size:"small",children:t.jsx(a.TableBody,{children:[0,1,2].map((n,l)=>t.jsx(a.TableRow,{children:i&&i.map(s=>t.jsx(a.TableCell,{component:"th",children:t.jsx(Fe,{property:e[s],size:"small"})},`table-cell-${s}`))},`table_${n}_${l}`))})})}function Wl(){return t.jsx(a.Grid,{children:[0,1].map((e,o)=>De(o))})}function Hl(){return t.jsx(a.Grid,{children:[0,1].map((e,o)=>t.jsx(t.Fragment,{children:De(o)}))})}function jo(e){return t.jsx(a.Grid,{children:[0,1].map((o,r)=>t.jsx(t.Fragment,{children:t.jsx(Fe,{property:e,size:"small"})}))})}function jl(){return t.jsx(a.Skeleton,{variant:"rectangular",width:300,height:100})}function Nt(e){const o=e==="tiny"?40:e==="small"?100:200;return t.jsx(a.Skeleton,{variant:"rectangular",width:o,height:o})}function Gl(e){return t.jsx(a.Skeleton,{variant:"rectangular",width:e!=="regular"?300:500,height:e!=="regular"?200:250})}function Yl(){return t.jsx(a.Skeleton,{variant:"rectangular",width:200,height:100})}function Xl(e,o="regular"){if(typeof e.config?.url=="boolean"&&e.config.url)return t.jsxs("div",{style:{display:"flex"},children:[Go(),De()]});const r=e.config?.url||e.config?.storageMeta?.mediaType;return r==="image"?Nt(o):r==="audio"?jl():r==="video"?Gl(o):Jl(o)}function Jl(e){return t.jsx(a.Box,{sx:{width:Ve(e),height:Ve(e)},children:Go()})}function De(e){return t.jsx(a.Skeleton,{variant:"text"},`skeleton_${e}`)}function Go(){return t.jsx(a.Skeleton,{variant:"rectangular",width:24,height:24})}const Yo=z.default.memo(Zl,Kl);function Kl(e,o){return e.name===o.name&&e.size===o.size&&e.height===o.height&&e.width===o.width&&e.value===o.value}const qt={};function Zl({name:e,value:o,property:r,size:i}){const n=Ue(),l=o,[s,d]=z.default.useState(qt[l]);return p.useEffect(()=>{if(!l)return;let c=!1;return r.config?.storageMeta?.storeUrl?(d(l),qt[l]=l):l&&n.getDownloadURL(l).then(function(u){c||(d(u),qt[l]=u)}),()=>{c=!0}},[r.config?.storageMeta?.storeUrl,l]),l?s?t.jsx(Mt,{name:e,value:s,property:r,size:i}):Nt(i):null}const Ql=J.default(e=>K.default({arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItem:{margin:e.spacing(.5)}}));function Xo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array"||!r.of||r.of.dataType!=="string")throw Error("Picked wrong preview component ArrayOfStorageComponentsPreview");const n=i==="regular"?"small":"tiny",l=Ql();return t.jsx("div",{className:l.arrayWrap,children:o&&o.map((s,d)=>t.jsx("div",{className:l.arrayItem,children:t.jsx(ne,{children:t.jsx(de,{name:e,value:s,property:r.of,size:n})})},`preview_array_storage_${e}_${d}`))})}const je=ie.memo(ea,Rl);function Rl(e,o){return e.name===o.name&&e.size===o.size&&e.height===o.height&&e.width===o.width&&e.onHover===o.onHover&&e.value?.id===o.value?.id&&e.value?.path===o.value?.path}function ea({value:e,property:o,onClick:r,size:i,onHover:n}){if(typeof o.path!="string")throw Error("Picked the wrong component ReferencePreviewComponent");const l=e,s=o.previewProperties,d=Te(),c=Pe(),u=d.getCollectionResolver(o.path);if(!u)throw Error(`Couldn't find the corresponding collection view for the path: ${o.path}`);const g=u.schema,{entity:h,dataLoading:f,dataLoadingError:b}=st({path:l.path,entityId:l.id,schema:u.schemaResolver,useCache:!0}),y=p.useMemo(()=>{let w=s;return(!w||!w.length)&&(w=Object.keys(g.properties)),i==="small"||i==="regular"?w=w.slice(0,3):i==="tiny"&&(w=w.slice(0,1)),w},[s,g.properties,i]);let v;function C(w,m){return t.jsx(me,{error:w,tooltip:m})}return e?e instanceof ke?h&&!h.values?v=C("Reference does not exist",l.path):v=t.jsxs(t.Fragment,{children:[t.jsxs(a.Box,{sx:{display:"flex",flexDirection:"column",flexGrow:1,maxWidth:"calc(100% - 60px)",margin:1},children:[i!=="tiny"&&(e?t.jsx(a.Box,{sx:{display:i!=="regular"?"block":void 0,whiteSpace:i!=="regular"?"nowrap":void 0,overflow:i!=="regular"?"hidden":void 0,textOverflow:i!=="regular"?"ellipsis":void 0},children:t.jsx(a.Typography,{variant:"caption",className:"mono",children:e.id})}):t.jsx(a.Skeleton,{variant:"text"})),y&&y.map(w=>{const m=g.properties[w];return m?t.jsx("div",{children:h?t.jsx(de,{name:w,value:h.values[w],property:m,size:"tiny"}):t.jsx(Fe,{property:m,size:"tiny"})},"ref_prev_"+w):null})]}),t.jsx(a.Box,{sx:{margin:"auto"},children:h&&t.jsx(a.Tooltip,{title:`See details for ${h.id}`,children:t.jsx(a.IconButton,{size:i==="tiny"?"small":"medium",onClick:w=>{w.stopPropagation(),c.open({entityId:h.id,path:h.path,schema:g,overrideSchemaRegistry:!1})},children:t.jsx(go.default,{fontSize:"small"})})})})]}):v=C("Unexpected value",JSON.stringify(e)):v=C("Reference not set"),t.jsx(a.Paper,{elevation:0,sx:w=>{const m=r?{tabindex:0,backgroundColor:n?w.palette.mode==="dark"?a.lighten(w.palette.background.default,.1):a.darken(w.palette.background.default,.15):a.darken(w.palette.background.default,.1),transition:"background-color 300ms ease, box-shadow 300ms ease",boxShadow:n?"0 0 0 2px rgba(128,128,128,0.05)":void 0,cursor:n?"pointer":void 0}:{};return{width:"100%",display:"flex",color:"#838383",backgroundColor:a.darken(w.palette.background.default,.1),borderRadius:"2px",overflow:"hidden",padding:i==="regular"?1:0,itemsAlign:i==="tiny"?"center":void 0,fontWeight:w.typography.fontWeightMedium,...m}},onClick:r,children:v})}const ta=J.default(e=>K.default({arrayItem:{margin:e.spacing(.5)}}));function Jo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array"||!r.of||r.of.dataType!=="reference")throw Error("Picked wrong preview component ArrayOfReferencesPreview");const n=ta(),l=i==="regular"?"small":"tiny";return t.jsx(t.Fragment,{children:o&&o.map((s,d)=>t.jsx("div",{className:n.arrayItem,children:t.jsx(je,{name:`${e}[${d}]`,size:l,value:s,property:r.of})},`preview_array_ref_${e}_${d}`))})}const oa=J.default(()=>K.default({tableNoBottomBorder:{"&:last-child th, &:last-child td":{borderBottom:0}},verticalAlignTop:{verticalAlign:"top"}}));function Ko({name:e,value:o,property:r,size:i}){const n=oa();if(r.dataType!=="map")throw Error("Picked wrong preview component MapPreview");const l=r;if(!l.properties)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);if(!o)return null;let s;return i==="regular"?s=Object.keys(l.properties):(s=l.previewProperties||Object.keys(l.properties),i==="small"?s=s.slice(0,3):i==="tiny"&&(s=s.slice(0,1))),i!=="regular"?t.jsx(t.Fragment,{children:s.map((d,c)=>t.jsx("div",{children:t.jsx(ne,{children:t.jsx(de,{name:d,value:o[d],property:l.properties[d],size:i})})},"map_preview_"+l.title+d+c))}):t.jsx(a.Table,{size:"small",children:t.jsx(a.TableBody,{children:s&&s.map((d,c)=>t.jsxs(a.TableRow,{className:n.tableNoBottomBorder,children:[t.jsx(a.TableCell,{className:n.verticalAlignTop,width:"30%",component:"th",children:t.jsx(a.Typography,{variant:"caption",color:"textSecondary",children:l.properties[d].title})},`table-cell-title-${e}-${d}`),t.jsx(a.TableCell,{width:"70%",className:n.verticalAlignTop,component:"th",children:t.jsx(ne,{children:t.jsx(de,{name:d,value:o[d],property:l.properties[d],size:"small"})})},`table-cell-${e}-${d}`)]},`map_preview_table_${e}_${c}`))})},`map_preview_${e}`)}const ra=J.default(e=>K.default({array:{display:"flex",flexDirection:"column"},arrayItemBig:{margin:e.spacing(1)}}));function Zo({name:e,value:o,property:r,size:i}){if(!r.of)throw Error(`You need to specify an 'of' prop (or specify a custom field) in your array property ${e}`);const n=ra();if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayPreview");const l=o;if(!l)return null;const s=i==="regular"?"small":"tiny";return t.jsx("div",{className:n.array,children:l&&l.map((d,c)=>t.jsxs(z.default.Fragment,{children:[t.jsx("div",{className:n.arrayItemBig,children:t.jsx(ne,{children:t.jsx(de,{name:e,value:d,property:r.of,size:s})})}),c<l.length-1&&t.jsx(a.Divider,{})]},"preview_array_"+d+"_"+c))})}const na=J.default(e=>K.default({array:{display:"flex",flexDirection:"column"},arrayWrap:{display:"flex",flexWrap:"wrap"},arrayItemBig:{margin:e.spacing(1)}}));function Qo({name:e,value:o,property:r,size:i}){if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayPreview");if(!r.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${e}`);const n=na(),l=o;if(!l)return null;const s=i==="regular"?"small":"tiny",d=r.oneOf.typeField??"type",c=r.oneOf.valueField??"value",u=r.oneOf.properties;return t.jsx("div",{className:n.array,children:l&&l.map((g,h)=>t.jsxs(z.default.Fragment,{children:[t.jsx("div",{className:n.arrayItemBig,children:t.jsx(ne,{children:g&&t.jsx(de,{name:e,value:g[c],property:u[g[d]],size:s})})}),h<l.length-1&&t.jsx(a.Divider,{})]},"preview_array_"+g+"_"+h))})}function de(e){let o;const{property:r,name:i,value:n,size:l,height:s,width:d}=e,c={...e};if(n===void 0)o=t.jsx(ze,{});else if(r.config?.Preview)o=p.createElement(r.config.Preview,{name:i,value:n,property:r,size:l,height:s,width:d,customProps:r.config.customProps});else if(n===null)o=t.jsx(ze,{});else if(r.dataType==="string"){const u=r;typeof n=="string"?u.config?.url?o=t.jsx(Mt,{...c,property:r,value:n}):u.config?.storageMeta?o=t.jsx(Yo,{...c,property:r,value:n}):u.config?.markdown?o=t.jsx(lt,{source:n}):o=t.jsx(At,{...c,property:r,value:n}):o=Le(i,r.dataType,n)}else if(r.dataType==="array")if(n instanceof Array){const u=r;if(!u.of&&!u.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${i}`);u.of?u.of.dataType==="map"?o=t.jsx(qo,{name:i,property:r,value:n,size:l}):u.of.dataType==="reference"?typeof u.of.path=="string"?o=t.jsx(Jo,{...c,value:n,property:r}):o=t.jsx(ze,{}):u.of.dataType==="string"?u.of.config?.enumValues?o=t.jsx($t,{...c,value:n,property:r}):u.of.config?.storageMeta?o=t.jsx(Xo,{...c,value:n,property:r}):o=t.jsx(Lo,{...c,value:n,property:r}):u.of.dataType==="number"?u.of.config?.enumValues&&(o=t.jsx($t,{...c,value:n,property:r})):o=t.jsx(Zo,{...c,value:n,property:r}):u.oneOf&&(o=t.jsx(Qo,{...c,value:n,property:r}))}else o=Le(i,r.dataType,n);else r.dataType==="map"?typeof n=="object"?o=t.jsx(Ko,{...c,property:r}):o=Le(i,r.dataType,n):r.dataType==="timestamp"?n instanceof Date?o=t.jsx(Ho,{...c,value:n,property:r}):o=Le(i,r.dataType,n):r.dataType==="reference"?typeof r.path=="string"?n instanceof ke?o=t.jsx(je,{...c,value:n,property:r}):o=Le(i,r.dataType,n):o=t.jsx(ze,{}):r.dataType==="boolean"?typeof n=="boolean"?o=t.jsx(Mo,{...c,value:n,property:r}):o=Le(i,r.dataType,n):r.dataType==="number"?typeof n=="number"?o=t.jsx(zo,{...c,value:n,property:r}):o=Le(i,r.dataType,n):o=JSON.stringify(n);return o??t.jsx(ze,{})}function Le(e,o,r){return console.error(`Unexpected value for property ${e}, of type ${o}`,r),t.jsx(me,{error:`Unexpected value: ${JSON.stringify(r)}`})}function ia(e="inherit",o="inherit"){return t.jsx(Zi.default,{color:e,fontSize:o})}function ct(e,o="inherit",r="inherit"){return e.dataType==="string"?e.config?.multiline||e.config?.markdown?t.jsx(qi.default,{color:o,fontSize:r}):e.config?.storageMeta?e.config.storageMeta.mediaType==="image"?t.jsx(Xi.default,{color:o,fontSize:r}):t.jsx(zi.default,{color:o,fontSize:r}):e.config?.url?t.jsx(Ji.default,{color:o,fontSize:r}):e.config?.enumValues?t.jsx(Ui.default,{color:o,fontSize:r}):t.jsx(Ni.default,{color:o,fontSize:r}):e.dataType==="number"?t.jsx(Yi.default,{color:o,fontSize:r}):e.dataType==="geopoint"?t.jsx(Hi.default,{color:o,fontSize:r}):e.dataType==="map"?e.properties?t.jsx(ji.default,{color:o,fontSize:r}):t.jsx(Co.default,{color:o,fontSize:r}):e.dataType==="array"?e.of?ct(e.of,o,r):t.jsx(Co.default,{color:o,fontSize:r}):e.dataType==="boolean"?t.jsx(Ki.default,{color:o,fontSize:r}):e.dataType==="timestamp"?t.jsx(Wi.default,{color:o,fontSize:r}):e.dataType==="reference"?t.jsx(Gi.default,{color:o,fontSize:r}):t.jsx(Vi.default,{color:o,fontSize:r})}const Ro=J.default(e=>K.default({property:{display:"flex"},valuePreview:{height:"72px",padding:e.spacing(2,3)},iconCell:{paddingTop:e.spacing(1)},titleCell:{width:"25%",padding:e.spacing(1)}}));function dt({entity:e,schema:o,path:r}){const i=Ro(),n=ce(),l=o.properties;return t.jsx(a.TableContainer,{children:t.jsx(a.Table,{"aria-label":"entity table",children:t.jsxs(a.TableBody,{children:[t.jsxs(a.TableRow,{children:[t.jsx(a.TableCell,{align:"right",component:"td",scope:"row",className:i.titleCell,children:t.jsx(a.Typography,{variant:"caption",color:"textSecondary",children:"Id"})}),t.jsx(a.TableCell,{padding:"none",className:i.iconCell,children:ia("disabled","small")}),t.jsx(a.TableCell,{className:i.valuePreview,children:t.jsxs(a.Box,{display:"flex",alignItems:"center",children:[e.id,n?.entityLinkBuilder&&t.jsx("a",{href:n.entityLinkBuilder({entity:e}),rel:"noopener noreferrer",target:"_blank",children:t.jsx(a.IconButton,{"aria-label":"go-to-entity-datasource",size:"large",children:t.jsx(rt.default,{fontSize:"small"})})})]})})]}),o&&Object.entries(l).map(([s,d])=>{const c=e.values[s];return t.jsxs(a.TableRow,{children:[t.jsx(a.TableCell,{align:"right",component:"td",scope:"row",className:i.titleCell,children:t.jsx(a.Typography,{style:{paddingLeft:"16px"},variant:"caption",color:"textSecondary",children:d.title})}),t.jsx(a.TableCell,{padding:"none",className:i.iconCell,children:ct(d,"disabled","small")}),t.jsx(a.TableCell,{className:i.valuePreview,children:t.jsx(ne,{children:t.jsx(de,{name:s,value:c,property:d,size:"regular"})})})]},"entity_prev"+d.title+s)})]})})})}var la=Object.freeze(Object.defineProperty({__proto__:null,useStyles:Ro,EntityPreview:dt,default:dt},Symbol.toStringTag,{value:"Module"}));function aa(e){return e.dataType==="boolean"?"center":e.dataType==="number"?e.config?.enumValues?"left":"right":e.dataType==="timestamp"?"right":"left"}function er(e){if(e.columnWidth)return e.columnWidth;if(e.dataType==="string")return e.config?.url?e.config?.url==="video"||e.config?.storageMeta?.mediaType==="video"?340:e.config?.url==="audio"||e.config?.storageMeta?.mediaType==="audio"?300:240:e.config?.storageMeta?220:e.config?.enumValues?200:e.config?.multiline||e.config?.markdown?300:(e.validation?.email,200);if(e.dataType==="array"){const o=e;return o.of?er(o.of):300}else return e.dataType==="number"?e.config?.enumValues?200:140:e.dataType==="map"?360:e.dataType==="timestamp"?160:e.dataType==="reference"?220:e.dataType==="boolean"?140:200}function tr(e){return`subcollection:${e.path}`}function sa(e,o,r){return p.useMemo(()=>{const i=e.properties,n=e.excludedProperties,l=e.additionalColumns??[],s=e.subcollections??[],d=o.properties,c=Object.entries(d).filter(([h,f])=>f.disabled&&typeof f.disabled=="object"&&f.disabled.hidden).map(([h,f])=>h),u=[...Object.keys(e.schema.properties),...l.map(h=>h.id)];let g;if(i?g=i.map(h=>u.find(f=>f===h)).filter(h=>!!h):n?g=u.filter(h=>!n.includes(h)):g=u.filter(h=>!c.includes(h)),r){const h=s.map(f=>tr(f)).filter(f=>n?!n?.includes(f):!0);g.push(...h.filter(f=>!g.includes(f)))}return g},[e.properties,e.excludedProperties,e.additionalColumns,e.subcollections,e.schema.properties,o.properties,r])}const ca=J.default(e=>K.default({search:{position:"relative",display:"flex",alignItems:"center",height:40,borderRadius:e.shape.borderRadius,backgroundColor:e.palette.mode==="light"?ot.alpha(e.palette.common.black,.05):ot.darken(e.palette.background.default,.2),"&:hover":{backgroundColor:e.palette.mode==="light"?ot.alpha(e.palette.common.black,.1):ot.darken(e.palette.background.default,.3)},marginLeft:e.spacing(1),[e.breakpoints.up("sm")]:{marginLeft:e.spacing(1),width:"auto"}},searchIcon:{padding:e.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit",minHeight:"inherit"},inputInput:{padding:e.spacing(1,1,1,0),paddingLeft:`calc(1em + ${e.spacing(4)})`,transition:e.transitions.create("width"),width:"100%",[e.breakpoints.up("sm")]:{width:"12ch"}},inputActive:{[e.breakpoints.up("sm")]:{width:"20ch"}}}));function da({onTextSearch:e}){const o=ca(),[r,i]=p.useState(""),[n,l]=p.useState(!1);p.useEffect(()=>{const d=setTimeout(()=>{e(r||void 0)},250);return()=>{clearTimeout(d)}},[r]);const s=p.useCallback(()=>{i(""),e(void 0)},[]);return t.jsx(a.FormControl,{children:t.jsxs("div",{className:o.search,children:[t.jsx("div",{className:o.searchIcon,children:t.jsx(ui.default,{htmlColor:"#666"})}),t.jsx(di.default,{placeholder:"Search",value:r,onChange:d=>{i(d.target.value)},onFocus:()=>l(!0),onBlur:()=>l(!1),classes:{root:o.inputRoot,input:ue.default(o.inputInput,{[o.inputActive]:n})},endAdornment:r?t.jsx(a.IconButton,{size:"small",onClick:s,children:t.jsx(Ie.default,{fontSize:"small"})}):t.jsx("div",{style:{width:26}}),inputProps:{"aria-label":"search"}})]})})}const ua=J.default(e=>K.default({toolbar:{minHeight:56,[e.breakpoints.down("xl")]:{paddingLeft:e.spacing(.5),paddingRight:e.spacing(.5)},paddingLeft:e.spacing(1),paddingRight:e.spacing(1),backgroundColor:e.palette.mode==="light"?e.palette.common.white:e.palette.background.default,borderBottom:`1px solid ${e.palette.divider}`,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%"},actions:{display:"flex",alignItems:"center","& > *":{[e.breakpoints.down("md")]:{marginRight:e.spacing(.5)},marginRight:e.spacing(1)}},selectRoot:{"label + &":{marginTop:e.spacing(3)}},input:{borderRadius:4,position:"relative",backgroundColor:e.palette.mode==="light"?a.alpha(e.palette.common.black,.05):a.darken(e.palette.background.default,.2),fontSize:14,fontWeight:e.typography.fontWeightMedium,padding:"10px 26px 10px 12px",transition:e.transitions.create(["border-color","box-shadow"]),"&:focus":{borderRadius:4}},item:{backgroundColor:e.palette.background.default,fontSize:14,fontWeight:e.typography.fontWeightMedium,paddingTop:e.spacing(1),paddingBottom:e.spacing(1),"&:hover":{backgroundColor:a.darken(e.palette.background.default,.1)},"&:focus":{backgroundColor:a.darken(e.palette.background.default,.2),"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:e.palette.text.primary}}}}));function fa(e){const o=ua(),r=a.useTheme(),i=a.useMediaQuery(r.breakpoints.up("md")),n=e.filterIsSet&&t.jsx(a.Box,{display:"flex",alignItems:"center",children:t.jsx(a.Tooltip,{title:"Clear filter",children:t.jsx(a.IconButton,{style:{height:"fit-content"},"aria-label":"filter clear",onClick:e.clearFilter,size:"large",children:t.jsx(Ie.default,{})})})}),l=t.jsx(a.Select,{variant:"standard",value:e.size,style:{width:56},onChange:s=>{e.onSizeChanged(s.target.value)},MenuProps:{MenuListProps:{disablePadding:!0,style:{borderRadius:4}},elevation:1},input:t.jsx(a.InputBase,{classes:{root:o.selectRoot,input:o.input}}),renderValue:s=>s.toUpperCase(),children:["xs","s","m","l","xl"].map(s=>t.jsx(a.MenuItem,{classes:{root:o.item},value:s,children:s.toUpperCase()},`size-select-${s}`))});return t.jsxs("div",{className:o.toolbar,children:[t.jsxs(a.Box,{display:"flex",alignItems:"center",children:[e.title&&t.jsx(a.Hidden,{lgDown:!0,children:t.jsx(a.Box,{mr:2,children:e.title})}),l,n]}),t.jsxs("div",{className:o.actions,children:[i&&t.jsx(a.Box,{width:22,children:e.loading&&t.jsx(a.CircularProgress,{size:16,thickness:8})}),e.onTextSearch&&t.jsx(da,{onTextSearch:e.onTextSearch},"search-bar"),e.actions]})]})}const ha=J.default(e=>K.default({tableContainer:{width:"100%",height:"100%",flexGrow:1},headerTypography:{fontSize:"0.750rem",fontWeight:600,textTransform:"uppercase"},header:{width:"calc(100% + 24px)",margin:"0px -12px",padding:"0px 12px",color:e.palette.text.secondary,backgroundColor:e.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600},tableRow:{cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.875rem"},tableRowClickable:{"&:hover":{backgroundColor:e.palette.mode==="dark"?a.alpha(e.palette.background.default,.6):a.alpha(e.palette.background.default,.5)}},column:{padding:"0px !important"},cellButtonsWrap:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",backgroundColor:(e.palette.mode==="dark",a.alpha(e.palette.background.default,.8))},cellButtons:{minWidth:138},cellButtonsId:{width:138,textAlign:"center",textOverflow:"ellipsis",overflow:"hidden"},selectContainer:{display:"flex",justifyContent:"space-around"},verticalLine:{width:"1px",backgroundColor:"#dfdfdf",height:"55px"},"select-all":{position:"absolute",top:"-100px",right:"-100px",opacity:"0"}}));function zt({entity:e,isSelected:o,isAllSelected:r,selectionEnabled:i,size:n,toggleEntitySelection:l,selectAll:s,onCopyClicked:d,onEditClicked:c,onDeleteClicked:u,data:g}){const h=Boolean(c),f=Boolean(u),b=ha(),[y,v]=z.default.useState(null);p.useCallback(m=>{v(m.currentTarget),m.stopPropagation()},[v]),p.useCallback(()=>{v(null)},[v]);const C=m=>{l&&l(e),m.stopPropagation()},w=m=>{s&&s(e),m.stopPropagation()};return p.useCallback(m=>{m.stopPropagation(),u&&u(e),v(null)},[e,u,v]),p.useCallback(m=>{m.stopPropagation(),d&&d(e),v(null)},[e,d,v]),t.jsxs("div",{className:b.cellButtonsWrap,children:[(h||f||i)&&t.jsxs("div",{className:b.cellButtons,children:["(",t.jsxs("div",{className:b.selectContainer,children:[h&&t.jsx(a.Tooltip,{title:`Edit ${e.id}`,children:t.jsx(a.IconButton,{onClick:m=>{m.stopPropagation(),c&&c(e)},size:"large",children:t.jsx(Oe.KeyboardTab,{})})}),t.jsx("span",{className:b.verticalLine}),i&&t.jsxs("div",{children:[t.jsx(a.Tooltip,{title:`Select ${e.id}`,style:{marginTop:"5px"},children:t.jsx(a.Checkbox,{checked:o,onChange:C})}),t.jsx(a.Tooltip,{title:"Select All",className:b["select-all"]+" select-all",children:t.jsx(a.Checkbox,{checked:r,onChange:w})})]})]}),")"]}),n!=="xs"&&t.jsx("div",{className:b.cellButtonsId,children:e?t.jsxs(a.Typography,{className:"mono",variant:"caption",color:"textSecondary",children:[" ",e.id," "]}):t.jsx(a.Skeleton,{variant:"text"})})]})}function Vt(e){switch(e){case"xl":return 400;case"l":return 280;case"m":return 140;case"s":return 80;case"xs":return 54;default:throw Error("Missing mapping for collection size -> height")}}const ga=J.default(e=>K.default({tableCell:{position:"relative",height:"100%",width:"100%",border:"2px solid transparent",borderRadius:4,overflow:"hidden",contain:"strict",display:"flex",padding:({size:o,removePadding:r})=>{if(r)return 0;switch(o){case"l":case"xl":return e.spacing(2);case"m":return e.spacing(1);case"s":return e.spacing(.5);default:return e.spacing(.25)}},"&:hover":{backgroundColor:({disabled:o})=>o?void 0:e.palette.mode==="dark"?e.palette.background.paper:e.palette.background.default},justifyContent:({align:o})=>{switch(o){case"right":return"flex-end";case"center":return"center";case"left":default:return"flex-start"}}},fullWidth:{width:"100%"},fullHeight:{height:"100%"},error:{border:`2px solid ${e.palette.error.light} !important`},selected:{backgroundColor:e.palette.mode==="dark"?e.palette.background.paper:e.palette.background.default,border:"2px solid #5E9ED6",transition:"border-color 300ms ease-in-out"},saved:{border:`2px solid ${e.palette.success.light}`},disabled:{alpha:.8},iconsTop:{position:"absolute",top:2,right:2},arrow:{color:e.palette.error.light},tooltip:{margin:"0 8px",backgroundColor:e.palette.error.light},centered:{alignItems:"center"},faded:{"-webkit-mask-image":"linear-gradient(to bottom, black 60%, transparent 100%)",maskImage:"linear-gradient(to bottom, black 60%, transparent 100%)",alignItems:"start"},scrollable:{overflow:"auto",alignItems:"start"}})),pa=({children:e,selected:o,focused:r,disabled:i,disabledTooltip:n,size:l,saved:s,error:d,align:c,allowScroll:u,openPopup:g,removePadding:h,fullHeight:f,select:b,showExpandIcon:y=!0})=>{const v=z.default.createRef(),[C,w]=p.useState(!1),m=p.useMemo(()=>Vt(l),[l]),[S,_]=p.useState(!1),[k,I]=p.useState(s),P=z.default.createRef();p.useEffect(()=>{P.current&&r&&P.current.focus({preventScroll:!0})},[r]),p.useEffect(()=>{k!==s&&I(!0);const X=setTimeout(()=>{I(!1)},500);return()=>{clearTimeout(X)}},[s]);const L=p.useCallback(()=>{if(g){const N=v&&v?.current?.getBoundingClientRect();g(N)}},[v]),U=p.useCallback(N=>{N.detail===3&&L()},[L]),$=p.useCallback(()=>{if(!b)return;const N=v&&v?.current?.getBoundingClientRect();i?b(void 0):!o&&N&&b(N)},[v,b,o,i]),T=p.useCallback(N=>{$(),N.stopPropagation()},[$]),E=p.useCallback(N=>{if(N?.bounds){const X=N.bounds.height>m;C!==X&&w(X)}},[C,m]),A=ga({size:l,align:c,disabled:i,removePadding:h}),O=t.jsx(po.default,{bounds:!0,onResize:E,children:({measureRef:N})=>t.jsx("div",{ref:N,className:ue.default(A.fullWidth,{[A.fullHeight]:f}),children:e})});return t.jsxs("div",{tabIndex:o||i?void 0:0,ref:v,onFocus:T,onClick:U,onMouseEnter:()=>_(!0),onMouseMove:()=>_(!0),onMouseLeave:()=>_(!1),className:ue.default(A.tableCell,{[A.disabled]:i,[A.centered]:i||!C,[A.error]:d,[A.saved]:o&&k,[A.selected]:!d&&(o||r),[A.fullHeight]:f}),children:[t.jsx("div",{className:ue.default(A.fullWidth,{[A.faded]:!i&&!u&&C,[A.scrollable]:!i&&u&&C,[A.fullHeight]:f}),children:O}),i&&S&&n&&t.jsx("div",{style:{position:"absolute",top:4,right:4,fontSize:"14px"},children:t.jsx(a.Tooltip,{title:n,children:t.jsx(Oi.default,{color:"disabled",fontSize:"inherit"})})}),(d||y)&&t.jsxs("div",{className:A.iconsTop,children:[o&&!i&&y&&t.jsx(a.IconButton,{ref:P,color:"inherit",size:"small",onClick:L,children:t.jsxs("svg",{className:"MuiSvgIcon-root MuiSvgIcon-fontSizeSmall",fill:"#666",width:"20",height:"20",viewBox:"0 0 24 24",children:[t.jsx("path",{className:"cls-2",d:"M20,5a1,1,0,0,0-1-1L14,4h0a1,1,0,0,0,0,2h2.57L13.29,9.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L18,7.42V10a1,1,0,0,0,1,1h0a1,1,0,0,0,1-1Z"}),t.jsx("path",{className:"cls-2",d:"M10.71,13.29a1,1,0,0,0-1.42,0L6,16.57V14a1,1,0,0,0-1-1H5a1,1,0,0,0-1,1l0,5a1,1,0,0,0,1,1h5a1,1,0,0,0,0-2H7.42l3.29-3.29A1,1,0,0,0,10.71,13.29Z"})]})}),d&&t.jsx(a.Tooltip,{classes:{arrow:A.arrow,tooltip:A.tooltip},arrow:!0,placement:"left",title:d.message,children:t.jsx($i.default,{fontSize:"inherit",color:"error"})})]})]})},Ut=z.default.memo(pa,ba);function ba(e,o){return e.selected===o.selected&&e.focused===o.selected&&e.disabled===o.disabled&&e.size===o.size&&e.align===o.align&&e.saved===o.saved&&e.showExpandIcon===o.showExpandIcon&&e.removePadding===o.removePadding&&e.fullHeight===o.fullHeight&&Se.default(e.value,o.value)}Ce.addMethod(Ce.array,"uniqueInArray",function(e=r=>r,o){return this.test("uniqueInArray",o,r=>!r||r.length===new Set(r.map(e)).size)});function or(e,o){const r={};return Object.entries(e).forEach(([i,n])=>{r[i]=ut({property:n,customFieldValidator:o,name:i})}),Ce.object().shape(r)}function ut(e){const o=e.property;if(typeof o=="function")throw console.log("Error in property",e),Error("PropertyBuilders can only be defined as the root properties in entity schemas, not in child properties");if(o.dataType==="string")return ya(e);if(o.dataType==="number")return wa(e);if(o.dataType==="boolean")return Sa(e);if(o.dataType==="map")return va(e);if(o.dataType==="array")return ka(e);if(o.dataType==="timestamp")return ma(e);if(o.dataType==="geopoint")return Ca(e);if(o.dataType==="reference")return xa(e);throw console.error("Unsupported data type in yup mapping",o),Error("Unsupported data type in yup mapping")}function va({property:e,parentProperty:o,customFieldValidator:r,name:i}){const n={};return e.properties&&Object.entries(e.properties).forEach(([l,s])=>{n[l]=ut({property:s,parentProperty:e,customFieldValidator:r,name:`${i}[${l}]`})}),Ce.object().shape(n)}function ya({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.string();const l=e.validation;return e.config?.enumValues&&(l?.required&&(n=n.required(l?.requiredMessage?l.requiredMessage:"Required")),n=n.oneOf(qe(e.config?.enumValues).map(([s,d])=>s))),l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),l.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",(s,d)=>r({name:i,property:e,parentProperty:o,value:s}))),(l.min||l.min===0)&&(n=n.min(l.min,`${e.title} must be min ${l.min} characters long`)),(l.max||l.max===0)&&(n=n.max(l.max,`${e.title} must be max ${l.max} characters long`)),l.matches&&(n=n.matches(l.matches,l.matchesMessage)),l.email&&(n=n.email(`${e.title} must be an email`)),l.url&&(n=n.url(`${e.title} must be a url`)),l.trim&&(n=n.trim()),l.lowercase&&(n=n.lowercase()),l.uppercase&&(n=n.uppercase())):n=n.notRequired().nullable(!0),n}function wa({property:e,parentProperty:o,customFieldValidator:r,name:i}){const n=e.validation;let l=Ce.number().typeError("Must be a number");return n?(l=n.required?l.required(n.requiredMessage?n.requiredMessage:"Required").nullable(!0):l.notRequired().nullable(!0),n.unique&&r&&i&&(l=l.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s}))),(n.min||n.min===0)&&(l=l.min(n.min,`${e.title} must be higher or equal to ${n.min}`)),(n.max||n.max===0)&&(l=l.max(n.max,`${e.title} must be lower or equal to ${n.max}`)),(n.lessThan||n.lessThan===0)&&(l=l.lessThan(n.lessThan,`${e.title} must be higher than ${n.lessThan}`)),(n.moreThan||n.moreThan===0)&&(l=l.moreThan(n.moreThan,`${e.title} must be lower than ${n.moreThan}`)),n.positive&&(l=l.positive(`${e.title} must be positive`)),n.negative&&(l=l.negative(`${e.title} must be negative`)),n.integer&&(l=l.integer(`${e.title} must be an integer`))):l=l.notRequired().nullable(!0),l}function Ca({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.object();const l=e.validation;return l?.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s}))),l?.required?n=n.required(l.requiredMessage).nullable(!0):n=n.notRequired().nullable(!0),n}function ma({property:e,parentProperty:o,customFieldValidator:r,name:i}){if(e.autoValue)return Ce.object().nullable(!0);let n=Ce.date();const l=e.validation;return l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),l.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s}))),l.min&&(n=n.min(l.min,`${e.title} must be after ${l.min}`)),l.max&&(n=n.max(l.max,`${e.title} must be before ${l.min}`))):n=n.notRequired().nullable(!0),n}function xa({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.object();const l=e.validation;return l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),l.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s})))):n=n.notRequired().nullable(!0),n}function Sa({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.boolean();const l=e.validation;return l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),l.unique&&r&&i&&(n=n.test("unique","This value already exists and should be unique",s=>r({name:i,property:e,parentProperty:o,value:s})))):n=n.notRequired().nullable(!0),n}function Ta(e){return e.validation?.uniqueInArray?!0:e.dataType==="map"&&e.properties?Object.entries(e.properties).filter(([o,r])=>r.validation?.uniqueInArray):!1}function ka({property:e,parentProperty:o,customFieldValidator:r,name:i}){let n=Ce.array();if(e.of){n=n.of(ut({property:e.of,parentProperty:e}));const s=Ta(e.of);s&&(typeof s=="boolean"?n=n.uniqueInArray(d=>d,`${e.title} should have unique values within the array`):Array.isArray(s)&&s.forEach(([d,c])=>{n=n.uniqueInArray(u=>u&&u[d],`${e.title} \u2192 ${c.title??d}: should have unique values within the array`)}))}const l=e.validation;return l?(n=l.required?n.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):n.notRequired().nullable(!0),(l.min||l.min===0)&&(n=n.min(l.min,`${e.title} should be min ${l.min} entries long`)),l.max&&(n=n.max(l.max,`${e.title} should be max ${l.max} entries long`))):n=n.notRequired().nullable(!0),n}const _a=J.default(e=>K.default({input:{padding:0,margin:0,width:"100%",color:"unset",fontWeight:"unset",lineHeight:"unset",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none"}}));function Ea(e){const{disabled:o,value:r,multiline:i,updateValue:n,focused:l}=e,[s,d]=p.useState(r),c=p.useRef(!1);p.useEffect(()=>{const f=setTimeout(()=>{(!r||r.length===0)&&!s||s!==r&&n(s)},300);return()=>{clearTimeout(f)}},[s]),p.useEffect(()=>{!l&&r!==s&&d(r)},[r,l]);const u=_a(),g=z.default.createRef();return p.useEffect(()=>{g.current&&l&&!c.current?(c.current=!0,g.current.focus({preventScroll:!0}),g.current.selectionStart=g.current.value.length,g.current.selectionEnd=g.current.value.length):c.current=l},[l,g]),t.jsx("div",{style:{display:"flex"},children:t.jsx(a.TextareaAutosize,{ref:g,disabled:o,className:ue.default(u.input),value:s??"",onChange:h=>{const f=h.target.value;(i||!f.endsWith(`
`))&&d(f)}})})}const Ia=J.default(e=>K.default({select:{height:"100%"},selectRoot:{display:"flex",alignItems:"center",height:"100%"}}));function Wt(e){const{name:o,enumValues:r,error:i,internalValue:n,disabled:l,small:s,focused:d,updateValue:c,multiple:u,setPreventOutsideClick:g,valueType:h}=e,[f,b]=p.useState(!1),y=()=>{g(!0),b(!0)},v=()=>{g(!1),b(!1)},C=Ia(),w=Array.isArray(n)&&u||!Array.isArray(n)&&!u,m=z.default.createRef();return p.useEffect(()=>{m.current&&d&&m.current?.focus({preventScroll:!0})},[d,m]),t.jsx(a.Select,{variant:"standard",inputRef:m,className:C.select,classes:{select:C.selectRoot},open:f,disabled:l,multiple:u,onClose:v,onOpen:y,fullWidth:!0,inputProps:{style:{height:"100%"}},disableUnderline:!0,error:!!i,value:w?u?n.map(S=>S.toString()):n:u?[]:"",onChange:S=>{if(h==="number")if(u){const _=S.target.value.map(k=>parseFloat(k));c(_)}else c(parseFloat(S.target.value));else if(h==="string")S.target.value?c(S.target.value):c(null);else throw Error("Missing mapping in TableSelect")},renderValue:S=>u&&Array.isArray(S)?t.jsx(it,{value:S,name:o,enumValues:r,size:s?"small":"regular"}):t.jsx(xe,{enumKey:S,enumValues:r,small:s}),children:qe(r).map(([S,_])=>{const k=t.jsx(xe,{enumKey:S,enumValues:r,small:!0});return u?t.jsxs(a.MenuItem,{value:S,disabled:Re(_),dense:!0,children:[t.jsx(a.Checkbox,{checked:Array.isArray(n)&&n.map(I=>I.toString()).includes(S.toString())}),t.jsx(a.ListItemText,{primary:k})]},`select-${o}-${S}`):t.jsx(a.MenuItem,{value:S,disabled:Re(_),dense:!0,children:k},`select-${o}-${S}`)})},`table_select_${o}`)}const Ba=J.default(e=>K.default({input:{padding:0,margin:0,width:"100%",color:"unset",fontWeight:"unset",lineHeight:"unset",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none"},numberInput:{textAlign:"right"}}));function Pa(e){const{align:o,value:r,updateValue:i,focused:n,onBlur:l,disabled:s}=e,d=r&&typeof r=="number"?r.toString():"",[c,u]=p.useState(d);p.useEffect(()=>{const y=setTimeout(()=>{if(c!==d)if(c!=null){const v=parseFloat(c);if(isNaN(v))return;v!=null&&i(v)}else i(null)},300);return()=>{clearTimeout(y)}},[c]),p.useEffect(()=>{!n&&d!==c&&u(r!=null?r.toString():null)},[r,n]);const g=z.default.createRef(),h=Ba();p.useEffect(()=>{g.current&&n&&g.current.focus({preventScroll:!0})},[n,g]);const f=/^-?[0-9]+[,.]?[0-9]*$/;return t.jsx(a.Input,{inputRef:g,style:{width:"100%",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none",padding:0},inputProps:{style:{textAlign:o}},disabled:s,className:ue.default(h.input,h.numberInput),disableUnderline:!0,value:c??"",onBlur:l,onChange:b=>{const y=b.target.value.replace(",",".");y.length===0&&u(null),(f.test(y)||y.startsWith("-"))&&u(y)}})}function Fa(e){const{disabled:o,internalValue:r,updateValue:i,focused:n}=e,l=z.default.createRef();return p.useEffect(()=>{l.current&&n&&l.current.focus({preventScroll:!0})},[n,l]),t.jsx(a.Switch,{inputRef:l,color:"secondary",checked:Boolean(r),disabled:o,onChange:s=>{const d=s.target.checked;i(d)}})}J.default(e=>K.default({hidden:{display:"none"}}));function Aa(e){const{disabled:o,error:r,internalValue:i,setPreventOutsideClick:n,updateValue:l}=e,s=p.useCallback(()=>{n(!0)},[]),d=p.useCallback(()=>{n(!1)},[]);return t.jsx(a.Box,{display:"flex",alignItems:"center",width:"100%",children:t.jsx(mt.default,{value:i??null,clearable:!0,disabled:o,onChange:c=>{l(c)},renderInput:c=>t.jsx(a.TextField,{...c,variant:"standard",error:Boolean(r),style:{height:"100%"},InputProps:{...c.InputProps,style:{fontSize:14},disableUnderline:!0}}),InputAdornmentProps:{style:{fontSize:"small",height:26}},onOpen:s,onClose:d})})}function rr(e){const{name:o,internalValue:r,setPreventOutsideClick:i,property:n,updateValue:l,size:s,disabled:d}=e;let c,u;if(n.dataType==="reference")c=n,u=!1;else if(n.dataType==="array"&&n.of?.dataType==="reference")c=n.of,u=!0;else throw Error("TableReferenceField misconfiguration");if(typeof c.path!="string")throw Error("Picked the wrong component TableReferenceField");const g=c.path,[h,f]=p.useState(!1),[b,y]=p.useState(!1),C=Te().getCollectionResolver(g);if(!C)throw Error(`Couldn't find the corresponding collection view for the path: ${g}`);const w=p.useCallback(U=>{d||U.detail<=1&&(U.stopPropagation(),i(!0),y(!0))},[d,i]),m=p.useCallback(()=>{i(!1),y(!1)},[i,y]),S=p.useCallback(U=>{l(U?nt(U):null),i(!1),y(!1)},[l,i,y]),_=p.useCallback(U=>{l(U.map($=>nt($)))},[l]),k=r?Array.isArray(r)?r.map(U=>U.id):r.id?[r.id]:[]:[],I=!r||Array.isArray(r)&&r.length===0;function P(){return r instanceof ke?t.jsx(je,{name:o,onClick:d?void 0:w,value:r,property:c,onHover:h,size:Be(s)}):t.jsx(me,{error:"Data is not a reference"})}function L(){return Array.isArray(r)?t.jsx(t.Fragment,{children:r.map((U,$)=>t.jsx(a.Box,{sx:{m:.5},children:t.jsx(je,{name:`${o}[${$}]`,onClick:d?void 0:w,size:"tiny",onHover:h,value:U,property:c})},`preview_array_ref_${o}_${$}`))}):t.jsx(me,{error:"Data is not an array of references"})}return C?t.jsxs("div",{onMouseEnter:()=>f(!0),onMouseMove:()=>f(!0),onMouseLeave:()=>f(!1),children:[r&&!u&&P(),r&&u&&L(),I&&t.jsxs(a.Button,{onClick:w,size:"small",variant:"outlined",color:"primary",children:["Edit ",n.title]}),!d&&b&&t.jsx(ht,{open:b,multiselect:u,path:g,collectionResolver:C,onClose:m,onMultipleEntitiesSelected:_,onSingleEntitySelected:S,selectedEntityIds:k})]}):t.jsx(me,{error:"The specified collection does not exist"})}const $a=J.default(e=>({dropZone:{position:"relative",height:"100%",outline:0,display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:({hasValue:o})=>o?"start":"center",alignItems:"center"},activeDrop:{borderRadius:"2px",border:"2px solid",borderColor:"transparent"},acceptDrop:{transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",background:"repeating-linear-gradient( 45deg, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.2) 10px, rgba(128, 128, 128, 0.25) 10px, rgba(128, 128, 128, 0.25) 20px) !important",borderColor:e.palette.success.light},rejectDrop:{borderColor:e.palette.error.light},arrayEntry:{border:"1px dashed transparent",borderRadius:"4px"},arrayEntryHovered:{opacity:.5,border:"1px dashed gray",boxSizing:"border-box"},thumbnailCloseIcon:{position:"absolute",borderRadius:"9999px",top:-8,right:-8,zIndex:100,backgroundColor:e.palette.background.paper}}));function Oa(e){const{name:o,error:r,internalValue:i,disabled:n,property:l,entityId:s,entityValues:d,previewSize:c,updateValue:u,setPreventOutsideClick:g}=e,h=l.dataType==="array",f=l.dataType==="string"?l.config?.storageMeta:l.dataType==="array"&&l.of.dataType==="string"?l.of.config?.storageMeta:void 0;if(!f)throw Error("Storage meta must be specified");const b=v=>{if(f.fileName){const C=f.fileName({entityId:s,values:d,property:l,file:v,storageMeta:f,name:o});if(!C||C.length===0)throw Error("You need to return a valid filename");return C}return v.name},y=v=>{if(typeof f.storagePath=="string")return f.storagePath;if(typeof f.storagePath=="function"){const C=f.storagePath({entityId:s,values:d,property:l,file:v,storageMeta:f,name:o});if(!C||C.length===0)throw Error("You need to return a valid filename");return C}return console.warn("When using a storage property, if you don't specify the storagePath, the root storage is used"),"/"};return t.jsx(Da,{value:i,name:o,disabled:n,autoFocus:!1,property:l,onChange:v=>{u(v)},fileNameBuilder:b,storagePathBuilder:y,storageMeta:f,multipleFilesSupported:h,previewSize:c})}function Da({property:e,name:o,value:r,onChange:i,multipleFilesSupported:n,previewSize:l,disabled:s,autoFocus:d,storageMeta:c,fileNameBuilder:u,storagePathBuilder:g}){const h=Ue(),[f,b]=p.useState(!1),y=n&&l==="regular"?"small":l;if(n){const F=e;if(F.of){if(F.of.dataType!=="string")throw Error("Storage field using array must be of data type string")}else throw Error("Storage field using array must be of data type string")}const v=c?.metadata,C=Boolean(r),w=$a({hasValue:C}),m=r==null?[]:(n?r:[r]).map(F=>({id:I(),storagePathOrDownloadUrl:F,metadata:v,size:y})),S=ie.useRef(r),[_,k]=ie.useState(m);Se.default(S.current,r)||(S.current=r,k(m??[]));function I(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}function P(F){return F.filter((Y,H)=>(F.map(W=>W.storagePathOrDownloadUrl).indexOf(Y.storagePathOrDownloadUrl)===H||!Y.storagePathOrDownloadUrl)&&(F.map(W=>W.file).indexOf(Y.file)===H||!Y.file))}const L=F=>{if(!F.length||s)return;let Y;n?Y=[..._,...F.map(H=>({id:I(),file:H,fileName:u(H),metadata:v}))]:Y=[{id:I(),file:F[0],fileName:u(F[0]),metadata:v}],Y=P(Y),k(Y)},U=async(F,Y,H)=>{let W=F;c.storeUrl&&(W=await h.getDownloadURL(F)),c.postProcess&&(W=await c.postProcess(W));let j;Y.storagePathOrDownloadUrl=W,Y.metadata=H,j=[..._],j=P(j),k(j);const M=j.filter(Z=>!!Z.storagePathOrDownloadUrl).map(Z=>Z.storagePathOrDownloadUrl);i(n?M:M?M[0]:null)},$=F=>{if(n){const Y=_.filter(H=>H.storagePathOrDownloadUrl!==F);i(Y.filter(H=>!!H.storagePathOrDownloadUrl).map(H=>H.storagePathOrDownloadUrl)),k(Y)}else i(null),k([])},{open:T,getRootProps:E,getInputProps:A,isDragActive:O,isDragAccept:N,isDragReject:X}=co.useDropzone({accept:c.acceptedFiles,disabled:s,noClick:!0,noKeyboard:!0,onDrop:L}),{...D}=E(),B=n?"Drag 'n' drop some files here, or click here to edit":"Drag 'n' drop a file here, or click here edit",q=n?e.of:e;return t.jsxs(a.Box,{...D,onMouseEnter:()=>b(!0),onMouseMove:()=>b(!0),onMouseLeave:()=>b(!1),className:ue.default(w.dropZone,{[w.activeDrop]:O,[w.rejectDrop]:X,[w.acceptDrop]:N}),children:[t.jsx("input",{autoFocus:d,...A()}),_.map((F,Y)=>{let H;return F.storagePathOrDownloadUrl?H=t.jsx(Ma,{property:q,disabled:s,value:F.storagePathOrDownloadUrl,onClear:$,size:y},`storage_preview_${Y}`):F.file&&(H=t.jsx(La,{entry:F,metadata:v,storagePath:g(F.file),onFileUploadComplete:U,size:y},`storage_progress_${Y}`)),H}),!r&&t.jsx(a.Box,{sx:{flexGrow:1,m:2,maxWidth:200},onClick:T,children:t.jsx(a.Typography,{sx:{color:F=>F.palette.mode==="light"?"#999":"#444"},variant:"body2",align:"center",children:B})}),f&&t.jsx(a.IconButton,{color:"inherit",size:"small",onClick:T,sx:{position:"absolute",bottom:2,right:2},children:t.jsx(Di.default,{sx:{width:16,height:16,fill:"#666"}})})]})}function La({storagePath:e,entry:o,metadata:r,onFileUploadComplete:i,size:n}){const l=Ue(),s=He(),[d,c]=ie.useState(),[u,g]=ie.useState(!1),h=ie.useRef(!1),f=p.useCallback((y,v)=>{c(void 0),g(!0),l.uploadFile({file:y,fileName:v,path:e,metadata:r}).then(async({path:C})=>{console.debug("Upload successful"),await i(C,o,r),h.current&&g(!1)}).catch(C=>{console.error("Upload error",C),h.current&&(c(C.message),g(!1)),s.open({type:"error",title:"Error uploading file",message:C.message})})},[o,r,i,s,l,e]);p.useEffect(()=>(h.current=!0,o.file&&f(o.file,o.fileName),()=>{h.current=!1}),[o.file,o.fileName,f]);const b=p.useMemo(()=>Ve(n),[n]);return t.jsxs(a.Box,{m:1,sx:{width:b,height:b},children:[u&&t.jsx(a.Skeleton,{variant:"rectangular",sx:{width:b,height:b}}),d&&t.jsxs("p",{children:["Error uploading file: ",d]})]})}function Ma({property:e,value:o,size:r}){return t.jsx(a.Box,{m:1,position:"relative",children:o&&t.jsx(ne,{children:t.jsx(de,{value:o,property:e,size:r})})})}const Na=({selected:e,focused:o,name:r,setPreventOutsideClick:i,setFocused:n,onValueChange:l,select:s,openPopup:d,value:c,property:u,validation:g,size:h,align:f,width:b,height:y,entityId:v,entityValues:C})=>{const[w,m]=p.useState(c);ge({property:u,value:w,setValue:m});const[S,_]=p.useState(),[k,I]=p.useState(!1),P=Boolean(u.config?.Field),L=Boolean(u.config?.Preview),U=Qe(u),$=typeof u.disabled=="object"?u.disabled.disabledMessage:void 0,T=Boolean(u.disabled),E=p.useCallback(()=>{n(!1)},[]);p.useEffect(()=>{c!==w&&m(c)},[c]),p.useEffect(()=>{Se.default(c,w)||(I(!1),g.validate(w).then(()=>{_(void 0),l&&l({value:w,name:r,setError:_,setSaved:I})}).catch(q=>{console.error(q),_(q)}))},[w]);const A=p.useCallback(q=>{let F;q===void 0?F=null:F=q,m(F)},[]);let O,N=!1,X=!1,D=!1,B=!1;if(!U&&!P&&(!L||e)){if(u.dataType==="string"&&u.config?.storageMeta||u.dataType==="array"&&u.of?.dataType==="string"&&u.of?.config?.storageMeta)O=t.jsx(Oa,{error:S,disabled:T,focused:o,property:u,entityId:v,entityValues:C,internalValue:w,previewSize:Be(h),updateValue:A,name:r,onBlur:E,setPreventOutsideClick:i}),X=!0,B=!0,D=!0;else if(e&&u.dataType==="number"){const F=u;F.config?.enumValues?O=t.jsx(Wt,{name:r,multiple:!1,disabled:T,focused:o,valueType:"number",small:Be(h)!=="regular",enumValues:F.config.enumValues,error:S,onBlur:E,internalValue:w,updateValue:A,setPreventOutsideClick:i}):(O=t.jsx(Pa,{align:f,error:S,focused:o,disabled:T,onBlur:E,value:w,updateValue:A}),N=!0)}else if(e&&u.dataType==="string"){const F=u;if(F.config?.enumValues)O=t.jsx(Wt,{name:r,multiple:!1,focused:o,disabled:T,valueType:"string",small:Be(h)!=="regular",enumValues:F.config.enumValues,error:S,onBlur:E,internalValue:w,updateValue:A,setPreventOutsideClick:i});else if(!F.config?.storageMeta&&!F.config?.markdown){const Y=!!F.config?.multiline;O=t.jsx(Ea,{error:S,disabled:T,multiline:Y,focused:o,value:w,updateValue:A}),N=!0}}else if(u.dataType==="boolean")O=t.jsx(Fa,{error:S,disabled:T,focused:o,internalValue:w,updateValue:A});else if(u.dataType==="timestamp")O=t.jsx(Aa,{name:r,error:S,disabled:T,focused:o,internalValue:w,updateValue:A,setPreventOutsideClick:i}),N=!0;else if(u.dataType==="reference")typeof u.path=="string"&&(O=t.jsx(rr,{name:r,internalValue:w,updateValue:A,disabled:T,size:h,property:u,setPreventOutsideClick:i})),N=!0;else if(u.dataType==="array"){const F=u;if(F.of&&(F.of.dataType==="string"||F.of.dataType==="number"?e&&F.of.config?.enumValues&&(O=t.jsx(Wt,{name:r,multiple:!0,disabled:T,focused:o,small:Be(h)!=="regular",valueType:F.of.dataType,enumValues:F.of.config.enumValues,error:S,onBlur:E,internalValue:w,updateValue:A,setPreventOutsideClick:i}),N=!0):F.of.dataType==="reference"&&(typeof F.of.path=="string"&&(O=t.jsx(rr,{name:r,disabled:T,internalValue:w,updateValue:A,size:h,property:u,setPreventOutsideClick:i})),N=!1)),!F.of&&!F.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${r}`)}}return O||(N=!1,X=e&&!O&&!T&&!U,O=t.jsx(ne,{children:t.jsx(de,{width:b,height:y,name:r,value:w,property:u,size:Be(h)})})),t.jsx(Ut,{select:s,selected:e,focused:o,disabled:T||U,disabledTooltip:$??"Disabled",removePadding:D,fullHeight:B,size:h,saved:k,error:S,align:f,allowScroll:N,showExpandIcon:X,openPopup:T?void 0:d,value:w,children:O})},qa=z.default.memo(Na,za);function za(e,o){return e.selected===o.selected&&e.focused===o.selected&&e.height===o.height&&e.size===o.size&&e.align===o.align&&e.width===o.width&&Se.default(e.property,o.property)&&Se.default(e.value,o.value)}function Va({containerRef:e,ref:o,x:r,y:i,onMove:n}){let l=0,s=0;const d=h=>{if(h.button!==0||!o.current||h.target!==o.current)return;const{x:f,y:b}=o.current.getBoundingClientRect();l=h.screenX-f,s=h.screenY-b,document.addEventListener("mousemove",u),document.addEventListener("mouseup",c),h.stopPropagation()},c=h=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c),h.stopPropagation()},u=h=>{n(h.screenX-l,h.screenY-s),h.stopPropagation()},g=()=>{e.current&&(e.current.style.top=`${i}px`,e.current.style.left=`${r}px`)};p.useEffect(()=>{const h=o.current;return h&&h.addEventListener("mousedown",d),g(),()=>{h&&h.removeEventListener("mousedown",d)}})}function Ua(){const[e,o]=p.useState({width:0,height:0});return p.useLayoutEffect(()=>{function r(){o({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",r),r(),()=>window.removeEventListener("resize",r)},[]),e}function ft({name:e,value:o,disabled:r,buildEntry:i,onInternalIdAdded:n,includeAddButton:l}){const s=o&&Array.isArray(o)&&o.length>0,d=p.useMemo(()=>s?o.map((h,f)=>h?{[Io(h)+f]:Ht()}:{}).reduce((h,f)=>({...h,...f}),{}):{},[o,s]),c=p.useRef(d),[u,g]=p.useState(s?Object.values(c.current):[]);return p.useEffect(()=>{if(s&&o&&o.length!==u.length){const h=o.map((f,b)=>{const y=Io(f)+b;if(y in c.current)return c.current[y];{const v=Ht();return c.current[y]=v,v}});g(h)}},[s,u.length,o]),t.jsx(we.FieldArray,{name:e,validateOnChange:!0,render:h=>{const f=()=>{if(r)return;const v=Ht(),C=[...u,v];n&&n(v),g(C),h.push(null)},b=v=>{const C=[...u];C.splice(v,1),g(C),h.remove(v)},y=v=>{if(!v.destination)return;const C=v.source.index,w=v.destination.index,m=[...u],S=m[C];m[C]=m[w],m[w]=S,g(m),h.move(C,w)};return t.jsx(Me.DragDropContext,{onDragEnd:y,children:t.jsx(Me.Droppable,{droppableId:`droppable_${e}`,children:(v,C)=>t.jsxs("div",{...v.droppableProps,ref:v.innerRef,children:[s&&u.map((w,m)=>t.jsx(Me.Draggable,{draggableId:`array_field_${e}_${w}}`,isDragDisabled:r,index:m,children:(S,_)=>t.jsx(a.Box,{ref:S.innerRef,...S.draggableProps,style:S.draggableProps.style,sx:{marginBottom:1,borderRadius:"4px",opacity:1},children:t.jsxs(a.Box,{display:"flex",children:[t.jsx(a.Box,{flexGrow:1,width:"100%",children:i(m,w)},`field_${e}_entryValue`),t.jsxs(a.Box,{width:"36px",display:"flex",flexDirection:"column",alignItems:"center",children:[t.jsx("div",{...S.dragHandleProps,children:t.jsx(Li.default,{fontSize:"small",color:r?"disabled":"inherit",sx:{cursor:r?"inherit":"move"}})}),!r&&t.jsx(a.IconButton,{size:"small","aria-label":"remove",onClick:()=>b(m),children:t.jsx(Ie.default,{fontSize:"small"})})]})]},`field_${m}`)})},`array_field_${e}_${w}}`)),v.placeholder,l&&!r&&t.jsx(a.Box,{p:1,justifyContent:"center",textAlign:"left",children:t.jsx(a.Button,{variant:"outlined",color:"primary",disabled:r,onClick:f,children:"Add"})})]})})})}})}function Ht(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}function pe({property:e}){const o=typeof e.disabled=="object"?e.disabled.disabledMessage:void 0;return t.jsxs(a.Box,{display:"flex",children:[t.jsx(a.Box,{flexGrow:1,children:t.jsx(a.FormHelperText,{children:o||e.description})}),e.longDescription&&t.jsx(a.Tooltip,{title:t.jsx(a.Typography,{variant:"caption",children:e.longDescription}),placement:"bottom-start",arrow:!0,children:t.jsx(a.IconButton,{edge:"start",size:"small",children:t.jsx(Mi.default,{color:"disabled",fontSize:"small"})})})]})}function be({property:e}){return t.jsxs(t.Fragment,{children:[t.jsx("span",{style:{paddingRight:"12px"},children:ct(e)}),t.jsx("span",{children:e.title})]})}const Wa=J.default(e=>K.default({inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)}}));function jt({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,autoFocus:s,touched:d,property:c,includeDescription:u,shouldAlwaysRerender:g}){const h=Wa(),f=c.config?.enumValues;return ge({property:c,value:o,setValue:r}),t.jsxs(a.FormControl,{variant:"filled",fullWidth:!0,required:c.validation?.required,error:n,disabled:l,children:[t.jsx(a.InputLabel,{id:`${e}-select-label`,classes:{root:h.inputLabel,shrink:h.shrinkInputLabel},children:t.jsx(be,{property:c})}),t.jsx(a.Select,{sx:{minHeight:"64px"},variant:"filled",labelId:`${e}-select-label`,autoFocus:s,value:o!==void 0?o:"",disabled:l,onChange:b=>{const y=b.target.value,v=y?c.dataType==="number"?parseFloat(y):y:null;return r(v)},renderValue:b=>t.jsx(xe,{enumKey:b,enumValues:f,small:!1}),children:qe(f).map(([b,y])=>t.jsx(a.MenuItem,{value:b,disabled:Re(y),children:t.jsx(xe,{enumKey:b,enumValues:f,small:!0})},`select_${e}_${b}`))}),u&&t.jsx(pe,{property:c}),n&&t.jsx(a.FormHelperText,{children:i})]})}const Ha=J.default(e=>K.default({inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)}}));function nr({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,property:s,includeDescription:d,autoFocus:c}){const u=Ha();if(!s.of)throw Error("Using wrong component ArrayEnumSelect");if(s.of.dataType!=="string"&&s.of.dataType!=="number")throw Error("Field misconfiguration: array field of type string or number");const g=s.of.config?.enumValues;if(!g)throw console.error(s),Error("Field misconfiguration: array field of type string or number needs to have enumValues");ge({property:s,value:o,setValue:r});const h=!!o&&Array.isArray(o);return t.jsxs(a.FormControl,{variant:"filled",fullWidth:!0,required:s.validation?.required,error:n,children:[t.jsx(a.InputLabel,{id:`${e}-multiselect-label`,classes:{root:u.inputLabel,shrink:u.shrinkInputLabel},children:t.jsx(be,{property:s})}),t.jsx(a.Select,{multiple:!0,sx:{minHeight:"64px"},variant:"filled",labelId:`${e}-multiselect-label`,value:h?o.map(f=>f.toString()):[],autoFocus:c,disabled:l,onChange:f=>{let b;return s.of?.dataType==="number"?b=f.target.value?f.target.value.map(y=>parseFloat(y)):[]:b=f.target.value,r(b)},renderValue:f=>t.jsx(it,{value:f,name:e,enumValues:g,size:"regular"}),children:qe(g).map(([f,b])=>{const y=h&&o.map(v=>v.toString()).includes(f.toString());return t.jsxs(a.MenuItem,{value:f,disabled:Re(b),dense:!0,children:[t.jsx(a.Checkbox,{checked:y}),t.jsx(a.ListItemText,{primary:t.jsx(xe,{enumKey:f,enumValues:g,small:!0})})]},`form-select-${e}-${f}`)})}),d&&t.jsx(pe,{property:s}),n&&t.jsx(a.FormHelperText,{children:i})]})}const Gt=J.default(e=>({dropZone:{position:"relative",paddingTop:"2px",border:"2px solid transparent",minHeight:"254px",outline:0,borderTopLeftRadius:"2px",borderTopRightRadius:"2px",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",borderBottom:e.palette.mode==="light"?"1px solid rgba(0, 0, 0, 0.42)":"1px solid rgba(255, 255, 255, 0.7)",boxSizing:"border-box",transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms","&:focus":{borderBottom:`2px solid ${e.palette.primary.main}`}},disabled:{backgroundColor:"rgba(0, 0, 0, 0.12)",color:e.palette.mode==="light"?"rgba(0, 0, 0, 0.38)":"rgba(255, 255, 255, 0.38)",borderBottom:`1px dotted ${e.palette.grey[400]}`},nonActiveDrop:{"&:hover":{backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)"}},activeDrop:{paddingTop:"0px",boxSizing:"border-box",border:"2px solid"},acceptDrop:{transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",background:"repeating-linear-gradient( 45deg, rgba(0, 0, 0, 0.09), rgba(0, 0, 0, 0.09) 10px, rgba(0, 0, 0, 0.12) 10px, rgba(0, 0, 0, 0.12) 20px) !important",border:"2px solid",borderColor:e.palette.success.light},rejectDrop:{border:"2px solid",borderColor:e.palette.error.light},uploadItem:{padding:e.spacing(1),minWidth:220,minHeight:220},uploadItemSmall:{padding:e.spacing(1),minWidth:118,minHeight:118,boxSizing:"border-box"},thumbnailCloseIcon:{position:"absolute",borderRadius:"9999px",top:-8,right:-8,zIndex:100,backgroundColor:e.palette.background.paper}}));function Yt({name:e,value:o,setValue:r,error:i,showError:n,autoFocus:l,tableMode:s,property:d,includeDescription:c,context:u,isSubmitting:g}){const h=d.dataType==="array",f=Qe(d)||!!d.disabled||g,b=h?Array.isArray(o)?o:[]:o;ge({property:d,value:o,setValue:r});const y=d.dataType==="string"?d.config?.storageMeta:d.dataType==="array"&&d.of.dataType==="string"?d.of.config?.storageMeta:void 0;if(!y)throw Error("Storage meta must be specified");const v=w=>{if(y.fileName){const m=y.fileName({entityId:u.entityId,values:u.values,property:d,file:w,storageMeta:y,name:e});if(!m||m.length===0)throw Error("You need to return a valid filename");return m}return w.name},C=w=>{if(typeof y.storagePath=="string")return y.storagePath;if(typeof y.storagePath=="function"){const m=y.storagePath({entityId:u.entityId,values:u.values,property:d,file:w,storageMeta:y,name:e});if(!m||m.length===0)throw Error("You need to return a valid filename");return m}return console.warn("When using a storage property, if you don't specify the storagePath, the root storage is used"),"/"};return t.jsxs(a.FormControl,{fullWidth:!0,required:d.validation?.required,error:n,children:[!s&&t.jsx(a.FormHelperText,{filled:!0,required:d.validation?.required,children:t.jsx(be,{property:d})}),t.jsx(Ga,{value:b,name:e,disabled:f,autoFocus:l,property:d,onChange:w=>{r(w)},fileNameBuilder:v,storagePathBuilder:C,storageMeta:y,multipleFilesSupported:h}),c&&t.jsx(pe,{property:d}),n&&t.jsx(a.FormHelperText,{children:i})]})}function ja({storageMeta:e,disabled:o,isDraggingOver:r,onExternalDrop:i,multipleFilesSupported:n,droppableProvided:l,autoFocus:s,internalValue:d,property:c,onClear:u,metadata:g,storagePathBuilder:h,onFileUploadComplete:f,size:b,name:y,helpText:v}){const C=Gt(),{getRootProps:w,getInputProps:m,isDragActive:S,isDragAccept:_,isDragReject:k}=co.useDropzone({accept:e.acceptedFiles,disabled:o||r,noDragEventsBubbling:!0,onDrop:i});return t.jsxs(a.Box,{...w(),className:ue.default(C.dropZone,{[C.nonActiveDrop]:!S,[C.activeDrop]:S,[C.rejectDrop]:k,[C.acceptDrop]:_,[C.disabled]:o}),sx:{display:n&&d.length?void 0:"flex",alignItems:"center"},children:[t.jsxs(a.Box,{...l.droppableProps,ref:l.innerRef,sx:{display:"flex",alignItems:"center",overflow:n&&d.length?"auto":void 0,minHeight:n&&d.length?180:250,p:1,"&::-webkit-scrollbar":{display:"none"}},children:[t.jsx("input",{autoFocus:s,...m()}),d.map((I,P)=>{let L;if(I.storagePathOrDownloadUrl){const U=n?c.of:c;L=t.jsx(Xa,{name:`storage_preview_${I.storagePathOrDownloadUrl}`,property:U,disabled:o,value:I.storagePathOrDownloadUrl,onClear:u,size:I.size})}else I.file&&(L=t.jsx(Ya,{entry:I,metadata:g,storagePath:h(I.file),onFileUploadComplete:f,size:b}));return t.jsx(Me.Draggable,{draggableId:`array_field_${y}_${I.id}}`,index:P,children:(U,$)=>t.jsx(a.Box,{ref:U.innerRef,...U.draggableProps,...U.dragHandleProps,style:U.draggableProps.style,sx:{borderRadius:"4px"},children:L})},`array_field_${y}_${I.id}}`)}),l.placeholder]}),t.jsx(a.Box,{sx:{flexGrow:1,minHeight:38,boxSizing:"border-box",m:2},children:t.jsx(a.Typography,{align:"center",variant:"body2",sx:I=>({color:"#838383",fontWeight:I.typography.fontWeightMedium}),children:v})})]})}function Ga({property:e,name:o,value:r,onChange:i,multipleFilesSupported:n,disabled:l,autoFocus:s,storageMeta:d,fileNameBuilder:c,storagePathBuilder:u}){const g=Ue();if(n){const $=e;if($.of){if($.of.dataType!=="string")throw Error("Storage field using array must be of data type string")}else throw Error("Storage field using array must be of data type string")}const h=d?.metadata,f=n?"small":"regular",b=(n?r:[r]).map($=>({id:m(),storagePathOrDownloadUrl:$,metadata:h,size:f})),[y,v]=ie.useState(r),[C,w]=ie.useState(b);ie.useState(void 0),Se.default(y,r)||(v(r),w(b));function m(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}const S=($,T)=>{const E=[...C],A=E[$];E.splice($,1),E.splice(T,0,A),w(E);const O=E.filter(N=>!!N.storagePathOrDownloadUrl).map(N=>N.storagePathOrDownloadUrl);i(O)},_=$=>{!$.destination||S($.source.index,$.destination.index)};function k($){return $.filter((T,E)=>($.map(A=>A.storagePathOrDownloadUrl).indexOf(T.storagePathOrDownloadUrl)===E||!T.storagePathOrDownloadUrl)&&($.map(A=>A.file).indexOf(T.file)===E||!T.file))}const I=$=>{if(!$.length||l)return;let T;n?T=[...C,...$.map(E=>({id:m(),file:E,fileName:c(E),metadata:h,size:f}))]:T=[{id:m(),file:$[0],fileName:c($[0]),metadata:h,size:f}],T=k(T),w(T)},P=async($,T,E)=>{console.debug("onFileUploadComplete",$,T);let A=$;d.storeUrl&&(A=await g.getDownloadURL($)),d.postProcess&&(A=await d.postProcess(A));let O;T.storagePathOrDownloadUrl=A,T.metadata=E,O=[...C],O=k(O),w(O);const N=O.filter(X=>!!X.storagePathOrDownloadUrl).map(X=>X.storagePathOrDownloadUrl);i(n?N:N?N[0]:null)},L=$=>{if(n){const T=C.filter(E=>E.storagePathOrDownloadUrl!==$);i(T.filter(E=>!!E.storagePathOrDownloadUrl).map(E=>E.storagePathOrDownloadUrl)),w(T)}else i(null),w([])},U=n?"Drag 'n' drop some files here, or click to select files":"Drag 'n' drop a file here, or click to select one";return t.jsx(Me.DragDropContext,{onDragEnd:_,children:t.jsx(Me.Droppable,{droppableId:`droppable_${o}`,direction:"horizontal",children:($,T)=>t.jsx(ja,{storageMeta:d,disabled:l,isDraggingOver:T.isDraggingOver,droppableProvided:$,onExternalDrop:I,multipleFilesSupported:n,autoFocus:s,internalValue:C,property:e,onClear:L,metadata:h,storagePathBuilder:u,onFileUploadComplete:P,size:f,name:o,helpText:U})})})}function Ya({storagePath:e,entry:o,metadata:r,onFileUploadComplete:i,size:n}){const l=Ue(),s=Gt(),d=He(),[c,u]=ie.useState(),[g,h]=ie.useState(!1),f=ie.useRef(!1),b=p.useCallback((y,v)=>{u(void 0),h(!0),l.uploadFile({file:y,fileName:v,path:e,metadata:r}).then(async({path:C})=>{console.debug("Upload successful"),await i(C,o,r),f.current&&h(!1)}).catch(C=>{console.error("Upload error",C),f.current&&(u(C.message),h(!1)),d.open({type:"error",title:"Error uploading file",message:C.message})})},[o,r,i,d,l,e]);return ie.useEffect(()=>(f.current=!0,o.file&&b(o.file,o.fileName),()=>{f.current=!1}),[o.file,o.fileName,b]),t.jsx(a.Box,{m:1,children:t.jsxs(a.Paper,{elevation:0,className:n==="regular"?s.uploadItem:s.uploadItemSmall,variant:"outlined",children:[g&&t.jsx(a.Skeleton,{variant:"rectangular",sx:{width:"100%",height:"100%"}}),c&&t.jsxs("p",{children:["Error uploading file: ",c]})]})})}function Xa({name:e,property:o,value:r,onClear:i,disabled:n,size:l}){const s=Gt();return t.jsx(a.Box,{m:1,position:"relative",children:t.jsxs(a.Paper,{elevation:0,className:l==="regular"?s.uploadItem:s.uploadItemSmall,variant:"outlined",children:[!n&&t.jsx("a",{className:s.thumbnailCloseIcon,children:t.jsx(a.IconButton,{size:"small",onClick:d=>{d.stopPropagation(),i(r)},children:t.jsx(Ie.default,{fontSize:"small"})})}),r&&t.jsx(ne,{children:t.jsx(de,{name:e,value:r,property:o,size:l})})]})})}const Ja=J.default(e=>K.default({inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)}}));function Xt({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,autoFocus:s,property:d,includeDescription:c,allowInfinity:u,shouldAlwaysRerender:g}){const h=Ja();let f,b;if(d.dataType==="string"){const _=d.config?.url;f=typeof _=="string"?_:void 0,b=d.config?.multiline}ge({property:d,value:o,setValue:r});const y=!!b,v=o??(d.dataType==="string"?"":o===0?0:""),C=v===1/0,w=!C&&d.dataType==="number"?"number":void 0,m=_=>{if(!_)r(null);else if(w==="number"){const k=parseFloat(_);r(k)}else r(_)},S=t.jsx(a.FilledInput,{sx:{minHeight:"64px"},autoFocus:s,type:w,multiline:y,inputProps:{rows:4},value:C?"Infinity":o??"",disabled:l,onChange:_=>{m(_.target.value)}});return t.jsxs(t.Fragment,{children:[t.jsxs(a.FormControl,{variant:"filled",required:d.validation?.required,error:n,disabled:C,fullWidth:!0,children:[t.jsx(a.InputLabel,{classes:{root:h.inputLabel,shrink:h.shrinkInputLabel},children:t.jsx(be,{property:d})}),S,t.jsxs(a.Box,{display:"flex",children:[t.jsxs(a.Box,{flexGrow:1,children:[n&&t.jsx(a.FormHelperText,{children:i}),c&&t.jsx(pe,{property:d})]}),u&&t.jsx(a.FormControlLabel,{checked:C,style:{marginRight:0},labelPlacement:"start",control:t.jsx(a.Switch,{size:"small",type:"checkbox",onChange:_=>{m(_.target.checked?1/0:void 0)}}),disabled:l,label:t.jsx(a.Typography,{variant:"caption",children:"Set value to Infinity"})})]})]}),f&&v&&t.jsx(ne,{children:t.jsx(a.Box,{m:1,children:t.jsx(de,{name:e,value:v,property:d,size:"regular"})})})]})}const Ka=J.default(e=>K.default({formControl:{justifyContent:"space-between",margin:0,width:"100%",minHeight:"64px",paddingLeft:"16px",paddingRight:"24px",color:"rgba(0, 0, 0, 0.87)",boxSizing:"border-box",position:"relative",display:"inline-flex",alignItems:"center",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",borderTopLeftRadius:"4px",borderTopRightRadius:"4px",transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms","&::before":{borderBottom:e.palette.mode==="light"?"1px solid rgba(0, 0, 0, 0.42)":"1px solid rgba(255, 255, 255, 0.7)",left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",pointerEvents:"none"},"&::after":{content:'""',transition:"transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",left:0,bottom:0,position:"absolute",right:0,transform:"scaleX(0)",borderBottom:`2px solid ${e.palette.primary.main}`},"&:hover":{backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)"}},focus:{"&::before":{borderBottom:e.palette.mode==="light"?"1px solid rgba(255, 255, 255, 0.7)":"1px solid rgba(0, 0, 0, 0.87)"},"&::after":{transform:"scaleX(1)",pointerEvents:"none"}}})),Za=z.default.forwardRef(function({name:e,value:o,setValue:r,error:i,showError:n,autoFocus:l,disabled:s,touched:d,property:c,includeDescription:u,shouldAlwaysRerender:g},h){const f=Ka();ge({property:c,value:o,setValue:r});const[b,y]=p.useState(l);return t.jsx(t.Fragment,{children:t.jsxs(a.FormControl,{fullWidth:!0,children:[t.jsx(a.FormControlLabel,{className:ue.default(f.formControl,{[f.focus]:b}),onClick:v=>y(!0),labelPlacement:"start",checked:Boolean(o),inputRef:h,control:t.jsx(a.Switch,{type:"checkbox",color:"secondary",autoFocus:l,disabled:s,onFocus:v=>y(!0),onBlur:v=>y(!1),onChange:v=>{y(!0),r(v.target.checked)}}),disabled:s,label:t.jsx(a.Typography,{color:"textSecondary",children:t.jsx(be,{property:c})})}),u&&t.jsx(pe,{property:c}),n&&t.jsx(a.FormHelperText,{children:i})]})})}),ir=e=>t.jsx(Za,{...e});function lr({name:e,value:o,setValue:r,autoFocus:i,error:n,showError:l,disabled:s,touched:d,property:c,includeDescription:u,shouldAlwaysRerender:g}){const h=o||null;return ge({property:c,value:o,setValue:r}),t.jsxs(t.Fragment,{children:[t.jsx(mt.default,{clearable:!0,autoFocus:i,value:h,label:t.jsx(be,{property:c}),renderInput:f=>t.jsx(a.TextField,{...f,fullWidth:!0,InputProps:{...f.InputProps,sx:{minHeight:"64px"}},error:l,variant:"filled",helperText:l?n:null}),disabled:s,onChange:f=>r(f)}),u&&t.jsx(pe,{property:c})]})}const Qa=J.default(e=>K.default({root:{elevation:0,width:"100%",padding:e.spacing(1),position:"relative",transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",borderTopLeftRadius:"2px",borderTopRightRadius:"2px",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)","&::before":{borderBottom:e.palette.mode==="light"?"1px solid rgba(0, 0, 0, 0.42)":"1px solid rgba(255, 255, 255, 0.7)",left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",pointerEvents:"none"},"&::after":{content:'""',transition:"transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",left:0,bottom:0,position:"absolute",right:0,transform:"scaleX(0)",borderBottom:`2px solid ${e.palette.primary.main}`},"&:hover":{cursor:"pointer",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)"},color:"#838383",fontWeight:e.typography.fontWeightMedium},disabled:{backgroundColor:"rgba(0, 0, 0, 0.12)",color:e.palette.mode==="light"?"rgba(0, 0, 0, 0.38)":"rgba(255, 255, 255, 0.38)","&::before":{borderBottom:e.palette.mode==="light"?"1px dotted rgba(0, 0, 0, 0.42)":"1px dotted rgba(255, 255, 255, 0.7)"},"&::after":{borderBottom:`2px dotted ${e.palette.primary.main}`},"&:hover":{cursor:"inherit",backgroundColor:"rgba(0, 0, 0, 0.12)"}}}));function ar({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,touched:s,autoFocus:d,property:c,includeDescription:u,context:g,shouldAlwaysRerender:h}){if(typeof c.path!="string")throw Error("Picked the wrong component ReferenceField");ge({property:c,value:o,setValue:r});const f=Qa(),[b,y]=z.default.useState(d),v=Pe(),C=Te(),w=p.useMemo(()=>C.getCollectionResolver(c.path),[c.path,C]);if(!w)throw Error(`Couldn't find the corresponding collection for the path: ${c.path}`);const m=w.schemaResolver,S=c.path,_=o&&o instanceof ke,{entity:k,dataLoading:I,dataLoadingError:P}=st({path:_?o.path:void 0,entityId:_?o.id:void 0,schema:m,useCache:!0}),L=O=>{l||(r(O?nt(O):null),y(!1))},U=()=>{y(!0)},$=O=>{O.stopPropagation(),r(null),y(!1)},T=O=>{O.stopPropagation(),k&&v.open({entityId:k.id,path:S,overrideSchemaRegistry:!1})},E=()=>{y(!1)};function A(O){const N=k&&!k.values;let X;if(!O)X=t.jsx(me,{error:"The specified collection does not exist. Check console"});else if(N)X=t.jsx(a.Tooltip,{title:o&&o.path,children:t.jsxs(a.Box,{display:"flex",alignItems:"center",p:1,flexGrow:1,children:[t.jsx(Ct.default,{fontSize:"small",color:"error"}),t.jsxs(a.Box,{marginLeft:1,children:["Missing reference ",k&&k.id]})]})});else if(_){const D=O({}),B=Object.keys(D.properties);let q=c.previewProperties?.filter(F=>B.includes(F));(!q||!q.length)&&(q=B),q=q.slice(0,3),X=t.jsx(a.Box,{display:"flex",flexDirection:"column",flexGrow:1,ml:1,mr:1,children:q&&q.map((F,Y)=>{const H=D.properties[F];return H?t.jsx(a.Box,{mt:.5,mb:.5,children:t.jsx(ne,{children:k?t.jsx(de,{name:F,value:k.values[F],property:H,size:"tiny"}):t.jsx(Fe,{property:H,size:"tiny"})})},`reference_previews_${F}`):null})})}else X=t.jsxs(a.Box,{p:1,onClick:l?void 0:U,justifyContent:"center",display:"flex",children:[t.jsx(a.Typography,{variant:"body2",sx:D=>({flexGrow:1,textAlign:"center",color:"#838383",fontWeight:D.typography.fontWeightMedium}),children:"No value set"}),!l&&t.jsx(a.Button,{variant:"outlined",color:"primary",children:"Set"})]});return t.jsx(a.Box,{onClick:l?void 0:U,display:"flex",children:t.jsxs(a.Box,{display:"flex",flexDirection:"column",flexGrow:1,children:[t.jsxs(a.Box,{display:"flex",flexDirection:"row",flexGrow:1,children:[t.jsx(a.Box,{flexGrow:1,children:t.jsx(a.FormHelperText,{filled:!0,required:c.validation?.required,children:t.jsx(be,{property:c})})}),k&&t.jsx(a.Box,{alignSelf:"center",m:1,children:t.jsx(a.Tooltip,{title:o&&o.path,children:t.jsx(a.Typography,{variant:"caption",className:"mono",children:k.id})})}),!N&&k&&o&&t.jsx(a.Box,{children:t.jsx(a.Tooltip,{title:`See details for ${k.id}`,children:t.jsx("span",{children:t.jsx(a.IconButton,{onClick:T,size:"large",children:t.jsx(go.default,{})})})})}),o&&t.jsx(a.Box,{children:t.jsx(a.Tooltip,{title:"Clear",children:t.jsx("span",{children:t.jsx(a.IconButton,{disabled:l,onClick:l?void 0:$,size:"large",children:t.jsx(Ie.default,{})})})})})]}),X]})})}return t.jsxs(a.FormControl,{error:n,fullWidth:!0,children:[t.jsxs("div",{className:`${f.root} ${l?f.disabled:""}`,children:[m&&A(m),w&&t.jsx(ht,{open:b,collectionResolver:w,multiselect:!1,path:S,onClose:E,onSingleEntitySelected:L})]}),u&&t.jsx(pe,{property:c}),n&&t.jsx(a.FormHelperText,{children:i})]})}function sr({name:e,value:o,error:r,showError:i,isSubmitting:n,setValue:l,tableMode:s,property:d,includeDescription:c,underlyingValueHasChanged:u,context:g,disabled:h,shouldAlwaysRerender:f}){if(!d.of)throw Error("ArrayDefaultField misconfiguration. Property `of` not set");const b=d.of,[y,v]=p.useState();ge({property:d,value:o,setValue:l});const C=(w,m)=>Ge({name:`${e}[${w}]`,disabled:h,property:b,includeDescription:c,underlyingValueHasChanged:u,context:g,tableMode:!1,partOfArray:!0,autoFocus:m===y,shouldAlwaysRerender:!1});return t.jsxs(a.FormControl,{fullWidth:!0,error:i,children:[!s&&t.jsx(a.FormHelperText,{filled:!0,required:d.validation?.required,children:t.jsx(be,{property:d})}),t.jsx(a.Paper,{variant:"outlined",sx:w=>({elevation:0,padding:w.spacing(2),[w.breakpoints.up("md")]:{padding:w.spacing(2)}}),children:t.jsx(ft,{value:o,name:e,buildEntry:C,onInternalIdAdded:v,disabled:n||Boolean(d.disabled),includeAddButton:!d.disabled})}),c&&t.jsx(pe,{property:d}),i&&typeof r=="string"&&t.jsx(a.FormHelperText,{children:r})]})}function cr({name:e,value:o,error:r,showError:i,isSubmitting:n,setValue:l,tableMode:s,property:d,includeDescription:c,underlyingValueHasChanged:u,context:g,disabled:h,shouldAlwaysRerender:f}){if(!d.oneOf)throw Error("ArrayOneOfField misconfiguration. Property `oneOf` not set");ge({property:d,value:o,setValue:l});const[b,y]=p.useState(),v=(C,w)=>t.jsx(Ra,{name:`${e}[${C}]`,index:C,value:o[C],typeField:d.oneOf.typeField??"type",valueField:d.oneOf.valueField??"value",properties:d.oneOf.properties,autoFocus:w===b,context:g},`array_one_of_${C}`);return t.jsxs(a.FormControl,{fullWidth:!0,error:i,children:[!s&&t.jsx(a.FormHelperText,{filled:!0,required:d.validation?.required,children:t.jsx(be,{property:d})}),t.jsx(a.Paper,{variant:"outlined",sx:C=>({elevation:0,padding:C.spacing(2),[C.breakpoints.up("md")]:{padding:C.spacing(2)}}),children:t.jsx(ft,{value:o,name:e,buildEntry:v,onInternalIdAdded:y,disabled:n||Boolean(d.disabled),includeAddButton:!d.disabled})}),c&&t.jsx(pe,{property:d}),i&&typeof r=="string"&&t.jsx(a.FormHelperText,{children:r})]})}function Ra({name:e,index:o,value:r,typeField:i,valueField:n,properties:l,autoFocus:s,context:d}){const c=r&&r[i],[u,g]=p.useState(c??void 0);p.useEffect(()=>{c!==u&&g(c)},[c]);const h=u?l[u]:void 0,f=Object.entries(l).map(([v,C])=>({[v]:C.title??v})).reduce((v,C)=>({...v,...C})),b=`${e}[${i}]`,y=`${e}[${n}]`;return t.jsxs(a.Paper,{sx:v=>({elevation:0,padding:v.spacing(2),[v.breakpoints.up("md")]:{padding:v.spacing(2)}}),elevation:0,children:[t.jsx(we.FastField,{required:!0,name:b,children:v=>t.jsxs(a.FormControl,{fullWidth:!0,children:[t.jsx(a.InputLabel,{id:`${e}_${o}_select_label`,children:t.jsx("span",{children:"Type"})}),t.jsx(a.Select,{fullWidth:!0,sx:{marginBottom:2},labelId:`${e}_${o}_select_label`,value:v.field.value!==void 0&&v.field.value!==null?v.field.value:"",onChange:C=>{const w=C.target.value;v.form.setFieldTouched(b),g(w),v.form.setFieldValue(b,w),v.form.setFieldValue(y,null)},renderValue:C=>t.jsx(xe,{enumKey:C,enumValues:f,small:!0}),children:qe(f).map(([C,w])=>t.jsx(a.MenuItem,{value:C,children:t.jsx(xe,{enumKey:C,enumValues:f,small:!0})},`select_${e}_${o}_${C}`))})]})}),h&&t.jsx(a.FormControl,{fullWidth:!0,children:Ge({name:y,property:h,context:d,autoFocus:s})},`form_control_${e}_${u}`)]})}function Jt({name:e,value:o,setValue:r,error:i,showError:n,isSubmitting:l,touched:s,tableMode:d,property:c,includeDescription:u,context:g}){return t.jsxs(a.FormControl,{fullWidth:!0,error:n,children:[!d&&t.jsx(a.FormHelperText,{filled:!0,required:c.validation?.required,children:t.jsx(be,{property:c})}),t.jsx(a.Paper,{sx:h=>({minHeight:"64px",elevation:0,padding:h.spacing(2),[h.breakpoints.up("md")]:{padding:h.spacing(3)}}),variant:"outlined",children:t.jsx(ne,{children:t.jsx(de,{name:e,value:o,property:c,size:"regular"})})}),n&&typeof i=="string"&&t.jsx(a.FormHelperText,{children:i}),u&&t.jsx(pe,{property:c})]})}const es=J.default(e=>K.default({root:{"& .w-md-editor-toolbar li > button":{color:e.palette.text.secondary},"& .w-md-editor-toolbar li.active > button":{color:e.palette.primary.main},"& .w-md-editor-text-pre, & .w-md-editor-text-pre .title, & .w-md-editor-text-pre .bold":{color:"inherit !important"},"& .wmde-markdown-color code.language-markdown":{color:"inherit"},"& .w-md-editor":{color:"inherit",backgroundColor:e.palette.mode==="light"?"rgb(240, 240, 240)":"#323232"},"& .w-md-editor-toolbar":{borderBottom:"inherit",backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.09)"}}}));function dr({name:e,value:o,setValue:r,error:i,showError:n,disabled:l,autoFocus:s,touched:d,property:c,tableMode:u,includeDescription:g,context:h,shouldAlwaysRerender:f}){const b=es();ge({property:c,value:o,setValue:r});const y=v=>{r(v||null)};return t.jsxs(a.FormControl,{required:c.validation?.required,error:n,fullWidth:!0,children:[!u&&t.jsx(a.FormHelperText,{filled:!0,required:c.validation?.required,children:t.jsx(be,{property:c})}),t.jsx("div",{className:b.root,children:t.jsx(Qi.default,{value:typeof o=="string"?o:"",preview:"edit",onChange:v=>y(v)})}),t.jsx(a.Box,{display:"flex",children:t.jsxs(a.Box,{flexGrow:1,children:[n&&typeof i=="string"&&t.jsx(a.FormHelperText,{children:i}),g&&t.jsx(pe,{property:c})]})})]})}function ur({name:e,value:o,error:r,showError:i,isSubmitting:n,tableMode:l,property:s,includeDescription:d,setValue:c}){const u=s.of;if(u.dataType!=="reference")throw Error("ArrayOfReferencesField expected a property containing references");const[g,h]=z.default.useState(!1),[f,b]=z.default.useState(!1),y=o&&Array.isArray(o)?o.map(k=>k.id):[];ge({property:s,value:o,setValue:c});const v=Te(),C=p.useMemo(()=>u.path?v.getCollectionResolver(u.path):void 0,[u.path]);if(!C)throw Error(`Couldn't find the corresponding collection for the path: ${u.path}`);const w=()=>{h(!0)},m=()=>{h(!1)},S=k=>{c(k.map(I=>nt(I)))},_=(k,I)=>{const P=o&&o.length>k?o[k]:void 0;return P?t.jsx("div",{onMouseEnter:()=>b(!0),onMouseMove:()=>b(!0),onMouseLeave:()=>b(!1),children:t.jsx(je,{value:P,property:u,onHover:f,size:"regular",onClick:w})}):t.jsx("div",{children:"Internal ERROR"})};return t.jsxs(t.Fragment,{children:[t.jsxs(a.FormControl,{fullWidth:!0,error:i,children:[!l&&t.jsx(a.FormHelperText,{filled:!0,required:s.validation?.required,children:t.jsx(be,{property:s})}),t.jsxs(a.Paper,{variant:"outlined",sx:k=>({elevation:0,padding:k.spacing(2),[k.breakpoints.up("md")]:{padding:k.spacing(2)}}),children:[!C&&t.jsx(me,{error:"The specified collection does not exist. Check console"}),C&&t.jsxs(t.Fragment,{children:[t.jsx(ft,{value:o,name:e,buildEntry:_,disabled:n}),t.jsx(a.Box,{p:1,justifyContent:"center",textAlign:"left",children:t.jsxs(a.Button,{variant:"outlined",color:"primary",disabled:n,onClick:w,children:["Edit ",s.title]})})]})]}),d&&t.jsx(pe,{property:s}),i&&typeof r=="string"&&t.jsx(a.FormHelperText,{children:r})]}),C&&u.path&&t.jsx(ht,{open:g,multiselect:!0,collectionResolver:C,path:u.path,onClose:m,onMultipleEntitiesSelected:S,selectedEntityIds:y})]})}function Ge({name:e,property:o,context:r,includeDescription:i,underlyingValueHasChanged:n,disabled:l,tableMode:s,partOfArray:d,autoFocus:c,shouldAlwaysRerender:u}){let g;if(Qe(o))g=Jt;else if(o.config?.Field)g=o.config?.Field;else if(o.dataType==="array"){const h=o.of;h&&((h.dataType==="string"||h.dataType==="number")&&h.config?.enumValues?g=nr:h.dataType==="string"&&h.config?.storageMeta?g=Yt:h.dataType==="reference"?g=ur:g=sr);const f=o.oneOf;if(f&&(g=cr),!h&&!f)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${e}`)}else o.dataType==="map"?g=fr:o.dataType==="reference"?o.path?g=ar:g=Jt:o.dataType==="timestamp"?g=lr:o.dataType==="boolean"?g=ir:o.dataType==="number"?o.config?.enumValues?g=jt:g=Xt:o.dataType==="string"&&(o.config?.storageMeta?g=Yt:o.config?.markdown?g=dr:o.config?.enumValues?g=jt:g=Xt);if(g){const h={name:e,property:o,includeDescription:i,underlyingValueHasChanged:n,context:r,disabled:l,tableMode:s,partOfArray:d,autoFocus:c,shouldAlwaysRerender:u},f=u||o.config?.Field?we.Field:we.FastField;return t.jsx(f,{required:o.validation?.required,name:`${e}`,children:b=>t.jsx(ts,{component:g,componentProps:h,fieldProps:b})})}return t.jsx("div",{children:`Currently the field ${o.dataType} is not supported`})}function ts({component:e,componentProps:{name:o,property:r,includeDescription:i,underlyingValueHasChanged:n,tableMode:l,partOfArray:s,autoFocus:d,context:c,disabled:u,shouldAlwaysRerender:g},fieldProps:h}){const f=r.config?.customProps,b=h.field.value,y=h.meta.initialValue,v=we.getIn(h.form.errors,o),C=we.getIn(h.form.touched,o),w=v&&(h.form.submitCount>0||r.validation?.unique)&&(!Array.isArray(v)||!!v.filter(I=>!!I).length),m=h.form.isSubmitting,[S,_]=p.useState(b);p.useEffect(()=>{const I=setTimeout(()=>{h.form.setFieldValue(o,S)},50);return()=>{clearTimeout(I)}},[S]),p.useEffect(()=>{Se.default(b,S)||_(b)},[b]);const k={name:o,value:S,initialValue:y,setValue:I=>{h.form.setFieldTouched(o,!0,!1),_(I)},error:v,touched:C,showError:w,isSubmitting:m,includeDescription:i??!0,property:r,disabled:u??!1,underlyingValueHasChanged:n??!1,tableMode:l??!1,partOfArray:s??!1,autoFocus:d??!1,customProps:f,context:c,shouldAlwaysRerender:g??!0};return t.jsxs(t.Fragment,{children:[z.default.createElement(e,k),n&&!m&&t.jsx(a.FormHelperText,{children:"This value has been updated elsewhere"})]})}function fr({name:e,value:o,showError:r,disabled:i,property:n,setValue:l,tableMode:s,includeDescription:d,underlyingValueHasChanged:c,context:u}){const g=n.config?.pickOnlySomeKeys||!1;if(!n.properties)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);let h;g?o?h=hl(n.properties,...Object.keys(o).filter(b=>b in n.properties)):h={}:h=n.properties,ge({property:n,value:o,setValue:l});function f(){const b=Object.keys(n.properties).filter(v=>!o||!(v in o)),y=v=>{l({...o,[v.target.value]:null})};return b.length?t.jsx(a.Box,{m:1,children:t.jsxs(a.FormControl,{fullWidth:!0,children:[t.jsx(a.InputLabel,{children:"Add property"}),t.jsx(a.Select,{variant:"standard",value:"",disabled:i,onChange:y,children:b.map(v=>t.jsx(a.MenuItem,{value:v,children:n.properties[v].title||v},v))})]})}):t.jsx(t.Fragment,{})}return t.jsxs(a.FormControl,{fullWidth:!0,error:r,children:[!s&&t.jsx(a.FormHelperText,{filled:!0,required:n.validation?.required,children:t.jsx(be,{property:n})}),t.jsxs(a.Paper,{elevation:0,variant:"outlined",sx:b=>({elevation:0,padding:b.spacing(2),[b.breakpoints.up("md")]:{padding:b.spacing(2)}}),children:[t.jsx(a.Grid,{container:!0,spacing:2,children:Object.entries(h).filter(([b,y])=>!Bo(y)).map(([b,y],v)=>t.jsx(a.Grid,{item:!0,sm:12,xs:12,children:Ge({name:`${e}[${b}]`,disabled:i,property:y,includeDescription:d,underlyingValueHasChanged:c,context:u,tableMode:s,partOfArray:!1,autoFocus:!1,shouldAlwaysRerender:!1})},`map-${e}-${v}`))}),g&&f()]}),d&&t.jsx(pe,{property:n})]})}const os=({containerRef:e})=>{const{isSubmitting:o,isValidating:r,errors:i}=we.useFormikContext();return p.useEffect(()=>{const n=Object.keys(i);if(n.length>0&&o&&!r){const l=e?.current?.querySelector(`#form_field_${n[0]}`);if(l&&e?.current){const s=hr(e.current);if(s){const c=l.getBoundingClientRect().top;s.scrollTo({top:s.scrollTop+c-64,behavior:"smooth"})}const d=l.querySelector("input");d&&d.focus()}}},[o,r,i,e]),null},rs=e=>{const o=e&&e.scrollHeight>e.clientHeight,r=e?window.getComputedStyle(e).overflowY:null,i=r&&r.indexOf("hidden")!==-1;return o&&!i},hr=e=>!e||e===document.body?document.body:rs(e)?e:hr(e.parentNode),ns=J.default(e=>K.default({paper:{elevation:0,padding:e.spacing(2),[e.breakpoints.up("md")]:{padding:e.spacing(2)}},largePadding:{padding:e.spacing(2),[e.breakpoints.up("md")]:{padding:e.spacing(3)}},inputLabel:{marginTop:e.spacing(1/2),marginLeft:e.spacing(1/2)},shrinkInputLabel:{marginTop:"-2px",marginLeft:e.spacing(1/2)},buttons:{display:"flex",justifyContent:"flex-end"},button:{margin:e.spacing(1)},form:{marginTop:e.spacing(2)},input:{minHeight:"64px"},select:{paddingTop:e.spacing(1/2)},oneOfInput:{marginBottom:e.spacing(2)}}));function is({schema:e,status:o,onChange:r,error:i,entity:n}){const l=ns(),s=o==="existing"||!e.customId,d=o!=="existing"&&!e.customId,c=typeof e.customId=="object",u=He(),{copy:g}=Wo({onSuccess:y=>u.open({type:"success",message:`Copied ${y}`})}),h=ce(),f={className:l.input,endAdornment:n?t.jsxs(a.InputAdornment,{position:"end",children:[t.jsx(a.IconButton,{onClick:y=>g(n.id),"aria-label":"copy-id",size:"large",children:t.jsx(a.Tooltip,{title:"Copy",children:t.jsx("svg",{className:"MuiSvgIcon-root MuiSvgIcon-fontSizeSmall",fill:"currentColor",width:"20",height:"20",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})})})}),h?.entityLinkBuilder&&t.jsx("a",{href:h.entityLinkBuilder({entity:n}),rel:"noopener noreferrer",target:"_blank",children:t.jsx(a.IconButton,{onClick:y=>y.stopPropagation(),"aria-label":"go-to-datasource",size:"large",children:t.jsx(a.Tooltip,{title:"Open in the console",children:t.jsx(rt.default,{fontSize:"small"})})})})]}):void 0},b={label:d?"ID is set automatically":"ID",disabled:s,name:"id",type:null,value:n&&o==="existing"?n.id:void 0,variant:"filled"};return oi.createElement(a.FormControl,{fullWidth:!0,error:i,...b,key:"custom-id-field"},c&&e.customId&&t.jsxs(t.Fragment,{children:[t.jsx(a.InputLabel,{id:"id-label",children:b.label}),t.jsx(a.Select,{labelId:"id-label",className:l.select,error:i,...b,onChange:y=>r(y.target.value),children:Object.entries(e.customId).map(([y,v])=>t.jsx(a.MenuItem,{value:y,children:`${y} - ${v}`},`custom-id-item-${y}`))})]}),!c&&t.jsx(a.TextField,{...b,error:i,InputProps:f,helperText:e.customId==="optional"?"Leave this blank to autogenerate an ID":"ID of the new document",onChange:y=>{let v=y.target.value;return v&&(v=v.trim()),r(v.length?v:void 0)}}),t.jsx(we.ErrorMessage,{name:"id",component:"div",children:y=>"You need to specify an ID"}))}const gr=J.default(e=>K.default({stickyButtons:{marginTop:e.spacing(2),background:e.palette.mode==="light"?"rgba(255,255,255,0.6)":"rgba(255, 255, 255, 0)",backdropFilter:"blur(4px)",borderTop:e.palette.divider,position:"sticky",bottom:0,zIndex:200},container:{padding:e.spacing(4),marginTop:e.spacing(2),marginBottom:e.spacing(2),[e.breakpoints.down("lg")]:{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),paddingTop:e.spacing(3),paddingBottom:e.spacing(3)},[e.breakpoints.down("md")]:{padding:e.spacing(2)}},button:{margin:e.spacing(1)},form:{marginTop:e.spacing(2)}}));function Kt({status:e,path:o,schemaOrResolver:r,entity:i,onEntitySave:n,onDiscard:l,onModified:s,onValuesChanged:d}){const c=gr(),u=_e(),g=e==="existing"?i?.id:void 0,h=p.useMemo(()=>fe({schemaOrResolver:r,path:o,entityId:g}),[o,g]),f=p.useMemo(()=>{const O=h.properties;if((e==="existing"||e==="copy")&&i)return i.values??Et(O,h.defaultValues);if(e==="new")return Et(O,h.defaultValues);throw console.error({status:e,entity:i}),new Error("Form has not been initialised with the correct parameters")},[e,h,i]),b=z.default.useRef(null),[y,v]=z.default.useState(void 0),[C,w]=z.default.useState(!1),[m,S]=z.default.useState(),_=z.default.useRef(i?.values??f),k=_.current,[I,P]=p.useState(k),L=p.useMemo(()=>fe({schemaOrResolver:r,path:o,entityId:g,values:I,previousValues:k}),[r,o,g,I]),U=(e==="new"||e==="copy")&&!!L.customId&&L.customId!=="optional",$=p.useMemo(()=>k&&e==="existing"?Object.keys(L.properties).map(O=>{const N=k[O],X=f[O];return Se.default(N,X)?{}:{[O]:X}}).reduce((O,N)=>({...O,...N}),{}):{},[k,f]),T=p.useCallback((O,N)=>{if(U&&!y){console.error("Missing custom Id"),w(!0),N.setSubmitting(!1);return}S(null),w(!1);let X;if(e==="existing"){if(!i?.id)throw Error("Form misconfiguration when saving, no id for existing entity");X=i.id}else if(e==="new"||e==="copy"){if(L.customId){if(L.customId!=="optional"&&!y)throw Error("Form misconfiguration when saving, customId should be set");X=y}}else throw Error("New FormType added, check EntityForm");n&&n({schema:L,path:o,entityId:X,values:O,previousValues:i?.values}).then(D=>{_.current=O,N.setTouched({})}).catch(D=>{console.error(D),S(D)}).finally(()=>{N.setSubmitting(!1)})},[e,o,L,i,n,U,y]),E=p.useCallback(({name:O,value:N,property:X})=>u.checkUniqueField(o,O,N,X,g),[u,o,g]),A=p.useMemo(()=>or(L.properties,E),[L.properties]);return t.jsx(we.Formik,{initialValues:k,onSubmit:T,validationSchema:A,validate:O=>console.debug("Validating",O),onReset:()=>l&&l(),children:({values:O,touched:N,setFieldValue:X,handleSubmit:D,isSubmitting:B,dirty:q})=>t.jsx(ls,{baseDataSourceValues:f,values:O,onModified:s,setInternalValue:P,onValuesChanged:d,underlyingChanges:$,entityId:g,entity:i,touched:N,setFieldValue:X,schema:L,isSubmitting:B,classes:c,formRef:b,status:e,setCustomId:v,customIdError:C,handleSubmit:D,savingError:m})})}function ls({baseDataSourceValues:e,values:o,onModified:r,setInternalValue:i,onValuesChanged:n,underlyingChanges:l,entity:s,touched:d,setFieldValue:c,schema:u,entityId:g,isSubmitting:h,classes:f,formRef:b,status:y,setCustomId:v,customIdError:C,handleSubmit:w,savingError:m}){const S=p.useMemo(()=>!Se.default(e,o),[e,o]);p.useEffect(()=>{r&&r(S),i(o),n&&n(o)},[S,o]),l&&s&&Object.entries(l).forEach(([I,P])=>{const L=o[I];!Se.default(P,L)&&!d[I]&&(console.debug("Updated value from the datasource:",I,P),c(I,P!==void 0?P:null))});const _={schema:u,entityId:g,values:o},k=t.jsx(a.Grid,{container:!0,spacing:4,children:Object.entries(u.properties).filter(([I,P])=>!Bo(P)).map(([I,P])=>{const L=!!l&&Object.keys(l).includes(I)&&!!d[I],U=typeof u.originalSchema.properties[I]=="function",$=h||Qe(P)||Boolean(P.disabled),T={name:I,disabled:$,property:P,includeDescription:!0,underlyingValueHasChanged:L,context:_,tableMode:!1,partOfArray:!1,autoFocus:!1,shouldAlwaysRerender:U};return t.jsx(a.Grid,{item:!0,xs:12,id:`form_field_${I}`,children:Ge(T)},`field_${u.name}_${I}`)})});return t.jsxs(a.Container,{maxWidth:"sm",className:f.container,ref:b,children:[t.jsx(is,{schema:u,status:y,onChange:v,error:C,entity:s}),t.jsxs(we.Form,{className:f.form,onSubmit:w,noValidate:!0,children:[t.jsx(a.Box,{pt:3,children:k}),t.jsxs("div",{className:f.stickyButtons,children:[m&&t.jsx(a.Box,{textAlign:"right",children:t.jsx(a.Typography,{color:"error",children:m.message})}),as(f,h,S,y)]})]}),t.jsx(os,{containerRef:b})]})}function as(e,o,r,i){const n=o||!r&&i==="existing";return t.jsxs(a.Box,{textAlign:"right",children:[i==="existing"&&t.jsx(a.Button,{variant:"text",color:"primary",disabled:n,className:e.button,type:"reset",children:"Discard"}),t.jsxs(a.Button,{variant:"contained",color:"primary",type:"submit",disabled:n,className:e.button,children:[i==="existing"&&"Save",i==="copy"&&"Create copy",i==="new"&&"Create"]})]})}var ss=Object.freeze(Object.defineProperty({__proto__:null,useStyles:gr,EntityForm:Kt,default:Kt},Symbol.toStringTag,{value:"Module"}));const cs=({onResize:e})=>{const o=p.useRef(0),r=p.useRef(null),i=p.useRef(e);i.current=e;const n=p.useCallback(s=>{o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{i.current(s)})},[]),l=p.useCallback(()=>{const s=r.current;s&&s.contentDocument&&s.contentDocument.defaultView&&s.contentDocument.defaultView.addEventListener("resize",n)},[n]);return p.useEffect(()=>{const s=r.current;return()=>{s&&s.contentDocument&&s.contentDocument.defaultView&&s.contentDocument.defaultView.removeEventListener("resize",n)}},[n]),t.jsx("object",{onLoad:l,ref:r,tabIndex:-1,type:"text/html",data:"about:blank",title:"",style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",pointerEvents:"none",zIndex:-1,opacity:0}})},ds=J.default(e=>K.default({form:{display:"flex",flexDirection:"column"},button:{marginTop:e.spacing(1),alignSelf:"flex-end",position:"sticky",bottom:0},popup:{display:"inline-block",userSelect:"none",position:"fixed",zIndex:1300,boxShadow:"0 0 0 2px rgba(128,128,128,0.2)",borderRadius:"4px",backgroundColor:e.palette.background.paper},popupInner:{padding:e.spacing(2),overflow:"auto",cursor:"inherit"},hidden:{visibility:"hidden",zIndex:-1}}));function us({tableKey:e,entity:o,customFieldValidator:r,name:i,schemaResolver:n,path:l,cellRect:s,setPreventOutsideClick:d,open:c,onClose:u,columnIndex:g,onCellValueChange:h}){const[f,b]=z.default.useState(),[y,v]=p.useState(),[C,w]=p.useState(o?.values),m=ds(),S=Ua(),_=z.default.useRef(null),k=z.default.useRef(null),I=z.default.useRef(!1),P=_.current?.getBoundingClientRect();Va({containerRef:k,ref:_,x:y?.x,y:y?.y,onMove:(D,B)=>A({x:D,y:B})}),p.useEffect(()=>{I.current=!1},[i,o]);const L=p.useCallback(()=>{if(!s)throw Error("getInitialLocation error");return{x:s.left<S.width-s.right?s.x+s.width/2:s.x-s.width/2,y:s.top<S.height-s.bottom?s.y+s.height/2:s.y-s.height/2}},[s,S.height,S.width]),U=p.useCallback(({x:D,y:B})=>{if(!P)throw Error("normalizePosition called before draggableBoundingRect is set");return{x:Math.max(0,Math.min(D,S.width-P.width)),y:Math.max(0,Math.min(B,S.height-P.height))}},[P,S]),$=p.useCallback(D=>{if(!s||!P)return;const B=U(D??L());(!y||B.x!==y.x||B.y!==y.y)&&v(B)},[s,P,L,U,y]);p.useEffect(()=>{!s||!P||I.current||(I.current=!0,$(L()))},[s,P,L,$]),p.useLayoutEffect(()=>{$(y)},[S,s]),p.useEffect(()=>{d(c)},[c]);const T=p.useMemo(()=>{if(!n)return;const D=fe({schemaOrResolver:n,path:l,values:C,previousValues:o?.values});return or(i&&D.properties[i]?{[i]:D.properties[i]}:{},r)},[l,C,i]),E=()=>{if(!!P)return $(y)},A=D=>{if(!!P)return $(D)},O=async D=>(b(null),o&&h&&i?h({value:D[i],name:i,entity:o,setError:b,setSaved:()=>{}}):Promise.resolve());if(!o)return t.jsx(t.Fragment,{});const N=o&&t.jsxs("div",{style:{width:520,maxWidth:"100vw",maxHeight:"85vh"},children:[t.jsx(we.Formik,{initialValues:o.values,validationSchema:T,validate:D=>console.debug("Validating",D),onSubmit:(D,B)=>{O(D).then(()=>u()).finally(()=>B.setSubmitting(!1))},children:({handleChange:D,values:B,errors:q,touched:F,dirty:Y,setFieldValue:H,setFieldTouched:W,handleSubmit:j,isSubmitting:M})=>{if(Se.default(B,C)||w(B),!o)return t.jsx(me,{error:"PopupFormField misconfiguration"});if(!n)return t.jsx(t.Fragment,{});const Z=M,oe=fe({schemaOrResolver:n,path:l,values:B,previousValues:o?.values}),re={schema:oe,entityId:o.id,values:B},R=oe.properties[i];return t.jsxs(we.Form,{className:m.form,onSubmit:j,noValidate:!0,children:[i&&R&&Ge({name:i,disabled:M||Qe(R)||!!R.disabled,property:R,includeDescription:!1,underlyingValueHasChanged:!1,context:re,tableMode:!0,partOfArray:!1,autoFocus:c,shouldAlwaysRerender:!0}),t.jsx(a.Button,{className:m.button,variant:"contained",color:"primary",type:"submit",disabled:Z,children:"Save"})]})}}),f&&t.jsx(a.Typography,{color:"error",children:f.message})]},`popup_form_${e}_${o.id}_${g}`),X=t.jsxs("div",{className:ue.default(m.popup,{[m.hidden]:!c}),ref:k,children:[t.jsx(cs,{onResize:E}),t.jsxs("div",{className:m.popupInner,ref:_,children:[N,t.jsx(a.IconButton,{size:"small",style:{position:"absolute",top:-14,right:-14,backgroundColor:"#666"},onClick:D=>{D.stopPropagation(),u()},children:t.jsx(Ie.default,{style:{color:"white"},fontSize:"small"})})]})]},`draggable_${i}_${o.id}`);return t.jsx(Mn.Portal,{container:document.body,children:X})}function fs(e,o){return typeof e=="boolean"?e:typeof e=="function"?e(o):!0}function hs({schemaResolver:e,additionalColumns:o,displayedProperties:r,path:i,inlineEditing:n,size:l,onCellValueChange:s,uniqueFieldValidator:d}){const c=ce(),[u,g]=z.default.useState(void 0),[h,f]=z.default.useState(void 0),[b,y]=z.default.useState(!1),[v,C]=z.default.useState(!1),w=z.default.useRef(Math.random().toString(36)),m=p.useMemo(()=>o?o.map(B=>({[B.id]:B})).reduce((B,q)=>({...B,...q}),[]):{},[o]);p.useEffect(()=>{const B=q=>{q.keyCode===27&&_()};return document.addEventListener("keydown",B,!1),()=>{document.removeEventListener("keydown",B,!1)}});const S=p.useCallback(B=>{g(B),y(!0)},[]),_=p.useCallback(()=>{g(void 0),y(!1),C(!1)},[]),k=p.useCallback(()=>{f(void 0),y(!0)},[]),I=p.useCallback(B=>qe(B).filter(([q,F])=>!Re(F)).map(([q,F])=>({[q]:Do(F)})).reduce((q,F)=>({...q,...F}),{}),[]),P=p.useCallback((B,q=!1)=>{if(B.dataType==="number"||B.dataType==="string"){const F=B.title,Y=B.config?.enumValues;return{dataType:B.dataType,isArray:q,title:F,enumValues:Y?I(Y):void 0}}else{if(B.dataType==="array"&&B.of)return P(B.of,!0);if(B.dataType==="boolean"){const F=B.title;return{dataType:B.dataType,isArray:q,title:F}}else if(B.dataType==="timestamp"){const F=B.title;return{dataType:B.dataType,isArray:q,title:F}}}},[I]),L=p.useMemo(()=>fe({schemaOrResolver:e,path:i}),[e,i]),$=We().extra.admin,T={};Object.keys(L.properties).forEach(B=>{L.properties[B].onlyForGlobalAdmin?$&&(T[B]=L.properties[B]):T[B]=L.properties[B]}),L.properties=T;const E=({column:B,columnIndex:q,rowData:F,rowIndex:Y})=>{const H=F,W=B.dataKey,M=e({entityId:H.id,values:H.values}).properties[W];if(!M)return null;if(fs(n,H)){const oe=ye=>{f(ye?{columnIndex:q,width:B.width,height:B.height,entity:H,cellRect:ye,name:W,schemaResolver:e}:void 0)},re=ye=>{S(ye?{columnIndex:q,width:B.width,height:B.height,entity:H,cellRect:ye,name:W,schemaResolver:e}:void 0)},R=u?.columnIndex===q&&u?.entity.id===H.id,ve=R&&b,ee=ut({property:M,customFieldValidator:d?({name:ye,value:et,property:lo})=>d({name:ye,value:et,property:lo,entityId:H.id}):void 0,name:W}),$e=s?ye=>s({...ye,entity:H}):void 0;return H?t.jsx(qa,{size:l,align:B.align,name:W,validation:ee,onValueChange:$e,selected:R,focused:ve,setPreventOutsideClick:C,setFocused:y,value:H?.values?H.values[W]:void 0,property:M,openPopup:oe,select:re,width:B.width,height:B.height,entityId:H.id,entityValues:H.values},`table_cell_${W}_${Y}_${q}`):t.jsx(Fe,{property:M,size:Be(l)})}else return t.jsx(Ut,{size:l,value:H.values[W],align:B.align,disabled:!0,children:t.jsx(de,{width:B.width,height:B.height,name:`preview_${W}_${Y}_${q}`,property:M,value:H.values[W],size:Be(l)})},`preview_cell_${W}_${Y}_${q}`)},A=({column:B,columnIndex:q,rowData:F,rowIndex:Y})=>{const H=F,W=m[B.dataKey],j=W.dependencies?Object.entries(H.values).filter(([M,Z])=>W.dependencies.includes(M)).reduce((M,Z)=>({...M,...Z}),{}):void 0;return t.jsx(Ut,{value:j,focused:!1,selected:!1,disabled:!0,size:l,align:"left",allowScroll:!1,showExpandIcon:!1,disabledTooltip:"Additional columns can't be edited directly",children:t.jsx(ne,{children:W.builder({entity:H,context:c})})})},O=Object.keys(L.properties).map(B=>{const q=L.properties[B];return{key:B,property:q,align:aa(q),icon:F=>ct(q,F?void 0:"disabled","small"),label:q.title||B,sortable:!0,filter:P(q),width:er(q),cellRenderer:E}});if(o){const B=o.map(q=>({key:q.id,type:"additional",align:"left",sortable:!1,label:q.title,width:q.width??200,cellRenderer:A}));O.push(...B)}const N=r.map(B=>O.find(q=>q.key===B)).filter(B=>!!B),X=d?({name:B,value:q,property:F})=>d({name:B,value:q,property:F,entityId:u?.entity.id}):void 0,D=t.jsx(us,{open:Boolean(h),onClose:k,cellRect:h?.cellRect,columnIndex:h?.columnIndex,name:h?.name,schemaResolver:h?.schemaResolver,entity:h?.entity,tableKey:w.current,customFieldValidator:X,path:i,onCellValueChange:s,setPreventOutsideClick:C});return{columns:N,popupFormField:D}}const gs=50,ps=vt.makeStyles(e=>K.default({root:{height:"100%",width:"100%",display:"flex",flexDirection:"column"}})),Zt=z.default.memo(vs,bs);function bs(e,o){return e.path===o.path&&e.collection===o.collection&&e.title===o.title&&e.toolbarActionsBuilder===o.toolbarActionsBuilder&&e.tableRowActionsBuilder===o.tableRowActionsBuilder&&e.inlineEditing===o.inlineEditing}function vs({path:e,collection:o,schemaResolver:r,inlineEditing:i,toolbarActionsBuilder:n,title:l,tableRowActionsBuilder:s,entitiesDisplayedFirst:d,onEntityClick:c,onColumnResize:u,onSizeChanged:g,hoverRow:h=!0}){const f=ce(),b=_e(),y=Pe(),v=a.useTheme(),C=a.useMediaQuery(v.breakpoints.up("md")),[w,m]=z.default.useState(o.defaultSize??"m"),S=o.initialFilter,_=o.initialSort,k=o.filterCombinations,I=o.textSearchEnabled,P=o.pagination===void 0||Boolean(o.pagination),L=typeof o.pagination=="number"?o.pagination:gs,[U,$]=z.default.useState(P?L:void 0),[T,E]=z.default.useState(S||{}),[A,O]=z.default.useState(_),N=!!T&&Object.keys(T).length>0,X=ps(),D=p.useMemo(()=>{const ae=o.subcollections?.map(he=>({id:tr(he),title:he.name,width:200,dependencies:[],builder:({entity:Xe})=>t.jsx(a.Button,{color:"primary",onClick:tt=>{tt.stopPropagation(),y.open({path:e,entityId:Xe.id,selectedSubpath:he.path,permissions:o.permissions,schema:r,subcollections:o.subcollections,callbacks:o.callbacks,overrideSchemaRegistry:!1})},children:(he.buttonContent&&he.buttonContent({entity:Xe}))??he.name})}))??[];return[...o.additionalColumns??[],...ae]},[o,e]),B=p.useMemo(()=>r({}),[]),q=sa(o,B,!0),F=p.useCallback(({name:ae,value:he,property:Xe,entityId:tt})=>b.checkUniqueField(e,ae,he,Xe,tt),[e,b]),Y=p.useCallback(({value:ae,name:he,setSaved:Xe,setError:tt,entity:ao})=>{const Tc={path:e,entityId:ao.id,values:{...ao.values,[he]:ae},previousValues:ao.values,schema:r,status:"existing"};return Dt({...Tc,callbacks:o.callbacks,dataSource:b,context:f,onSaveSuccess:()=>Xe(!0),onSaveFailure:kc=>{tt(kc)}})},[e,o,r]);let{columns:H,popupFormField:W}=hs({schemaResolver:r,additionalColumns:D,displayedProperties:q,path:e,inlineEditing:i,size:w,onCellValueChange:Y,uniqueFieldValidator:F});console.log("columns",H),H=H.filter(ae=>ae.property?!ae.property.hideInTable:!0);const[j,M]=z.default.useState(),{data:Z,dataLoading:oe,noMoreToLoad:re,dataLoadingError:R}=at({entitiesDisplayedFirst:d,path:e,schemaResolver:r,filterValues:T,sortBy:A,searchString:j,itemCount:U}),ve=p.useMemo(()=>n&&n({size:w,data:Z}),[n,w,Z]),G=p.useCallback(()=>{!P||oe||re||U!==void 0&&$(U+L)},[oe,U,re,L,P]),ee=p.useCallback(()=>{$(L)},[L]),$e=p.useCallback(()=>E({}),[]),ye=p.useCallback(({entry:ae,size:he})=>s?s({entity:ae,size:he}):t.jsx(zt,{entity:ae,size:he,data:Z}),[s]),et=p.useCallback(({rowData:ae})=>{},[c]),lo=p.useCallback(ae=>{g&&g(ae),m(ae)},[]),Sc=p.useCallback(ae=>M(ae),[]);return t.jsxs(a.Paper,{className:X.root,children:[t.jsx(fa,{filterIsSet:N,onTextSearch:I?Sc:void 0,clearFilter:$e,actions:ve,size:w,onSizeChanged:lo,title:l,loading:oe}),t.jsx(Tr,{data:Z,columns:H,onRowClick:et,onEndReached:G,onResetPagination:ee,idColumnBuilder:ye,error:R,paginationEnabled:P,onColumnResize:u,frozenIdColumn:C,size:w,loading:oe,filter:T,onFilterUpdate:E,sortBy:A,onSortByUpdate:O,hoverRow:h,checkFilterCombination:(ae,he)=>ys(ae,k,he),collection:o}),W]})}function ys(e,o,r){const i=r?r[0]:void 0,n=r?r[1]:void 0,l=Object.values(e);if(i&&l.map(c=>c[0]).includes("=="))return!1;const s=Object.keys(e),d=s.length;return d===1&&(!i||i===s[0])?!0:!o&&d>1||i&&d===1&&s[0]!==i?!1:!!o&&o.filter(c=>!i||i in c).find(c=>Object.entries(e).every(([u,g])=>c[u]!==void 0&&(!n||c[u]===n)))!==void 0}const ws=J.default(e=>K.default({dialogBody:{flexGrow:1,overflow:"auto",minWidth:"85vw"},paper:{height:"100%"}}));function ht({onSingleEntitySelected:e,onMultipleEntitiesSelected:o,onClose:r,open:i,multiselect:n,collectionResolver:l,path:s,selectedEntityIds:d}){const c=ws(),u=_e(),g=l,h=l.schema,f=l.schemaResolver,[b,y]=p.useState();p.useEffect(()=>{let k=!1;return d?Promise.all(d.map(I=>u.fetchEntity({path:s,entityId:I,schema:f}))).then(I=>{k||y(I)}):y([]),()=>{k=!0}},[u,s,d]);const v=k=>{!n&&e?e(k):w(k)},C=()=>{!n&&e?e(null):o&&o([])},w=k=>{let I;b&&(b.map(P=>P.id).indexOf(k.id)>-1?I=b.filter(P=>P.id!==k.id):I=[...b,k],y(I),o&&o(I))},m=({entity:k,size:I})=>{const P=d&&d.indexOf(k.id)>-1;return t.jsx(zt,{entity:k,size:I,isSelected:P,selectionEnabled:n,toggleEntitySelection:w})},S=()=>t.jsx(a.Button,{onClick:C,color:"primary",children:"Clear"}),_=t.jsx(a.Typography,{variant:"h6",children:`Select ${h.name}`});return t.jsxs(a.Dialog,{onClose:r,classes:{paper:c.paper},maxWidth:"xl",scroll:"paper",open:i,children:[t.jsx("div",{className:c.dialogBody,children:b&&t.jsx(Zt,{path:s,collection:g,schemaResolver:f,inlineEditing:!1,toolbarActionsBuilder:S,onEntityClick:v,tableRowActionsBuilder:m,title:_,entitiesDisplayedFirst:b})}),t.jsx(a.Divider,{}),t.jsx(a.DialogActions,{children:t.jsx(a.Button,{onClick:k=>{k.stopPropagation(),r()},color:"primary",variant:"contained",children:"Close"})})]})}function Cs({entityOrEntitiesToDelete:e,schemaResolver:o,onClose:r,open:i,callbacks:n,onEntityDelete:l,onMultipleEntitiesDelete:s,path:d,...c}){const u=_e(),g=He(),[h,f]=p.useState(!1),[b,y]=z.default.useState(),[v,C]=z.default.useState(),w=ce(),m=p.useMemo(()=>o({}),[]);z.default.useEffect(()=>{if(e){const E=Array.isArray(e)&&e.length===1?e[0]:e;y(E),C(Array.isArray(E))}},[e]);const S=p.useCallback(()=>{r()},[r]),_=p.useCallback(E=>{console.debug("Deleted",E)},[]),k=p.useCallback((E,A)=>{g.open({type:"error",title:`${m.name}: Error deleting`,message:A?.message}),console.error("Error deleting entity"),console.error(A)},[m.name]),I=p.useCallback((E,A)=>{g.open({type:"error",title:`${m.name}: Error before deleting`,message:A?.message}),console.error(A)},[m.name]),P=p.useCallback((E,A)=>{g.open({type:"error",title:`${m.name}: Error after deleting (entity is deleted)`,message:A?.message}),console.error(A)},[m.name]),L=p.useCallback(E=>Vo({dataSource:u,entity:E,schema:m,callbacks:n,onDeleteSuccess:_,onDeleteFailure:k,onPreDeleteHookError:I,onDeleteSuccessHookError:P,context:w}),[u,m,n,_,k,I,P,w]),U=p.useCallback(async()=>{b&&(f(!0),v?Promise.all(b.map(L)).then(E=>{f(!1),s&&b&&s(d,b),E.every(Boolean)?g.open({type:"success",message:`${m.name}: multiple deleted`}):E.some(Boolean)?g.open({type:"warning",message:`${m.name}: Some of the entities have been deleted, but not all`}):g.open({type:"error",message:`${m.name}: Error deleting entities`}),r()}):L(b).then(E=>{f(!1),E&&(l&&b&&l(d,b),g.open({type:"success",message:`${m.name} deleted`}),r())}))},[b,v,L,s,d,r,g,m.name,l]);let $;if(b&&v)$=t.jsx("div",{children:"Multiple entities"});else{const E=b,A=o({entityId:E?.id,values:E?.values});$=E?t.jsx(dt,{entity:E,schema:A,path:d}):t.jsx(t.Fragment,{})}const T=v?`${m.name}: Confirm multiple delete?`:`Would you like to delete this ${m.name}?`;return t.jsxs(a.Dialog,{maxWidth:"md","aria-labelledby":"delete-dialog",open:i,onBackdropClick:r,...c,children:[t.jsx(a.DialogTitle,{id:"delete-dialog-title",children:T}),!v&&t.jsx(a.DialogContent,{dividers:!0,children:$}),t.jsxs(a.DialogActions,{children:[h&&t.jsx(a.CircularProgress,{size:16,thickness:8}),t.jsx(a.Button,{onClick:S,disabled:h,color:"primary",children:"Cancel"}),t.jsx(a.Button,{autoFocus:!0,disabled:h,onClick:U,color:"primary",children:"Ok"})]})]})}function ms(e,o,r,i,n){const l=r.properties,s=Ss(l,i,n),d=xs(e,o,l,s),c=yr(s.map(g=>g.label)),u=d.map(g=>yr(g));Ts([c,...u],`${r.name}.csv`,"text/csv")}function xs(e,o,r,i){const n=e.map(l=>({id:l.id,...vr(l.values,r)}));return o&&o.forEach((l,s)=>{n[s]={...n[s],...l}}),n&&n.map(l=>i.map(s=>_t(l,s.key)))}function Ss(e,o,r){const i=[{label:"id",key:"id"},...Object.entries(e).map(([n,l])=>pr(l,n,"")).flat()];return r?.additionalColumns&&i.push(...r.additionalColumns.map(n=>({label:n.key,key:n.key}))),i}function pr(e,o,r=""){const i=r?`${r}.${o}`:o;return e.dataType==="map"&&e.properties?Object.entries(e.properties).map(([n,l])=>pr(l,n,i)).flat():[{label:i,key:i}]}function br(e,o){let r;if(o.dataType==="map"&&o.properties)r=vr(e,o.properties);else if(o.dataType==="array")o.of&&Array.isArray(e)?o.of.dataType==="map"?r=e.map(i=>JSON.stringify(i)):r=e.map(i=>br(i,o.of)):r=e;else if(o.dataType==="reference"){const i=e||void 0;r=i?i.pathWithId:null}else o.dataType==="timestamp"?r=e?e.getTime():null:r=e;return r}function vr(e,o){const r=Object.entries(o).map(([i,n])=>{const l=e&&e[i],s=br(l,n);return s===void 0?{}:{[i]:s}}).reduce((i,n)=>({...i,...n}),{});return{...e,...r}}function yr(e){return e.map(o=>{if(o==null)return"";const r=String(o);return'"'+r.replaceAll('"','""')+'"'}).join(",")+`\r
`}function Ts(e,o,r){const i=new Blob(e,{type:r}),n=URL.createObjectURL(i),l=document.createElement("a");l.href=n,l.setAttribute("download",o),l.click()}const Qt=200;function ks({schema:e,schemaResolver:o,path:r,exportConfig:i}){const n=_e(),l=ce(),s=p.useRef(),d=p.useRef(),[c,u]=z.default.useState(!1),[g,h]=z.default.useState(),[f,b]=z.default.useState(!1),[y,v]=z.default.useState(!1),[C,w]=z.default.useState(!1),m=p.useCallback(()=>{w(!0)},[w]),S=p.useCallback(()=>{w(!1)},[w]),_=p.useCallback((P,L,U,$,T,E)=>{if(!P)throw Error("Trying to perform export without loading data first");const A=$({});ms(P,L,A,T,E)},[]);p.useEffect(()=>{if(!C)return;u(!0);const P=async $=>{$.length>=Qt&&b(!0);const T=s.current&&$.length>s.current.length&&y;s.current=$;const E=await L($);d.current=E,u(!1),h(void 0),T&&(_($,E,e,o,r,i),S())},L=async $=>{if(!i?.additionalColumns)return;const T=i.additionalColumns;return await Promise.all($.map(async A=>(await Promise.all(T.map(async O=>({[O.key]:await O.builder({entity:A,context:l})})))).reduce((O,N)=>({...O,...N}),{})))},U=$=>{console.error("ERROR",$),u(!1),h($)};n.fetchCollection({path:r,schema:o,limit:y?void 0:Qt}).then(P).catch(U)},[r,y,e,C,n,o,_,i,S,l]);const k=f&&!y,I=p.useCallback(()=>{k?v(!0):(_(s.current,d.current,e,o,r,i),S())},[k,_,e,o,r,i,S]);return t.jsxs(t.Fragment,{children:[t.jsx(a.Tooltip,{title:"Export",children:t.jsx(a.IconButton,{color:"primary",onClick:m,size:"large",children:t.jsx(fi.default,{})})}),t.jsxs(a.Dialog,{open:C,onClose:S,children:[t.jsx(a.DialogTitle,{children:"Export data"}),t.jsx(a.DialogContent,{children:t.jsxs(a.DialogContentText,{children:[t.jsx("div",{children:"Download the the content of this table as a CSV"}),t.jsx("br",{}),k&&t.jsxs(a.Alert,{elevation:1,variant:"filled",severity:"warning",children:[t.jsxs("div",{children:["This collections has a large number of documents (more than ",Qt,")."]}),t.jsx("div",{children:"Would you like to proceed?"})]})]})}),t.jsxs(a.DialogActions,{children:[c&&t.jsx(a.CircularProgress,{size:16,thickness:8}),t.jsx(a.Button,{color:"primary",onClick:S,children:"Cancel"}),t.jsx(a.Button,{color:"primary",disabled:c,onClick:I,children:"Download"})]})]})]})}const gt={edit:!0,create:!0,delete:!0};function Rt(e,o,r,i,n){if(e===void 0)return gt;if(typeof e=="object")return e;if(typeof e=="function")return e({user:r.user,authController:r,entity:o,path:i,context:n});throw Error("New type of HasPermission added and not mapped")}function eo(e,o,r,i,n){return Rt(e,o,r,i,n).edit??gt.edit}function wr(e,o,r,i){return Rt(e,null,o,r,i).create??gt.create}function Cr(e,o,r,i,n){return Rt(e,o,r,i,n).delete??gt.delete}function to(e){const[o,r]=p.useState([]);let i=at({path:e.path,schemaResolver:e.schemaResolver});i=at({path:e.path,schemaResolver:e.schemaResolver});const n=p.useCallback(c=>{let u;o.map(g=>g.id).includes(c.id)?u=o.filter(g=>g.id!==c.id):u=[...o,c],r(u)},[o]),l=p.useCallback(c=>{if(o.length===i.data.length&&o.length!==0)r([]);else if(i.data){const u=i.data;r(u)}},[o]),s=p.useCallback(c=>o.map(u=>u.id).includes(c.id),[o]),d=p.useCallback(()=>o.length===i.data.length&&o.length!==0,[o,i]);return{selectedEntities:o,setSelectedEntities:r,isEntitySelected:s,isAllEntitiesSelected:d,toggleEntitySelection:n,selectAll:l}}function pt({path:e,collection:o}){const r=Pe(),i=ce(),n=We(),l=Te(),s=a.useTheme(),d=a.useMediaQuery(s.breakpoints.up("md")),[c,u]=z.default.useState(void 0),g=l.getCollectionResolver(e);if(!g)throw Error(`Couldn't find the corresponding collection view for the path: ${e}`);const h=p.useCallback(W=>{l.onCollectionModifiedForUser(e,W)},[e]),f=g??o,{schemaResolver:b}=g,y=f.exportable===void 0||f.exportable,v=f.selectionEnabled===void 0||f.selectionEnabled,C=f.inlineEditing!==void 0&&!f.inlineEditing,[w,m]=z.default.useState(null),S=to(f),_=f.selectionController??S,{selectedEntities:k,toggleEntitySelection:I,selectAll:P,isAllEntitiesSelected:L,isEntitySelected:U,setSelectedEntities:$,collectionData:T}=_;p.useEffect(()=>{u(void 0)},[k]);const E=p.useCallback(W=>r.open({entityId:W.id,path:e,permissions:f.permissions,schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1}),[e,f,r]),A=p.useCallback(W=>(W.stopPropagation(),r.open({path:e,permissions:f.permissions,schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1})),[e,f,r]),O=p.useCallback((W,j)=>{$(k.filter(M=>M.id!==j.id))},[k,$]),N=p.useCallback((W,j)=>{$([]),u(void 0)},[$]),X=p.useCallback(W=>eo(f.permissions,W,n,e,i)?f.inlineEditing===void 0||f.inlineEditing:!1,[f.inlineEditing,f.permissions,e]),D=p.useCallback(({width:W,key:j})=>{if(!f.schema.properties[j])return;const M={columnWidth:W},Z={schema:{properties:{[j]:M}}};h&&h(Z)},[f.schema.properties,h]),B=p.useCallback(W=>{h&&h({defaultSize:W})},[h]),q=w!=null,F=p.useMemo(()=>t.jsxs("div",{style:{padding:"4px"},children:[t.jsx(a.Typography,{variant:"h6",style:{lineHeight:"1.0",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"160px",cursor:f.description?"pointer":"inherit"},onClick:f.description?W=>{m(W.currentTarget),W.stopPropagation()}:void 0,children:`${f.name}`}),t.jsx(a.Typography,{style:{display:"block",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"160px",direction:"rtl",textAlign:"left"},variant:"caption",color:"textSecondary",children:`/${e}`}),f.description&&t.jsx(a.Popover,{id:"info-dialog",open:q,anchorEl:w,elevation:1,onClose:()=>{m(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(a.Box,{m:2,children:t.jsx(lt,{source:f.description})})})]}),[f.description,f.name,e,q,w]),Y=p.useCallback(({entity:W,size:j})=>{const M=U(W),Z=L(),oe=wr(f.permissions,n,e,i),re=eo(f.permissions,W,n,e,i),R=Cr(f.permissions,W,n,e,i),ve=ee=>r.open({entityId:ee.id,path:e,copy:!0,permissions:{edit:re,create:oe,delete:R},schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1}),G=ee=>r.open({entityId:ee.id,path:e,permissions:{edit:re,create:oe,delete:R},schema:f.schema,subcollections:f.subcollections,callbacks:f.callbacks,overrideSchemaRegistry:!1});return t.jsx(zt,{entity:W,isSelected:M,isAllSelected:Z,selectionEnabled:v,size:j,toggleEntitySelection:I,selectAll:P,onEditClicked:G,onCopyClicked:oe?ve:void 0,onDeleteClicked:R?u:void 0})},[_,r,f.permissions,n,e]),H=p.useCallback(W=>{const j=wr(f.permissions,n,e,i)&&A&&(d?t.jsxs(a.Button,{onClick:A,startIcon:t.jsx(Oe.Add,{}),size:"large",variant:"contained",color:"primary",children:["Add ",f.schema.name]}):t.jsx(a.Button,{onClick:A,size:"medium",variant:"contained",color:"primary",children:t.jsx(Oe.Add,{})})),M=k.every(ve=>Cr(f.permissions,ve,n,e,i)),Z=ve=>{ve.stopPropagation(),u(k)},oe=v&&t.jsx(a.Tooltip,{title:M?"Multiple delete":"You have selected one entity you cannot delete",children:t.jsxs("span",{children:[d&&t.jsx(a.Button,{disabled:!k?.length||!M,startIcon:t.jsx(Oe.Delete,{}),onClick:Z,color:"primary",children:t.jsxs("p",{style:{minWidth:24},children:["(",k?.length,")"]})}),!d&&t.jsx(a.IconButton,{color:"primary",disabled:!k?.length||!M,onClick:Z,size:"large",children:t.jsx(Oe.Delete,{})})]})}),re=f.extraActions?f.extraActions({path:e,collection:f,selectionController:_,context:i}):void 0,R=y&&t.jsx(ks,{schema:f.schema,schemaResolver:b,exportConfig:typeof f.exportable=="object"?f.exportable:void 0,path:e});return t.jsxs(t.Fragment,{children:[re,oe,R,j]})},[_,e,f,d]);return t.jsxs(t.Fragment,{children:[t.jsx(Zt,{title:F,path:e,collection:f,schemaResolver:b,onSizeChanged:B,inlineEditing:X,onEntityClick:E,onColumnResize:D,tableRowActionsBuilder:Y,toolbarActionsBuilder:H,hoverRow:C},`collection_table_${e}`),c&&t.jsx(Cs,{entityOrEntitiesToDelete:c,path:e,schema:f.schema,schemaResolver:b,callbacks:f.callbacks,open:!!c,onEntityDelete:O,onMultipleEntitiesDelete:N,onClose:()=>u(void 0)})]})}var _s=Object.freeze(Object.defineProperty({__proto__:null,useSelectionController:to,EntityCollectionView:pt,default:pt},Symbol.toStringTag,{value:"Module"}));function Ee(e){return t.jsx(a.Box,{display:"flex",width:"100%",maxHeight:"100%",height:"100vh",children:t.jsx(a.Box,{m:"auto",children:t.jsx(a.CircularProgress,{...e})})})}const Es=J.default(e=>K.default({card:{display:"flex",flexDirection:"column",alignItems:"flex-start",minHeight:248},flexGrow:{flexGrow:1}}));function mr(){const e=Es(),o=Te();if(!o.navigation)return t.jsx(t.Fragment,{});const{navigationEntries:r,groups:i}=_o(o,!1),n=[...i];r.filter(s=>!s.group).length>0&&n.push(null);function l(s){return t.jsx(a.Grid,{item:!0,xs:12,sm:6,md:4,children:t.jsx(a.Paper,{variant:"outlined",children:t.jsxs(a.CardActionArea,{className:e.card,component:se.Link,to:s.url,children:[t.jsxs(a.CardContent,{className:e.flexGrow,children:[t.jsx(yi.default,{color:"disabled"}),t.jsx(a.Typography,{gutterBottom:!0,variant:"h5",component:"h2",children:s.name}),s.description&&t.jsx(a.Typography,{variant:"body2",color:"textSecondary",component:"div",children:t.jsx(lt,{source:s.description})})]}),t.jsx(a.CardActions,{style:{alignSelf:"flex-end"},children:t.jsx(a.Box,{p:1,children:t.jsx(vi.default,{color:"primary"})})})]})})},`nav_${s.group}_${s.name}`)}return t.jsx(a.Container,{children:n.map((s,d)=>t.jsxs(a.Box,{mt:6,mb:6,children:[n.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(a.Typography,{color:"textSecondary",className:"weight-500",children:s?.toUpperCase()??"Collections".toUpperCase()}),t.jsx(a.Divider,{})]}),t.jsx(a.Box,{mt:2,children:t.jsxs(a.Grid,{container:!0,spacing:2,children:[s&&r.filter(c=>c.group===s).map(c=>l(c)),!s&&r.filter(c=>!c.group).map(c=>l(c))]})})]},`group_${d}`))})}const Is={name:"1oajfbb",styles:"& .BaseTable{box-shadow:0 2px 4px 0 rgba(128, 128, 128, 0.2);contain:strict;position:relative;box-sizing:border-box;font-size:13px;}& .BaseTable--disabled{opacity:0.7;pointer-events:none;}& .BaseTable--dynamic .BaseTable__row{overflow:hidden;align-items:stretch;}& .BaseTable:not(.BaseTable--dynamic) .BaseTable__row-cell-text,& .BaseTable .BaseTable__row--frozen .BaseTable__row-cell-text{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}& .BaseTable__table{position:absolute;top:0;display:flex;flex-direction:column-reverse;}& .BaseTable__table-main{outline:1px solid rgba(128, 128, 128, 0.1);left:0;}& .BaseTable__table-main .BaseTable__header-cell:first-of-type,.BaseTable__table-main .BaseTable__row-cell:first-of-type{padding:0;}& .BaseTable__table-frozen-left .BaseTable__body{backdrop-filter:blur(4px);}& .BaseTable__table-frozen-left .BaseTable__header,& .BaseTable__table-frozen-left .BaseTable__body,.BaseTable__table-frozen-right .BaseTable__header,& .BaseTable__table-frozen-right .BaseTable__body{overflow:hidden!important;}& .BaseTable__table-frozen-left{box-shadow:2px 0 4px 0 rgba(128, 128, 128, 0.1);top:0;left:0;}& .BaseTable__table-frozen-left .BaseTable__header-cell:first-of-type,.BaseTable__table-frozen-left .BaseTable__row-cell:first-of-type{padding:0;}& .BaseTable__table-frozen-left .BaseTable__header-row,& .BaseTable__table-frozen-left .BaseTable__row{padding-right:0!important;}& .BaseTable__table-frozen-left .BaseTable__body{overflow-y:auto!important;}& .BaseTable__table-frozen-right{box-shadow:-2px 0 4px 0 rgba(128, 128, 128, 0.3);top:0;right:0;}& .BaseTable__table-frozen-right .BaseTable__header-cell:last-child,.BaseTable__table-frozen-right .BaseTable__row-cell:last-child{padding-right:15px;}& .BaseTable__table-frozen-right .BaseTable__header-row,& .BaseTable__table-frozen-right .BaseTable__row{padding-left:0!important;}& .BaseTable__table-frozen-right .BaseTable__body{overflow-y:auto!important;}& .BaseTable__header{overflow:hidden!important;}& .BaseTable .BaseTable__header,& .BaseTable .BaseTable__body{outline:none;}& .BaseTable__header-row,.BaseTable__row{display:flex;align-items:center;border-bottom:1px solid rgba(128, 128, 128, 0.1);box-sizing:border-box;}& .BaseTable__header-row{font-weight:700;}& .BaseTable__row{}& .BaseTable__row:hover,.BaseTable__row--hovered{}& .BaseTable__row-expanded{}& .BaseTable__header-cell,.BaseTable__row-cell{min-width:0;height:100%;display:flex;align-items:center;padding:0 7.5px;box-sizing:border-box;}& .BaseTable__header-cell--align-center,.BaseTable__row-cell--align-center{justify-content:center;text-align:center;}& .BaseTable__header-cell--align-right,.BaseTable__row-cell--align-right{justify-content:flex-end;text-align:right;}& .BaseTable__header-cell{position:relative;cursor:default;}& .BaseTable__header-cell:hover .BaseTable__column-resizer{visibility:visible;opacity:0.5;}& .BaseTable__header-cell:hover .BaseTable__column-resizer:hover{opacity:1;}& .BaseTable__header-cell .BaseTable__sort-indicator{display:none;}& .BaseTable__header-cell--sortable:hover{background-color:#f3f3f3;cursor:pointer;}& .BaseTable__header-cell--sortable:not(.BaseTable__header-cell--sorting):hover .BaseTable__sort-indicator{display:block;color:#888888;}& .BaseTable__header-cell--sorting .BaseTable__sort-indicator,.BaseTable__header-cell--sorting:hover .BaseTable__sort-indicator{display:block;}& .BaseTable__header-cell--resizing .BaseTable__column-resizer{visibility:visible;opacity:1;}& .BaseTable__header-cell--resizing .BaseTable__column-resizer::after{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;content:'';left:-9999px;}& .BaseTable__header-cell-text{overflow:hidden;text-overflow:ellipsis;white-space:normal;}& .BaseTable__header-row--resizing .BaseTable__header-cell{background-color:transparent;cursor:col-resize;}& .BaseTable__header-row--resizing .BaseTable__header-cell:not(.BaseTable__header-cell--sorting) .BaseTable__sort-indicator{display:none;}& .BaseTable__header-row--resizing .BaseTable__header-cell:not(.BaseTable__header-cell--resizing) .BaseTable__column-resizer{visibility:hidden;}& .BaseTable__column-resizer{width:3px;visibility:hidden;background-color:#cccccc;}& .BaseTable__column-resizer:hover{visibility:visible;opacity:1;}& .BaseTable__footer{position:absolute;left:0;right:0;bottom:0;overflow:hidden;background-color:#ffffff;}& .BaseTable__resizing-line{cursor:col-resize;position:absolute;top:0;background-color:#cccccc;width:3px;transform:translateX(-100%);}& .BaseTable__empty-layer{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;}& .BaseTable__overlay{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden;pointer-events:none;}& .BaseTable__overlay>*{pointer-events:auto;}"},Bs={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"in","array-contains":"Contains","array-contains-any":"Any"},oo=["array-contains-any","in"];function Ps({name:e,value:o,setValue:r,dataType:i,isArray:n,enumValues:l,title:s}){const d=n?["array-contains"]:["==","!=",">","<",">=","<="];l&&(n?d.push("array-contains-any"):d.push("in"));const[c,u]=o||[d[0],void 0],[g,h]=p.useState(c),[f,b]=p.useState(u);function y(C,w){let m=w;const S=oo.includes(g),_=oo.includes(C);S!==_&&(m=_?typeof w=="string"||typeof w=="number"?[w]:[]:""),typeof m=="number"&&isNaN(m)&&(m=void 0),h(C),b(m);const k=m!==null&&Array.isArray(m)?m.length>0:m!==void 0;r(C&&k?[C,m]:void 0)}const v=oo.includes(g);return t.jsxs(a.Box,{display:"flex",width:340,alignItems:"center",children:[t.jsx(a.Box,{width:80,children:t.jsx(a.FormControl,{fullWidth:!0,children:t.jsx(a.Select,{value:g,fullWidth:!0,onChange:C=>{y(C.target.value,f)},children:d.map(C=>t.jsx(a.MenuItem,{value:C,children:Bs[C]},`filter_op_${e}_${C}`))})})}),t.jsx(a.Box,{flexGrow:1,ml:1,children:t.jsxs(a.FormControl,{fullWidth:!0,children:[!l&&t.jsx(a.OutlinedInput,{fullWidth:!0,type:i==="number"?"number":void 0,value:f!==void 0?f:"",onChange:C=>{const w=i==="number"?parseFloat(C.target.value):C.target.value;y(g,w)}},`filter_${e}`),l&&t.jsx(a.Select,{fullWidth:!0,multiple:v,value:f!==void 0?f:n?[]:"",onChange:C=>y(g,i==="number"?parseInt(C.target.value):C.target.value),renderValue:v?C=>t.jsx("div",{children:C.map(w=>t.jsx(xe,{enumKey:w,enumValues:l,small:!0},`select_value_${e}_${w}`))}):void 0,children:Object.entries(l).map(([C,w])=>t.jsx(a.MenuItem,{value:C,children:t.jsx(xe,{enumKey:C,enumValues:l,small:!0})},`select_${e}_${C}`))},`filter-select-${v}-${e}`)]})}),f!==void 0&&t.jsx(a.Box,{ml:1,children:t.jsx(a.IconButton,{onClick:C=>y(g,void 0),size:"small",children:t.jsx(vo.default,{title:`Clear ${s}`,children:t.jsx(Ie.default,{fontSize:"small"})})})})]})}const Fs=J.default(e=>K.default({formControl:{width:"200px"},label:{width:"100%",height:"100%"}}));function As({name:e,title:o,value:r,setValue:i}){const n=Fs();function l(c){i(c!==void 0?["==",c]:void 0)}const s=r&&r[1],d=!!r;return t.jsx(a.FormControlLabel,{className:n.formControl,labelPlacement:"end",checked:d&&s,control:t.jsx(a.Checkbox,{indeterminate:!d,onChange:c=>{l(s?!1:d?void 0:!0)}},`filter-${e}`),label:d?s?`${o} is true`:`${o} is false`:"No filter"})}const $s={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"in","array-contains":"Contains","array-contains-any":"Any"},xr=["array-contains-any","in"];function Os({name:e,isArray:o,value:r,setValue:i,title:n}){const l=o?["array-contains"]:["==","!=",">","<",">=","<="],[s,d]=r||[l[0],void 0],[c,u]=p.useState(s),[g,h]=p.useState(d);function f(b,y){let v=y;const C=xr.includes(c),w=xr.includes(b);C!==w&&(v=w?y?[y]:[]:""),u(b),h(v===null?void 0:v);const m=v!==null&&Array.isArray(v)?v.length>0:v!==void 0;i(b&&m?[b,v]:void 0)}return t.jsxs(a.Box,{display:"flex",width:340,alignItems:"center",children:[t.jsx(a.Box,{width:80,children:t.jsx(a.FormControl,{fullWidth:!0,children:t.jsx(a.Select,{value:c,fullWidth:!0,onChange:b=>{f(b.target.value,g)},children:l.map(b=>t.jsx(a.MenuItem,{value:b,children:$s[b]},`filter_op_${e}_${b}`))})})}),t.jsx(a.Box,{flexGrow:1,ml:1,children:t.jsx(mt.default,{clearable:!0,InputProps:{},renderInput:b=>t.jsx(a.Input,{startAdornment:t.jsx(Si.default,{fontSize:"small"})}),value:g??null,onChange:b=>{f(c,b===null?void 0:b)}})}),g!==void 0&&t.jsx(a.Box,{ml:1,children:t.jsx(a.IconButton,{onClick:b=>f(c,void 0),size:"small",children:t.jsx(vo.default,{title:`Clear ${n}`,children:t.jsx(Ie.default,{fontSize:"small"})})})})]})}const Sr=J.default(e=>K.default({header:({onHover:o})=>({width:"calc(100% + 24px)",margin:"0px -12px",padding:"0px 12px",color:o?e.palette.text.primary:e.palette.text.secondary,backgroundColor:o?a.darken(e.palette.background.default,.05):e.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600}),headerInternal:({align:o})=>({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:o==="right"?"flex-end":o==="center"?"center":"flex-start"}),headerTitle:({align:o})=>({overflow:"hidden",flexShrink:1}),headerTitleInternal:({align:o})=>({margin:"0px 4px",overflow:"hidden",justifyContent:o,flexShrink:1}),headerIcon:{paddingTop:"4px"},headerIconButton:{backgroundColor:e.palette.mode==="light"?"#f5f5f5":e.palette.background.default},headerTypography:{fontSize:"0.750rem",fontWeight:600,textTransform:"uppercase"}})),Ds=z.default.memo(Ls);function Ls({sort:e,onColumnSort:o,onFilterUpdate:r,filter:i,column:n}){const[l,s]=p.useState(!1),d=p.useRef(null),c=Sr({onHover:l,align:n.align}),[u,g]=z.default.useState(!1),h=p.useCallback(y=>{g(!0)},[]),f=p.useCallback(()=>{g(!1)},[]),b=p.useCallback(y=>{r(y),g(!1)},[]);return t.jsxs(ne,{children:[t.jsxs(a.Grid,{className:c.header,ref:d,wrap:"nowrap",alignItems:"center",onMouseEnter:()=>s(!0),onMouseMove:()=>s(!0),onMouseLeave:()=>s(!1),container:!0,children:[t.jsx(a.Grid,{item:!0,xs:!0,className:c.headerTitle,children:t.jsxs("div",{className:c.headerInternal,children:[t.jsx("div",{className:c.headerIcon,children:n.icon&&n.icon(l||u)}),t.jsx("div",{className:c.headerTitleInternal,children:n.label})]})}),n.sortable&&(e||l||u)&&t.jsx(a.Grid,{item:!0,children:t.jsx(a.Badge,{color:"secondary",variant:"dot",overlap:"circular",invisible:!e,children:t.jsxs(a.IconButton,{size:"small",className:c.headerIconButton,onClick:()=>{o(n.key)},children:[!e&&t.jsx(bo.default,{fontSize:"small"}),e==="asc"&&t.jsx(bo.default,{fontSize:"small"}),e==="desc"&&t.jsx(mi.default,{fontSize:"small"})]})})}),n.filter&&t.jsx(a.Grid,{item:!0,children:t.jsx(a.Badge,{color:"secondary",variant:"dot",overlap:"circular",invisible:!i,children:t.jsx(a.IconButton,{className:c.headerIconButton,size:"small",onClick:h,children:t.jsx(xi.default,{fontSize:"small",color:l||u?void 0:"disabled"})})})})]}),n.sortable&&t.jsx(a.Popover,{id:u?`popover_${n.key}`:void 0,open:u,elevation:2,anchorEl:d.current,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsx(Ms,{column:n,filter:i,onFilterUpdate:b})})]})}function Ms({column:e,onFilterUpdate:o,filter:r}){const i=e.key,n=Sr({}),[l,s]=p.useState(r),d=h=>{o(l)},c=h=>{o(void 0)},u=!!r;function g(h,f,b,y){if(f.dataType==="number"||f.dataType==="string"){const v=f.dataType,C=f.title,w=f.enumValues;return t.jsx(Ps,{value:b,setValue:y,name:h,dataType:v,isArray:f.isArray,enumValues:w,title:C})}else if(f.dataType==="boolean"){const v=f.title;return t.jsx(As,{value:b,setValue:y,name:h,title:v})}else if(f.dataType==="timestamp"){const v=f.title;return t.jsx(Os,{value:b,setValue:y,name:h,isArray:f.isArray,title:v})}return t.jsx("div",{children:`Currently the field ${f.dataType} is not supported`})}return t.jsxs(t.Fragment,{children:[t.jsx(a.Box,{p:2,className:n.headerTypography,children:e.label??i}),t.jsx(a.Divider,{}),e.filter&&t.jsx(a.Box,{p:2,children:g(i,e.filter,l,s)}),t.jsxs(a.Box,{display:"flex",justifyContent:"flex-end",m:2,children:[t.jsx(a.Box,{mr:1,children:t.jsx(a.Button,{disabled:!u,color:"primary",type:"reset","aria-label":"filter clear",onClick:c,children:"Clear"})}),t.jsx(a.Button,{variant:"outlined",color:"primary",onClick:d,children:"Filter"})]})]})}const Ns=1200,qs=J.default(e=>K.default({tableContainer:{width:"100%",height:"100%",flexGrow:1},header:{width:"calc(100% + 24px)",margin:"0px -12px",padding:"0px 12px",color:e.palette.text.secondary,backgroundColor:e.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600},tableRow:{cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.875rem"},tableRowClickable:{"&:hover":{backgroundColor:e.palette.mode==="dark"?a.alpha(e.palette.background.default,.6):a.alpha(e.palette.background.default,.5)}},column:{padding:"0px !important"}}));function Tr({data:e,idColumnBuilder:o,onResetPagination:r,onEndReached:i,size:n,columns:l,frozenIdColumn:s,onRowClick:d,onColumnResize:c,filter:u,checkFilterCombination:g,collection:h,onFilterUpdate:f,sortBy:b,error:y,emptyMessage:v,onSortByUpdate:C,loading:w,hoverRow:m=!0}){const S=b?b[0]:void 0,_=b?b[1]:void 0,[k,I]=z.default.useState(),P=p.useRef(null),L=p.useRef(0),U=p.useRef(0),$=qs();p.useEffect(()=>{P.current&&e?.length&&P.current.scrollToTop(L.current)},[e?.length]);const T=j=>{const M=S===j&&_==="desc",oe=S===j&&_==="asc"?"desc":M?void 0:"asc",re=M?void 0:j,R=oe&&re?[re,oe]:void 0;u&&g&&!g(u,R)&&f&&f(void 0),r&&r(),C&&C(R),X()},[E,A]=z.default.useState(void 0),O=()=>{const j=document.querySelectorAll(".select-all")[0].getElementsByTagName("input")[0];E===void 0?(j.click(),setTimeout(()=>{j.click()},100)):j.click(),A(j.checked)},N=()=>{C&&C(void 0)},X=()=>{P.current&&(L.current=0,P.current.scrollToTop(0))},D=({scrollTop:j,scrollUpdateWasRequested:M})=>{const Z=Date.now()-U.current>3e3;!M&&Z&&(L.current=j)},B=()=>{U.current=Date.now(),i&&i()},q=j=>{!d||d(j)},F=({columnIndex:j})=>{const M=l[j-1],Z=M&&u&&u[M.key]?u[M.key]:void 0,oe=re=>{let R=u?{...u}:{};re?R[M.key]=re:delete R[M.key],!g||g(R,S&&_?[S,_]:void 0)||(R=re?{[M.key]:re}:{}),f&&f(R),M.key!==S&&N()};return t.jsx(ne,{children:j===0?t.jsxs("div",{className:$.header,style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",padding:0},children:[t.jsx("p",{style:{margin:0,width:"45px"},children:"ID"}),t.jsx(a.Tooltip,{title:"Select All",className:"select-all",children:t.jsx(a.Checkbox,{checked:E,onChange:O})})]}):t.jsx(Ds,{onFilterUpdate:oe,filter:Z,sort:S===M.key?_:void 0,onColumnSort:T,column:M})})};function Y(){return t.jsxs(a.Box,{display:"flex",flexDirection:"column",justifyContent:"center",margin:6,children:[t.jsx(a.Typography,{variant:"h6",children:"Error fetching data from the data source"}),y?.name&&t.jsx(a.Typography,{children:y?.name}),y?.message&&t.jsx(a.Typography,{children:y?.message})]})}function H(){return w?t.jsx(Ee,{}):t.jsxs(a.Box,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",padding:2,children:[t.jsx(a.Box,{padding:1,children:t.jsx(Ci.default,{})}),t.jsx(a.Typography,{children:v})]})}const W=p.useCallback(({column:j,width:M})=>{c&&c({width:M,key:j.key,column:j})},[c]);return t.jsx(t.Fragment,{children:t.jsx(po.default,{bounds:!0,onResize:I,children:({measureRef:j})=>t.jsx("div",{ref:j,className:$.tableContainer,css:Is,children:k?.bounds&&t.jsxs(wi.default,{rowClassName:ue.default($.tableRow,{[$.tableRowClickable]:m}),data:e,onColumnResizeEnd:W,width:k.bounds.width,height:k.bounds.height,emptyRenderer:y?Y():H(),fixed:!0,ignoreFunctionInColumnCompare:!1,rowHeight:Vt(n),ref:P,onScroll:D,overscanRowCount:2,onEndReachedThreshold:Ns,onEndReached:B,rowEventHandlers:{onClick:q},children:[t.jsx(yt.Column,{headerRenderer:F,cellRenderer:({rowData:M})=>o?o({size:n,entry:M}):null,align:"center",dataKey:"id",flexShrink:0,frozen:s?"left":void 0,width:160},"header-id"),l.map(M=>t.jsx(yt.Column,{title:M.label,className:$.column,headerRenderer:F,cellRenderer:M.cellRenderer,height:Vt(n),align:M.align,flexGrow:1,flexShrink:0,resizable:!0,size:n,dataKey:M.key,width:M.width},M.key))]})})})})}const kr=()=>p.useContext(So);function zs(){return t.jsx(a.Box,{display:"flex",width:"100%",height:"100%",children:t.jsxs(a.Box,{m:"auto",children:[t.jsx(a.Typography,{variant:"h4",align:"center",gutterBottom:!0,children:"Page not found"}),t.jsx(a.Typography,{align:"center",children:"This page does not exist or you may not have access to it"})]})})}function _r({HomePage:e}){const o=se.useLocation(),r=Te(),i=r.navigation;if(!i)return t.jsx(t.Fragment,{});const n=o.state,l=n&&n.base_location?n.base_location:o,s=[];if(i.views){const g=(h,f)=>t.jsx(se.Route,{path:h,element:t.jsx(ro,{path:h,title:f.name,children:f.view},`navigation_${h}`)},"navigation_view_"+h);i.views.forEach(h=>{Array.isArray(h.path)?s.push(...h.path.map(f=>g(f,h))):s.push(g(h.path,h))})}const d=[...i.collections].sort((g,h)=>h.path.length-g.path.length).map(g=>{const h=r.buildUrlCollectionPath(g.path);return t.jsx(se.Route,{path:h+"/*",element:t.jsx(ro,{path:h,title:g.name,children:t.jsx(pt,{path:g.path,collection:g})})},`navigation_${g.path}`)}),c=t.jsx(se.Route,{path:"/",element:t.jsx(ro,{path:"/",title:"Home",children:e?t.jsx(e,{}):t.jsx(mr,{})},"navigation_home")}),u=t.jsx(se.Route,{path:"*",element:t.jsx(zs,{})});return t.jsxs(se.Routes,{location:l,children:[d,s,c,u]})}function ro({children:e,title:o,path:r}){const i=kr();return z.default.useEffect(()=>{i.set({breadcrumbs:[{title:o,url:r}]})},[r,o]),t.jsx(t.Fragment,{children:e})}function Er(){return t.jsxs("svg",{width:"232",height:"232",viewBox:"0 0 599 599",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[t.jsxs("defs",{children:[t.jsxs("radialGradient",{cx:"28.6213569%",cy:"43.1133328%",fx:"28.6213569%",fy:"43.1133328%",r:"71.5003456%",gradientTransform:"translate(0.286214,0.431133),rotate(3.343450),scale(1.000000,0.996175),translate(-0.286214,-0.431133)",id:"radialGradient-1",children:[t.jsx("stop",{stopColor:"#FF5B79",offset:"0%"}),t.jsx("stop",{stopColor:"#FA5574",offset:"28.0930803%"}),t.jsx("stop",{stopColor:"#EC4C51",offset:"44.7242531%"}),t.jsx("stop",{stopColor:"#9543C1",offset:"71.4578165%"}),t.jsx("stop",{stopColor:"#3857B3",offset:"100%"})]}),t.jsxs("radialGradient",{cx:"53.6205516%",cy:"47.2473036%",fx:"53.6205516%",fy:"47.2473036%",r:"50.8229649%",gradientTransform:"translate(0.536206,0.472473),rotate(90.000000),scale(1.000000,1.206631),translate(-0.536206,-0.472473)",id:"radialGradient-2",children:[t.jsx("stop",{stopColor:"#68294F",stopOpacity:"0",offset:"0%"}),t.jsx("stop",{stopColor:"#5E2548",stopOpacity:"0.04641108",offset:"75.3503173%"}),t.jsx("stop",{stopColor:"#0D060B",stopOpacity:"0.437431709",offset:"100%"})]}),t.jsxs("radialGradient",{cx:"53.8605015%",cy:"48.1990423%",fx:"53.8605015%",fy:"48.1990423%",r:"59.9151549%",gradientTransform:"translate(0.538605,0.481990),rotate(180.000000),scale(1.000000,0.925027),translate(-0.538605,-0.481990)",id:"radialGradient-3",children:[t.jsx("stop",{stopColor:"#68294F",stopOpacity:"0",offset:"0%"}),t.jsx("stop",{stopColor:"#5E2548",stopOpacity:"0.04641108",offset:"84.0867343%"}),t.jsx("stop",{stopColor:"#FF0000",stopOpacity:"0.567324765",offset:"100%"})]})]}),t.jsx("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:t.jsxs("g",{id:"firecms_logo",children:[t.jsx("circle",{fill:"url(#radialGradient-1)",cx:"299.5",cy:"299.5",r:"299.5"}),t.jsx("circle",{fill:"url(#radialGradient-2)",cx:"299.5",cy:"299.5",r:"299.5"}),t.jsx("circle",{fill:"url(#radialGradient-3)",cx:"299.5",cy:"299.5",r:"299.5"})]})})]})}const Vs=J.default(e=>K.default({logo:{padding:e.spacing(3),maxWidth:280}}));function Ir({logo:e,closeDrawer:o}){const r=Vs(),i=Te(),{navigationEntries:n,groups:l}=p.useMemo(()=>_o(i,!1),[i]),s=Object.values(n).filter(u=>!u.group),d=p.useCallback((u,g,h)=>t.jsx(a.ListItem,{button:!0,component:se.NavLink,onClick:o,style:({isActive:f})=>({fontWeight:f?"600":"500",background:f?"rgba(128,128,128,0.1)":"inherit"}),to:h.url,children:t.jsx(a.Typography,{variant:"subtitle2",sx:{fontWeight:"inherit",py:.5},children:h.name.toUpperCase()})},`navigation_${u}`),[o]);let c;return e?c=t.jsx("img",{className:r.logo,src:e,alt:"Logo"}):c=t.jsx("div",{className:r.logo,children:t.jsx(Er,{})}),t.jsxs(t.Fragment,{children:[t.jsx(a.Link,{color:"inherit",onClick:o,component:se.NavLink,to:i.homeUrl,children:c},"breadcrumb-home"),t.jsxs(a.List,{children:[l.map(u=>t.jsxs(z.default.Fragment,{children:[t.jsx(a.Divider,{},`divider_${u}`),t.jsx(a.Box,{pt:2,pl:2,pr:2,pb:.5,children:t.jsx(a.Typography,{variant:"caption",color:"textSecondary",className:"weight-500",children:u.toUpperCase()})}),Object.values(n).filter(g=>g.group===u).map((g,h)=>d(h,u,g))]},`drawer_group_${u}`)),s.length>0&&t.jsx(a.Divider,{},"divider_ungrouped"),s.map((u,g)=>d(g,"none",u))]})]})}const Us=J.default(e=>K.default({appbar:{},menuButton:{marginRight:e.spacing(2)},breadcrumb:{backgroundColor:e.palette.grey[100],height:e.spacing(3),color:e.palette.grey[800],fontWeight:e.typography.fontWeightMedium,"&:hover, &:focus":{cursor:"pointer",backgroundColor:e.palette.grey[300]},"&:active":{boxShadow:e.shadows[1],backgroundColor:e.palette.grey[400]}}}));function Ws({title:e,handleDrawerToggle:o,toolbarExtraWidget:r}){const i=Us(),n=kr(),{breadcrumbs:l}=n,s=We(),{mode:d,toggleMode:c}=Lt(),u=s.user?.displayName?s.user.displayName[0].toUpperCase():s.user?.email?s.user.email[0].toUpperCase():"A";return t.jsx(a.Slide,{direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:t.jsx(a.AppBar,{className:i.appbar,position:"relative",elevation:1,children:t.jsxs(a.Toolbar,{children:[t.jsx(a.IconButton,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:o,className:i.menuButton,size:"large",children:t.jsx(Ti.default,{})}),t.jsx(a.Hidden,{lgDown:!0,children:t.jsx(a.Box,{mr:3,children:t.jsx(a.Link,{underline:"none",color:"inherit",component:se.Link,to:"/",children:t.jsx(a.Typography,{variant:"h6",noWrap:!0,children:e})},"breadcrumb-home")})}),t.jsx(a.Box,{mr:2,children:t.jsx(a.Breadcrumbs,{separator:t.jsx(Ei.default,{htmlColor:"rgb(0,0,0,0.87)",fontSize:"small"}),"aria-label":"breadcrumb",children:l.map((g,h)=>t.jsx(a.Link,{underline:"none",color:"inherit",component:se.Link,to:g.url,children:t.jsx(a.Chip,{classes:{root:i.breadcrumb},label:g.title})},`breadcrumb-${h}`))})}),t.jsx(a.Box,{flexGrow:1}),r&&t.jsx(ne,{children:r}),t.jsx(a.Box,{p:1,mr:1,children:t.jsx(a.IconButton,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:()=>c(),size:"large",children:d==="dark"?t.jsx(_i.default,{}):t.jsx(ki.default,{})})}),t.jsx(a.Box,{p:1,mr:1,children:s.user&&s.user.photoURL?t.jsx(a.Avatar,{src:s.user.photoURL}):t.jsx(a.Avatar,{children:u})}),t.jsx(a.Button,{variant:"text",color:"inherit",onClick:s.signOut,children:"Log Out"})]})})})}const Hs=vt.makeStyles(e=>vt.createStyles({main:{display:"flex",flexDirection:"column",width:"100vw",height:"100vh"},content:{flexGrow:1,width:"100%",height:"100%",overflow:"auto"},drawerPaper:{width:280}}));function Br(e){const{children:o,name:r,logo:i,toolbarExtraWidget:n,Drawer:l}=e,s=Hs(),d=Te(),[c,u]=z.default.useState(!1),g=()=>u(!c),h=()=>u(!1),f=l||Ir;return t.jsxs(t.Fragment,{children:[t.jsx("nav",{children:t.jsx(a.Drawer,{variant:"temporary",anchor:"left",open:c,onClose:h,classes:{paper:s.drawerPaper},ModalProps:{keepMounted:!0},children:d.navigation?t.jsx(f,{logo:i,closeDrawer:h}):t.jsx(Ee,{})})}),t.jsxs("div",{className:s.main,children:[t.jsx(Ws,{title:r,handleDrawerToggle:g,toolbarExtraWidget:n}),t.jsx("main",{className:s.content,children:o})]})]})}function js(e){const o=e.getBoundingClientRect(),r=a.ownerWindow(e);let i;if(e.fakeTransform)i=e.fakeTransform;else{const l=r.getComputedStyle(e);i=l.getPropertyValue("-webkit-transform")||l.getPropertyValue("transform")}let n=0;if(i&&i!=="none"&&typeof i=="string"){const l=i.split("(")[1].split(")")[0].split(",");n=parseInt(l[4],10)}return`translateX(${r.innerWidth}px) translateX(${n-o.left}px)`}function bt(e){const o=js(e);o&&(e.style.webkitTransform=o,e.style.transform=o)}const Gs=ie.forwardRef(function(o,r){const{children:i,in:n,timeout:l,onExitAnimation:s,...d}=o,c=a.useTheme(),u=ie.useRef(null),g=a.useForkRef(i.ref,u),h=a.useForkRef(g,r),f=m=>S=>{m&&(S===void 0?m(u.current):m(u.current,S))},b=f(m=>{bt(m),Ys(m)}),y=f(m=>{const S=Pr({timeout:l},{mode:"enter"});m.style.webkitTransition=c.transitions.create("-webkit-transform",{...S,easing:c.transitions.easing.easeOut}),m.style.transition=c.transitions.create("transform",{...S,easing:c.transitions.easing.easeOut}),m.style.webkitTransform="none",m.style.transform="none",m.style.opacity=1}),v=f(m=>{const S=Pr({timeout:l},{mode:"exit"});m.style.opacity=.5,m.style.webkitTransition=c.transitions.create(["-webkit-transform","opacity"],{...S,easing:c.transitions.easing.sharp}),m.style.transition=c.transitions.create(["transform","opacity"],{...S,easing:c.transitions.easing.sharp}),bt(m)}),C=f(m=>{m.style.webkitTransition="",m.style.transition=""}),w=ie.useCallback(()=>{u.current&&bt(u.current)},[]);return ie.useEffect(()=>{if(n)return;const m=a.debounce(()=>{u.current&&bt(u.current)}),S=a.ownerWindow(u.current);return S.addEventListener("resize",m),()=>{m.clear(),S.removeEventListener("resize",m)}},[n]),ie.useEffect(()=>{n||w()},[n,w]),t.jsx(Tn.Transition,{nodeRef:u,onEnter:b,onEntering:y,onExit:v,onExited:C,appear:!0,in:n,timeout:l,...d,children:(m,S)=>ie.cloneElement(i,{ref:h,style:{visibility:m==="exited"&&!n?"hidden":void 0,...i.props.style},...S})})}),Ys=e=>e.scrollTop;function Pr(e,o){const{timeout:r}=e;return{duration:typeof r=="number"?r:r[o.mode]||0}}const Xs=J.default(e=>K.default({root:{},paper:{height:"100%",WebkitOverflowScrolling:"touch",position:"fixed",outline:0},paperAnchorRight:({offsetPosition:o})=>({left:"auto",right:0}),modal:{}})),Fr={enter:225,exit:175},Ar=z.default.forwardRef(function(o,r){const{children:i,onClose:n,open:l,offsetPosition:s,onExitAnimation:d}=o,c=Xs({offsetPosition:s}),u=t.jsx(a.Paper,{elevation:1,square:!0,style:{transition:"transform 1000ms cubic-bezier(0.33, 1, 0.68, 1)",transform:`translateX(-${s*240}px)`},className:ue.default(c.paper,c.paperAnchorRight),children:i}),g=t.jsx(Gs,{in:l,timeout:Fr,onExitAnimation:d,children:u});return t.jsx(a.Modal,{BackdropProps:{transitionDuration:Fr},BackdropComponent:a.Backdrop,className:ue.default(c.root,c.modal),open:l,onClose:n,ref:r,keepMounted:!0,disableEnforceFocus:!0,children:g})}),$r="560px",Ye="100vw",no="55vw",Js=p.lazy(()=>Promise.resolve().then(function(){return _s})),Ks=p.lazy(()=>Promise.resolve().then(function(){return ss})),Zs=p.lazy(()=>Promise.resolve().then(function(){return la})),Qs=J.default(e=>K.default({container:({containerWidth:o})=>({display:"flex",flexDirection:"column",width:o,height:"100%",[e.breakpoints.down("sm")]:{width:Ye},transition:"width 250ms ease-in-out"}),containerWide:({containerWidth:o})=>({width:`calc(${no} + ${o})`,[e.breakpoints.down("lg")]:{width:Ye}}),subcollectionPanel:{width:no,height:"100%",overflow:"auto",borderLeft:`1px solid ${e.palette.divider}`,[e.breakpoints.down("lg")]:{borderLeft:"inherit",width:Ye}},tabsContainer:({containerWidth:o})=>({flexGrow:1,height:"100%",width:`calc(${no} + ${o})`,[e.breakpoints.down("lg")]:{width:Ye},display:"flex",overflow:"auto",flexDirection:"row"}),form:({containerWidth:o})=>({width:o,maxWidth:"100%",height:"100%",overflow:"auto",[e.breakpoints.down("sm")]:{maxWidth:Ye,width:Ye}}),tabBar:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1),paddingTop:e.spacing(0)},tab:{fontSize:"0.875rem",minWidth:"140px"}}));function Rs({path:e,entityId:o,callbacks:r,selectedSubpath:i,copy:n,permissions:l,schema:s,subcollections:d,onModifiedValues:c,width:u}){const g=typeof u=="number"?`${u}px`:u,h=Qs({containerWidth:g??$r}),f=_e(),b=Pe(),y=He(),v=ce(),C=We(),[w,m]=p.useState(n?"copy":o?"existing":"new"),[S,_]=p.useState(o),[k,I]=p.useState(!1),[P,L]=z.default.useState(-1),[U,$]=p.useState(),{entity:T,dataLoading:E,dataLoadingError:A}=st({path:e,entityId:S,schema:s,useCache:!1}),O=p.useMemo(()=>fe({schemaOrResolver:s,path:e,entityId:o,values:U,previousValues:T?.values}),[s,e,o,U]);p.useEffect(()=>{function G(ee){U&&(ee.preventDefault(),ee.returnValue=`You have unsaved changes in this ${O.name}. Are you sure you want to leave this page?`)}return typeof window<"u"&&window.addEventListener("beforeunload",G),()=>{typeof window<"u"&&window.removeEventListener("beforeunload",G)}},[U,window]);const N=O.views,X=N?.length??0;p.useEffect(()=>{T&&I(!eo(l,T,C,e,v))},[T,l]);const D=a.useTheme(),B=a.useMediaQuery(D.breakpoints.up("lg"));p.useEffect(()=>{if(i||L(-1),N){const G=N.map(ee=>ee.path).findIndex(ee=>ee===i);L(G)}if(d&&i){const G=d.map(ee=>ee.path).findIndex(ee=>ee===i);L(G+X)}},[i]);const q=p.useCallback(G=>{y.open({type:"error",title:"Error before saving",message:G?.message}),console.error(G)},[]),F=p.useCallback(G=>{y.open({type:"error",title:`${O.name}: Error after saving (entity is saved)`,message:G?.message}),console.error(G)},[]),Y=p.useCallback(G=>{_(G.id),y.open({type:"success",message:`${O.name}: Saved correctly`}),m("existing"),c(!1),P===-1&&b.close()},[]),H=p.useCallback(G=>{y.open({type:"error",title:`${O.name}: Error saving`,message:G?.message}),console.error("Error saving entity",e,o),console.error(G)},[]),W=p.useCallback(async({schema:G,path:ee,entityId:$e,values:ye,previousValues:et})=>{if(!!w)return Dt({path:ee,entityId:$e,callbacks:r,values:ye,previousValues:et,schema:G,status:w,dataSource:f,context:v,onSaveSuccess:Y,onSaveFailure:H,onPreSaveHookError:q,onSaveSuccessHookError:F})},[w,r,f,v,Y,H,q,F]),j=p.useCallback(()=>{P===-1&&b.close()},[b,P]),M=k?t.jsx(p.Suspense,{fallback:t.jsx(Ee,{}),children:t.jsx(Zs,{entity:T,path:e,schema:O})}):t.jsx(p.Suspense,{fallback:t.jsx(Ee,{}),children:t.jsx(Ks,{status:w,path:e,schemaOrResolver:s,onEntitySave:W,onDiscard:j,onValuesChanged:$,onModified:c,entity:T},`form_${e}_${T?.id??"new"}`)}),Z=N&&N.map((G,ee)=>t.jsx(a.Box,{className:h.subcollectionPanel,role:"tabpanel",flexGrow:1,height:"100%",width:"100%",hidden:P!==ee,children:t.jsx(ne,{children:G.builder({schema:O,entity:T,modifiedValues:U??T?.values})})},`custom_view_${G.path}_${ee}`)),oe=d&&d.map((G,ee)=>{const $e=T?`${T?.path}/${T?.id}/${le(G.path)}`:void 0;return t.jsx(a.Box,{className:h.subcollectionPanel,role:"tabpanel",flexGrow:1,hidden:P!==ee+X,children:T&&$e?t.jsx(p.Suspense,{fallback:t.jsx(Ee,{}),children:t.jsx(Js,{path:$e,collection:G})}):t.jsx(a.Box,{m:3,display:"flex",alignItems:"center",justifyContent:"center",children:t.jsx(a.Box,{children:"You need to save your entity before adding additional collections"})})},`subcol_${G.name}_${ee}`)}),re=p.useCallback(G=>{if(G!==-1){if(N&&G<X)return N[G].path;if(d)return d[G-X].path;throw Error("Something is wrong in getSelectedSubpath")}},[N]),R=p.useCallback(G=>{L(G),o&&b.open({path:e,entityId:o,selectedSubpath:re(G),overrideSchemaRegistry:!1})},[]),ve=t.jsxs(a.Box,{sx:{paddingLeft:2,paddingRight:2,paddingTop:2,display:"flex",alignItems:"center",backgroundColor:D.palette.mode==="light"?D.palette.background.default:D.palette.background.paper},children:[t.jsx(a.IconButton,{onClick:G=>b.close(),size:"large",children:t.jsx(Ii.default,{})}),t.jsx(a.Tabs,{value:P===-1?0:!1,indicatorColor:"secondary",textColor:"inherit",scrollButtons:"auto",children:t.jsx(a.Tab,{label:O.name,classes:{root:h.tab},wrapped:!0,onClick:()=>{R(-1)}})}),t.jsx(a.Box,{flexGrow:1}),E&&t.jsx(a.CircularProgress,{size:16,thickness:8}),t.jsxs(a.Tabs,{value:P>=0?P:!1,indicatorColor:"secondary",textColor:"inherit",onChange:(G,ee)=>{R(ee)},className:h.tabBar,variant:"scrollable",scrollButtons:"auto",children:[N&&N.map(G=>t.jsx(a.Tab,{classes:{root:h.tab},wrapped:!0,label:G.name},`entity_detail_custom_tab_${G.name}`)),d&&d.map(G=>t.jsx(a.Tab,{classes:{root:h.tab},wrapped:!0,label:G.name},`entity_detail_collection_tab_${G.name}`))]})]});return t.jsx("div",{className:ue.default(h.container,{[h.containerWide]:P!==-1}),children:E?t.jsx(Ee,{}):t.jsxs(t.Fragment,{children:[ve,t.jsx(a.Divider,{}),t.jsxs("div",{className:h.tabsContainer,children:[t.jsx(a.Box,{role:"tabpanel",hidden:!B&&P!==-1,className:h.form,children:M}),Z,oe]})]})})}function ec(e,o){const[r,i]=z.default.useState(),{navigator:n}=z.default.useContext(se.UNSAFE_NavigationContext),l=se.useNavigate(),s=()=>{i(void 0)},d=()=>{o(),i(void 0),l(-1)},c=p.useCallback(({action:u,location:g,retry:h})=>{switch(u){case"REPLACE":{h();return}case"POP":i(g)}},[]);return z.default.useEffect(()=>{if(!e||r||!("block"in n))return;const u=n.block(g=>{const h={...g,retry(){u(),g.retry()}};c(h)});return u},[n,c,e,r]),{navigationWasBlocked:Boolean(r),handleCancel:s,handleOk:d}}function tc({open:e,handleOk:o,handleCancel:r,schemaName:i}){return t.jsxs(Bi.default,{open:e,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[t.jsx(Ai.default,{id:"alert-dialog-title",children:"Unsaved changes"}),t.jsxs(Fi.default,{children:[t.jsxs(wo.default,{id:"alert-dialog-description",children:["You have unsaved changes in this ",t.jsx("b",{children:i}),"."]}),t.jsx(wo.default,{id:"alert-dialog-description",children:"Are you sure you want to leave this page?"})]}),t.jsxs(Pi.default,{children:[t.jsx(yo.default,{onClick:r,autoFocus:!0,children:" Cancel "}),t.jsx(yo.default,{onClick:o,children:" Ok "})]})]})}function Or(){const o=Pe().sidePanels,r=[...o,void 0];return t.jsx(t.Fragment,{children:r.map((i,n)=>t.jsx(oc,{panel:i,offsetPosition:o.length-n-1},`side_entity_dialog_${n}`))})}function oc({panel:e,offsetPosition:o}){const[r,i]=p.useState(!1),[n,l]=p.useState(!1),{navigationWasBlocked:s,handleOk:d,handleCancel:c}=ec(r&&!n,()=>i(!1)),u=()=>{i(!1),l(!1),h.close()},g=()=>{l(!1)},h=Pe(),f=Te(),b=e?f.getCollectionResolver(e.path,e.entityId):void 0;if(e&&!b)throw Error("ERROR: You are trying to open an entity with no schema defined.");const y=p.useMemo(()=>{if(!!e)return fe({schemaOrResolver:b.schemaResolver,path:e.path,entityId:e.entityId})},[e,b]);return!e||!y?t.jsx(Ar,{open:!1,offsetPosition:o,children:t.jsx("div",{style:{width:$r}})}):t.jsxs(t.Fragment,{children:[t.jsx(Ar,{open:Boolean(e),onClose:()=>{r?l(!0):h.close()},offsetPosition:o,children:t.jsx(ne,{children:t.jsx(Rs,{...b,...e,schema:b.schemaResolver,onModifiedValues:i})})}),t.jsx(tc,{open:s||n,handleOk:n?u:d,handleCancel:n?g:c,schemaName:y.name})]})}const Dr=({mode:e,primaryColor:o,secondaryColor:r,fontFamily:i})=>({...a.createTheme({palette:{mode:e,background:{default:e==="dark"?"#242424":"#f6f7f8"},primary:{main:o||"#0070f4"},secondary:{main:r||so.pink["400"]},error:{main:so.red.A400}},typography:{fontFamily:i||'"Rubik", "Roboto", "Helvetica", "Arial", sans-serif',fontWeightMedium:500,h6:{fontWeight:500,fontSize:"1.15rem"}},components:{MuiButton:{styleOverrides:{root:{borderRadius:4}}},MuiTableRow:{styleOverrides:{root:{"&:last-child td":{borderBottom:0}}}},MuiTypography:{styleOverrides:{root:{"&.mono":{fontFamily:"'Space Mono', 'Lucida Console', monospace"},"&.weight-500":{fontWeight:500}}}},MuiInputBase:{styleOverrides:{root:{"&.mono":{fontFamily:"'Space Mono', 'Lucida Console', monospace"}}}}}})});function rc(e){return e}function nc(e){return e}function ic(e){return e}function lc(e){return e}function ac(e){return e}function sc(e){return e}function cc(e){return e}function dc(e){return e}function uc(e){return e}function fc(e){return e}const Lr=({firebaseApp:e,signInOptions:o})=>{const[r,i]=p.useState(void 0),[n,l]=p.useState(),[s,d]=p.useState(!0),[c,u]=p.useState(!0),[g,h]=p.useState(!1);function f(){h(!0),i(null)}p.useEffect(()=>{if(!e)return;const T=te.getAuth(e);return i(T.currentUser),te.onAuthStateChanged(T,b,E=>l(E))},[e]);const b=async T=>{i(T),d(!1),u(!1)};function y(){const T=te.getAuth(e);te.signOut(T).then(E=>{i(null),l(null)}),h(!1)}const v=T=>o.find(E=>{if(E===null)throw Error("useFirebaseAuthDelegate");if(typeof E=="object"&&E.provider===T)return E}),C=()=>{const T=new te.GoogleAuthProvider,E=v("google.com");E?.scopes&&E.scopes.forEach(O=>T.addScope(O)),E?.customParameters&&T.setCustomParameters(E.customParameters);const A=te.getAuth();te.signInWithPopup(A,T).catch(l)};function w(T,E){u(!0),te.signInWithPopup(T,E).catch(l).then(()=>u(!1))}return{user:r??null,authError:n,authLoading:c,initialLoading:s,signOut:y,loginSkipped:g,skipLogin:f,googleLogin:C,anonymousLogin:()=>{const T=te.getAuth();u(!0),uo.signInAnonymously(T).catch(l).then(()=>u(!1))},appleLogin:()=>{const T=new te.OAuthProvider("apple.com"),E=v("apple.com");E?.scopes&&E.scopes.forEach(O=>T.addScope(O)),E?.customParameters&&T.setCustomParameters(E.customParameters);const A=te.getAuth();w(A,T)},facebookLogin:()=>{const T=new te.FacebookAuthProvider,E=v("facebook.com");E?.scopes&&E.scopes.forEach(O=>T.addScope(O)),E?.customParameters&&T.setCustomParameters(E.customParameters);const A=te.getAuth();w(A,T)},githubLogin:()=>{const T=new te.GithubAuthProvider,E=v("github.com");E?.scopes&&E.scopes.forEach(O=>T.addScope(O)),E?.customParameters&&T.setCustomParameters(E.customParameters);const A=te.getAuth();w(A,T)},microsoftLogin:()=>{const T=new te.OAuthProvider("microsoft.com"),E=v("microsoft.com");E?.scopes&&E.scopes.forEach(O=>T.addScope(O)),E?.customParameters&&T.setCustomParameters(E.customParameters);const A=te.getAuth();w(A,T)},twitterLogin:()=>{const T=new te.TwitterAuthProvider,E=v("twitter.com");E?.customParameters&&T.setCustomParameters(E.customParameters);const A=te.getAuth();w(A,T)},emailPasswordLogin:(T,E)=>{const A=te.getAuth();u(!0),te.signInWithEmailAndPassword(A,T,E).catch(l).then(()=>u(!1))},fetchSignInMethodsForEmail:T=>{const E=te.getAuth();return u(!0),te.fetchSignInMethodsForEmail(E,T).then(A=>(u(!1),A))},createUserWithEmailAndPassword:(T,E)=>{const A=te.getAuth();u(!0),uo.createUserWithEmailAndPassword(A,T,E).catch(l).then(()=>u(!1))}}};function Mr({firebaseApp:e,textSearchController:o}){const r=p.useRef(),i=r.current;p.useEffect(()=>{!e||(r.current=Q.getFirestore(e))},[e]);function n(c,u,g){const h=Nr(c.data()),f=c.data()?g.properties?vl(h,g.properties):c.data():void 0;return{id:c.id,path:qr(c.ref.path),values:f}}function l(c,u,g,h,f,b){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");const y=Q.collection(i,c),v=[];return u&&Object.entries(u).filter(([C,w])=>!!w).forEach(([C,w])=>{const[m,S]=w;v.push(Q.where(C,m,io(S,i)))}),u&&g&&h&&Object.entries(u).forEach(([C,w])=>{C!==g&&v.push(Q.orderBy(C,"asc"))}),g&&h&&v.push(Q.orderBy(g,h)),f&&v.push(Q.startAfter(f)),b&&v.push(Q.limit(b)),Q.query(y,...v)}function s(c,u,g){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");return Q.getDoc(Q.doc(i,c,u)).then(h=>{const f=fe({schemaOrResolver:g,entityId:h.id,path:c});return n(h,c,f)})}async function d(c,u,g){if(!o)throw Error("Trying to make text search without specifying a FirestoreTextSearchController");const h=await o({path:c,searchString:u});if(h===void 0)throw Error("The current path is not supported by the specified FirestoreTextSearchController");const f=h.map(async b=>{try{return await s(c,b,g)}catch(y){return console.error(y),null}});return Promise.all(f).then(b=>b.filter(y=>y!==null&&y.values))}return{fetchCollection({path:c,schema:u,filter:g,limit:h,startAfter:f,searchString:b,orderBy:y,order:v}){if(b)return d(c,b,u);console.debug("Fetching collection",c,h,g,f,y,v);const C=l(c,g,y,v,f,h),w=fe({schemaOrResolver:u,path:c});return Q.getDocs(C).then(m=>m.docs.map(S=>n(S,c,w)))},listenCollection({path:c,schema:u,filter:g,limit:h,startAfter:f,searchString:b,orderBy:y,order:v,onUpdate:C,onError:w}){console.debug("Listening collection",c,h,g,f,y,v);const m=l(c,g,y,v,f,h);if(b)return d(c,b,u).then(C).catch(_=>{w&&w(_)}),()=>{};const S=fe({schemaOrResolver:u,path:c});return Q.onSnapshot(m,{next:_=>{C(_.docs.map(k=>n(k,c,S)))},error:w})},fetchEntity({path:c,entityId:u,schema:g}){return s(c,u,g)},listenEntity({path:c,entityId:u,schema:g,onUpdate:h,onError:f}){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");return Q.onSnapshot(Q.doc(i,c,u),{next:b=>{const y=fe({schemaOrResolver:g,entityId:b.id,path:c});h(n(b,c,y))},error:f})},saveEntity:async function({path:c,entityId:u,values:g,schema:h,status:f}){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");const y=fe({schemaOrResolver:h,entityId:u,path:c}).properties,v=Q.collection(i,c),C=bl({inputValues:g,properties:y,status:f,timestampNowValue:Q.serverTimestamp(),referenceConverter:m=>Q.doc(i,m.path,m.id),geopointConverter:m=>new Q.GeoPoint(m.latitude,m.longitude)});console.debug("Saving entity",c,u,C);let w;return u?w=Q.doc(v,u):w=Q.doc(v),Q.setDoc(w,C,{merge:!0}).then(()=>({id:w.id,path:w.path,values:Nr(C)}))},async deleteEntity({entity:c}){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");return Q.deleteDoc(Q.doc(i,c.path,c.id))},checkUniqueField(c,u,g,h,f){if(!i)throw Error("useFirestoreDataSource Firestore not initialised");if(console.debug("Check unique field entity",c,u,g,f),h.dataType==="array"&&console.error("checkUniqueField received an array"),g==null)return Promise.resolve(!0);const b=Q.query(Q.collection(i,c),Q.where(u,"==",g));return Q.getDocs(b).then(y=>y.docs.filter(v=>v.id!==f).length===0)}}}function Nr(e){const o=r=>{if(r==null)return r;if(Q.serverTimestamp().isEqual(r))return null;if(r instanceof Q.Timestamp)return r.toDate();if(r instanceof Ne)return new Ne(r.latitude,r.longitude);if(r instanceof Q.DocumentReference)return new ke(r.id,qr(r.path));if(Array.isArray(r))return r.map(o);if(typeof r=="object"){const i={};for(const n of Object.keys(r))i[n]=o(r[n]);return i}return r};return o(e)}function io(e,o){return Array.isArray(e)?e.map(r=>io(r,o)):e instanceof ke?Q.doc(o,e.path,e.id):e instanceof Ne?new Q.GeoPoint(e.latitude,e.longitude):typeof e=="object"?Object.entries(e).map(([r,i])=>({[r]:io(i,o)})).reduce((r,i)=>({...r,...i}),{}):e}function qr(e){let o=e.lastIndexOf("/");return o=o===-1?e.length:o,e.substring(0,o)}function zr({firebaseApp:e}){const[o,r]=p.useState();p.useEffect(()=>{!e||r(Ke.getStorage(e))},[e]);const i={};return{uploadFile({file:n,fileName:l,path:s,metadata:d}){if(!o)throw Error("useFirebaseStorageSource Firebase not initialised");const c=l??n.name;return console.debug("Uploading file",c,n,s,d),Ke.uploadBytes(Ke.ref(o,`${s}/${c}`),n,d).then(u=>({path:u.ref.fullPath}))},getDownloadURL(n){if(!o)throw Error("useFirebaseStorageSource Firebase not initialised");if(i[n])return i[n];const l=Ke.getDownloadURL(Ke.ref(o,n));return i[n]=l,l}}}function Vr({firebaseConfig:e,onFirebaseInit:o}){const[r,i]=z.default.useState(),[n,l]=z.default.useState(!1),[s,d]=z.default.useState(),[c,u]=z.default.useState(),g=p.useCallback(h=>{try{const f=ri.initializeApp(h);u(void 0),l(!1),o&&o(h),i(f)}catch(f){console.error(f),u(f)}},[o]);return p.useEffect(()=>{l(!0),e?(console.log("Using specified config",e),g(e)):fetch("/__/firebase/init.json").then(async h=>{if(console.debug("Firebase init response",h.status),h&&h.status<300){const f=await h.json();console.log("Using configuration fetched from Firebase Hosting",f),g(f)}}).catch(h=>{l(!1),d("Could not load Firebase configuration from Firebase hosting. If the app is not deployed in Firebase hosting, you need to specify the configuration manually"+h.toString())})},[e,g]),{firebaseApp:r,firebaseConfigLoading:n,configError:s,firebaseConfigError:c}}const hc=e=>t.jsx(t.Fragment,{children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:32,height:32,children:[t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJb",x1:"29.401",x2:"29.401",y1:"4.064",y2:"106.734",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#ff5840"}),t.jsx("stop",{offset:".007",stopColor:"#ff5840"}),t.jsx("stop",{offset:".989",stopColor:"#fa528c"}),t.jsx("stop",{offset:"1",stopColor:"#fa528c"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJb)",d:"M47.46,15.5l-1.37,1.48c-1.34,1.44-3.5,1.67-5.15,0.6c-2.71-1.75-6.43-3.13-11-2.37 c-4.94,0.83-9.17,3.85-11.64, 7.97l-8.03-6.08C14.99,9.82,23.2,5,32.5,5c5,0,9.94,1.56,14.27,4.46 C48.81,10.83,49.13,13.71,47.46,15.5z"}),t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJc",x1:"12.148",x2:"12.148",y1:".872",y2:"47.812",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#feaa53"}),t.jsx("stop",{offset:".612",stopColor:"#ffcd49"}),t.jsx("stop",{offset:"1",stopColor:"#ffde44"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJc)",d:"M16.01,30.91c-0.09,2.47,0.37,4.83,1.27,6.96l-8.21,6.05c-1.35-2.51-2.3-5.28-2.75-8.22 c-1.06-6.88,0.54-13.38, 3.95-18.6l8.03,6.08C16.93,25.47,16.1,28.11,16.01,30.91z"}),t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJd",x1:"29.76",x2:"29.76",y1:"32.149",y2:"-6.939",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#42d778"}),t.jsx("stop",{offset:".428",stopColor:"#3dca76"}),t.jsx("stop",{offset:"1",stopColor:"#34b171"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJd)",d:"M50.45,51.28c-4.55,4.07-10.61,6.57-17.36,6.71C22.91,58.2,13.66,52.53,9.07,43.92l8.21-6.05 C19.78,43.81, 25.67,48,32.5,48c3.94,0,7.52-1.28,10.33-3.44L50.45,51.28z"}),t.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJe",x1:"46",x2:"46",y1:"3.638",y2:"35.593",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0",stopColor:"#155cde"}),t.jsx("stop",{offset:".278",stopColor:"#1f7fe5"}),t.jsx("stop",{offset:".569",stopColor:"#279ceb"}),t.jsx("stop",{offset:".82",stopColor:"#2cafef"}),t.jsx("stop",{offset:"1",stopColor:"#2eb5f0"})]}),t.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJe)",d:"M59,31.97c0.01,7.73-3.26,14.58-8.55,19.31l-7.62-6.72c2.1-1.61,3.77-3.71,4.84-6.15 c0.29-0.66-0.2-1.41-0.92-1.41H37c-2.21,0-4-1.79-4-4v-2c0-2.21,1.79-4,4-4h17C56.75,27,59,29.22,59,31.97z"})]})}),gc=e=>t.jsx("svg",{width:32,height:32,viewBox:"0 0 56 56",style:{transform:"scale(2.8)"},version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("g",{stroke:e==="light"?"#424245":"white",strokeWidth:"0.5",fillRule:"evenodd",children:t.jsx("path",{d:"M28.2226562,20.3846154 C29.0546875,20.3846154 30.0976562,19.8048315 30.71875,19.0317864 C31.28125,18.3312142 31.6914062,17.352829 31.6914062,16.3744437 C31.6914062,16.2415766 31.6796875,16.1087095 31.65625,16 C30.7304687,16.0362365 29.6171875,16.640178 28.9492187,17.4494596 C28.421875,18.06548 27.9414062,19.0317864 27.9414062,20.0222505 C27.9414062,20.1671964 27.9648438,20.3121424 27.9765625,20.3604577 C28.0351562,20.3725366 28.1289062,20.3846154 28.2226562,20.3846154 Z M25.2929688,35 C26.4296875,35 26.9335938,34.214876 28.3515625,34.214876 C29.7929688,34.214876 30.109375,34.9758423 31.375,34.9758423 C32.6171875,34.9758423 33.4492188,33.792117 34.234375,32.6325493 C35.1132812,31.3038779 35.4765625,29.9993643 35.5,29.9389701 C35.4179688,29.9148125 33.0390625,28.9122695 33.0390625,26.0979021 C33.0390625,23.6579784 34.9140625,22.5588048 35.0195312,22.474253 C33.7773438,20.6382708 31.890625,20.5899555 31.375,20.5899555 C29.9804688,20.5899555 28.84375,21.4596313 28.1289062,21.4596313 C27.3554688,21.4596313 26.3359375,20.6382708 25.1289062,20.6382708 C22.8320312,20.6382708 20.5,22.5950413 20.5,26.2911634 C20.5,28.5861411 21.3671875,31.013986 22.4335938,32.5842339 C23.3476562,33.9129053 24.1445312,35 25.2929688,35 Z",fill:e==="light"?"#424245":"white",fillRule:"nonzero"})})}),pc=e=>t.jsx("svg",{fill:e==="light"?"#1c1e21":"white",role:"img",viewBox:"0 0 24 24",width:28,height:28,xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"})}),bc=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 90 90",children:t.jsx("g",{children:t.jsx("path",{d:"M90,15.001C90,7.119,82.884,0,75,0H15C7.116,0,0,7.119,0,15.001v59.998   C0,82.881,7.116,90,15.001,90H45V56H34V41h11v-5.844C45,25.077,52.568,16,61.875,16H74v15H61.875C60.548,31,59,32.611,59,35.024V41   h15v15H59v34h16c7.884,0,15-7.119,15-15.001V15.001z",fill:e==="light"?"#39569c":"white"})})}),vc=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 480 480",children:t.jsx("g",{children:t.jsx("path",{d:"M0.176,224L0.001,67.963l192-26.072V224H0.176z M224.001,37.241L479.937,0v224H224.001V37.241z M479.999,256l-0.062,224   l-255.936-36.008V256H479.999z M192.001,439.918L0.157,413.621L0.147,256h191.854V439.918z",fill:e==="light"?"#00a2ed":"white"})})}),yc=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 24 24",children:t.jsx("path",{fill:e==="light"?"#00acee":"white",d:"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"})}),wc=J.default(e=>K.default({logo:{padding:e.spacing(3),width:260,height:260}}));function Ur({allowSkipLogin:e,logo:o,signInOptions:r,firebaseApp:i,authDelegate:n,NoUserComponent:l,disableSignupScreen:s=!1}){const d=wc(),c=We(),u=Lt(),[g,h]=p.useState(!1),f=r.map(C=>typeof C=="object"?C.provider:C);function b(){let C;const w=["auth/popup-closed-by-user","auth/cancelled-popup-request"];return n.authError&&(n.authError.code==="auth/operation-not-allowed"?C=t.jsxs(t.Fragment,{children:[t.jsx(a.Box,{p:1,children:t.jsx(me,{error:"You need to enable the corresponding login provider in your Firebase project"})}),i&&t.jsx(a.Box,{p:1,children:t.jsx("a",{href:`https://console.firebase.google.com/project/${i.options.projectId}/authentication/providers`,rel:"noopener noreferrer",target:"_blank",children:t.jsx(a.Button,{variant:"text",color:"primary",children:"Open Firebase configuration"})})})]}):w.includes(n.authError.code)||(console.error(n.authError),C=t.jsx(a.Box,{p:1,children:t.jsx(me,{error:n.authError.message})}))),C}let y;o?y=t.jsx("img",{className:d.logo,src:o,alt:"Logo"}):y=t.jsx("div",{className:d.logo,children:t.jsx(Er,{})});let v;return c.notAllowedError&&(typeof c.notAllowedError=="string"?v=c.notAllowedError:c.notAllowedError instanceof Error?v=c.notAllowedError.message:v="It looks like you don't have access to the CMS, based on the specified Authenticator configuration"),t.jsx(a.Fade,{in:!0,timeout:500,mountOnEnter:!0,unmountOnExit:!0,children:t.jsx(a.Box,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",p:2},children:t.jsxs(a.Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",maxWidth:340},children:[t.jsx(a.Box,{m:1,children:y}),v&&t.jsx(a.Box,{p:2,children:t.jsx(me,{error:v})}),b(),!g&&t.jsxs(t.Fragment,{children:[Wr(n,f,u.mode),f.includes("password")&&t.jsx(Ae,{text:"Email/password",icon:t.jsx(Ri.default,{fontSize:"large"}),onClick:()=>h(!0)}),f.includes("anonymous")&&t.jsx(Ae,{text:"Log in anonymously",icon:t.jsx(el.default,{fontSize:"large"}),onClick:n.anonymousLogin}),e&&t.jsx(a.Box,{m:1,children:t.jsx(a.Button,{onClick:n.skipLogin,children:"Skip login"})})]}),g&&t.jsx(Cc,{authDelegate:n,onClose:()=>h(!1),mode:u.mode,NoUserComponent:l,disableSignupScreen:s})]})})})}function Ae({icon:e,onClick:o,text:r}){return t.jsx(a.Box,{m:.5,width:"100%",children:t.jsx(a.Button,{fullWidth:!0,variant:"outlined",onClick:o,children:t.jsxs(a.Box,{sx:{p:"1",display:"flex",width:"240px",height:"32px",alignItems:"center",justifyItems:"center"},children:[t.jsx(a.Box,{sx:{display:"flex",flexDirection:"column",width:"32px",alignItems:"center",justifyItems:"center"},children:e}),t.jsx(a.Box,{sx:{flexGrow:1,pl:2,textAlign:"center"},children:r})]})})})}function Cc({onClose:e,authDelegate:o,mode:r,NoUserComponent:i,disableSignupScreen:n}){const l=p.useRef(null),[s,d]=p.useState(),[c,u]=p.useState(),[g,h]=p.useState(),f=c===void 0,b=c&&c.includes("password"),y=c&&!c.includes("password")&&c.length>0,v=c&&!c.includes("password");p.useEffect(()=>{console.log("loginMode",b),(b||v)&&l.current&&l.current.focus()},[b,v]),p.useEffect(()=>{if(!document)return;const P=L=>{L.keyCode===27&&e()};return document.addEventListener("keydown",P,!1),()=>{document.removeEventListener("keydown",P,!1)}},[document]);function C(){s&&o.fetchSignInMethodsForEmail(s).then(P=>{console.log(P),u(P)})}function w(){s&&g&&o.emailPasswordLogin(s,g)}function m(){s&&g&&o.createUserWithEmailAndPassword(s,g)}const S=()=>{f?e():u(void 0)},_=P=>{P.preventDefault(),f?C():b?w():v&&m()},k=v?"No user found with that email. Pick a password to create a new account":b?"Please enter your password":"Please enter your email",I=v?"Create account":b?"Login":"Ok";return y?t.jsxs(a.Grid,{container:!0,spacing:1,children:[t.jsx(a.Grid,{item:!0,xs:12,children:t.jsx(a.IconButton,{onClick:S,children:t.jsx(mo.default,{sx:{width:20,height:20}})})}),t.jsxs(a.Grid,{item:!0,xs:12,sx:{p:1},children:[t.jsx(a.Typography,{align:"center",variant:"subtitle2",children:"You already have an account"}),t.jsxs(a.Typography,{align:"center",variant:"body2",children:["You can use one of these methods to login with ",s]})]}),t.jsx(a.Grid,{item:!0,xs:12,children:c&&Wr(o,c,r)})]}):t.jsx(a.Slide,{direction:"up",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:t.jsx("form",{onSubmit:_,children:t.jsxs(a.Grid,{container:!0,spacing:1,children:[t.jsx(a.Grid,{item:!0,xs:12,children:t.jsx(a.IconButton,{onClick:S,children:t.jsx(mo.default,{sx:{width:20,height:20}})})}),t.jsx(a.Grid,{item:!0,xs:12,sx:{p:1,display:v&&n?"none":"flex"},children:t.jsx(a.Typography,{align:"center",variant:"subtitle2",children:k})}),t.jsx(a.Grid,{item:!0,xs:12,sx:{display:f?"inherit":"none"},children:t.jsx(a.TextField,{placeholder:"Email",fullWidth:!0,autoFocus:!0,value:s,disabled:o.authLoading,type:"email",onChange:P=>d(P.target.value)})}),t.jsx(a.Grid,{item:!0,xs:12,children:v&&i}),t.jsx(a.Grid,{item:!0,xs:12,sx:{display:b||v&&!n?"inherit":"none"},children:t.jsx(a.TextField,{placeholder:"Password",fullWidth:!0,value:g,disabled:o.authLoading,inputRef:l,type:"password",onChange:P=>h(P.target.value)})}),t.jsx(a.Grid,{item:!0,xs:12,children:t.jsxs(a.Box,{sx:{display:v&&n?"none":"flex",justifyContent:"end",alignItems:"center",width:"100%"},children:[o.authLoading&&t.jsx(a.CircularProgress,{sx:{p:1},size:16,thickness:8}),t.jsx(a.Button,{type:"submit",children:I})]})})]})})})}function Wr(e,o,r){return t.jsxs(t.Fragment,{children:[o.includes("google.com")&&t.jsx(Ae,{text:"Sign in with Google",icon:hc(),onClick:e.googleLogin}),o.includes("microsoft.com")&&t.jsx(Ae,{text:"Sign in with Microsoft",icon:vc(r),onClick:e.microsoftLogin}),o.includes("apple.com")&&t.jsx(Ae,{text:"Sign in with Apple",icon:gc(r),onClick:e.appleLogin}),o.includes("github.com")&&t.jsx(Ae,{text:"Sign in with Github",icon:pc(r),onClick:e.githubLogin}),o.includes("facebook.com")&&t.jsx(Ae,{text:"Sign in with Facebook",icon:bc(r),onClick:e.facebookLogin}),o.includes("twitter.com")&&t.jsx(Ae,{text:"Sign in with Twitter",icon:yc(r),onClick:e.twitterLogin})]})}const Hr=[te.GoogleAuthProvider.PROVIDER_ID];function mc({name:e,logo:o,toolbarExtraWidget:r,authentication:i,schemaOverrideHandler:n,navigation:l,textSearchController:s,allowSkipLogin:d,signInOptions:c=Hr,firebaseConfig:u,onFirebaseInit:g,primaryColor:h,secondaryColor:f,fontFamily:b,dateTimeFormat:y,locale:v,HomePage:C,basePath:w,baseCollectionPath:m,LoginViewProps:S}){const{firebaseApp:_,firebaseConfigLoading:k,configError:I,firebaseConfigError:P}=Vr({onFirebaseInit:g,firebaseConfig:u}),L=Lr({firebaseApp:_,signInOptions:c}),U=Mr({firebaseApp:_,textSearchController:s}),$=zr({firebaseApp:_});return I?t.jsxs("div",{children:[" ",I," "]}):P?t.jsx("div",{children:"It seems like the provided Firebase config is not correct. If you are using the credentials provided automatically by Firebase Hosting, make sure you link your Firebase app to Firebase Hosting."}):k||!_?t.jsxs(t.Fragment,{children:[t.jsx(a.CssBaseline,{}),t.jsx(Ee,{})]}):t.jsx(se.BrowserRouter,{basename:w,children:t.jsx($o,{navigation:l,authDelegate:L,authentication:i,schemaOverrideHandler:n,dateTimeFormat:y,dataSource:U,storageSource:$,entityLinkBuilder:({entity:T})=>`https://console.firebase.google.com/project/${_.options.projectId}/firestore/data/${T.path}/${T.id}`,locale:v,basePath:w,baseCollectionPath:m,children:({context:T,mode:E,loading:A})=>{const O=Dr({mode:E,primaryColor:h,secondaryColor:f,fontFamily:b});let N;return A?N=t.jsx(Ee,{}):T.authController.canAccessMainView?N=t.jsxs(Br,{name:e,logo:o,toolbarExtraWidget:r,children:[t.jsx(_r,{HomePage:C}),t.jsx(Or,{})]}):N=t.jsx(Ur,{logo:o,allowSkipLogin:d,signInOptions:c??Hr,firebaseApp:_,authDelegate:L,...S}),t.jsxs(a.ThemeProvider,{theme:O,children:[t.jsx(a.CssBaseline,{}),N]})}})})}function xc(e,o){return console.log("Performing Algolia query",e,o),e.search(o).then(({hits:r})=>r.map(i=>i.objectID)).catch(r=>(console.log(r),[]))}x.ArrayContainer=ft,x.ArrayDefaultField=sr,x.ArrayEnumPreview=it,x.ArrayEnumSelect=nr,x.ArrayOfMapsPreview=qo,x.ArrayOfReferencesField=ur,x.ArrayOfReferencesPreview=Jo,x.ArrayOfStorageComponentsPreview=Xo,x.ArrayOfStringsPreview=Lo,x.ArrayOneOfField=cr,x.ArrayOneOfPreview=Qo,x.ArrayPreview=Zo,x.ArrayPropertyEnumPreview=$t,x.AsyncPreviewComponent=kl,x.BooleanPreview=Mo,x.CircularProgressCenter=Ee,x.CollectionTable=Zt,x.CustomChip=Ft,x.DateTimeField=lr,x.Drawer=Ir,x.EmptyValue=ze,x.EntityCollectionView=pt,x.EntityForm=Kt,x.EntityPreview=dt,x.EntityReference=ke,x.ErrorView=me,x.FieldDescription=pe,x.FireCMS=$o,x.FireCMSHomePage=mr,x.FirebaseCMSApp=mc,x.FirebaseLoginView=Ur,x.GeoPoint=Ne,x.ImagePreview=No,x.LabelWithIcon=be,x.MapField=fr,x.MapPreview=Ko,x.Markdown=lt,x.MarkdownField=dr,x.NavigationRoutes=_r,x.NumberPreview=zo,x.PreviewComponent=de,x.ReadOnlyField=Jt,x.ReferenceDialog=ht,x.ReferenceField=ar,x.ReferencePreview=je,x.Scaffold=Br,x.Select=jt,x.SideEntityDialogs=Or,x.SkeletonComponent=Fe,x.StorageThumbnail=Yo,x.StorageUploadField=Yt,x.StringPreview=At,x.SwitchField=ir,x.Table=Tr,x.TextField=Xt,x.TimestampPreview=Ho,x.UrlComponentPreview=Mt,x.buildAdditionalColumnDelegate=fc,x.buildCollection=nc,x.buildEntityCallbacks=uc,x.buildEnumValueConfig=dc,x.buildEnumValues=cc,x.buildNavigation=rc,x.buildProperties=ac,x.buildPropertiesOrBuilder=sc,x.buildProperty=lc,x.buildPropertyField=Ge,x.buildSchema=ic,x.createCMSDefaultTheme=Dr,x.deleteEntityWithCallbacks=Vo,x.performAlgoliaTextSearch=xc,x.resolveNavigationFrom=Uo,x.saveEntityWithCallbacks=Dt,x.useAuthController=We,x.useClearRestoreValue=ge,x.useClipboard=Wo,x.useCollectionFetch=at,x.useDataSource=_e,x.useEntityFetch=st,x.useFireCMSContext=ce,x.useFirebaseAuthDelegate=Lr,x.useFirebaseStorageSource=zr,x.useFirestoreDataSource=Mr,x.useInitialiseFirebase=Vr,x.useModeState=Lt,x.useNavigation=Te,x.useResolvedNavigationFrom=ql,x.useSelectionController=to,x.useSideEntityController=Pe,x.useSnackbarController=He,x.useStorageSource=Ue,Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map
